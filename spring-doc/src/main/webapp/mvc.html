<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>16.&nbsp;Web MVC &#26694;&#26550;</title><link rel="stylesheet" type="text/css" href="css/manual-multipage.css"><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="index.html" title="Spring Framework Reference Documentation"><link rel="up" href="spring-web.html" title="Part&nbsp;V.&nbsp;The Web"><link rel="prev" href="spring-web.html" title="Part&nbsp;V.&nbsp;The Web"><link rel="next" href="view.html" title="17.&nbsp;View technologies"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">16.&nbsp;Web MVC &#26694;&#26550;</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="spring-web.html">Prev</a>&nbsp;</td><th width="60%" align="center">Part&nbsp;V.&nbsp;The Web</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="view.html">Next</a></td></tr></table><hr></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="mvc" href="#mvc"></a>16.&nbsp;Web MVC &#26694;&#26550;</h2></div></div></div>

<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="mvc-introduction" href="#mvc-introduction"></a>16.1&nbsp;Spring Web MVC &#26694;&#26550;&#20171;&#32461;</h2></div></div></div>

<p>Spring Web &#27169;&#22411;-&#35270;&#22270;-&#25511;&#21046;&#22120;(MVC) &#26694;&#26550;&#26159;&#22260;&#32469; <code class="literal">DispatcherServlet</code>&#32780;&#35774;&#35745;&#30340;&#65292;&#20854;&#25903;&#25345;&#21487;&#37197;&#32622;&#30340; handler &#26144;&#23556;&#65292;&#35270;&#22270;&#35299;&#26512;&#65292;&#26412;&#22320;&#21270;&#12289;&#26102;&#21306;&#21644;&#20027;&#39064;&#30340;&#35299;&#26512;&#20197;&#21450;&#25991;&#20214;&#19978;&#20256;&#30340;&#21151;&#33021;&#12290;<code class="literal">DispatcherServlet</code> &#36127;&#36131;&#23558;&#35831;&#27714;&#20998;&#21457;&#21040;&#19981;&#21516;&#30340; handler&#12290;&#40664;&#35748;&#30340; handler &#36890;&#36807;<code class="literal">@Controller</code> &#21644; <code class="literal">@RequestMapping</code>&#27880;&#35299;&#65292;&#25552;&#20379;&#22810;&#31181;&#28789;&#27963;&#30340;&#22788;&#29702;&#26041;&#27861;&#12290;&#33509;&#21152;&#19978; <code class="literal">@PathVariable</code> &#27880;&#35299;&#21644;&#20854;&#20182;&#36741;&#21161;&#21151;&#33021;&#65292;&#20320;&#20063;&#21487;&#29992;&#20351;&#29992; <code class="literal">@Controller</code> &#26426;&#21046;&#26469;&#21019;&#24314; RESTful web &#31449;&#28857;&#21644;&#24212;&#29992;&#31243;&#24207;&#12290;</p>
<div class="sidebar"><div class="titlepage"></div>
<p>"&#23545;&#25193;&#23637;&#24320;&#25918;&#8230;" &#26159; Spring Web MVC &#30340;&#37325;&#35201;&#35774;&#35745;&#21407;&#21017;&#20043;&#19968;&#65292;&#31526;&#21512; Spring &#30340;&#26412;&#36523;&#35774;&#35745;&#30340;&#27010;&#24565;
"<span class="emphasis"><em>&#23545;&#25193;&#23637;&#24320;&#21457;&#65292;&#23545;&#20462;&#25913;&#20851;&#38381;</em></span>"&#12290;</p>
<p>Spring Web MVC &#26680;&#24515;&#31867;&#20013;&#37096;&#20998;&#26041;&#27861;&#34987;&#26631;&#35760;&#20026; <code class="literal">final</code>,&#24320;&#21457;&#32773;&#19981;&#33021;&#36890;&#36807;&#35206;&#30422;&#36825;&#20123;&#26041;&#27861;&#65292;&#26469;&#25552;&#20379;&#33258;&#23450;&#20041;&#30340;&#34892;&#20026;&#12290;&#20854;&#30446;&#30340;&#26159;&#36981;&#24490;&#24320;&#38381;(OCP)&#21407;&#21017;&#65292; &#32780;&#19981;&#26159;&#25925;&#24847;&#20993;&#38590;&#24320;&#21457;&#32773;&#12290;</p>
<p>&#22312; Seth Ladd &#31561;&#20154;&#25152;&#33879;&#19968;&#20070;<span class="emphasis"><em>Expert Spring Web MVC and Web Flow</em></span>&#20013;&#65292;&#35814;&#32454;&#35299;&#37322;&#20102;&#36825;&#19968;&#35774;&#35745;&#21407;&#21017;&#65292;&#22914;&#26524;&#20320;&#26377;&#20852;&#36259;&#28145;&#20837;&#20102;&#35299;&#30340;&#65292;&#21487;&#20197;&#38405;&#35835;&#19968;&#19979;&#65292;&#37325;&#28857;&#38405;&#35835;&#35813;&#20070;&#31532;&#19968;&#29256; 117 &#39029; "A Look At Design" &#30340;&#31456;&#33410;&#12290;&#25110;&#32773;&#65292;&#20320;&#21487;&#20197;&#30475;&#19968;&#19979;&#36825;&#20010;&#65306;</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<a class="ulink" href="http://www.objectmentor.com/resources/articles/ocp.pdf" target="_top">Bob Martin, The Open-Closed
Principle (PDF)</a>
</li></ul></div>

<p>Spring MVC &#19981;&#20801;&#35768;&#22312; final &#26041;&#27861;&#28155;&#21152; advice&#12290;&#22914;&#19981;&#33021;&#22312; <code class="literal">AbstractController.setSynchronizeOnSession()</code> &#26041;&#27861;&#28155;&#21152; advice&#12290;&#38656;&#35201;&#20102;&#35299; AOP &#20195;&#29702;&#30340;&#30456;&#20851;&#20449;&#24687;&#19982;&#21450;&#20026;&#20160;&#20040;&#19981;&#33021;&#22312; final &#26041;&#27861;&#19978;&#28155;&#21152; advice&#65292;&#21487;&#20197;&#21442;&#32771;
<a class="xref" href="aop.html#aop-understanding-aop-proxies" title="9.6.1&nbsp;Understanding AOP proxies">Section&nbsp;9.6.1, &#8220;Understanding AOP proxies&#8221;</a>&#12290;</p>
</div>

<p>&#20351;&#29992; Spring Web MVC &#65292;&#20320;&#19981;&#38656;&#35201;&#23454;&#29616;&#26694;&#26550;&#25351;&#23450;&#30340;&#20219;&#20309;&#25509;&#21475;&#25110;&#32487;&#25215;&#20219;&#24847;&#22522;&#31867;&#65292;&#23601;&#21487;&#20197;&#20351;&#29992;&#20219;&#24847;&#23545;&#35937;&#20316;&#20026;&#21629;&#20196;&#23545;&#35937;(&#25110;&#34920;&#21333;&#23545;&#35937;)&#12290;Spring &#30340;&#25968;&#25454;&#32465;&#23450;&#30456;&#24403;&#20043;&#28789;&#27963;&#65292;&#27604;&#22914;&#65292;Spring&#21487;&#20197;&#23558;&#19981;&#21305;&#37197;&#30340;&#31867;&#22411;&#20316;&#20026;&#24212;&#29992;&#21487;&#35782;&#21035;&#30340;&#39564;&#35777;&#38169;&#35823;&#65292;&#32780;&#19981;&#26159;&#31995;&#32479;&#38169;&#35823;&#65292;&#25152;&#20197;&#65292;&#20320;&#19981;&#38656;&#35201;&#21435;&#37325;&#22797;&#23450;&#20041;&#19968;&#22871;&#23646;&#24615;&#19968;&#33268;&#32780;&#31867;&#22411;&#26159;&#21407;&#22987;&#23383;&#31526;&#20018;&#30340;&#19994;&#21153;&#36923;&#36753;&#23545;&#35937;&#65292;&#21435;&#22788;&#29702;&#38169;&#35823;&#30340;&#25552;&#20132;&#25110;&#23545;&#23383;&#31526;&#20018;&#36827;&#34892;&#31867;&#22411;&#36716;&#25442;&#12290;&#21453;&#36807;&#26469;&#35828;&#23601;&#26159;&#65292;spring &#20801;&#35768;&#20320;&#30452;&#25509;&#23558;&#27491;&#30830;&#31867;&#22411;&#30340;&#21442;&#25968;&#32465;&#23450;&#21040;&#19994;&#21153;&#36923;&#36753;&#23545;&#35937;&#12290;</p>
<p>Spring &#30340;&#35270;&#22270;&#35299;&#26512;&#20063;&#30456;&#24403;&#20043;&#28789;&#27963;&#12290;&#23436;&#25104;&#19968;&#20010;&#35831;&#27714;&#65292;<code class="literal">Controller</code> &#36890;&#24120;&#26159;&#36127;&#36131;&#20934;&#22791;&#19968;&#20010;&#25968;&#25454;&#27169;&#22411; <code class="literal">Map</code> &#21644;&#36873;&#25321;&#19968;&#20010;&#25351;&#23450;&#30340;&#35270;&#22270;&#65292;&#24403;&#28982;&#65292;&#20063;&#25903;&#25345;&#30452;&#25509;&#23558;&#25968;&#25454;&#20889;&#21040;&#21709;&#24212;&#27969;&#37324;&#12290;&#35270;&#22270;&#21517;&#31216;&#30340;&#35299;&#26512;&#26159;&#39640;&#24230;&#21487;&#37197;&#32622;&#30340;&#65292;&#21487;&#20197;&#36890;&#36807;&#25991;&#20214;&#25193;&#23637;&#21517;&#12289;accept header &#30340; Content-Type&#12289;bean &#30340;&#21517;&#31216;&#12289;&#23646;&#24615;&#25991;&#20214;&#25110;&#33258;&#23450;&#20041;&#30340; <code class="literal">ViewResolver</code> &#23454;&#29616;&#26469;&#35299;&#26512;&#12290;&#27169;&#22411;(Model,MVC &#20013;&#30340; <span class="emphasis"><em>M</em></span>),&#26159;&#19968;&#20010; <code class="literal">Map</code> &#25509;&#21475;&#65292;&#25552;&#20379;&#23545;&#35270;&#22270;&#25968;&#25454;&#30340;&#23436;&#20840;&#25277;&#35937;&#65292;&#21487;&#30452;&#25509;&#19982;&#28210;&#26579;&#27169;&#29256;&#38598;&#25104;&#65292;&#22914; JSP&#65292;Veloctiy&#65292;Freemarker;&#25110;&#30452;&#25509;&#29983;&#25104;&#21407;&#22987;&#25968;&#25454;&#65292;&#25110;xml&#12289;json&#31561;&#20854;&#20182;&#31867;&#22411;&#30340;&#21709;&#24212;&#20869;&#23481;&#12290;&#27169;&#22411; <code class="literal">Map</code> &#25509;&#21475;&#21482;&#26159;&#36127;&#36131;&#23558;&#25968;&#25454;&#36716;&#25442;&#20026;&#21512;&#36866;&#26684;&#24335;&#65292;&#22914; jsp &#35831;&#27714;&#23646;&#24615;&#65292;velocity &#30340; model &#31561;&#12290;</p>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-features" href="#mvc-features"></a>16.1.1&nbsp;Spring Web MVC &#30340;&#29305;&#28857;</h3></div></div></div>

<div class="sidebar"><div class="titlepage"><div><div><p class="title"><b>Spring Web Flow</b></p></div></div></div>

<p>Spring Web Flow (SWF) aims to be the best solution for the management of web application
page flow.</p>
<p>SWF integrates with existing frameworks like Spring MVC and JSF, in both Servlet and
Portlet environments. If you have a business process (or processes) that would benefit
from a conversational model as opposed to a purely request model, then SWF may be the
solution.</p>
<p>SWF allows you to capture logical page flows as self-contained modules that are reusable
in different situations, and as such is ideal for building web application modules that
guide the user through controlled navigations that drive business processes.</p>
<p>For more information about SWF, consult the
<a class="ulink" href="http://projects.spring.io/spring-webflow/" target="_top">Spring Web Flow website</a>.</p>
</div>

<p>Spring&#8217;s web module includes many unique web support features:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<span class="emphasis"><em>Clear separation of roles</em></span>. Each role&#8201;&#8212;&#8201;controller, validator, command object,
form object, model object, <code class="literal">DispatcherServlet</code>, handler mapping, view resolver, and so
on&#8201;&#8212;&#8201;can be fulfilled by a specialized object.
</li><li class="listitem">
<span class="emphasis"><em>Powerful and straightforward configuration of both framework and application classes
as JavaBeans</em></span>. This configuration capability includes easy referencing across
contexts, such as from web controllers to business objects and validators.
</li><li class="listitem">
<span class="emphasis"><em>Adaptability, non-intrusiveness, and flexibility.</em></span> Define any controller method
signature you need, possibly using one of the parameter annotations (such as
@RequestParam, @RequestHeader, @PathVariable, and more) for a given scenario.
</li><li class="listitem">
<span class="emphasis"><em>Reusable business code, no need for duplication</em></span>. Use existing business objects
as command or form objects instead of mirroring them to extend a particular framework
base class.
</li><li class="listitem">
<span class="emphasis"><em>Customizable binding and validation</em></span>. Type mismatches as application-level
validation errors that keep the offending value, localized date and number binding,
and so on instead of String-only form objects with manual parsing and conversion to
business objects.
</li><li class="listitem">
<span class="emphasis"><em>Customizable handler mapping and view resolution</em></span>. Handler mapping and view
resolution strategies range from simple URL-based configuration, to sophisticated,
purpose-built resolution strategies. Spring is more flexible than web MVC frameworks
that mandate a particular technique.
</li><li class="listitem">
<span class="emphasis"><em>Flexible model transfer</em></span>. Model transfer with a name/value <code class="literal">Map</code> supports easy
integration with any view technology.
</li><li class="listitem">
<span class="emphasis"><em>Customizable locale, time zone and theme resolution, support for JSPs with or without
Spring tag library, support for JSTL, support for Velocity without the need for extra
bridges, and so on.</em></span>
</li><li class="listitem">
<span class="emphasis"><em>A simple yet powerful JSP tag library known as the Spring tag library that provides
support for features such as data binding and themes</em></span>. The custom tags allow for
maximum flexibility in terms of markup code. For information on the tag library
descriptor, see the appendix entitled <a class="xref" href="spring.tld.html" title="35.&nbsp;spring.tld">Chapter&nbsp;35, <i>spring.tld</i></a>
</li><li class="listitem">
<span class="emphasis"><em>A JSP form tag library, introduced in Spring 2.0, that makes writing forms in JSP
pages much easier.</em></span> For information on the tag library descriptor, see the appendix
entitled <a class="xref" href="spring-form.tld.html" title="36.&nbsp;spring-form.tld">Chapter&nbsp;36, <i>spring-form.tld</i></a>
</li><li class="listitem">
<span class="emphasis"><em>Beans whose lifecycle is scoped to the current HTTP request or HTTP <code class="literal">Session</code>.</em></span>
This is not a specific feature of Spring MVC itself, but rather of the
<code class="literal">WebApplicationContext</code> container(s) that Spring MVC uses. These bean scopes are
described in <a class="xref" href="beans.html#beans-factory-scopes-other" title="5.5.4&nbsp;Request, session, and global session scopes">Section&nbsp;5.5.4, &#8220;Request, session, and global session scopes&#8221;</a>
</li></ul></div>

</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-introduction-pluggability" href="#mvc-introduction-pluggability"></a>16.1.2&nbsp;&#20854;&#20182; MVC &#23454;&#29616;&#30340;&#21487;&#25554;&#20837;&#24615;</h3></div></div></div>

<p>Non-Spring MVC implementations are preferable for some projects. Many teams expect to
leverage their existing investment in skills and tools, for example with JSF.</p>
<p>If you do not want to use Spring&#8217;s Web MVC, but intend to leverage other solutions that
Spring offers, you can integrate the web MVC framework of your choice with Spring
easily. Simply start up a Spring root application context through its
<code class="literal">ContextLoaderListener</code>, and access it through its <code class="literal">ServletContext</code> attribute (or
Spring&#8217;s respective helper method) from within any action object. No "plug-ins"
are involved, so no dedicated integration is necessary. From the web layer&#8217;s point of
view, you simply use Spring as a library, with the root application context instance as
the entry point.</p>
<p>Your registered beans and Spring&#8217;s services can be at your fingertips even without
Spring&#8217;s Web MVC. Spring does not compete with other web frameworks in this scenario.
It simply addresses the many areas that the pure web MVC frameworks do not, from bean
configuration to data access and transaction handling. So you can enrich your
application with a Spring middle tier and/or data access tier, even if you just want
to use, for example, the transaction abstraction with JDBC or Hibernate.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="mvc-servlet" href="#mvc-servlet"></a>16.2&nbsp;The DispatcherServlet</h2></div></div></div>

<p>&#20687;&#20854;&#20182; web MVC &#26694;&#26550;&#19968;&#26679;&#65292; Spring web MVC &#26694;&#26550;&#20063;&#26159;&#22522;&#20110;&#35831;&#27714;&#39537;&#21160;&#65292;&#22260;&#32469;&#19968;&#20010;&#26680;&#24515; Servlet &#36716;&#21457;&#35831;&#27714;&#21040;&#23545;&#24212;&#30340; Controller &#32780;&#35774;&#35745;&#30340;&#65292;&#25552;&#20379;&#23545;web &#31243;&#24207;&#24320;&#21457;&#30340;&#22522;&#30784;&#30340;&#25903;&#25345;&#12290;&#28982;&#32780; Spring &#30340; <code class="literal">DispatcherServlet</code> &#24182;&#19981;&#20165;&#20165;&#25317;&#26377;&#36825;&#20123;&#65292;&#22240;&#20026; Spring MVC &#26694;&#26550;&#38598;&#25104;&#20102; Spring IOC &#23481;&#22120;&#65292;&#22240;&#27492;&#65292;Spring MVC  &#21487;&#20197;&#20351;&#29992; Spring &#25552;&#20379;&#30340;&#20854;&#20182;&#21151;&#33021;&#12290;</p>
<p>&#22914;&#22270;&#65292;&#23637;&#31034;&#20102; Spring web MVC <code class="literal">DispatcherServlet</code> &#22788;&#29702;&#35831;&#27714;&#30340;&#27969;&#31243;&#12290;
The request processing workflow of the Spring Web MVC <code class="literal">DispatcherServlet</code> is illustrated
in the following diagram. The pattern-savvy reader will recognize that the
<code class="literal">DispatcherServlet</code> is an expression of the "Front Controller" design pattern (this is a
pattern that Spring Web MVC shares with many other leading web frameworks).</p>
<div class="figure"><a name="d5e13866" href="#d5e13866"></a><p class="title"><b>Figure&nbsp;16.1.&nbsp;</b></p><div class="figure-contents">
  <div class="mediaobject"><img src="images/mvc.png" alt="mvc"></div>
</div></div><br class="figure-break">

<p>Spring Web MVC &#35831;&#27714;&#22788;&#29702;&#30340;&#23439;&#35266;&#22270;</p>
<p><code class="literal">DispatcherServlet</code> &#32487;&#25215;&#20102; <code class="literal">HttpServlet</code> &#65292;&#26159;&#19968;&#20010;&#30495;&#23454;&#30340; Servlet&#65292;&#22240;&#27492;&#21487;&#20197;&#22312; <code class="literal">web.xml</code> &#25991;&#20214;&#22768;&#26126;&#12290;&#21478;&#22806;&#20320;&#38656;&#35201;&#20351;&#29992; url &#21305;&#37197;&#20803;&#20214;&#25351;&#23450; <code class="literal">DispatcherServlet</code> &#22788;&#29702;&#30340;&#35831;&#27714;&#12290;&#22914;&#19979;&#20363;&#23376;&#65292;&#20351;&#29992;&#20102;&#26631;&#20934; java EE Servlet &#37197;&#32622;&#65292;&#37197;&#32622;&#20102;&#19968;&#20010; <code class="literal">DispatcherServlet</code>&#30340;&#22768;&#26126;&#21644;&#21305;&#37197; url &#20803;&#20214;:</p>
<pre class="programlisting"><span class="hl-tag">&lt;web-app&gt;</span>
    <span class="hl-tag">&lt;servlet&gt;</span>
        <span class="hl-tag">&lt;servlet-name&gt;</span>example<span class="hl-tag">&lt;/servlet-name&gt;</span>
        <span class="hl-tag">&lt;servlet-class&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="hl-tag">&lt;/servlet-class&gt;</span>
        <span class="hl-tag">&lt;load-on-startup&gt;</span>1<span class="hl-tag">&lt;/load-on-startup&gt;</span>
    <span class="hl-tag">&lt;/servlet&gt;</span>

    <span class="hl-tag">&lt;servlet-mapping&gt;</span>
        <span class="hl-tag">&lt;servlet-name&gt;</span>example<span class="hl-tag">&lt;/servlet-name&gt;</span>
        <span class="hl-tag">&lt;url-pattern&gt;</span>/example/*<span class="hl-tag">&lt;/url-pattern&gt;</span>
    <span class="hl-tag">&lt;/servlet-mapping&gt;</span>

<span class="hl-tag">&lt;/web-app&gt;</span></pre>

<p>&#22312;&#21018;&#25165;&#37197;&#32622;&#30340;&#20363;&#23376;&#20013;&#65292;&#25152;&#26377;&#20197; <code class="literal">/example</code> &#24320;&#22987;&#30340;&#35831;&#27714;&#37117;&#20250;&#34987;&#21517;&#20026; <code class="literal">example</code> &#30340; <code class="literal">DispatcherServlet</code> &#25152;&#22788;&#29702;&#12290;&#22312; Servlet 3.0+ &#29615;&#22659;&#65292;&#20063;&#21487;&#20197;&#20197;&#32534;&#31243;&#26041;&#24335;&#37197;&#32622;&#19978;&#36848; <code class="literal">DispatcherServlet</code>&#12290;&#22914;&#19979;&#20195;&#30721;&#19982;&#19978;&#36848; <code class="literal">web.xml</code> &#37197;&#32622;&#20363;&#23376;&#31561;&#25928;:</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyWebApplicationInitializer <span class="hl-keyword">implements</span> WebApplicationInitializer {

    <em><span class="hl-annotation" style="color: gray">@Override</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> onStartup(ServletContext container) {
        ServletRegistration.Dynamic registration = container.addServlet(<span class="hl-string">"dispatcher"</span>, <span class="hl-keyword">new</span> DispatcherServlet());
        registration.setLoadOnStartup(<span class="hl-number">1</span>);
        registration.addMapping(<span class="hl-string">"/example/*"</span>);
    }

}</pre>

<p>Spring MVC &#25552;&#20379;&#30340; <code class="literal">WebApplicationInitializer</code> &#25509;&#21475;&#65292;&#21487;&#20197;&#30830;&#20445;&#26816;&#27979;&#21040;&#22522;&#20110;&#20195;&#30721;&#30340;&#37197;&#32622;&#21644;&#29992;&#26469;&#33258;&#21160;&#21021;&#22987;&#21270;&#22522;&#20110; Servlet 3 &#30340;&#23481;&#22120;&#12290;&#23427;&#26377;&#19968;&#20010;&#25277;&#35937;&#30340;&#23454;&#29616;&#31867; <code class="literal">AbstractDispatcherServletInitializer</code>,&#31616;&#21270;&#20102;<code class="literal">DispatcherServlet</code> &#30340;&#27880;&#20876;&#65292;&#21482;&#38656;&#25351;&#23450; servlet mapping &#23601;&#21487;&#20197;&#20102;&#65292;&#35814;&#24773;&#35831;&#21442;&#32771;  <a class="link" href="mvc.html#mvc-container-config" title="16.15&nbsp;Code-based Servlet container initialization">Code-based Servlet container initialization</a>&#12290;</p>
<p>&#19978;&#36848;&#30340;&#25805;&#20316;&#20165;&#20165;&#26159;&#24320;&#21551;&#20102; Spring Web MVC &#20043;&#26053;&#30340;&#31532;&#19968;&#27493;&#65292;&#29616;&#22312;&#20320;&#38656;&#35201;&#37197;&#32622; Spring Web MVC &#25152;&#20351;&#29992;&#21040;&#30340;&#21508;&#31181; bean(&#36825;&#19981;&#22312;&#26412;&#33410;&#35752;&#35770;&#33539;&#22260;)&#12290;</p>
<p>&#22914; <a class="xref" href="beans.html#context-introduction" title="5.15&nbsp;Additional Capabilities of the ApplicationContext">Section&nbsp;5.15, &#8220;Additional Capabilities of the ApplicationContext&#8221;</a> &#25152;&#25551;&#36848;&#37027;&#26679;&#65292;&#22312;Spring&#37324;&#21487;&#20197;&#33719;&#21462;&#21040; <code class="literal">ApplicationContext</code> &#23454;&#20363;&#12290;&#22312; web MVC &#26694;&#26550;&#65292;&#27599;&#19968;&#20010; <code class="literal">DispatcherServlet</code> &#37117;&#25317;&#26377;&#33258;&#24049;&#30340; <code class="literal">WebApplicationContext</code>&#65292;&#36825;&#20010; <code class="literal">WebApplicationContext</code> &#32487;&#25215;&#20102;&#26681; <code class="literal">WebApplicationContext</code> &#23450;&#20041;&#30340;&#25152;&#26377; bean.</p>
<p>As detailed in <a class="xref" href="beans.html#context-introduction" title="5.15&nbsp;Additional Capabilities of the ApplicationContext">Section&nbsp;5.15, &#8220;Additional Capabilities of the ApplicationContext&#8221;</a>, <code class="literal">ApplicationContext</code> instances in Spring can be
scoped. In the Web MVC framework, each <code class="literal">DispatcherServlet</code> has its own
<code class="literal">WebApplicationContext</code>, which inherits all the beans already defined in the root
<code class="literal">WebApplicationContext</code>. These inherited beans can be overridden in the servlet-specific
scope, and you can define new scope-specific beans local to a given Servlet instance.</p>
<div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
Spring Web MVC &#19978;&#19979;&#25991;&#30340;&#23618;&#27425;&#32467;&#26500;
image::images/mvc-contexts.gif[width=400]
</li></ol></div>

<p><code class="literal">DispatcherServlet</code> &#22312;&#21021;&#22987;&#21270;&#26102;&#65292;Spring MVC &#20250;&#26597;&#25214; web &#24212;&#29992; <code class="literal">WEB_INF</code> &#30446;&#24405;&#19979;&#30340;<span class="emphasis"><em>[servlet-name]-servlet.xml</em></span> &#24182;&#21019;&#24314;&#22312;&#27492;&#25991;&#20214;&#23450;&#20041;&#30340; bean,&#33509;&#22312;&#20840;&#23616;&#33539;&#22260;&#37324;&#26377;&#19968;&#20010;&#21517;&#31216;&#30456;&#21516;&#30340; bean&#65292;&#20840;&#23616;&#33539;&#22260;&#30340; bean &#20250;&#34987;&#35206;&#30422;&#25481;&#12290;</p>
<p>&#20551;&#35774;<code class="literal">DispatcherServlet</code> Servlet &#30340;&#37197;&#32622;&#22914;&#19979;(&#22312; web.xml &#37197;&#32622;)&#65306;</p>
<pre class="programlisting"><span class="hl-tag">&lt;web-app&gt;</span>
    <span class="hl-tag">&lt;servlet&gt;</span>
        <span class="hl-tag">&lt;servlet-name&gt;</span><span class="strong"><strong>golfing</strong></span><span class="hl-tag">&lt;/servlet-name&gt;</span>
        <span class="hl-tag">&lt;servlet-class&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="hl-tag">&lt;/servlet-class&gt;</span>
        <span class="hl-tag">&lt;load-on-startup&gt;</span>1<span class="hl-tag">&lt;/load-on-startup&gt;</span>
    <span class="hl-tag">&lt;/servlet&gt;</span>
    <span class="hl-tag">&lt;servlet-mapping&gt;</span>
        <span class="hl-tag">&lt;servlet-name&gt;</span><span class="strong"><strong>golfing</strong></span><span class="hl-tag">&lt;/servlet-name&gt;</span>
        <span class="hl-tag">&lt;url-pattern&gt;</span>/golfing/*<span class="hl-tag">&lt;/url-pattern&gt;</span>
    <span class="hl-tag">&lt;/servlet-mapping&gt;</span>
<span class="hl-tag">&lt;/web-app&gt;</span></pre>

<p>&#19978;&#36848;&#37197;&#32622;&#65292;&#35201;&#27714;&#24212;&#29992;&#31243;&#24207;&#22312; <code class="literal">WEB-INF</code> &#30446;&#24405;&#19979;&#26377;&#19968;&#20010; <code class="literal">golfing-servlet.xml</code> &#25991;&#20214;&#65292;&#22312;&#36825;&#20010;&#25991;&#20214;&#37324;&#65292;&#20250;&#21253;&#21547; Spring MVC &#30340;&#25152;&#26377;&#32452;&#20214;(beans)&#12290;&#20320;&#21487;&#20197;&#36890;&#36807;&#23450;&#20041; servlet &#21021;&#22987;&#21270;&#21442;&#25968;&#26469;&#25913;&#21464;<span class="emphasis"><em>[servlet-name]-servlet.xml</em></span> &#25991;&#20214;&#30340;&#36335;&#24452;&#65292;&#22914;&#19979;&#65306;</p>
<pre class="programlisting"><span class="hl-tag">&lt;web-app&gt;</span>
    <span class="hl-tag">&lt;context-param&gt;</span>
        <span class="hl-tag">&lt;param-name&gt;</span>contextConfigLocation<span class="hl-tag">&lt;/param-name&gt;</span>
        <span class="hl-tag">&lt;param-value&gt;</span>/WEB-INF/root-context.xml<span class="hl-tag">&lt;/param-value&gt;</span>
    <span class="hl-tag">&lt;/context-param&gt;</span>
    <span class="hl-tag">&lt;servlet&gt;</span>
        <span class="hl-tag">&lt;servlet-name&gt;</span>dispatcher<span class="hl-tag">&lt;/servlet-name&gt;</span>
        <span class="hl-tag">&lt;servlet-class&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="hl-tag">&lt;/servlet-class&gt;</span>
        <span class="hl-tag">&lt;init-param&gt;</span>
            <span class="hl-tag">&lt;param-name&gt;</span>contextConfigLocation<span class="hl-tag">&lt;/param-name&gt;</span>
            <span class="hl-tag">&lt;param-value&gt;</span><span class="hl-tag">&lt;/param-value&gt;</span>
        <span class="hl-tag">&lt;/init-param&gt;</span>
        <span class="hl-tag">&lt;load-on-startup&gt;</span>1<span class="hl-tag">&lt;/load-on-startup&gt;</span>
    <span class="hl-tag">&lt;/servlet&gt;</span>
    <span class="hl-tag">&lt;servlet-mapping&gt;</span>
        <span class="hl-tag">&lt;servlet-name&gt;</span>dispatcher<span class="hl-tag">&lt;/servlet-name&gt;</span>
        <span class="hl-tag">&lt;url-pattern&gt;</span>/*<span class="hl-tag">&lt;/url-pattern&gt;</span>
    <span class="hl-tag">&lt;/servlet-mapping&gt;</span>
    <span class="hl-tag">&lt;listener&gt;</span>
        <span class="hl-tag">&lt;listener-class&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="hl-tag">&lt;/listener-class&gt;</span>
    <span class="hl-tag">&lt;/listener&gt;</span>
<span class="hl-tag">&lt;/web-app&gt;</span></pre>

<p><code class="literal">WebApplicationContext</code> &#25193;&#23637;&#20102; <code class="literal">ApplicationContext</code>&#65292;&#39069;&#22806;&#25552;&#20379;&#20102; web &#31243;&#24207;&#25152;&#38656;&#35201;&#30340;&#21151;&#33021;&#12290;&#19982;&#20256;&#32479; <code class="literal">ApplicationContext</code> &#19981;&#21516;&#30340;&#26159;&#65292;<code class="literal">WebApplicationContext</code> &#25903;&#25345;&#20027;&#39064;&#35299;&#26512;(&#26597;&#30475; <a class="xref" href="mvc.html#mvc-themeresolver" title="16.9&nbsp;&#20027;&#39064;&#30340;&#20351;&#29992;">Section&nbsp;16.9, &#8220;&#20027;&#39064;&#30340;&#20351;&#29992;&#8221;</a>)&#65292;&#24182;&#19988;&#30693;&#36947;&#20854;&#25152;&#20851;&#32852;&#30340;&#30340; Servlet(&#36890;&#36807;&#19968;&#20010;&#25351;&#21521; <code class="literal">ServletContext</code> &#30340;&#24341;&#29992;)&#12290;<code class="literal">WebApplicationContext</code> &#32465;&#23450;&#22312; <code class="literal">ServletContext</code> &#37324;&#65292;&#22312;&#38656;&#35201;&#35775;&#38382;&#30340;&#26102;&#20505;&#65292;&#21487;&#20197;&#20351;&#29992; <code class="literal">RequestContextUtils</code> &#25552;&#20379;&#30340;&#38745;&#24577;&#26041;&#27861;&#33719;&#21462; <code class="literal">WebApplicationContext</code>&#12290;</p>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-servlet-special-bean-types" href="#mvc-servlet-special-bean-types"></a>16.2.1&nbsp;WebApplicationContext &#30340;&#19987;&#29992; bean</h3></div></div></div>

<p><code class="literal">DispatcherServlet</code>  &#20351;&#29992;&#20102;&#20854;&#19987;&#29992;&#30340; bean &#26469;&#22788;&#29702;&#35831;&#27714;&#21644;&#28210;&#26579;&#35270;&#22270;&#12290;&#36825;&#20123; bean &#26159; Spring &#30340;&#32452;&#25104;&#37096;&#20998;&#20043;&#19968;&#65292;&#20320;&#21487;&#20197;&#36873;&#25321;&#22312; <code class="literal">WebApplicationContext</code>&#37197;&#32622;&#25152;&#20351;&#29992;&#19968;&#20010;&#25110;&#22810;&#20010;&#19987;&#29992;&#30340;bean&#12290;&#24403;&#28982;&#65292;&#27604;&#24182;&#19981;&#38656;&#35201;&#19968;&#24320;&#22987;&#23601;&#21435;&#37197;&#32622;&#36825;&#20123;&#19987;&#29992;&#30340; bean&#65292;&#22240;&#20026;&#22312;&#20320;&#19981;&#37197;&#32622;&#36825;&#20123; bean&#26102;&#65292;Spring &#20250;&#32500;&#25252;&#19968;&#31995;&#21015;&#40664;&#35748;&#30340; bean&#12290;&#39318;&#20808;&#25105;&#20204;&#30475;&#19968;&#19979;  <code class="literal">DispatcherServlet</code> &#20381;&#36182;&#20102;&#21738;&#20123;&#19987;&#29992;&#30340; bean&#65292;&#21518;&#32493;&#20877;&#20316;&#35814;&#35299;&#12290;</p>
<div class="table"><a name="mvc-webappctx-special-beans-tbl" href="#mvc-webappctx-special-beans-tbl"></a><p class="title"><b>Table&nbsp;16.1.&nbsp;WebApplicationContext &#19987;&#29992; bean &#21015;&#34920;</b></p><div class="table-contents">

  <table summary="WebApplicationContext &#19987;&#29992; bean &#21015;&#34920;" style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="col_1"><col class="col_2"></colgroup><thead><tr><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Bean &#31867;&#22411;</th><th style="border-bottom: 0.5pt solid ; " align="left" valign="top">&#35299;&#37322;</th></tr></thead><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><a class="link" href="mvc.html#mvc-handlermapping" title="16.4&nbsp;Handler &#26144;&#23556;">HandlerMapping</a></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>&#23558;&#20256;&#20837;&#30340;&#35831;&#27714;&#26144;&#23556;&#21040;&#22788;&#29702;&#22120;&#65292;&#19982;&#19968;&#31995;&#21015;&#22522;&#20110;&#21508;&#31181;&#26465;&#20214;&#30340; pre- &#21644; post- &#22788;&#29702;&#22120;&#65292;&#36825;&#20123;&#22788;&#29702;&#22120;&#26681;&#25454; <code class="literal">HandlerMapping</code> &#23454;&#29616;&#30340;&#19981;&#21516;&#32780;&#20250;&#26377;&#25152;&#24046;&#24322;&#12290;&#26368;&#20250;&#27426;&#36814;&#30340; <code class="literal">HandlerMapping</code> &#23454;&#29616;&#25552;&#20379;&#27880;&#35299;&#25511;&#21046;&#22120;&#65292;&#20294;&#20854;&#20182;&#23454;&#29616;&#20063;&#20173;&#28982;&#26159;&#23384;&#22312;&#30340;&#12290;</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>HandlerAdapter</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>&#24110;&#21161; <code class="literal">DispatcherServlet</code> &#21435;&#35843;&#29992;&#35831;&#27714;&#25152;&#26144;&#23556;&#30340; handler&#65292;&#19981;&#31649;hadler &#26368;&#32456;&#26159;&#21542;&#20250;&#34987;&#35843;&#29992;&#65292;&#36825;&#20010;&#22788;&#29702;&#36807;&#31243;&#37117;&#20250;&#23384;&#22312;&#30340;&#12290;&#27604;&#22914;&#65292;&#35843;&#29992;&#27880;&#35299;&#25511;&#21046;&#22120;&#21069;&#38656;&#35201;&#35299;&#26512;&#21508;&#31181; annotations&#12290;&#22240;&#27492;&#65292;<code class="literal">HandlerAdapter</code> &#30340;&#20027;&#35201;&#30446;&#30340;&#23601;&#26159;&#20174; <code class="literal">DispatcherServlet</code> &#20013;&#23631;&#34109;&#36825;&#20123;&#22788;&#29702;&#32454;&#33410;&#12290;</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><a class="link" href="mvc.html#mvc-exceptionhandlers" title="16.11&nbsp;Handling exceptions">HandlerExceptionResolver</a></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>&#23558;&#24322;&#24120;&#26144;&#23556;&#21040;&#25351;&#23450;&#35270;&#22270;&#65292;&#20063;&#25903;&#25345;&#33258;&#23450;&#20041;&#26356;&#21152;&#22797;&#26434;&#30340;&#24322;&#24120;&#22788;&#29702;&#27969;&#31243;</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><a class="link" href="mvc.html#mvc-viewresolver" title="16.5&nbsp;&#35270;&#22270;&#35299;&#26512;">ViewResolver</a></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>&#23558;&#21512;&#29702;&#30340;&#35270;&#22270;&#21517;&#31216;&#35299;&#37322;&#20026;&#30495;&#23454;&#30340;&#35270;&#22270;&#31867;&#22411;</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><a class="link" href="mvc.html#mvc-localeresolver" title="16.8&nbsp;&#20351;&#29992;&#26412;&#22320;&#21270;">LocaleResolver</a> &amp; <a class="link" href="mvc.html#mvc-timezone" title="16.8.1&nbsp;&#33719;&#24471;&#26102;&#21306;&#20449;&#24687;">LocaleContextResolver</a></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>&#35299;&#37322;&#23458;&#25143;&#31471;&#25152;&#22312;&#22320;&#21306;&#21644;&#20854;&#26102;&#21306;(&#26412;&#22320;&#21270;)&#65292;&#20197;&#20415;&#25552;&#20379;&#22269;&#38469;&#21270;&#30340;&#35270;&#22270;</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><a class="link" href="mvc.html#mvc-themeresolver" title="16.9&nbsp;&#20027;&#39064;&#30340;&#20351;&#29992;">ThemeResolver</a></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>&#35299;&#37322; web &#31243;&#24207;&#21487;&#29992;&#30340;&#20027;&#39064;&#65292;&#27604;&#22914;&#65292;&#25552;&#20379;&#20010;&#24615;&#21270;&#30340;&#24067;&#23616;</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><a class="link" href="mvc.html#mvc-multipart" title="16.10&nbsp;Spring&#8217;s multipart (file upload) support">MultipartResolver</a></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>&#35299;&#37322; multi-part &#35831;&#27714;&#65292;&#27604;&#22914;&#65292;&#22312; html form &#37324;&#25903;&#25345;&#25991;&#20214;&#19978;&#20256;</p></td></tr><tr><td style="border-right: 0.5pt solid ; " align="left" valign="top"><p><a class="link" href="mvc.html#mvc-flash-attributes" title="16.6&nbsp;&#20351;&#29992; flash &#23646;&#24615;">FlashMapManager</a></p></td><td style="" align="left" valign="top"><p>Stores and retrieves the "input" and the "output" <code class="literal">FlashMap</code> that can be used to pass
  attributes from one request to another, usually across a redirect.</p></td></tr></tbody></table>
</div></div><br class="table-break">

</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-servlet-config" href="#mvc-servlet-config"></a>16.2.2&nbsp;&#40664;&#35748;&#30340; DispatcherServlet &#37197;&#32622;</h3></div></div></div>

<p>&#22914;&#19978;&#19968;&#33410;&#25152;&#35828;&#65292;&#27599;&#19968;&#20010; <code class="literal">DispatcherServlet</code> &#37117;&#32500;&#25345;&#20102;&#19968;&#31995;&#21015;&#40664;&#35748;&#30340;&#23454;&#29616;&#12290;&#36825;&#20123;&#40664;&#35748;&#23454;&#29616;&#30340;&#20449;&#24687;&#20445;&#23384;&#22312; <code class="literal">org.springframework.web.servlet</code> &#21253;&#37324;&#30340; <code class="literal">DispatcherServlet.properties</code> &#25991;&#20214;&#12290;</p>
<p>&#23613;&#31649;&#25152;&#26377;&#19987;&#29992;&#30340; bean &#37117;&#26377;&#20854;&#21512;&#29702;&#30340;&#40664;&#35748;&#20540;&#12290;&#36831;&#26089;&#20320;&#20063;&#38656;&#35201;&#26681;&#25454;&#23454;&#38469;&#21435;&#33258;&#23450;&#20041;&#36825;&#20123; bean &#30340;&#20013;&#19968;&#20010;&#25110;&#22810;&#20010;&#23646;&#24615;&#20540;&#12290;&#20363;&#22914;&#19968;&#31181;&#24456;&#24120;&#35265;&#30340;&#33258;&#23450;&#20041;&#24212;&#29992;&#65292;&#37197;&#32622;&#19968;&#20010; <code class="literal">InternalResourceViewResolver</code>&#65292;&#20854; <code class="literal">prefix</code> &#20026;&#35270;&#22270;&#25991;&#20214;&#30340;&#29238;&#25991;&#20214;&#22841;&#12290;</p>
<p>&#19981;&#31649;&#36825;&#20123;&#40664;&#35748;&#32454;&#33410;&#22914;&#20309;&#23454;&#29616;&#65292;&#22312;&#36825;&#37324;&#37117;&#38656;&#35201;&#28165;&#26970;&#19968;&#20010;&#27010;&#24565;&#8212;&#8212;&#19968;&#26086;&#22312; <code class="literal">WebApplicationContext</code> &#37197;&#32622;&#33258;&#24049;&#19987;&#29992;&#30340; bean&#65292;&#23601;&#26377;&#25928;&#35206;&#30422;&#20102;&#21407;&#26377;&#19968;&#31995;&#21015;&#40664;&#35748;&#30340;&#23454;&#29616;&#65292;&#33267;&#23569;&#20063;&#20250;&#20316;&#20026;&#36825;&#20010;&#19987;&#29992; bean &#30340;&#19968;&#20010;&#23454;&#20363;&#12290;&#27604;&#22914;&#65292;&#37197;&#32622;&#20102; <code class="literal">InternalResourceViewResolver</code>&#65292;&#40664;&#35748;&#30340;&#19968;&#31995;&#21015; <code class="literal">ViewResolver</code> &#23454;&#29616;&#37117;&#20250;&#34987;&#35206;&#30422;&#12290;</p>
<p>&#22312; <a class="xref" href="mvc.html#mvc-config" title="16.16&nbsp;Configuring Spring MVC">Section&nbsp;16.16, &#8220;Configuring Spring MVC&#8221;</a> &#31456;&#33410;&#65292;&#20320;&#21487;&#20197;&#30693;&#36947; Spring MVC &#30340;&#20854;&#20182;&#37197;&#32622;&#36873;&#39033;&#65292;&#21253;&#25324; MVC java &#37197;&#32622;&#21644; MVC XML &#30340;&#21629;&#21517;&#31354;&#38388;&#12290;&#19981;&#31649;&#20320;&#36873;&#25321;&#22914;&#20309;&#21435;&#37197;&#32622;&#24212;&#29992;&#65292;&#36825;&#19968;&#33410;&#35299;&#37322;&#30340;&#29702;&#24565;&#22522;&#26412;&#37117;&#21487;&#20197;&#24110;&#21040;&#20320;&#12290;</p>
<p>In <a class="xref" href="mvc.html#mvc-config" title="16.16&nbsp;Configuring Spring MVC">Section&nbsp;16.16, &#8220;Configuring Spring MVC&#8221;</a> you&#8217;ll learn about other options for configuring Spring MVC including
MVC Java config and the MVC XML namespace both of which provide a simple starting point
and assume little knowledge of how Spring MVC works. Regardless of how you choose to
configure your application, the concepts explained in this section are fundamental
should be of help to you.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-servlet-sequence" href="#mvc-servlet-sequence"></a>16.2.3&nbsp;DispatcherServlet &#22788;&#29702;&#39034;&#24207;</h3></div></div></div>

<p>&#22312;&#20320;&#24314;&#31435;&#19968;&#20010; <code class="literal">DispatcherServlet</code> &#20043;&#21518;&#65292;&#24182;&#22788;&#29702;&#19968;&#20010;&#20256;&#36827;&#26469;&#30340;&#35831;&#27714;&#26102;&#65292;<code class="literal">DispatcherServlet</code> &#20250;&#25353;&#29031;&#20197;&#19979;&#39034;&#24207;&#24180;&#26469;&#22788;&#29702;&#36825;&#20010;&#35831;&#27714;&#65306;</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
&#23547;&#25214; <code class="literal">WebApplicationContext</code>&#65292;&#24182;&#23558; <code class="literal">WebApplicationContext</code>&#20316;&#20026;&#19968;&#20010;&#23646;&#24615;&#32465;&#23450;&#21040;&#35831;&#27714;&#37324;&#65292;&#20197;&#20415;&#25511;&#21046;&#22120;&#25110;&#20854;&#20182;&#21407;&#20214;&#22312;&#21518;&#32493;&#20013;&#20351;&#29992;&#12290;&#40664;&#35748;&#20250;&#20197; <code class="literal">DispatcherServlet.WEB_APPLICATION_CONTEXT_ATTRIBUTE</code> &#38190;&#32465;&#23450;&#21040;&#35831;&#27714;&#37324;&#12290;
</li><li class="listitem">
&#23558;&#26412;&#22320;&#21270;&#35299;&#26512;&#22120;&#32465;&#23450;&#21040;&#35831;&#27714;&#37324;&#65292;&#20197;&#20415;&#22312;&#22788;&#29702;&#36825;&#20010;&#35831;&#27714;&#26102;&#65292;&#21407;&#20214;&#21487;&#20197;&#35299;&#26512;&#21040;&#23458;&#25143;&#31471;&#30340;&#22320;&#21306;&#65288;&#20026;&#20102;&#28210;&#26579;&#35270;&#22270;&#65292;&#20934;&#22791;&#26085;&#26399;&#31561;&#65289;&#12290;&#22914;&#26524;&#20320;&#19981;&#38656;&#35201;&#26412;&#22320;&#21270;&#35299;&#26512;&#22120;&#65292;&#21487;&#20197;&#24573;&#30053;&#36825;&#20010;&#27493;&#39588;&#12290;
</li><li class="listitem">
&#23558;&#20027;&#39064;&#35299;&#26512;&#20854;&#32465;&#23450;&#21040;&#35831;&#27714;&#37324;&#65292;&#35753;&#21407;&#20214;&#65288;&#22914;&#35270;&#22270;&#65289;&#20915;&#23450;&#21435;&#20351;&#29992;&#21738;&#19968;&#31181;&#20027;&#39064;&#12290;&#22914;&#26524;&#20320;&#19981;&#38656;&#35201;&#20351;&#29992;&#20027;&#39064;&#65292;&#21487;&#20197;&#24573;&#30053;&#36825;&#20010;&#27493;&#39588;&#12290;
</li><li class="listitem">
&#22914;&#26524;&#20320;&#25351;&#23450;&#19968;&#20010; multipart file &#35299;&#26512;&#22120;&#65292;&#20250;&#26816;&#26597;&#36825;&#20010;&#35831;&#27714;&#21253;&#21547; multiparts &#35831;&#27714;&#12290;&#24403;&#21457;&#29616;&#20102; multiparts&#65292;&#36825;&#20010;&#35831;&#27714;&#20250;&#34987;&#23553;&#35013;&#20026; <code class="literal">MultipartHttpServletRequest</code> &#23545;&#35937;&#65292;&#25552;&#20379;&#32473;&#21518;&#32493;&#21407;&#20214;&#22788;&#29702;&#12290;&#35814;&#32454;&#20449;&#24687;&#65292;&#28165;&#21442;&#32771; <a class="xref" href="mvc.html#mvc-multipart" title="16.10&nbsp;Spring&#8217;s multipart (file upload) support">Section&nbsp;16.10, &#8220;Spring&#8217;s multipart (file upload) support&#8221;</a>&#12290;
</li><li class="listitem">
&#23547;&#25214;&#21512;&#36866;&#30340; handler&#12290;&#22914;&#20309;&#25214;&#21040;&#36825;&#20010; handler&#65292;&#25191;&#34892;&#19982;&#36825;&#20010; handler &#20851;&#32852;&#30340;&#25191;&#34892;&#38142;&#65292;&#30446;&#30340;&#26159;&#20934;&#22791;&#19968;&#20010; model &#25110; &#28210;&#26579;&#12290;
</li><li class="listitem">
&#22914;&#26524;&#36820;&#22238;&#19968;&#20010; model&#65292;&#28210;&#26579;&#30456;&#23545;&#24212;&#30340;&#35270;&#22270;&#12290;&#21453;&#20043;&#65288;&#21487;&#33021;&#26159;&#22240;&#20026; pre- &#25110; post- &#22788;&#29702;&#22120;&#25318;&#25130;&#20102;&#36825;&#20010;&#35831;&#27714;&#65292;&#20063;&#21487;&#33021;&#26159;&#26435;&#38480;&#38382;&#39064;&#65289;&#65292;&#20415;&#19981;&#28210;&#26579;&#20219;&#20309;&#35270;&#22270;&#65292;&#22240;&#20026;&#36825;&#20010;&#35831;&#27714;&#21487;&#33021;&#24050;&#25191;&#34892;&#23436;&#25104;&#12290;
</li></ul></div>

<p>handler &#24322;&#24120;&#35299;&#26512;&#26159;&#22312; <code class="literal">WebApplicationContext</code> &#22768;&#26126;&#30340;&#65292;&#25509;&#25910;&#22312;&#19978;&#36848;&#22788;&#29702;&#36807;&#31243;&#25243;&#20986;&#30340;&#24322;&#24120;&#12290;&#20351;&#29992;&#24322;&#24120;&#35299;&#26512;&#22120;&#65292;&#20320;&#21487;&#20197;&#26681;&#25454;&#24322;&#24120;&#20449;&#24687;&#33258;&#23450;&#20041;&#20854;&#22788;&#29702;&#26041;&#24335;&#12290;</p>
<p><code class="literal">DispatcherServlet</code> &#20063;&#25903;&#25345;&#36820;&#22238; <span class="emphasis"><em>last-modification-date</em></span>( &#22312; Servlet API &#37324;&#26377;&#30456;&#24212;&#30340;&#25509;&#21475;)&#12290;&#35753;&#25351;&#23450;&#35831;&#27714;&#36820;&#22238; <span class="emphasis"><em>last-modification-date</em></span> &#30340;&#22788;&#29702;&#26041;&#24335;&#38750;&#24120;&#31616;&#21333;&#65306;<code class="literal">DispatcherServlet</code>  &#23547;&#25214;&#26159;&#21542;&#26377;&#21305;&#37197;&#30340; handler&#65292;&#24182;&#26816;&#26597;&#36825;&#20010; handler &#26159;&#21542;&#23454;&#29616;&#20102; <span class="emphasis"><em>LastModified</em></span>&#25509;&#21475;&#65292;&#22914;&#26524;&#23454;&#29616;&#20102;&#35813;&#25509;&#21475;&#65292;&#26041;&#27861;<code class="literal">long getLastModified(request)</code> &#30340;&#36820;&#22238;&#20540;&#20250;&#36820;&#22238;&#21040;&#23458;&#25143;&#31471;&#12290;</p>
<p>&#20320;&#21487;&#20197;&#36890;&#36807;&#22312; web.xml &#37324;&#35774;&#32622; Servlet &#30340;&#21021;&#22987;&#21270;&#21442;&#25968;&#65292;&#26469;&#33258;&#23450;&#20041;&#19968;&#20010; <code class="literal">DispatcherServlet</code> &#23454;&#20363;&#12290;&#19979;&#34920;&#21015;&#20986;&#20102; <code class="literal">DispatcherServlet</code> &#25903;&#25345;&#30340;&#21442;&#25968;&#65306;</p>
<div class="table"><a name="mvc-disp-servlet-init-params-tbl" href="#mvc-disp-servlet-init-params-tbl"></a><p class="title"><b>Table&nbsp;16.2.&nbsp;DispatcherServlet initialization parameters</b></p><div class="table-contents">

  <table summary="DispatcherServlet initialization parameters" style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="col_1"><col class="col_2"></colgroup><thead><tr><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">&#21442;&#25968;</th><th style="border-bottom: 0.5pt solid ; " align="left" valign="top">&#35828;&#26126;</th></tr></thead><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">contextClass</code></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">WebApplicationContext</code> &#30340;&#23454;&#29616;&#31867;&#65292;&#36127;&#36131;&#21021;&#22987;&#21270; Servlet &#25152;&#20351;&#29992;&#30340;&#19978;&#19979;&#25991;&#12290;&#40664;&#35748;&#20351;&#29992; <code class="literal">XmlWebApplicationContext</code></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">contextConfigLocation</code></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>&#20256;&#32473; &#19978;&#19979;&#25991;(<code class="literal">contextClass</code>) &#20351;&#29992;&#30340;&#36335;&#24452;&#21442;&#25968;&#65292;&#29992;&#26469;&#35828;&#26126;&#22312;&#21738;&#37324;&#26597;&#25214;&#19978;&#19979;&#25991;(&#37197;&#32622;&#25991;&#20214;)&#12290;&#25903;&#25345;&#20197; , &#20998;&#38548;&#30340;&#22810;&#20010;&#36335;&#24452;&#21442;&#25968;&#12290;&#24403;&#36335;&#24452;&#21442;&#25968;&#20986;&#29616;&#37325;&#22797;&#26102;&#65292;&#36817;&#32773;&#20248;&#20808;&#12290;</p></td></tr><tr><td style="border-right: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">namespace</code></p></td><td style="" align="left" valign="top"><p><code class="literal">WebApplicationContext</code> &#21629;&#21517;&#35268;&#21017;. &#40664;&#35748;&#26159; <code class="literal">[servlet-name]-servlet</code>.</p></td></tr></tbody></table>
</div></div><br class="table-break">

</div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="mvc-controller" href="#mvc-controller"></a>16.3&nbsp;Implementing Controllers</h2></div></div></div>

<p>Controllers provide access to the application behavior that you typically define through
a service interface. Controllers interpret user input and transform it into a model that
is represented to the user by the view. Spring implements a controller in a very
abstract way, which enables you to create a wide variety of controllers.</p>
<p>Spring 2.5 introduced an annotation-based programming model for MVC controllers that
uses annotations such as <code class="literal">@RequestMapping</code>, <code class="literal">@RequestParam</code>, <code class="literal">@ModelAttribute</code>, and so
on. This annotation support is available for both Servlet MVC and Portlet MVC.
Controllers implemented in this style do not have to extend specific base classes or
implement specific interfaces. Furthermore, they do not usually have direct dependencies
on Servlet or Portlet APIs, although you can easily configure access to Servlet or
Portlet facilities.</p>
<div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top">
<p>&#22312; <a class="ulink" href="https://github.com/spring-projects/" target="_top">spring-projects Org on Github</a> &#19978;,&#26377;&#22909;&#20960;&#20010;&#39033;&#30446;&#37117;&#20351;&#29992;&#36825;&#19968;&#33410;&#35848;&#21040;&#30340;&#27880;&#35299;&#65292;&#26377;<span class="emphasis"><em>MvcShowcase</em></span>, <span class="emphasis"><em>MvcAjax</em></span>, <span class="emphasis"><em>MvcBasic</em></span>, <span class="emphasis"><em>PetClinic</em></span>, <span class="emphasis"><em>PetCare</em></span>&#31561;&#8230;&#8230;</p>
</td></tr></table></div>

<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Controller</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> HelloWorldController {

    <em><span class="hl-annotation" style="color: gray">@RequestMapping("/helloWorld")</span></em>
    <span class="hl-keyword">public</span> String helloWorld(Model model) {
        model.addAttribute(<span class="hl-string">"message"</span>, <span class="hl-string">"Hello World!"</span>);
        <span class="hl-keyword">return</span> <span class="hl-string">"helloWorld"</span>;
    }
}</pre>

<p>&#22914;&#20320;&#25152;&#35265;&#65292;<code class="literal">@Controller</code> &#21644; <code class="literal">@RequestMapping</code> &#20801;&#35768;&#28789;&#27963;&#30340;&#37197;&#32622;&#26041;&#27861;&#31614;&#21517;&#12290;&#22312;&#19978;&#36848;&#20363;&#23376;&#20013;&#65292;helloWorld &#26041;&#27861;&#25509;&#21463;&#19968;&#20010; <code class="literal">Model</code> &#21442;&#25968;&#65292;&#24182;&#36820;&#22238;&#19968;&#20010;&#35270;&#22270;&#21517;&#31216;&#65292;&#24403;&#28982;&#20063;&#20801;&#35768;&#28155;&#21152;&#26041;&#27861;&#20837;&#21442;&#21644;&#36820;&#22238;&#19981;&#21516;&#31867;&#22411;&#30340;&#20540;&#65292;&#36825;&#20123;&#20869;&#23481;&#23558;&#20250;&#22312;&#21518;&#38754;&#35299;&#37322;&#12290;<code class="literal">@Controller</code> &#12289;<code class="literal">@RequestMapping</code> &#21644;&#20854;&#20182;&#19968;&#20123;&#21151;&#33021;&#27880;&#35299;&#32452;&#25104;&#20102; Spring MVC &#23454;&#29616;&#30340;&#22522;&#30784;&#65292;&#36825;&#19968;&#33410;&#23558;&#20250;&#35848;&#21040;&#36825;&#20123;&#32452;&#25104;&#30340;&#27880;&#35299;&#21644;&#22312; Servlet &#29615;&#22659;&#30340;&#26222;&#36941;&#29992;&#27861;&#12290;</p>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-ann-controller" href="#mvc-ann-controller"></a>16.3.1&nbsp;&#20351;&#29992; @Controller &#23450;&#20041;&#25511;&#21046;&#22120;</h3></div></div></div>

<p><code class="literal">@Controller</code> &#34920;&#26126;&#20102;&#34987;&#27880;&#35299;&#31867;&#30340;&#26381;&#21153;&#35282;&#33394;&#8212;&#8212;&#25511;&#21046;&#22120;&#12290;Spring &#19981;&#38656;&#35201;&#21435;&#32487;&#25215;&#20219;&#20309; Controller &#30340;&#22522;&#31867;&#25110;&#24341;&#29992;&#20219;&#24847;&#30340; Servlet API&#12290;&#24403;&#28982;&#20102;&#65292;&#22914;&#20309;&#20320;&#38656;&#35201;&#30340;&#65292; &#20320;&#20173;&#28982;&#21487;&#20197;&#24341;&#29992; Servlet API&#12290;</p>
<p><code class="literal">@Controller</code> &#27880;&#35299;&#23450;&#20041;&#20102;&#34987;&#27880;&#35299;&#31867;&#30340;&#21407;&#22411;&#65292;&#34920;&#26126;&#20102;&#27880;&#35299;&#31867;&#30340;&#26381;&#21153;&#35282;&#33394;&#12290;dispatcher &#20250;&#25195;&#25551;&#36825;&#20123;&#34987; <code class="literal">@Controller</code> &#26631;&#35760;&#30340;&#31867;&#24182;&#26816;&#27979; <code class="literal">@RequestMapping</code> &#26631;&#35760;&#30340;&#26041;&#27861;(&#35265;&#19979;&#19968;&#33410;)&#12290;</p>
<p>&#20320;&#21487;&#20197;&#22312; dispatcher &#19978;&#19979;&#25991;&#26174;&#24335;&#23450;&#20041;&#25511;&#21046;&#22120; bean&#65292;&#19981;&#36807;&#65292;&#20026;&#20102;&#19982; Spring &#25903;&#25345;&#22312;&#31867;&#36335;&#24452;&#19978;&#26816;&#27979; bean &#24182;&#33258;&#21160;&#27880;&#20876;&#36825;&#20123; bean &#23450;&#20041; &#20445;&#25345;&#19968;&#33268;&#65292;<code class="literal">@Controller</code> &#20063;&#35768;&#20801;&#35768;&#33258;&#21160;&#26816;&#27979;&#12290;</p>
<p>&#35201;&#24320;&#21551;&#27880;&#35299;&#25511;&#21046;&#22120;&#30340;&#25195;&#25551;&#21151;&#33021;&#65292;&#38656;&#35201;&#22312;&#20320;&#30340;&#37197;&#32622;&#37324;&#28155;&#21152;&#32452;&#20214;&#25195;&#25551;&#20803;&#20214;&#12290;&#22914;&#19979; xml &#25152;&#31034;&#65292;&#21487;&#20197;&#20351;&#29992; <span class="emphasis"><em>spring-context</em></span> &#27169;&#24335;&#24320;&#21551;&#27492;&#25195;&#25551;&#21151;&#33021;&#65306;</p>
<pre class="programlisting"><span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hl-attribute">xmlns:p</span>=<span class="hl-value">"http://www.springframework.org/schema/p"</span>
    <span class="hl-attribute">xmlns:context</span>=<span class="hl-value">"http://www.springframework.org/schema/context"</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context.xsd"</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;context:component-scan</span> <span class="hl-attribute">base-package</span>=<span class="hl-value">"org.springframework.samples.petclinic.web"</span><span class="hl-tag">/&gt;</span>

    <span class="hl-comment">&lt;!-- ... --&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre>

</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-ann-requestmapping" href="#mvc-ann-requestmapping"></a>16.3.2&nbsp;&#20351;&#29992; @RequestMapping &#26144;&#23556;&#35831;&#27714;</h3></div></div></div>

<p>&#20320;&#21487;&#20197;&#22312;&#31867;&#25110;&#25351;&#23450; handler &#26041;&#27861;&#19978;&#65292;&#20351;&#29992; <code class="literal">@RequestMapping</code> &#27880;&#35299;&#26469;&#26144;&#23556; URL&#65292;&#22914; <code class="literal">/appointments</code>&#12290;</p>
<p>You use the <code class="literal">@RequestMapping</code> annotation to map URLs such as <code class="literal">/appointments</code> onto an
entire class or a particular handler method. Typically the class-level annotation maps a
specific request path (or path pattern) onto a form controller, with additional
method-level annotations narrowing the primary mapping for a specific HTTP method
request method ("GET", "POST", etc.) or an HTTP request parameter condition.</p>
<p>&#22914;&#19979;&#20363;&#23376;&#26469;&#33258;&#20110;  <span class="emphasis"><em>Petcare</em></span>  &#39033;&#30446;&#65292;&#23637;&#31034;&#20102;&#22914;&#20309;&#20351;&#29992; @RequestMapping &#27880;&#35299;&#12290;</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Controller</span></em>
<span class="strong"><strong>@RequestMapping("/appointments")</strong></span>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AppointmentsController {

    <span class="hl-keyword">private</span> <span class="hl-keyword">final</span> AppointmentBook appointmentBook;

    <em><span class="hl-annotation" style="color: gray">@Autowired</span></em>
    <span class="hl-keyword">public</span> AppointmentsController(AppointmentBook appointmentBook) {
        <span class="hl-keyword">this</span>.appointmentBook = appointmentBook;
    }

    <span class="strong"><strong>@RequestMapping(method = RequestMethod.GET)</strong></span>
    <span class="hl-keyword">public</span> Map&lt;String, Appointment&gt; get() {
        <span class="hl-keyword">return</span> appointmentBook.getAppointmentsForToday();
    }

    <span class="strong"><strong>@RequestMapping(value="/{day}", method = RequestMethod.GET)</strong></span>
    <span class="hl-keyword">public</span> Map&lt;String, Appointment&gt; getForDay(<em><span class="hl-annotation" style="color: gray">@PathVariable</span></em> <em><span class="hl-annotation" style="color: gray">@DateTimeFormat(iso=ISO.DATE)</span></em> Date day, Model model) {
        <span class="hl-keyword">return</span> appointmentBook.getAppointmentsForDay(day);
    }

    <span class="strong"><strong>@RequestMapping(value="/new", method = RequestMethod.GET)</strong></span>
    <span class="hl-keyword">public</span> AppointmentForm getNewForm() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> AppointmentForm();
    }

    <span class="strong"><strong>@RequestMapping(method = RequestMethod.POST)</strong></span>
    <span class="hl-keyword">public</span> String add(<em><span class="hl-annotation" style="color: gray">@Valid</span></em> AppointmentForm appointment, BindingResult result) {
        <span class="hl-keyword">if</span> (result.hasErrors()) {
            <span class="hl-keyword">return</span> <span class="hl-string">"appointments/new"</span>;
        }
        appointmentBook.addAppointment(appointment);
        <span class="hl-keyword">return</span> <span class="hl-string">"redirect:/appointments"</span>;
    }
}</pre>

<p>&#20363;&#23376;&#20013;&#65292;&#22312;&#22810;&#22788;&#22320;&#26041;&#20351;&#29992; <code class="literal">@RequestMapping</code>&#12290;&#31532;&#19968;&#20010;&#29992;&#22312;&#20102;&#31867;&#19978;&#65292;&#34920;&#31034;<code class="literal">@RequestMapping</code> &#36825;&#20010;&#25511;&#21046;&#22120;&#19979;&#30340;&#25152;&#26377; handler &#26041;&#27861;&#37117;&#26159;&#30456;&#23545; <code class="literal">/appointments</code> &#36335;&#24452;&#32780;&#35328;&#30340;&#12290;get() &#26041;&#27861;&#23545; <code class="literal">@RequestMapping</code> &#20570;&#20102;&#36827;&#19968;&#27493;&#30340;&#32454;&#21270; &#8212;&#8212; &#27492;&#26041;&#27861;&#21482;&#25509;&#25910; GET &#35831;&#27714;&#26041;&#24335;&#65292;&#25442;&#21477;&#35805;&#35828;&#23601;&#26159; <code class="literal">/appointments</code> &#30340;GET &#35831;&#27714;&#20250;&#35843;&#29992;&#36825;&#20010;&#26041;&#27861;; add() &#26041;&#27861;&#20063;&#20570;&#19968;&#20010;&#31867;&#20284;&#30340;&#32454;&#21270;; getNewForm() &#26041;&#27861;&#22312; RequestMapping &#19978;&#32452;&#21512;&#23450;&#20041;&#20102; http &#26041;&#27861;&#21644;&#36335;&#24452;&#65292;&#22240;&#27492;&#27492;&#26041;&#27861;&#20250;&#22788;&#29702; <code class="literal">appointments/new</code> &#30340; GET &#35831;&#27714;&#12290;</p>
<p>getForDay() &#26041;&#27861;&#28436;&#31034;&#20102; <code class="literal">@RequestMapping</code> &#30340;&#21478;&#22806;&#19968;&#31181;&#20351;&#29992;&#26041;&#24335; &#8212;&#8212; URI &#27169;&#29256;(&#26597;&#30475; <a class="link" href="mvc.html#mvc-ann-requestmapping-uri-templates" title="URI &#27169;&#29256;&#27169;&#24335;">the next section</a>)&#12290;</p>
<p>&#22312;&#31867;&#19978;&#28155;&#21152; <code class="literal">@RequestMapping</code> &#19981;&#26159;&#24517;&#39035;&#30340;&#65292;&#22914;&#26524;&#27809;&#26377;&#65292;&#25152;&#26377;&#30340;&#36335;&#24452;&#37117;&#26159;&#32477;&#23545;&#36335;&#24452;&#65292;&#32780;&#19981;&#26159;&#30456;&#23545;&#36335;&#24452;&#12290;&#26469;&#33258; <span class="emphasis"><em>PetClinic</em></span> &#39033;&#30446;&#30340;&#20363;&#23376;&#23637;&#31034;&#22914;&#20309;&#20351;&#29992; <code class="literal">@RequestMapping</code> &#26469;&#23450;&#20041;&#19968;&#20010; multi-action &#25511;&#21046;&#22120;&#65306;</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Controller</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ClinicController {

    <span class="hl-keyword">private</span> <span class="hl-keyword">final</span> Clinic clinic;

    <em><span class="hl-annotation" style="color: gray">@Autowired</span></em>
    <span class="hl-keyword">public</span> ClinicController(Clinic clinic) {
        <span class="hl-keyword">this</span>.clinic = clinic;
    }

    <span class="strong"><strong>@RequestMapping("/")</strong></span>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> welcomeHandler() {
    }

    <span class="strong"><strong>@RequestMapping("/vets")</strong></span>
    <span class="hl-keyword">public</span> ModelMap vetsHandler() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> ModelMap(<span class="hl-keyword">this</span>.clinic.getVets());
    }

}</pre>

<p>&#19978;&#38754;&#30340;&#20363;&#23376;&#27809;&#26377;&#25351;&#23450; GET&#12289;PUT&#12289;POST &#31561;&#26041;&#27861;&#65292;&#22240;&#20026; <code class="literal">@RequestMapping</code> &#40664;&#35748;&#21305;&#37197;&#25152;&#26377;&#30340; http &#26041;&#27861;&#12290;&#20351;&#29992; <code class="literal">@RequestMapping(method=GET)</code> &#21487;&#20197;&#32553;&#23567;&#20854;&#26144;&#23556;&#33539;&#22260;&#12290;</p>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="mvc-ann-requestmapping-proxying" href="#mvc-ann-requestmapping-proxying"></a><code class="literal">@Controller</code>' &#21644; AOP &#20195;&#29702;</h4></div></div></div>

<p>&#26576;&#20123;&#26102;&#20505;&#65292;&#25511;&#21046;&#22120;&#38656;&#35201;&#22312;&#36816;&#34892;&#26102; AOP &#20195;&#29702;&#20462;&#39280;&#19968;&#30058;&#12290;</p>
<p>In some cases a controller may need to be decorated with an AOP proxy at runtime.
One example is if you choose to have <code class="literal">@Transactional</code> annotations directly on the
controller. When this is the case, for controllers specifically, we recommend
using class-based proxying. This is typically the default choice with controllers.
However if a controller must implement an interface that is not a Spring Context
callback (e.g. <code class="literal">InitializingBean</code>, <code class="literal">*Aware</code>, etc), you may need to explicitly
configure class-based proxying. For example with <code class="literal">&lt;tx:annotation-driven /&gt;</code>,
change to <code class="literal">&lt;tx:annotation-driven proxy-target-class="true" /&gt;</code>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="mvc-ann-requestmapping-31-vs-30" href="#mvc-ann-requestmapping-31-vs-30"></a>New Support Classes for @RequestMapping methods in Spring MVC 3.1</h4></div></div></div>

<p>Spring 3.1 introduced a new set of support classes for <code class="literal">@RequestMapping</code> methods called
<code class="literal">RequestMappingHandlerMapping</code> and <code class="literal">RequestMappingHandlerAdapter</code> respectively. They are
recommended for use and even required to take advantage of new features in Spring MVC
3.1 and going forward. The new support classes are enabled by default by the MVC
namespace and the MVC Java config but must be configured explicitly if using neither.
This section describes a few important differences between the old and the new support
classes.</p>
<p>Prior to Spring 3.1, type and method-level request mappings were examined in two
separate stages&#8201;&#8212;&#8201;a controller was selected first by the
<code class="literal">DefaultAnnotationHandlerMapping</code> and the actual method to invoke was narrowed down
second by the <code class="literal">AnnotationMethodHandlerAdapter</code>.</p>
<p>With the new support classes in Spring 3.1, the <code class="literal">RequestMappingHandlerMapping</code> is the
only place where a decision is made about which method should process the request. Think
of controller methods as a collection of unique endpoints with mappings for each method
derived from type and method-level <code class="literal">@RequestMapping</code> information.</p>
<p>This enables some new possibilities. For once a <code class="literal">HandlerInterceptor</code> or a
<code class="literal">HandlerExceptionResolver</code> can now expect the Object-based handler to be a
<code class="literal">HandlerMethod</code>, which allows them to examine the exact method, its parameters and
associated annotations. The processing for a URL no longer needs to be split across
different controllers.</p>
<p>There are also several things no longer possible:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
Select a controller first with a <code class="literal">SimpleUrlHandlerMapping</code> or
<code class="literal">BeanNameUrlHandlerMapping</code> and then narrow the method based on <code class="literal">@RequestMapping</code>
annotations.
</li><li class="listitem">
Rely on method names as a fall-back mechanism to disambiguate between two
<code class="literal">@RequestMapping</code> methods that don&#8217;t have an explicit path mapping URL path but
otherwise match equally, e.g. by HTTP method. In the new support classes
<code class="literal">@RequestMapping</code> methods have to be mapped uniquely.
</li><li class="listitem">
Have a single default method (without an explicit path mapping) with which requests
are processed if no other controller method matches more concretely. In the new
support classes if a matching method is not found a 404 error is raised.
</li></ul></div>

<p>The above features are still supported with the existing support classes. However to
take advantage of new Spring MVC 3.1 features you&#8217;ll need to use the new support classes.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="mvc-ann-requestmapping-uri-templates" href="#mvc-ann-requestmapping-uri-templates"></a>URI &#27169;&#29256;&#27169;&#24335;</h4></div></div></div>

<p><span class="emphasis"><em>URI</em></span> &#27169;&#29256;&#33021;&#20415;&#25463;&#35775;&#38382; <code class="literal">@RequestMapping</code> &#26041;&#27861;&#20013; URL &#30340;&#26576;&#20123;&#37096;&#20998;&#12290;</p>
<p><span class="emphasis"><em>URI</em></span> &#27169;&#29256;&#26159;&#19968;&#20010;&#31867;&#20284;&#20110; URI &#30340;&#23383;&#31526;&#20018;&#65292;&#20854;&#20013;&#21253;&#21547;&#20102;&#19968;&#20010;&#25110;&#22810;&#20010;&#21464;&#37327;&#12290;&#24403;&#20320;&#23558;&#36825;&#20123;&#21464;&#37327;&#26367;&#25442;&#25481;&#24066;&#65292;&#23601;&#21464;&#22238;&#20102; URI&#12290; URI &#27169;&#29256;&#26684;&#24335; <a class="ulink" href="http://bitworking.org/projects/URI-Templates/" target="_top">proposed RFC</a> &#23450;&#20041;&#20102;&#22914;&#20309;&#21442;&#25968;&#21270; URI&#12290;&#27604;&#22914;&#65292;URI &#27169;&#29256; <code class="literal">http://www.example.com/users/{userId}</code>&#65292;&#21253;&#21547;&#20102;&#21464;&#37327; <span class="emphasis"><em>userId</em></span>&#65292;&#35774;&#32622;&#27492;&#21464;&#37327;&#20026; __fred&#65292;&#23601;&#20250;&#21464;&#25104;<code class="literal">http://www.example.com/users/fred</code>&#12290;</p>
<p>&#21487;&#22312;&#26041;&#27861;&#20837;&#21442;&#19978;&#20351;&#29992;&#27880;&#35299; <code class="literal">@PathVariable</code> &#32465;&#23450; URI &#30340;&#27169;&#29256;&#21442;&#25968;&#65306;</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@RequestMapping(value="/owners/{ownerId}", method=RequestMethod.GET)</span></em>
<span class="hl-keyword">public</span> String findOwner(<span class="strong"><strong>@PathVariable</strong></span> String ownerId, Model model) {
    Owner owner = ownerService.findOwner(ownerId);
    model.addAttribute(<span class="hl-string">"owner"</span>, owner);
    <span class="hl-keyword">return</span> <span class="hl-string">"displayOwner"</span>;
}</pre>

<p>URI &#27169;&#29256; " <code class="literal">/owners/{ownerId}</code>" &#25351;&#23450;&#20102;&#21442;&#25968; <code class="literal">owernId</code>&#12290;&#24403;&#25511;&#21046;&#22120;&#22788;&#29702;&#36825;&#20010;&#35831;&#27714;&#26102;&#65292;&#20250;&#23558; URI &#20013;&#21305;&#37197;&#30340;&#37096;&#20998;&#36171;&#20540;&#32473; <code class="literal">owernId</code> &#21464;&#37327;&#12290;&#22914;&#65292;&#24403;&#20256;&#20837; <code class="literal">/owners/fred</code> &#35831;&#27714;&#26102;&#65292;<code class="literal">owernId</code> &#30340;&#20540;&#23601;&#26159; <code class="literal">fred</code>&#12290;</p>
<p>[&#25552;&#31034;]</p>
<div class="informalexample">
<p>&#22312;&#22788;&#29702; @PathVariable &#27880;&#35299;&#26102;&#65292;Srping MVC &#26159;&#26681;&#25454;&#21517;&#31216;&#26469;&#21305;&#37197; URI &#27169;&#29256;&#21464;&#37327;&#30340;&#12290;&#20320;&#21487;&#20197;&#22312;&#27880;&#35299;&#37324;&#25351;&#23450;&#36825;&#20010;&#21517;&#31216;&#65306;</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@RequestMapping(value="/owners/{ownerId}", method=RequestMethod.GET)</span></em>
<span class="hl-keyword">public</span> String findOwner(<span class="strong"><strong>@PathVariable("ownerId")</strong></span> String theOwner, Model model) {
    <span class="hl-comment">// implementation omitted</span>
}</pre>

<p>&#22914;&#26524;URI &#27169;&#29256;&#21464;&#37327;&#21517;&#21644;&#20837;&#21442;&#21517;&#19968;&#33268;&#65292;&#21487;&#20197;&#30465;&#30053;&#36825;&#20010;&#32454;&#33410;&#12290;&#21482;&#35201;&#20320;&#30340;&#20195;&#30721;&#19981;&#26159;&#19981;&#24102;&#35843;&#35797;&#20449;&#24687;&#30340;&#32534;&#35793;&#65292;Spring MVC &#23558;&#21305;&#37197;&#20837;&#21442;&#21517;&#21644; URI &#21464;&#37327;&#21517;&#12290;</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@RequestMapping(value="/owners/{ownerId}", method=RequestMethod.GET)</span></em>
<span class="hl-keyword">public</span> String findOwner(<span class="strong"><strong>@PathVariable</strong></span> String ownerId, Model model) {
    <span class="hl-comment">// implementation omitted</span>
}</pre>

</div>

<p>&#19968;&#20010;&#26041;&#27861;&#21487;&#20197;&#26377;&#20219;&#24847;&#20010; <code class="literal">@PathVariable</code> &#27880;&#35299;&#12290;</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@RequestMapping(value="/owners/{ownerId}/pets/{petId}", method=RequestMethod.GET)</span></em>
<span class="hl-keyword">public</span> String findPet(<span class="strong"><strong>@PathVariable</strong></span> String ownerId, <span class="strong"><strong>@PathVariable</strong></span> String petId, Model model) {
    Owner owner = ownerService.findOwner(ownerId);
    Pet pet = owner.getPet(petId);
    model.addAttribute(<span class="hl-string">"pet"</span>, pet);
    <span class="hl-keyword">return</span> <span class="hl-string">"displayPet"</span>;
}</pre>

<p>&#24403;&#22312; <code class="literal">Map&lt;String, String&gt;</code> &#21442;&#25968;&#20351;&#29992; <code class="literal">@PathVariable</code> &#27880;&#35299;&#26102;&#65292;map &#20250;&#22635;&#20805;&#25152;&#26377; URI &#27169;&#29256;&#21464;&#37327;&#12290;</p>
<p>URI &#27169;&#29256;&#21487;&#20197;&#32452;&#21512;&#31867;&#22411;&#21644;&#21442;&#25968;&#36335;&#24452;&#30340; <span class="emphasis"><em>@RequestMapping</em></span>&#12290;&#22240;&#27492;&#65292;<code class="literal">findPet</code> &#21487;&#20197;&#22788;&#29702;&#31867;&#20284;  <code class="literal">/owners/42/pets/21</code> &#30340;URI &#12290;</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Controller</span></em>
@RequestMapping(<span class="strong"><strong>"/owners/{ownerId}"</strong></span>)
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> RelativePathUriTemplateController {

    @RequestMapping(<span class="strong"><strong>"/pets/{petId}"</strong></span>)
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> findPet(<em><span class="hl-annotation" style="color: gray">@PathVariable</span></em> String ownerId, <em><span class="hl-annotation" style="color: gray">@PathVariable</span></em> String petId, Model model) {
        <span class="hl-comment">// implementation omitted</span>
    }

}</pre>

<p><code class="literal">@PathVariable</code> &#21442;&#25968;&#21487;&#20197;&#26159;&#20219;&#24847;&#30340;&#31616;&#21333;&#31867;&#22411;&#65288;&#22914; int&#65292;long&#65292;Date &#31561;&#65289;&#65292;Spring &#20250;&#33258;&#21160;&#23558;&#20854;&#36827;&#34892;&#31867;&#22411;&#36716;&#25442;&#65292;&#36716;&#25442;&#20986;&#38169;&#20250;&#25243;&#20986; <code class="literal">TypeMismatchException</code>&#12290;&#20320;&#21487;&#20197;&#27880;&#20876;&#25903;&#25345;&#35299;&#26512;&#20854;&#20182;&#25968;&#25454;&#31867;&#22411;&#65292;&#35814;&#24773;&#35831;&#30475; <a class="xref" href="mvc.html#mvc-ann-typeconversion" title="&#26041;&#27861;&#21442;&#25968;&#21644;&#31867;&#22411;&#36716;&#25442;">the section called &#8220;&#26041;&#27861;&#21442;&#25968;&#21644;&#31867;&#22411;&#36716;&#25442;&#8221;</a> &#21644; <a class="xref" href="mvc.html#mvc-ann-webdatabinder" title="&#33258;&#23450;&#20041; WebDataBinder &#30340;&#21021;&#22987;&#21270;">the section called &#8220;&#33258;&#23450;&#20041; WebDataBinder &#30340;&#21021;&#22987;&#21270;&#8221;</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="mvc-ann-requestmapping-uri-templates-regex" href="#mvc-ann-requestmapping-uri-templates-regex"></a>&#22312; URI &#27169;&#29256;&#19978;&#20351;&#29992;&#27491;&#21017;&#34920;&#36798;&#24335;</h4></div></div></div>

<p>&#20598;&#23572;&#65292;&#22312;URI &#27169;&#29256;&#21464;&#37327;&#37324;&#65292;&#20320;&#20250;&#38656;&#35201;&#29992;&#21040;&#26356;&#21152;&#31934;&#30830;&#30340;&#25511;&#21046;&#12290;&#27604;&#22914; <code class="literal">"/spring-web/spring-web-3.0.5.jar"</code> &#36825;&#26679;&#30340;URI&#65292;&#35813;&#22914;&#20309;&#25286;&#20998;&#25104;&#22810;&#20010;&#37096;&#20998;&#65311;</p>
<p><code class="literal">@RequestMapping</code> &#27880;&#35299;&#25903;&#25345;&#22312; URI &#27169;&#29256;&#21464;&#37327;&#37324;&#20351;&#29992;&#27491;&#21017;&#34920;&#36798;&#24335;&#12290;&#35821;&#27861; <code class="literal">{&#21464;&#37327;&#21517;:&#27491;&#21017;&#34920;&#36798;&#24335;}</code>&#65292;&#31532;&#19968;&#20010;&#37096;&#20998;&#23450;&#20041;&#21464;&#37327;&#30340;&#21517;&#31216;&#65292;&#31532;&#20108;&#37096;&#20998;&#26159;&#27491;&#21017;&#34920;&#36798;&#24335;&#12290;&#22914;</p>
<pre class="programlisting">@RequestMapping(<span class="hl-string">"/spring-web/{symbolicName:[a-z-]</span><code class="literal">}-{version:\\d\\.\\d\\.\\d}{extension:\\.[a-z]</code>}<span class="hl-string">")
</span>    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> handle(<em><span class="hl-annotation" style="color: gray">@PathVariable</span></em> String version, <em><span class="hl-annotation" style="color: gray">@PathVariable</span></em> String extension) {
        <span class="hl-comment">// ...</span>
    }
}</pre>

</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="mvc-ann-requestmapping-patterns" href="#mvc-ann-requestmapping-patterns"></a>&#36335;&#24452;&#27169;&#24335;</h4></div></div></div>

<p><code class="literal">@RequestMapping</code> &#27880;&#35299;&#22788;&#29702;&#25903;&#25345; URI &#27169;&#29256;&#65292;&#20063;&#25903;&#25345;&#20351;&#29992; Ant &#39118;&#26684;&#27169;&#24335;(&#22914;&#65306;<code class="literal">/myPath/*.do)&#12290;&#21516;&#26102;&#25903;&#25345;&#32452;&#21512;&#20351;&#29992; URI &#27169;&#29256;&#21644; Ant &#39118;&#26684;&#27169;&#24335;&#65288;&#22914;&#65306;e.g. `/owners/*/pets/{petId}</code>&#65289;&#12290;</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="mvc-ann-requestmapping-pattern-comparison" href="#mvc-ann-requestmapping-pattern-comparison"></a>&#36335;&#24452;&#27169;&#24335;&#27604;&#36739;</h4></div></div></div>

<p>&#24403;&#19968;&#20010; URL &#19982;&#22810;&#20010;&#27169;&#24335;&#21305;&#37197;&#26102;&#65292;&#20250;&#35774;&#27861;&#25214;&#20986;&#26368;&#20855;&#20307;&#30340;&#37027;&#19968;&#20010;&#36335;&#24452;&#12290;</p>
<p>&#24403;&#27169;&#24335;&#20013;&#30340; URI &#27169;&#29256;&#21464;&#37327;&#21644;&#36890;&#37197;&#31526;&#30340;&#25968;&#37327;&#30456;&#23545;&#36739;&#23569;&#65292;&#20250;&#35748;&#20026;&#20854;&#30456;&#23545;&#20855;&#20307;&#12290;&#22914;&#65306;<code class="literal">/hotels/{hotel}/*</code> &#30456;&#23545; <code class="literal">/hotels/{hotel}/**</code> &#26356;&#21152;&#21512;&#36866;&#65292;&#22240;&#20026; <code class="literal">/hotels/{hotel}/*</code> &#21482;&#26377;&#19968;&#20010;URI &#27169;&#29256;&#21464;&#37327;&#21644;&#19968;&#20010;&#36890;&#37197;&#31526;&#65292;&#32780; hotels/{hotel}/**` &#26377;&#19968;&#20010; URI &#27169;&#29256;&#21464;&#37327;&#21644;&#20004;&#20010;&#36890;&#37197;&#31526;&#12290;</p>
<p>&#24403;&#20004;&#20010;&#27169;&#24335;&#20013;&#30340; URI &#27169;&#29256;&#21464;&#37327;&#21644;&#36890;&#37197;&#31526;&#25968;&#37327;&#30456;&#21516;&#26102;&#65292;&#26356;&#35814;&#32454;&#30340;&#37027;&#19968;&#20010;&#20250;&#35748;&#20026;&#30456;&#23545;&#36866;&#21512;&#12290;&#22914; <code class="literal">/foo/bar*</code>  &#27604; <code class="literal">/foo/*</code> &#26356;&#20026;&#35814;&#32454;&#12290;</p>
<p>&#24403;&#20004;&#20010;&#27169;&#24335;&#20013;&#21464;&#37327;&#20010;&#25968;&#35814;&#32454;&#31243;&#24230;&#30456;&#21516;&#26102;&#65292;&#20351;&#29992;&#26356;&#23569;&#36890;&#37197;&#31526;&#30340;&#37027;&#19968;&#20010;&#20250;&#30456;&#23545;&#20855;&#20307;&#12290;&#22914;  <code class="literal">/hotels/{hotel}</code> &#27604;  <code class="literal">/hotels/{hotel}</code> &#26356;&#21152;&#20855;&#20307;&#12290;</p>
<p>&#19968;&#20123;&#39069;&#22806;&#30340;&#29305;&#21035;&#35268;&#23450;&#65306;</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
&#20219;&#24847;&#27169;&#24335;&#37117;&#27604;&#40664;&#35748;&#20840;&#21305;&#37197; <code class="literal">/**</code> &#27169;&#24335;&#20855;&#20307;&#12290;&#22914;&#65306;<code class="literal">/api/{a}/{b}/{c}</code> &#27604; <code class="literal">/**</code> &#26356;&#21152;&#20855;&#20307;&#12290;
</li><li class="listitem">
&#20219;&#24847;&#19981;&#21253;&#21547;&#20004;&#20010;&#36890;&#37197;&#31526;&#30340;&#27169;&#24335;&#37117;&#27604;<span class="strong"><strong>&#21069;&#32512;&#27169;&#24335;</strong></span>&#65288;&#22914; <code class="literal">/public/**</code>) &#26356;&#21152;&#20855;&#20307;&#12290;<code class="literal">/public/path3/{a}/{b}/{c}</code> &#27604; <code class="literal">/public/**</code> &#26356;&#21152;&#20855;&#20307;&#12290;
</li></ul></div>

<p>For the full details see <code class="literal">AntPatternComparator</code> in <code class="literal">AntPathMatcher</code>. Note that the PathMatcher
can be customized (see <a class="xref" href="mvc.html#mvc-config-path-matching" title="16.16.9&nbsp;Path Matching">Section&nbsp;16.16.9, &#8220;Path Matching&#8221;</a> in the section on configuring Spring MVC).</p>
<p>&#20840;&#37096;&#32454;&#33410;&#20449;&#24687;&#21487;&#26597;&#30475; <code class="literal">AntPathMatcher</code> &#30340; <code class="literal">AntPatternComparator</code>&#12290;&#27880;&#24847;&#65292;PathMatcher &#26159;&#21487;&#20197;&#33258;&#23450;&#20041;&#30340;&#12290;&#65288;&#21487;&#26597;&#30475; <a class="xref" href="mvc.html#mvc-config-path-matching" title="16.16.9&nbsp;Path Matching">Section&nbsp;16.16.9, &#8220;Path Matching&#8221;</a> &#30340; Spring MVC &#37197;&#32622;&#65289;</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="mvc-ann-requestmapping-placeholders" href="#mvc-ann-requestmapping-placeholders"></a>&#36335;&#24452;&#27169;&#24335;&#19982;&#21344;&#20301;&#31526;</h4></div></div></div>

<p>&#22312; <code class="literal">@RequestMapping</code> &#27880;&#35299;&#20013;&#65292;&#27169;&#24335;&#25903;&#25345;&#20351;&#29992;&#21344;&#20301;&#31526;&#26469;&#20195;&#26367;&#26412;&#22320;&#23646;&#24615; &#21644;/&#25110;&#32773; &#31995;&#32479;&#23646;&#24615;&#21644;&#29615;&#22659;&#21464;&#37327;&#12290;&#24403;&#36335;&#24452;&#38656;&#35201;&#36890;&#36807;&#37197;&#32622;&#25991;&#20214;&#26469;&#33258;&#23450;&#20041;&#26102;&#65292;&#36866;&#21512;&#20351;&#29992;&#21344;&#20301;&#31526;&#12290;&#21344;&#20301;&#31526;&#30340;&#35814;&#32454;&#20449;&#24687;&#65292;&#21487;&#20197;&#26597;&#30475; <code class="literal">PropertyPlaceholderConfigurer</code> &#30340; javadoc&#12290;</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="mvc-ann-requestmapping-suffix-pattern-match" href="#mvc-ann-requestmapping-suffix-pattern-match"></a>&#36335;&#24452;&#27169;&#24335;&#30340;&#21518;&#32512;&#21305;&#37197;</h4></div></div></div>

<p>Spring MVC &#40664;&#35748;&#33258;&#21160;&#25191;&#34892; <code class="literal">".*"</code> &#30340;&#21518;&#32512;&#21305;&#37197;&#65292;&#25152;&#20197;&#24403;&#19968;&#20010;&#25511;&#21046;&#22120;&#21305;&#37197; <code class="literal">/person</code> &#26102;&#65292;&#20854;&#20063;&#38544;&#24335;&#21305;&#37197;  <code class="literal">/person.*</code>&#12290;&#36825;&#26679;&#30340;&#35774;&#35745;&#20801;&#35768;&#36890;&#36807;&#25991;&#20214;&#25193;&#23637;&#21517;&#26469;&#35828;&#26126;&#20869;&#23481;&#30340;&#31867;&#22411;&#21517;&#27604;&#22914; <code class="literal">/person.pdf</code>,
<code class="literal">/person.xml</code> &#31561;&#12290;&#28982;&#32780;&#65292;&#36825;&#37324;&#20250;&#26377;&#19968;&#20010;&#24120;&#29359;&#30340;&#38519;&#38449;&#65292;&#24403;&#36335;&#24452;&#26368;&#21518;&#30340;&#29255;&#27573;&#26159; URI &#27169;&#29256;&#21464;&#37327;&#26102;&#65288;&#22914; <code class="literal">/person/{id}</code>&#65289;&#65292;&#35831;&#27714; <code class="literal">/person/1.json</code> &#21487;&#20197;&#27491;&#30830;&#21305;&#37197;&#36335;&#24452;,&#21464;&#37327; id=1&#65292;&#25299;&#23637;&#21517;&#20026; json&#65292;&#21487;&#24403; id &#33258;&#36523;&#21253;&#21547; . (&#22914; <code class="literal">/person/joe@email.com</code>)&#65292;&#37027;&#21305;&#37197;&#32467;&#26524;&#23601;&#19981;&#26159;&#25105;&#20204;&#25152;&#26399;&#26395;&#30340;&#65292;&#26174;&#28982; ".com" &#19981;&#26159;&#25991;&#20214;&#25193;&#23637;&#21517;&#12290;</p>
<p>&#35299;&#20915;&#36825;&#20010;&#38382;&#39064;&#30340;&#27491;&#30830;&#26041;&#27861;&#26159;&#37197;&#32622; Spring MVC &#21482;&#23545;&#27880;&#20876;&#30340;&#25991;&#20214;&#25193;&#23637;&#21517;&#20570;&#21518;&#32512;&#21305;&#37197;&#65292;&#36825;&#35201;&#27714;&#20869;&#23481;(&#25193;&#23637;&#21517;)&#21327;&#21830;&#22909;&#12290;&#24819;&#20570;&#26356;&#22810;&#30340;&#20102;&#35299;&#65292;&#21487;&#20197;&#20808;&#30475; <a class="xref" href="mvc.html#mvc-config-content-negotiation" title="16.16.4&nbsp;Content Negotiation">Section&nbsp;16.16.4, &#8220;Content Negotiation&#8221;</a> &#21518;&#30475; <a class="xref" href="mvc.html#mvc-config-path-matching" title="16.16.9&nbsp;Path Matching">Section&nbsp;16.16.9, &#8220;Path Matching&#8221;</a>&#65292;&#36825;&#37324;&#23637;&#31034;&#37324;&#22914;&#20309;&#21551;&#29992;&#21518;&#32512;&#27169;&#24335;&#21644;&#22914;&#20309;&#21482;&#20351;&#29992;&#27880;&#20876;&#30340;&#21518;&#32512;&#27169;&#24335;&#12290;</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="mvc-ann-matrix-variables" href="#mvc-ann-matrix-variables"></a>&#30697;&#38453;&#21464;&#37327;</h4></div></div></div>

<p>The URI specification <a class="ulink" href="http://tools.ietf.org/html/rfc3986#section-3.3" target="_top">RFC 3986</a> defines
the possibility of including name-value pairs within path segments. There is no specific
term used in the spec. The general "URI path parameters" could be applied although the
more unique <a class="ulink" href="http://www.w3.org/DesignIssues/MatrixURIs.html" target="_top">"Matrix URIs"</a>, originating
from an old post by Tim Berners-Lee, is also frequently used and fairly well known.
Within Spring MVC these are referred to as matrix variables.</p>
<p>Matrix variables can appear in any path segment, each matrix variable separated with a
";" (semicolon). For example: <code class="literal">"/cars;color=red;year=2012"</code>. Multiple values may be
either "," (comma) separated <code class="literal">"color=red,green,blue"</code> or the variable name may be
repeated <code class="literal">"color=red;color=green;color=blue"</code>.</p>
<p>If a URL is expected to contain matrix variables, the request mapping pattern must
represent them with a URI template. This ensures the request can be matched correctly
regardless of whether matrix variables are present or not and in what order they are
provided.</p>
<p>Below is an example of extracting the matrix variable "q":</p>
<pre class="programlisting"><span class="hl-comment">// GET /pets/42;q=11;r=22</span>

<em><span class="hl-annotation" style="color: gray">@RequestMapping(value = "/pets/{petId}", method = RequestMethod.GET)</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> findPet(<em><span class="hl-annotation" style="color: gray">@PathVariable</span></em> String petId, <em><span class="hl-annotation" style="color: gray">@MatrixVariable</span></em> <span class="hl-keyword">int</span> q) {

    <span class="hl-comment">// petId == 42</span>
    <span class="hl-comment">// q == 11</span>

}</pre>

<p>Since all path segments may contain matrix variables, in some cases you need to be more
specific to identify where the variable is expected to be:</p>
<pre class="programlisting"><span class="hl-comment">// GET /owners/42;q=11/pets/21;q=22</span>

<em><span class="hl-annotation" style="color: gray">@RequestMapping(value = "/owners/{ownerId}/pets/{petId}", method = RequestMethod.GET)</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> findPet(
        <em><span class="hl-annotation" style="color: gray">@MatrixVariable(value="q", pathVar="ownerId")</span></em> <span class="hl-keyword">int</span> q1,
        <em><span class="hl-annotation" style="color: gray">@MatrixVariable(value="q", pathVar="petId")</span></em> <span class="hl-keyword">int</span> q2) {

    <span class="hl-comment">// q1 == 11</span>
    <span class="hl-comment">// q2 == 22</span>

}</pre>

<p>A matrix variable may be defined as optional and a default value specified:</p>
<pre class="programlisting"><span class="hl-comment">// GET /pets/42</span>

<em><span class="hl-annotation" style="color: gray">@RequestMapping(value = "/pets/{petId}", method = RequestMethod.GET)</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> findPet(<em><span class="hl-annotation" style="color: gray">@MatrixVariable(required=false, defaultValue="1")</span></em> <span class="hl-keyword">int</span> q) {

    <span class="hl-comment">// q == 1</span>

}</pre>

<p>All matrix variables may be obtained in a Map:</p>
<pre class="programlisting"><span class="hl-comment">// GET /owners/42;q=11;r=12/pets/21;q=22;s=23</span>

<em><span class="hl-annotation" style="color: gray">@RequestMapping(value = "/owners/{ownerId}/pets/{petId}", method = RequestMethod.GET)</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> findPet(
        <em><span class="hl-annotation" style="color: gray">@MatrixVariable</span></em> Map&lt;String, String&gt; matrixVars,
        <em><span class="hl-annotation" style="color: gray">@MatrixVariable(pathVar="petId"")</span></em> Map&lt;String, String&gt; petMatrixVars) {

    <span class="hl-comment">// matrixVars: ["q" : [11,22], "r" : 12, "s" : 23]</span>
    <span class="hl-comment">// petMatrixVars: ["q" : 11, "s" : 23]</span>

}</pre>

<p>Note that to enable the use of matrix variables, you must set the
<code class="literal">removeSemicolonContent</code> property of <code class="literal">RequestMappingHandlerMapping</code> to <code class="literal">false</code>. By
default it is set to <code class="literal">true</code>.</p>
<div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top">
<p>The MVC Java config and the MVC namespace both provide options for enabling the use of
matrix variables.</p>
<p>If you are using Java config, The <a class="link" href="mvc.html#mvc-config-advanced-java" title="16.16.10&nbsp;Advanced Customizations with MVC Java Config">Advanced Customizations
with MVC Java Config</a> section describes how the <code class="literal">RequestMappingHandlerMapping</code> can
be customized.</p>
<p>In the MVC namespace, the <code class="literal">&lt;mvc:annotation-driven&gt;</code> element has an
<code class="literal">enable-matrix-variables</code> attribute that should be set to <code class="literal">true</code>. By default it is set
to <code class="literal">false</code>.</p>
<pre class="programlisting"><span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
    <span class="hl-attribute">xmlns:mvc</span>=<span class="hl-value">"http://www.springframework.org/schema/mvc"</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/mvc
        http://www.springframework.org/schema/mvc/spring-mvc.xsd"</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;mvc:annotation-driven</span> <span class="hl-attribute">enable-matrix-variables</span>=<span class="hl-value">"true"</span><span class="hl-tag">/&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre>

</td></tr></table></div>

</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="mvc-ann-requestmapping-consumes" href="#mvc-ann-requestmapping-consumes"></a>&#21487;&#28040;&#36153;&#30340;&#23186;&#20307;&#31867;&#22411;</h4></div></div></div>

<p>&#20320;&#21487;&#20197;&#25351;&#23450;&#19968;&#31995;&#21015;&#21487;&#28040;&#36153;&#30340;&#23186;&#20307;&#31867;&#22411;&#26469;&#21387;&#32553;&#20027;&#35201;&#26144;&#23556;&#12290;&#36825;&#26679;&#21482;&#29992;&#24403; <span class="emphasis"><em>Content-Type</em></span> &#35831;&#27714;&#22836;&#21305;&#37197;&#21487;&#28040;&#36153;&#30340;&#23186;&#20307;&#31867;&#22411;&#65292;&#25165;&#35748;&#20026;&#36825;&#20010;&#35831;&#27714;&#26159;&#21487;&#26144;&#23556;&#30340;&#12290;&#22914;&#65306;</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Controller</span></em>
@RequestMapping(value = <span class="hl-string">"/pets"</span>, method = RequestMethod.POST, <span class="strong"><strong>consumes="application/json"</strong></span>)
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> addPet(<em><span class="hl-annotation" style="color: gray">@RequestBody</span></em> Pet pet, Model model) {
    <span class="hl-comment">// &#23454;&#29616;&#30465;&#30053;</span>
}</pre>

<p>Consumable media type expressions can also be negated as in <span class="emphasis"><em>!text/plain</em></span> to match to
all requests other than those with <span class="emphasis"><em>Content-Type</em></span> of <span class="emphasis"><em>text/plain</em></span>.</p>
<div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top">
<p><span class="emphasis"><em>consumes</em></span> &#26465;&#20214;&#25903;&#25345;&#22312;&#31867;&#21644;&#26041;&#27861;&#19978;&#20351;&#29992;&#12290;&#19982;&#22823;&#22810;&#25968;&#24773;&#20917;&#19981;&#19968;&#26679;&#30340;&#26159;&#65292;&#26041;&#27861;&#20013; <span class="emphasis"><em>consumes</em></span> &#20250;&#35206;&#30422;&#31867;&#19978;&#20351;&#29992; &#30340;<span class="emphasis"><em>consumes</em></span>&#65292;&#32780;&#19981;&#26159;&#32487;&#25215; &#31867;&#19978;&#20351;&#29992; &#30340;<span class="emphasis"><em>consumes</em></span>&#12290;</p>
</td></tr></table></div>

</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="mvc-ann-requestmapping-produces" href="#mvc-ann-requestmapping-produces"></a>&#21487;&#29983;&#20135;&#30340;&#23186;&#20307;&#31867;&#22411;</h4></div></div></div>

<p>&#20320;&#21487;&#20197;&#25351;&#23450;&#19968;&#31995;&#21015;&#21487;&#28040;&#36153;&#30340;&#23186;&#20307;&#31867;&#22411;&#26469;&#21387;&#32553;&#20027;&#35201;&#26144;&#23556;&#12290;&#24403; <span class="emphasis"><em>Accept</em></span> &#35831;&#27714;&#22836;&#21305;&#37197;&#21487;&#28040;&#36153;&#30340;&#23186;&#20307;&#31867;&#22411;&#65292;&#25165;&#35748;&#20026;&#36825;&#20010;&#35831;&#27714;&#26159;&#21487;&#26144;&#23556;&#30340;&#12290;&#27492;&#22806;&#65292;&#20351;&#29992; <span class="emphasis"><em>produces</em></span> &#26465;&#20214;&#21487;&#20197;&#20445;&#35777;&#23454;&#38469;&#31867;&#23481;&#30340;&#31867;&#22411;&#65292;<span class="emphasis"><em>produces</em></span>  &#29992;&#20110;&#24418;&#25104; response &#26041;&#38754;&#30340;&#23186;&#20307;&#31867;&#22411;&#65292;&#22914;&#65306;</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Controller</span></em>
@RequestMapping(value = <span class="hl-string">"/pets/{petId}"</span>, method = RequestMethod.GET, <span class="strong"><strong>produces="application/json"</strong></span>)
<em><span class="hl-annotation" style="color: gray">@ResponseBody</span></em>
<span class="hl-keyword">public</span> Pet getPet(<em><span class="hl-annotation" style="color: gray">@PathVariable</span></em> String petId, Model model) {
    <span class="hl-comment">// &#30465;&#30053;&#23454;&#29616;</span>
}</pre>

<p>Just like with <span class="emphasis"><em>consumes</em></span>, producible media type expressions can be negated as in
<span class="emphasis"><em>!text/plain</em></span> to match to all requests other than those with an <span class="emphasis"><em>Accept</em></span> header
value of <span class="emphasis"><em>text/plain</em></span>.</p>
<div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top">
<p><span class="emphasis"><em>produces</em></span>  &#26465;&#20214;&#25903;&#25345;&#22312;&#31867;&#21644;&#26041;&#27861;&#19978;&#20351;&#29992;&#12290;&#19982;&#22823;&#22810;&#25968;&#24773;&#20917;&#19981;&#19968;&#26679;&#30340;&#26159;&#65292;&#26041;&#27861;&#20013; <span class="emphasis"><em>produces</em></span>  &#20250;&#35206;&#30422;&#31867;&#19978;&#20351;&#29992; &#30340;<span class="emphasis"><em>produces</em></span> &#65292;&#32780;&#19981;&#26159;&#32487;&#25215; &#31867;&#19978;&#20351;&#29992; &#30340;<span class="emphasis"><em>produces</em></span> &#12290;</p>
</td></tr></table></div>

</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="mvc-ann-requestmapping-params-and-headers" href="#mvc-ann-requestmapping-params-and-headers"></a>&#35831;&#27714;&#21442;&#25968;&#21644;&#22836;&#23383;&#27573;&#20540;</h4></div></div></div>

<p>&#20320;&#21487;&#20197;&#36890;&#36807;&#35831;&#27714;&#21442;&#25968;&#26465;&#20214;&#26469;&#21387;&#32553;&#35831;&#27714;&#21305;&#37197;&#33539;&#22260;&#65292;&#22914;&#20351;&#29992; <code class="literal">"myParam"</code>, <code class="literal">"!myParam"</code>, &#25110; <code class="literal">"myParam=myValue"</code>&#12290;&#21069;&#20004;&#31181;&#24773;&#20917;&#34920;&#31034; &#23384;&#22312;/&#19981;&#23384;&#22312;&#65292;&#31532;&#19977;&#31181;&#25351;&#23450;&#20102;&#21442;&#25968;&#20540;&#12290;&#22914;&#19979;&#32473;&#20986;&#25351;&#23450;&#21442;&#25968;&#20540;&#30340;&#20363;&#23376;&#65306;</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Controller</span></em>
<em><span class="hl-annotation" style="color: gray">@RequestMapping("/owners/{ownerId}")</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> RelativePathUriTemplateController {

    @RequestMapping(value = <span class="hl-string">"/pets/{petId}"</span>, method = RequestMethod.GET, <span class="strong"><strong>params="myParam=myValue"</strong></span>)
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> findPet(<em><span class="hl-annotation" style="color: gray">@PathVariable</span></em> String ownerId, <em><span class="hl-annotation" style="color: gray">@PathVariable</span></em> String petId, Model model) {
        <span class="hl-comment">// &#30465;&#30053;&#23454;&#29616;</span>
    }

}</pre>

<p>&#31867;&#20284;&#30340;&#65292;&#22836;&#23383;&#27573;&#20063;&#25903;&#25345; &#23384;&#22312;/&#19981;&#23384;&#22312; &#21644;&#22522;&#20110;&#25351;&#23450;&#22836;&#23383;&#27573;&#20540;&#30340;&#21305;&#37197;&#65306;</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Controller</span></em>
<em><span class="hl-annotation" style="color: gray">@RequestMapping("/owners/{ownerId}")</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> RelativePathUriTemplateController {

    @RequestMapping(value = <span class="hl-string">"/pets"</span>, method = RequestMethod.GET, <span class="strong"><strong>headers="myHeader=myValue"</strong></span>)
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> findPet(<em><span class="hl-annotation" style="color: gray">@PathVariable</span></em> String ownerId, <em><span class="hl-annotation" style="color: gray">@PathVariable</span></em> String petId, Model model) {
        <span class="hl-comment">// &#30465;&#30053;&#23454;&#29616;</span>
    }

}</pre>

<div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top">
<p>&#23613;&#31649;&#20320;&#21487;&#20197;&#20351;&#29992;&#23186;&#20307;&#31867;&#22411;&#36890;&#37197;&#31526;&#26469;&#21305;&#37197; <span class="emphasis"><em>Content-Type</em></span> &#21644; <span class="emphasis"><em>Accept</em></span> &#22836;&#23383;&#27573;&#65288;&#22914; <span class="emphasis"><em>"content-type=text/*"</em></span> &#21487;&#20197;&#21305;&#37197; <span class="emphasis"><em>"text/plain"</em></span> &#21644;
<span class="emphasis"><em>"text/html"</em></span>&#65289;&#65292;&#36824;&#26159;&#24314;&#35758;&#20351;&#29992;  <span class="emphasis"><em>consumes</em></span> &#21644; <span class="emphasis"><em>produces</em></span> &#26465;&#20214;&#65292;&#22240;&#20026; <span class="emphasis"><em>consumes</em></span> &#21644; <span class="emphasis"><em>produces</em></span> &#19987;&#38376;&#20026;&#27492;&#32780;&#20351;&#29992;&#30340;&#12290;</p>
</td></tr></table></div>

</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-ann-methods" href="#mvc-ann-methods"></a>16.3.3&nbsp;&#23450;&#20041; @RequestMapping &#22788;&#29702;&#26041;&#27861;</h3></div></div></div>

<p>@RequestMapping &#22788;&#29702;&#26041;&#27861;&#20801;&#35768;&#38750;&#24120;&#28789;&#27963;&#30340;&#31614;&#21517;&#65292;&#20854;&#25903;&#25345;&#26041;&#27861;&#21442;&#25968;&#21644;&#36820;&#22238;&#20540;&#65288;&#22312;&#36825;&#19968;&#33410;&#35848;&#21040;&#65289;&#12290;&#38500;&#20102; <code class="literal">BindingResult</code> &#21442;&#25968;&#65292;&#20854;&#20182;&#31867;&#22411;&#21442;&#25968;&#39034;&#24207;&#38543;&#24847;&#65288;&#19979;&#19968;&#33410;&#20250;&#35848;&#21040;&#65289;&#12290;</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>Spring 3.1 &#20171;&#32461;&#20102;&#19968;&#22871; <code class="literal">@RequestMapping</code> &#26041;&#27861;&#30340;&#26032;&#25903;&#25345;&#31867;&#65292;&#20998;&#21035;&#26159; <code class="literal">RequestMappingHandlerMapping</code> &#21644; <code class="literal">RequestMappingHandlerAdapter</code>&#12290;&#25512;&#33616;&#20351;&#29992;&#26032;&#25903;&#25345;&#31867;&#65292;&#21363;&#20351;&#36825;&#20010;&#38656;&#35201;&#29992;&#21040; Spring MVC 3.1+ &#30340;&#26032;&#29305;&#24615;&#12290;&#26032;&#25903;&#25345;&#31867;&#21644; MVC &#30340; java &#37197;&#32622;&#26041;&#24335;&#22312; MVC &#21629;&#21517;&#31354;&#38388;&#37117;&#40664;&#35748;&#25903;&#25345;&#65292;&#28982;&#32780;&#65292;&#22914;&#26524;&#37117;&#19981;&#38656;&#35201;&#65292;&#24517;&#39035;&#26174;&#24335;&#37197;&#32622;&#12290;</p>
</td></tr></table></div>

<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="mvc-ann-arguments" href="#mvc-ann-arguments"></a>&#21487;&#25903;&#25345;&#30340;&#26041;&#27861;&#21442;&#25968;&#31867;&#22411;</h4></div></div></div>

<p>&#22914;&#19979;&#26159;&#21487;&#20197;&#25903;&#25345;&#30340;&#26041;&#27861;&#21442;&#25968;&#65306;</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
Request &#25110; response &#23545;&#35937; (Servlet API). &#36873;&#25321;&#20219;&#24847;&#25351;&#23450;&#30340; request &#25110; response &#31867;&#22411;&#65292;&#22914;<code class="literal">ServletRequest</code> o&#25110; <code class="literal">HttpServletRequest</code>.
</li><li class="listitem">
Session &#23545;&#35937; (Servlet API):&#38656;&#35201;&#26159; <code class="literal">HttpSession</code> &#31867;&#22411;. &#36825;&#31181;&#31867;&#22411;&#30340;&#21442;&#25968;&#20250;&#24378;&#21046;&#21512;&#36866; session &#30340;&#23384;&#22312;&#12290;&#22240;&#27492;&#65292;&#36825;&#20010;&#21442;&#25968;&#27704;&#36828;&#19981;&#20250;&#20026; null&#12290;
</li></ul></div>

<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>Session &#35775;&#38382;&#21487;&#33021;&#26159;&#38750;&#32447;&#31243;&#23433;&#20840;&#30340;&#65292;&#29305;&#21035;&#26159;&#22312; Servlet &#29615;&#22659;&#12290;&#24403;&#20801;&#35768;&#22810;&#20010;&#35831;&#27714;&#24182;&#21457;&#35775;&#38382; session &#26102;&#65292;&#21487;&#20197;&#32771;&#34385;&#35774;&#32622; <code class="literal">RequestMappingHandlerAdapter</code> &#30340; "synchronizeOnSession" &#20540;&#20026; "true"&#12290;</p>
</td></tr></table></div>

<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<code class="literal">org.springframework.web.context.request.WebRequest</code> &#25110;
<code class="literal">org.springframework.web.context.request.NativeWebRequest</code>.&#20801;&#35768;&#36890;&#36807;&#35831;&#27714;&#21442;&#25968;&#35775;&#38382;&#21644; request/session &#23646;&#24615;&#35775;&#38382;&#65292;&#27809;&#26377;&#19982;&#21407;&#22987;&#30340; Servlet/Portlet API &#32465;&#23450;&#12290;
</li><li class="listitem">
<code class="literal">java.util.Locale</code> &#32473;&#24403;&#21069;&#35831;&#27714;&#26412;&#22320;&#21270;&#65292;&#21462;&#20915;&#20110;&#26368;&#20855;&#20307;&#30340;&#26412;&#22320;&#21270;&#35299;&#26512;&#22120;&#65292;&#23454;&#38469;&#19978;&#21462;&#20915;&#19982;&#26159; Servlet &#29615;&#22659;&#37197;&#32622;&#30340; <code class="literal">LocaleResolver</code> &#12290;
</li><li class="listitem">
<code class="literal">java.io.InputStream</code> / <code class="literal">java.io.Reader</code> &#21487;&#35775;&#38382;&#35831;&#27714;&#30340;&#20869;&#23481;&#12290;&#36825;&#26159; Servlet API &#26292;&#38706;&#30340;&#21407;&#29983; InputStream/Reader &#12290;
</li><li class="listitem">
<code class="literal">java.io.OutputStream</code> / <code class="literal">java.io.Writer</code> &#29992;&#20110; &#20135;&#29983; response &#30340;&#20869;&#23481;&#12290;&#36825;&#26159; Servlet API &#26292;&#38706;&#30340;&#21407;&#29983; OutputStream/Writer.
</li><li class="listitem">
<code class="literal">org.springframework.http.HttpMethod</code> &#21487;&#35775;&#38382; HTTP &#35831;&#27714;&#26041;&#27861;&#12290;
</li><li class="listitem">
<code class="literal">java.security.Principal</code> &#21253;&#21547;&#20102;&#24403;&#21069;&#25480;&#26435;&#29992;&#25143;&#12290;
</li><li class="listitem">
<code class="literal">@PathVariable</code> &#27880;&#35299;&#21442;&#25968;&#65292;&#21487;&#35775;&#38382; URI &#27169;&#29256;&#21464;&#37327;&#12290;&#21487;&#26597;&#30475; <a class="xref" href="mvc.html#mvc-ann-requestmapping-uri-templates" title="URI &#27169;&#29256;&#27169;&#24335;">the section called &#8220;URI &#27169;&#29256;&#27169;&#24335;&#8221;</a>&#12290;
</li><li class="listitem">
<code class="literal">@MatrixVariable</code> annotated parameters for access to name-value pairs located in URI
path segments. See <a class="xref" href="mvc.html#mvc-ann-matrix-variables" title="&#30697;&#38453;&#21464;&#37327;">the section called &#8220;&#30697;&#38453;&#21464;&#37327;&#8221;</a>.
</li><li class="listitem">
<code class="literal">@RequestParam</code> &#27880;&#35299;&#21442;&#25968;&#65292;&#21487;&#35775;&#38382;&#25351;&#23450; Servlet request &#21442;&#25968;&#12290;&#21442;&#25968;&#20540;&#20250;&#34987;&#36716;&#25442;&#20026;&#26041;&#27861;&#21442;&#25968;&#30340;&#31867;&#22411;&#12290;&#21487;&#26597;&#30475;<a class="xref" href="mvc.html#mvc-ann-requestparam" title="&#20351;&#29992; @RequestParam &#23558;&#35831;&#27714;&#21442;&#25968;&#32465;&#23450;&#21040;&#26041;&#27861;&#21442;&#25968;">the section called &#8220;&#20351;&#29992; @RequestParam &#23558;&#35831;&#27714;&#21442;&#25968;&#32465;&#23450;&#21040;&#26041;&#27861;&#21442;&#25968;&#8221;</a>.
</li><li class="listitem">
<code class="literal">@RequestHeader</code> &#27880;&#35299;&#21442;&#25968;&#65292;&#21487;&#35775;&#38382;&#25351;&#23450; Servlet request &#30340; HTTP &#22836;&#23383;&#27573;&#12290;&#21442;&#25968;&#20540;&#20250;&#34987;&#36716;&#25442;&#20026;&#26041;&#27861;&#21442;&#25968;&#30340;&#31867;&#22411;&#12290;&#21487;&#26597;&#30475; <a class="xref" href="mvc.html#mvc-ann-requestheader" title="&#20351;&#29992; @RequestHeader &#26144;&#23556;&#35831;&#27714;&#22836;&#23383;&#27573;&#23646;&#24615;">the section called &#8220;&#20351;&#29992; @RequestHeader &#26144;&#23556;&#35831;&#27714;&#22836;&#23383;&#27573;&#23646;&#24615;&#8221;</a>
</li><li class="listitem">
<code class="literal">@RequestBody</code> &#27880;&#35299;&#21442;&#25968;&#65292;&#21487;&#35775;&#38382; HTTP &#35831;&#27714;&#20307;&#12290;&#21442;&#25968;&#20540;&#20351;&#29992; <code class="literal">HttpMessageConverter</code> &#36716;&#25442;&#20026;&#26041;&#27861;&#21442;&#25968;&#31867;&#22411;&#65292;&#21487;&#26597;&#30475;  <a class="xref" href="mvc.html#mvc-ann-requestbody" title="&#20351;&#29992; @RequestBody &#26144;&#23556;&#35831;&#27714;&#20307;">the section called &#8220;&#20351;&#29992; @RequestBody &#26144;&#23556;&#35831;&#27714;&#20307;&#8221;</a>
</li><li class="listitem">
<code class="literal">@RequestPart</code> &#27880;&#35299;&#21442;&#25968;&#65292;&#21487;&#35775;&#38382; "multipart/form-data" &#35831;&#27714;&#30340;&#20869;&#23481;&#12290;&#21487;&#26597;&#30475; <a class="xref" href="mvc.html#mvc-multipart-forms-non-browsers" title="16.10.5&nbsp;Handling a file upload request from programmatic clients">Section&nbsp;16.10.5, &#8220;Handling a file upload request from programmatic clients&#8221;</a> &#21644; <a class="xref" href="mvc.html#mvc-multipart" title="16.10&nbsp;Spring&#8217;s multipart (file upload) support">Section&nbsp;16.10, &#8220;Spring&#8217;s multipart (file upload) support&#8221;</a>
</li><li class="listitem">
<code class="literal">HttpEntity&lt;?&gt;</code> &#21442;&#25968;&#65292;&#21487;&#35775;&#38382; Servlet request &#30340;HTTP &#22836;&#21644;&#20869;&#23481;&#12290;&#35831;&#27714;&#27969;&#20351;&#29992; <code class="literal">HttpMessageConverter</code> &#36716;&#25442;&#20026; entity body&#65292;&#21487;&#26597;&#30475; <a class="xref" href="mvc.html#mvc-ann-httpentity" title="&#20351;&#29992; HttpEntity">the section called &#8220;&#20351;&#29992; HttpEntity&#8221;</a>
</li><li class="listitem">
<code class="literal">java.util.Map</code> / <code class="literal">org.springframework.ui.Model</code> / <code class="literal">org.springframework.ui.ModelMap</code>
&#29992;&#26469;&#20016;&#23500;&#38544;&#24335;&#27169;&#22411;&#65288;&#26292;&#38706;&#32473; web &#35270;&#22270;&#65289;
</li><li class="listitem">
<code class="literal">org.springframework.web.servlet.mvc.support.RedirectAttributes</code> to specify the exact
set of attributes to use in case of a redirect and also to add flash attributes
(attributes stored temporarily on the server-side to make them available to the
request after the redirect). <code class="literal">RedirectAttributes</code> is used instead of the implicit
model if the method returns a "redirect:" prefixed view name or <code class="literal">RedirectView</code>.
</li><li class="listitem">
Command or form objects to bind request parameters to bean properties (via setters) or
directly to fields, with customizable type conversion, depending on <code class="literal">@InitBinder</code>
methods and/or the HandlerAdapter configuration. See the <code class="literal">webBindingInitializer</code>
property on <code class="literal">RequestMappingHandlerAdapter</code>. Such command objects along with their
validation results will be exposed as model attributes by default, using the command
class class name - e.g. model attribute "orderAddress" for a command object of type
"some.package.OrderAddress". The <code class="literal">ModelAttribute</code> annotation can be used on a method
argument to customize the model attribute name used.
</li><li class="listitem">
<code class="literal">org.springframework.validation.Errors</code> /
<code class="literal">org.springframework.validation.BindingResult</code> &#24050;&#25191;&#34892;&#30340;&#21629;&#20196;&#25110;&#34920;&#21333;&#23545;&#35937;&#30340;&#39564;&#35777;&#38169;&#35823;(the immediately preceding method argument).
</li><li class="listitem">
<code class="literal">org.springframework.web.bind.support.SessionStatus</code> status handle for marking form
processing as complete, which triggers the cleanup of session attributes that have
been indicated by the <code class="literal">@SessionAttributes</code> annotation at the handler type level.
</li><li class="listitem">
<code class="literal">org.springframework.web.util.UriComponentsBuilder</code> a builder for preparing a URL
relative to the current request&#8217;s host, port, scheme, context path, and the literal
part of the servlet mapping.
</li></ul></div>

<p><code class="literal">Errors</code> &#25110; <code class="literal">BindingResult</code> &#21442;&#25968;&#24517;&#39035;&#36319;&#38543;&#25152;&#32465;&#23450;&#30340;&#27169;&#22411;&#23545;&#35937;&#65292;&#22914;&#26524;&#26041;&#27861;&#31614;&#21517;&#26377;&#36229;&#36807;&#19968;&#20010;&#27169;&#22411;&#23545;&#35937;&#30340;&#65292;Spring &#20250;&#20026;&#20854;&#20998;&#21035;&#21019;&#24314; <code class="literal">BindingResult</code> &#23454;&#20363;&#12290;&#22240;&#27492;&#65292;&#22914;&#19979;&#20363;&#23376;&#27809;&#26377;&#25928;&#26524;&#65306;</p>
<p>
<b>BindingResult and @ModelAttribute &#30340;&#26080;&#25928;&#39034;&#24207;.&nbsp;</b>

</p><pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@RequestMapping(method = RequestMethod.POST)</span></em>
<span class="hl-keyword">public</span> String processSubmit(<span class="strong"><strong>@ModelAttribute("pet") Pet pet</strong></span>, Model model, <span class="strong"><strong>BindingResult result</strong></span>) { ... }</pre><p>

</p>

<p>&#27880;&#24847;&#65292;&#22240;&#20026; <code class="literal">Pet</code> &#21644; <code class="literal">BindingResult</code> &#20043;&#38388;&#23384;&#22312;&#21442;&#25968; <code class="literal">Model</code>&#12290;&#35201;&#20854;&#26377;&#25928;&#65292;&#20320;&#38656;&#35201;&#37325;&#26032;&#25490;&#24207;&#21442;&#25968;&#31561;&#25105;&#20301;&#32622;&#65292;&#22914;&#19979;&#65306;</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@RequestMapping(method = RequestMethod.POST)</span></em>
<span class="hl-keyword">public</span> String processSubmit(<span class="strong"><strong>@ModelAttribute("pet") Pet pet</strong></span>, <span class="strong"><strong>BindingResult result</strong></span>, Model model) { ... }</pre>

<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>JDK 1.8&#8217;s <code class="literal">java.util.Optional</code> is supported as a method parameter type with annotations
that have a <code class="literal">required</code> attribute (e.g. <code class="literal">@RequestParam</code>, <code class="literal">@RequestHeader</code>, etc. The use
of <code class="literal">java.util.Optional</code> in those cases is equivalent to having <code class="literal">required=false</code>.</p>
</td></tr></table></div>

</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="mvc-ann-return-types" href="#mvc-ann-return-types"></a>&#21487;&#25903;&#25345;&#30340;&#26041;&#27861;&#36820;&#22238;&#31867;&#22411;</h4></div></div></div>

<p>&#20197;&#19979;&#26159;&#21487;&#25903;&#25345;&#30340;&#36820;&#22238;&#31867;&#22411;&#65306;</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
A <code class="literal">ModelAndView</code> object, with the model implicitly enriched with command objects and
the results of <code class="literal">@ModelAttribute</code> annotated reference data accessor methods.
</li><li class="listitem">
A <code class="literal">Model</code> object, with the view name implicitly determined through a
<code class="literal">RequestToViewNameTranslator</code> and the model implicitly enriched with command objects
and the results of <code class="literal">@ModelAttribute</code> annotated reference data accessor methods.
</li><li class="listitem">
A <code class="literal">Map</code> object for exposing a model, with the view name implicitly determined through
a <code class="literal">RequestToViewNameTranslator</code> and the model implicitly enriched with command objects
and the results of <code class="literal">@ModelAttribute</code> annotated reference data accessor methods.
</li><li class="listitem">
A <code class="literal">View</code> object, with the model implicitly determined through command objects and
<code class="literal">@ModelAttribute</code> annotated reference data accessor methods. The handler method may
also programmatically enrich the model by declaring a <code class="literal">Model</code> argument (see above).
</li><li class="listitem">
A <code class="literal">String</code> value that is interpreted as the logical view name, with the model
implicitly determined through command objects and <code class="literal">@ModelAttribute</code> annotated
reference data accessor methods. The handler method may also programmatically enrich
the model by declaring a <code class="literal">Model</code> argument (see above).
</li><li class="listitem">
<code class="literal">void</code> if the method handles the response itself (by writing the response content
directly, declaring an argument of type <code class="literal">ServletResponse</code> / <code class="literal">HttpServletResponse</code> for
that purpose) or if the view name is supposed to be implicitly determined through a
<code class="literal">RequestToViewNameTranslator</code> (not declaring a response argument in the handler method
signature).
</li><li class="listitem">
If the method is annotated with <code class="literal">@ResponseBody</code>, the return type is written to the
response HTTP body. The return value will be converted to the declared method argument
type using <code class="literal">HttpMessageConverter</code>s. See <a class="xref" href="mvc.html#mvc-ann-responsebody" title="&#20351;&#29992; @ResponseBody &#26144;&#23556;&#21709;&#24212;&#20307;">the section called &#8220;&#20351;&#29992; @ResponseBody &#26144;&#23556;&#21709;&#24212;&#20307;&#8221;</a>.
</li><li class="listitem">
An <code class="literal">HttpEntity&lt;?&gt;</code> or <code class="literal">ResponseEntity&lt;?&gt;</code> object to provide access to the Servlet
response HTTP headers and contents. The entity body will be converted to the response
stream using <code class="literal">HttpMessageConverter</code>s. See <a class="xref" href="mvc.html#mvc-ann-httpentity" title="&#20351;&#29992; HttpEntity">the section called &#8220;&#20351;&#29992; HttpEntity&#8221;</a>.
</li><li class="listitem">
An <code class="literal">HttpHeaders</code> object to return a response with no body.
</li><li class="listitem">
A <code class="literal">Callable&lt;?&gt;</code> can be returned when the application wants to produce the return value
asynchronously in a thread managed by Spring MVC.
</li><li class="listitem">
A <code class="literal">DeferredResult&lt;?&gt;</code> can be returned when the application wants to produce the return
value from a thread of its own choosing.
</li><li class="listitem">
A <code class="literal">ListenableFuture&lt;?&gt;</code> can be returned when the application wants to produce the return
value from a thread of its own choosing.
</li><li class="listitem">
Any other return type is considered to be a single model attribute to be exposed to
the view, using the attribute name specified through <code class="literal">@ModelAttribute</code> at the method
level (or the default attribute name based on the return type class name). The model
is implicitly enriched with command objects and the results of <code class="literal">@ModelAttribute</code>
annotated reference data accessor methods.
</li></ul></div>

</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="mvc-ann-requestparam" href="#mvc-ann-requestparam"></a>&#20351;&#29992; @RequestParam &#23558;&#35831;&#27714;&#21442;&#25968;&#32465;&#23450;&#21040;&#26041;&#27861;&#21442;&#25968;</h4></div></div></div>

<p>&#22312;&#25511;&#21046;&#22120;&#37324;&#65292;&#20351;&#29992; <code class="literal">@RequestParam</code> &#23558;&#35831;&#27714;&#21442;&#25968;&#32465;&#23450;&#21040;&#26041;&#27861;&#21442;&#25968;&#12290;</p>
<p>&#22914;&#19979;&#20195;&#30721;&#29255;&#27573;&#28436;&#31034;&#20102;&#20854;&#29992;&#27861;&#65306;</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Controller</span></em>
<em><span class="hl-annotation" style="color: gray">@RequestMapping("/pets")</span></em>
<em><span class="hl-annotation" style="color: gray">@SessionAttributes("pet")</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> EditPetForm {

    <span class="hl-comment">// ...</span>

    <em><span class="hl-annotation" style="color: gray">@RequestMapping(method = RequestMethod.GET)</span></em>
    <span class="hl-keyword">public</span> String setupForm(<span class="strong"><strong>@RequestParam("petId") int petId</strong></span>, ModelMap model) {
        Pet pet = <span class="hl-keyword">this</span>.clinic.loadPet(petId);
        model.addAttribute(<span class="hl-string">"pet"</span>, pet);
        <span class="hl-keyword">return</span> <span class="hl-string">"petForm"</span>;
    }

    <span class="hl-comment">// ...</span>

}</pre>

<p>&#20351;&#29992; <code class="literal">@RequestParam</code> &#30340;&#21442;&#25968;&#40664;&#35748;&#26159;&#24517;&#39035;&#25552;&#20379;&#30340;&#65292;&#24403;&#28982;&#65292;&#20320;&#21487;&#20197;&#25351;&#23450;&#20854;&#20026;&#21487;&#36873;&#30340;&#65292;&#23558; <code class="literal">@RequestParam</code> &#30340; <code class="literal">reqired</code> &#23646;&#24615;&#35774;&#32622; <code class="literal">false</code> &#21363;&#21487;&#12290;(&#22914;, <code class="literal">@RequestParam(value="id", required=false)</code>).</p>
<p>&#22914;&#26524;&#26041;&#27861;&#21442;&#25968;&#30340;&#31867;&#22411;&#19981;&#26159; <code class="literal">String</code>,&#31867;&#22411;&#36716;&#25442;&#20250;&#33258;&#21160;&#25191;&#34892;&#65292;&#21487;&#26597;&#30475; <a class="xref" href="mvc.html#mvc-ann-typeconversion" title="&#26041;&#27861;&#21442;&#25968;&#21644;&#31867;&#22411;&#36716;&#25442;">the section called &#8220;&#26041;&#27861;&#21442;&#25968;&#21644;&#31867;&#22411;&#36716;&#25442;&#8221;</a>&#12290;</p>
<p>&#22914;&#26524;&#23558; <code class="literal">@RequestParam</code> &#29992;&#20110; <code class="literal">Map&lt;String, String&gt;</code> &#25110;
<code class="literal">MultiValueMap&lt;String, String&gt;</code> &#21442;&#25968;&#65292;&#27492;&#21442;&#25968; map &#20250;&#22635;&#20805;&#25152;&#26377;&#30340;&#35831;&#27714;&#21442;&#25968;&#12290;</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="mvc-ann-requestbody" href="#mvc-ann-requestbody"></a>&#20351;&#29992; @RequestBody &#26144;&#23556;&#35831;&#27714;&#20307;</h4></div></div></div>

<p><code class="literal">@RequestBody</code> &#27880;&#35299;&#21442;&#25968;&#34920;&#31034;&#35813;&#21442;&#25968;&#23558;&#19982; HTTP &#35831;&#27714;&#20307;&#32465;&#23450;&#12290;&#20363;&#23376;&#65306;</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@RequestMapping(value = "/something", method = RequestMethod.PUT)</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> handle(<em><span class="hl-annotation" style="color: gray">@RequestBody</span></em> String body, Writer writer) <span class="hl-keyword">throws</span> IOException {
    writer.write(body);
}</pre>

<p>&#20320;&#20351;&#29992; <code class="literal">HttpMessageConverter</code> &#23558;&#35831;&#27714;&#20307;&#36716;&#25442;&#20026;&#26041;&#27861;&#21442;&#25968;&#12290;<code class="literal">HttpMessageConverter</code> &#36127;&#36131;&#23558;&#35831;&#27714;&#20449;&#24687;&#36716;&#25442;&#20026;&#25351;&#23450;&#23545;&#35937;&#21644;&#23558;&#25351;&#23450;&#23545;&#35937;&#36716;&#25442;&#20026;&#35831;&#27714;&#20307;&#12290;<code class="literal">RequestMappingHandlerAdapter</code> &#40664;&#35748;&#25903;&#25345; <code class="literal">@RequestBody</code> &#20351;&#29992;&#20197;&#19979; <code class="literal">HttpMessageConverters</code>&#12290;</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<code class="literal">ByteArrayHttpMessageConverter</code> &#36716;&#25442;&#20026;&#23383;&#33410;&#25968;&#32452;&#12290;
</li><li class="listitem">
<code class="literal">StringHttpMessageConverter</code> &#36716;&#25442;&#20026;&#23383;&#31526;&#20018;&#12290;
</li><li class="listitem">
<code class="literal">FormHttpMessageConverter</code> &#34920;&#21333;&#25968;&#25454;&#19982; MultiValueMap&lt;String, String&gt; &#20114;&#36716;&#12290;
</li><li class="listitem">
<code class="literal">SourceHttpMessageConverter</code> &#34920;&#21333;&#25968;&#25454;&#19982; javax.xml.transform.Source &#20114;&#36716;&#12290;
</li></ul></div>

<p>&#36716;&#25442;&#36215;&#30340;&#35814;&#32454;&#20449;&#24687;&#65292;&#21487;&#26597;&#30475; <a class="link" href="remoting.html#rest-message-conversion" title="21.10.2&nbsp;HTTP Message Conversion">Message
Converters</a>&#12290;&#20063;&#25552;&#37266;&#19968;&#19979;&#65292;&#24403;&#20351;&#29992; MVC &#21629;&#21517;&#31354;&#38388; &#25110; MVC Java &#37197;&#32622;&#26102;&#65292;&#40664;&#35748;&#27880;&#20876;&#20102;&#19968;&#31995;&#21015;&#36716;&#25442;&#22120;&#65292;&#35814;&#32454;&#20449;&#24687;&#21487;&#26597;&#30475; <a class="xref" href="mvc.html#mvc-config-enable" title="16.16.1&nbsp;Enabling the MVC Java Config or the MVC XML Namespace">Section&nbsp;16.16.1, &#8220;Enabling the MVC Java Config or the MVC XML Namespace&#8221;</a>&#12290;</p>
<p>&#22914;&#26524;&#20320;&#24819;&#35835;&#20889; XML &#30340;&#65292;&#38656;&#35201;&#27880;&#20876; <code class="literal">MarshallingHttpMessageConverter</code>&#65292;<code class="literal">MarshallingHttpMessageConverter</code> &#21253;&#21547;&#20102; <code class="literal">org.springframework.oxm</code> &#21253;&#20013;&#30340; <code class="literal">Marshaller</code> &#21644; <code class="literal">Unmarshaller</code> &#23454;&#29616;&#12290;&#22914;&#19979;&#20363;&#23376;&#28436;&#31034;&#20102;&#30452;&#25509;&#22312;&#37197;&#32622;&#25991;&#20214;&#27880;&#20876; <code class="literal">MarshallingHttpMessageConverter</code>&#65292;&#22914;&#26524;&#20320;&#30340;&#24212;&#29992;&#36890;&#36807; MVC &#21629;&#21517;&#31354;&#38388;&#25110; MVC Java &#37197;&#32622;&#30340;&#65292;&#21487;&#26597;&#30475; <a class="xref" href="mvc.html#mvc-config-enable" title="16.16.1&nbsp;Enabling the MVC Java Config or the MVC XML Namespace">Section&nbsp;16.16.1, &#8220;Enabling the MVC Java Config or the MVC XML Namespace&#8221;</a>&#12290;</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"messageConverters"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;util:list</span> <span class="hl-attribute">id</span>=<span class="hl-value">"beanList"</span><span class="hl-tag">&gt;</span>
            <span class="hl-tag">&lt;ref</span> <span class="hl-attribute">bean</span>=<span class="hl-value">"stringHttpMessageConverter"</span><span class="hl-tag">/&gt;</span>
            <span class="hl-tag">&lt;ref</span> <span class="hl-attribute">bean</span>=<span class="hl-value">"marshallingHttpMessageConverter"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;/util:list&gt;</span>
    <span class="hl-tag">&lt;/property
&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"stringHttpMessageConverter"</span>
        <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.http.converter.StringHttpMessageConverter"</span><span class="hl-tag">/&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"marshallingHttpMessageConverter"</span>
        <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.http.converter.xml.MarshallingHttpMessageConverter"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"marshaller"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"castorMarshaller"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"unmarshaller"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"castorMarshaller"</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"castorMarshaller"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.oxm.castor.CastorMarshaller"</span><span class="hl-tag">/&gt;</span></pre>

<p><code class="literal">@RequestBody</code> &#26041;&#27861;&#21442;&#25968;&#21487;&#28155;&#21152; <code class="literal">@Valid</code> &#27880;&#35299;&#65292;&#34987;&#27880;&#35299;&#30340;&#21442;&#25968;&#20250;&#20351;&#29992;&#37197;&#32622;&#30340; <code class="literal">Validator</code> &#26469;&#39564;&#35777;&#12290;&#24403;&#20351;&#29992; MVC &#21629;&#21517;&#31354;&#38388;&#25110; mvc Java &#37197;&#32622;&#26102;&#65292;&#24212;&#29992;&#20250;&#33258;&#21160;&#37197;&#32622; JSR-303 &#39564;&#35777;&#22120;&#65288;&#21069;&#25552;&#26159;&#22312;&#31867;&#36335;&#24452;&#33021;&#25214;&#21040; JSR-303 &#30340;&#23454;&#29616;&#65289;&#12290;</p>
<p>&#31867;&#20284;&#20110; <code class="literal">@ModelAttribute</code> &#21442;&#25968;&#65292;<code class="literal">Errors</code> &#21442;&#25968;&#20063;&#21487;&#29992;&#26469;&#26816;&#27979;&#38169;&#35823;&#12290;&#24403; <code class="literal">Errore</code> &#21442;&#25968;&#27809;&#26377;&#22768;&#26126;&#26102;&#65292;&#25110;&#25243;&#20986; <code class="literal">MethodArgumentNotValidException</code>&#12290;&#27492;&#24322;&#24120;&#20250;&#34987; <code class="literal">DefaultHandlerExceptionResolver</code> &#22788;&#29702; &#8212;&#8212; &#21521;&#23458;&#25143;&#31471;&#21457;&#36865; <code class="literal">400</code> &#38169;&#35823;&#12290;</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>&#21487;&#20197;&#26597;&#30475; <a class="xref" href="mvc.html#mvc-config-enable" title="16.16.1&nbsp;Enabling the MVC Java Config or the MVC XML Namespace">Section&nbsp;16.16.1, &#8220;Enabling the MVC Java Config or the MVC XML Namespace&#8221;</a>&#65292;&#20102;&#35299;&#22914;&#20309;&#20351;&#29992; MVC &#21629;&#21517;&#31354;&#38388;&#21644; MVC Java &#37197;&#32622;&#26469;&#37197;&#32622;&#20449;&#24687;&#36716;&#25442;&#22120;&#21644;&#39564;&#35777;&#22120;&#12290;</p>
</td></tr></table></div>

</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="mvc-ann-responsebody" href="#mvc-ann-responsebody"></a>&#20351;&#29992; @ResponseBody &#26144;&#23556;&#21709;&#24212;&#20307;</h4></div></div></div>

<p><code class="literal">@ResponseBody</code> &#30340;&#20351;&#29992;&#31867;&#20284;&#20110; <code class="literal">@RequestBody</code>&#12290;&#27492;&#27880;&#35299;&#29992;&#22312;&#26041;&#27861;&#19978;&#65292;&#29992;&#26469;&#34920;&#31034;&#30452;&#25509;&#23558;&#36820;&#22238;&#25968;&#25454;&#20889;&#21040; HTTP &#21709;&#24212;&#20307;&#37324;&#12290;&#27880;&#24847;&#65292;&#19981;&#26159;&#23558;&#25968;&#25454;&#25918;&#21040; Model &#20013;&#65292;&#25110;&#35299;&#26512;&#20026;&#35270;&#22270;&#21517;&#31216;&#12290;&#20363;&#23376;&#65306;</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@RequestMapping(value = "/something", method = RequestMethod.PUT)</span></em>
<em><span class="hl-annotation" style="color: gray">@ResponseBody</span></em>
<span class="hl-keyword">public</span> String helloWorld() {
    <span class="hl-keyword">return</span> <span class="hl-string">"Hello World"</span>;
}</pre>

<p>&#19978;&#36848;&#20363;&#23376;&#20250;&#23558; <code class="literal">Hello World</code> &#25991;&#26412;&#20889;&#21040; HTTP &#21709;&#24212;&#27969;&#20013;&#12290;</p>
<p>&#19982; <code class="literal">@RequestBody</code> &#19968;&#26679;&#65292;Spring &#20351;&#29992; <code class="literal">HttpMessageConverter</code> &#23558;&#36820;&#22238;&#23545;&#35937;&#36716;&#25442;&#20026;&#21709;&#24212;&#20307;&#12290;&#36716;&#25442;&#30340;&#35814;&#32454;&#20449;&#24687;&#21487;&#20197;&#26597;&#30475;&#19978;&#19968;&#33410;<a class="link" href="remoting.html#rest-message-conversion" title="21.10.2&nbsp;HTTP Message Conversion">&#20449;&#24687;&#36716;&#25442;&#22120;</a>&#12290;</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="mvc-ann-restcontroller" href="#mvc-ann-restcontroller"></a>&#20351;&#29992; @RestController &#21019;&#24314; REST &#25511;&#21046;&#22120;</h4></div></div></div>

<p>&#19968;&#31181;&#27604;&#36739;&#24120;&#35265;&#30340;&#22330;&#26223;&#65292;&#25511;&#21046;&#22120;&#23454;&#29616; REST API&#65292;&#21482;&#20250;&#36820;&#22238; JSON&#12289;XML &#25110;&#20854;&#20182;&#33258;&#23450;&#20041;&#23186;&#20307;&#31867;&#22411;&#12290;&#20026;&#20102;&#26041;&#20415;&#65292;&#20320;&#21487;&#20197;&#22312;&#25511;&#21046;&#22120;&#19978;&#28155;&#21152; <code class="literal">@RestController</code> &#27880;&#35299;&#65292;&#32780;&#19981;&#26159;&#22312;&#27599;&#19968;&#20010; <code class="literal">@RequestMapping</code> &#19978;&#20351;&#29992; <code class="literal">@ResponseBody</code>&#12290;</p>
<p><a class="ulink" href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/web/bind/annotation/RestController.html" target="_top"><code class="literal">@RestController</code></a> &#26159;&#19968;&#20010;&#32467;&#21512;&#20102; <code class="literal">@ResponseBody</code> &#21644; <code class="literal">@Controller</code> &#30340;&#27880;&#35299;&#12290;&#19981;&#20165;&#22914;&#27492;&#65292;<code class="literal">@RestController</code> &#36171;&#20104;&#20102;&#25511;&#21046;&#22120;&#26356;&#22810;&#30340;&#24847;&#20041;&#65292;&#22312;&#26410;&#26469;&#30340;&#29256;&#26412;&#20013;&#21487;&#33021;&#20250;&#25658;&#24102;&#39069;&#22806;&#30340;&#35821;&#20041;&#12290;&#12290;</p>
<p>&#19982;&#24120;&#35268; <code class="literal">@Controller</code> &#19968;&#26679;&#65292;<code class="literal">@RestController</code> &#21487;&#20197;&#21327;&#21161; <code class="literal">@ControllerAdvice</code> bean&#12290;&#35814;&#32454;&#20449;&#24687;&#21487;&#26597;&#30475;<a class="xref" href="mvc.html#mvc-ann-controller-advice" title="&#20351;&#29992; @ControllerAdvice &#27880;&#35299;&#22686;&#24378;&#25511;&#21046;&#22120;">the section called &#8220;&#20351;&#29992; <code class="literal">@ControllerAdvice</code> &#27880;&#35299;&#22686;&#24378;&#25511;&#21046;&#22120;&#8221;</a>&#12290;</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="mvc-ann-httpentity" href="#mvc-ann-httpentity"></a>&#20351;&#29992; HttpEntity</h4></div></div></div>

<p><code class="literal">HttpEntity</code> &#30340;&#29992;&#27861;&#31867;&#20284;&#20110; <code class="literal">@RequestBody</code> &#21644; <code class="literal">@ResponseBody</code> &#27880;&#35299;&#12290;&#38500;&#20102;&#21487;&#20197;&#35775;&#38382;&#35831;&#27714;/&#21709;&#24212;&#20307;&#65292;<code class="literal">HttpEntity</code>(&#21644;&#29305;&#29992;&#19982;&#21709;&#24212;&#30340;&#23376;&#31867; <code class="literal">ResponseEntity</code>) &#36824;&#21487;&#20197;&#35775;&#38382; request &#21644; response &#30340;&#22836;&#23383;&#27573;&#12290;&#20363;&#23376;&#65306;</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@RequestMapping("/something")</span></em>
<span class="hl-keyword">public</span> ResponseEntity&lt;String&gt; handle(HttpEntity&lt;<span class="hl-keyword">byte</span>[]&gt; requestEntity) <span class="hl-keyword">throws</span> UnsupportedEncodingException {
    String requestHeader = requestEntity.getHeaders().getFirst(<span class="hl-string">"MyRequestHeader"</span>));
    <span class="hl-keyword">byte</span>[] requestBody = requestEntity.getBody();

    <span class="hl-comment">// do something with request header and body</span>

    HttpHeaders responseHeaders = <span class="hl-keyword">new</span> HttpHeaders();
    responseHeaders.set(<span class="hl-string">"MyResponseHeader"</span>, <span class="hl-string">"MyValue"</span>);
    <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> ResponseEntity&lt;String&gt;(<span class="hl-string">"Hello World"</span>, responseHeaders, HttpStatus.CREATED);
}</pre>

<p>&#19978;&#36848;&#20363;&#23376;&#33719;&#21462;&#20102; <code class="literal">MyRequestHeader</code> &#22836;&#23383;&#27573;&#30340;&#20540;&#65292;&#20197;&#23383;&#33410;&#25968;&#32452;&#30340;&#24418;&#24335;&#35835;&#21462;&#20102;&#35831;&#27714;&#20307;&#65292;&#38543;&#21518;&#23558; <code class="literal">MyRequestHeader</code> &#28155;&#21152;&#21040; response&#65292;&#23558; <code class="literal">Hello World</code> &#20889;&#21040;&#21709;&#24212;&#27969;&#21644;&#35774;&#32622;&#21709;&#24212;&#29366;&#24577;&#30721;&#20026; 201(Created).</p>
<p>&#19982; <code class="literal">@RequestBody</code> &#21644; <code class="literal">@ResponseBody</code> &#19968;&#26679;&#65292;Srping &#20351;&#29992; <code class="literal">HttpMessageConverter</code> &#23558;&#25968;&#25454;&#19982;&#35831;&#27714;/&#21709;&#24212;&#27969;&#20114;&#36716;&#65292;&#21487;&#26597;&#30475;&#19978;&#19968;&#33410;<a class="link" href="remoting.html#rest-message-conversion" title="21.10.2&nbsp;HTTP Message Conversion">&#20449;&#24687;&#36716;&#25442;&#22120;</a></p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="mvc-ann-modelattrib-methods" href="#mvc-ann-modelattrib-methods"></a>&#22312;&#26041;&#27861;&#19978;&#20351;&#29992; @ModelAttribute</h4></div></div></div>

<p><code class="literal">@ModelAttribute</code> &#21487;&#29992;&#27442;&#26041;&#27861;&#25110;&#26041;&#27861;&#21442;&#25968;&#20013;&#12290;&#36825;&#19968;&#37096;&#20998;&#23558;&#20171;&#32461; <code class="literal">@ModelAttribute</code> &#22312;&#26041;&#27861;&#20013;&#30340;&#20351;&#29992;&#65292;&#19979;&#19968;&#37096;&#20998;&#20171;&#32461;&#20854;&#22312;&#26041;&#27861;&#21834;&#21442;&#25968;&#20013;&#30340;&#20351;&#29992;&#12290;</p>
<p>&#22312;&#26041;&#27861;&#19978;&#20351;&#29992; <code class="literal">@ModelAttribute</code> &#27880;&#35299;&#65292;&#34920;&#31034;&#27492;&#26041;&#27861;&#30340;&#30446;&#30340;&#22312;&#20110;&#28155;&#21152;&#19968;&#20010;&#25110;&#22810;&#20010;&#27169;&#22411;&#23646;&#24615;&#12290;&#36825;&#31181;&#26041;&#27861;&#25152;&#25903;&#25345;&#30340;&#21442;&#25968;&#31867;&#22411;&#19982; <code class="literal">@RequestMapping</code> &#19968;&#26679;&#65292;&#19981;&#21516;&#30340;&#26159;&#65292;&#20854;&#19981;&#33021;&#30452;&#25509;&#26144;&#23556;&#21040; request&#12290;&#21478;&#22806;&#65292;&#22312;&#21516;&#19968;&#20010;&#25511;&#21046;&#22120;&#37324;&#65292;<code class="literal">@ModelAttribute</code> &#20250;&#22312; <code class="literal">@RequestMapping</code> &#20043;&#21069;&#35843;&#29992;&#12290;&#20030;&#20960;&#20010;&#20363;&#23376;&#65306;</p>
<pre class="programlisting"><span class="hl-comment">// &#28155;&#21152;&#19968;&#20010;&#23646;&#24615;</span>
<span class="hl-comment">// &#26041;&#27861;&#30340;&#36820;&#22238;&#20540;&#20250;&#20197; "account" &#38190;&#28155;&#21152;&#21040; model</span>
<span class="hl-comment">// &#21487;&#36890;&#36807; @ModelAttribute("myAccount") &#33258;&#23450;&#20041;</span>

<em><span class="hl-annotation" style="color: gray">@ModelAttribute</span></em>
<span class="hl-keyword">public</span> Account addAccount(<em><span class="hl-annotation" style="color: gray">@RequestParam</span></em> String number) {
    <span class="hl-keyword">return</span> accountManager.findAccount(number);
}

<span class="hl-comment">// &#28155;&#21152;&#22810;&#20010;&#23646;&#24615;</span>

<em><span class="hl-annotation" style="color: gray">@ModelAttribute</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> populateModel(<em><span class="hl-annotation" style="color: gray">@RequestParam</span></em> String number, Model model) {
    model.addAttribute(accountManager.findAccount(number));
    <span class="hl-comment">// &#20877;&#28155;&#21152;&#22810;&#20010;&#8230;&#8230;</span>
}</pre>

<p><code class="literal">@ModelAttribute</code> &#29992;&#26469;&#23558;&#24120;&#29992;&#23646;&#24615;&#22635;&#20805;&#21040;&#27169;&#22411;&#37324;&#12290;&#22914;&#65306;&#22635;&#20805;&#19979;&#25289;&#26694;&#38472;&#36848;&#12289;&#23456;&#29289;&#31867;&#22411;&#12289;&#25110;&#21629;&#20196;&#23545;&#35937;&#65288;&#22914; Account&#65292;&#29992;&#20110;&#34920;&#31034; HTML &#34920;&#21333;&#25968;&#25454;&#65289;&#12290;&#26368;&#21518;&#19968;&#31181;&#24773;&#20917;&#20250;&#22312;&#19979;&#19968;&#37096;&#20998;&#28145;&#20837;&#35848;&#35770;&#12290;</p>
<p>&#30041;&#24847;&#19968;&#19979; <code class="literal">@ModelAttribute</code> &#26041;&#27861;&#30340;&#20004;&#31181;&#20351;&#29992;&#26041;&#24335;&#12290;&#31532;&#19968;&#31181;&#65292;&#22312;&#26041;&#27861;&#37324;&#38544;&#24335;&#28155;&#21152;&#19968;&#20010;&#23646;&#24615;&#24182;&#36820;&#22238;&#65307;&#31532;&#20108;&#31181;&#65292;&#26041;&#27861;&#37324;&#25509;&#25910; <code class="literal">Model</code> &#21442;&#25968;&#65292;&#24182;&#23558;&#20219;&#24847;&#20010;&#23646;&#24615;&#28155;&#21152;&#21040; <code class="literal">Model</code>&#20013;&#12290;&#20320;&#21487;&#20197;&#26681;&#25454;&#33258;&#36523;&#38656;&#35201;&#36873;&#25321;&#20854;&#20013;&#19968;&#31181;&#20351;&#29992;&#26041;&#24335;&#12290;</p>
<p>&#19968;&#20010;&#25511;&#21046;&#22120;&#21487;&#20197;&#26377;&#22810;&#20010; <code class="literal">@ModelAttribute</code> &#26041;&#27861;&#12290;&#22312;&#21516;&#19968;&#20010;&#25511;&#21046;&#22120;&#20013;&#65292;&#25152;&#26377; <code class="literal">@ModelAttribute</code> &#26041;&#27861;&#37117;&#20250;&#22312; <code class="literal">@RequestMapping</code> &#26041;&#27861;&#20043;&#21069;&#35843;&#29992;&#12290;</p>
<p><code class="literal">@ModelAttribute</code> &#26041;&#27861;&#20063;&#21487;&#20197;&#22312;  <code class="literal">@ControllerAdvice</code> &#27880;&#35299;&#30340;&#31867;&#20013;&#20351;&#29992;&#65292;&#31867;&#20284;&#30340;&#21487;&#24212;&#29992;&#20110;&#20854;&#20182;&#25511;&#21046;&#22120;&#65292;&#35814;&#32454;&#20449;&#24687;&#21487;&#26597;&#30475; <a class="xref" href="mvc.html#mvc-ann-controller-advice" title="&#20351;&#29992; @ControllerAdvice &#27880;&#35299;&#22686;&#24378;&#25511;&#21046;&#22120;">the section called &#8220;&#20351;&#29992; <code class="literal">@ControllerAdvice</code> &#27880;&#35299;&#22686;&#24378;&#25511;&#21046;&#22120;&#8221;</a>&#12290;</p>
<div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top">
<p>&#24403;&#27169;&#22411;&#23646;&#24615;&#21517;&#31216;&#27809;&#26377;&#26174;&#24335;&#23450;&#20041;&#65292;&#20250;&#26159;&#19968;&#31181;&#20160;&#20040;&#26679;&#30340;&#24773;&#20917;&#65311;&#22312;&#36825;&#31181;&#24773;&#20917;&#19979;&#65292;&#40664;&#35748;&#20351;&#29992;&#21442;&#25968;&#31867;&#22411;&#21517;&#31216;&#20316;&#20026;&#27169;&#22411;&#23646;&#24615;&#21517;&#31216;&#12290;&#22914;&#65292;&#24403;&#26041;&#27861;&#36820;&#22238; <code class="literal">Account</code> &#23545;&#35937;&#26102;&#65292;&#20854;&#40664;&#35748;&#30340;&#27169;&#22411;&#23646;&#24615;&#21517;&#31216;&#26159; "account"&#12290;&#20320;&#21487;&#20197;&#36890;&#36807;&#35774;&#32622;<code class="literal">@ModelAttribute</code> &#27880;&#35299;&#30340; "value" &#23646;&#24615;&#26469;&#33258;&#23450;&#20041;&#12290;&#24403;&#30452;&#25509;&#24448; <code class="literal">Model</code> &#28155;&#21152;&#23646;&#24615;&#26102;&#65292;&#35831;&#27491;&#30830;&#20351;&#29992; <code class="literal">addAttribute(..)</code> &#30340;&#37325;&#36733;&#26041;&#27861; &#8212;&#8212; &#22914;&#65292;&#26159;&#21542;&#22312;&#26041;&#27861;&#20013;&#24102;&#23646;&#24615;&#21517;&#12290;</p>
</td></tr></table></div>

<p><code class="literal">@ModelAttribute</code> &#27880;&#35299;&#20063;&#21487;&#29992;&#22312; <code class="literal">@RequestMapping</code> &#26041;&#27861;&#20013;&#12290;&#36825;&#31181;&#24773;&#20917;&#19979;&#65292;<code class="literal">@RequestMapping</code> &#26041;&#27861;&#30340;&#36820;&#22238;&#20540;&#23558;&#35299;&#26512;&#20026;&#27169;&#22411;&#23646;&#24615;&#65292;&#32780;&#19981;&#26159;&#35270;&#22270;&#21517;&#31216;&#12290;&#30456;&#21453;&#65292;&#35270;&#22270;&#21517;&#31216;&#26469;&#28304;&#20110;&#35270;&#22270;&#21517;&#31216;&#30340;&#32422;&#23450;&#65292;&#23601;&#31867;&#20284;&#20110;&#26041;&#27861;&#36820;&#22238; void&#65292;&#21487;&#26597;&#30475;<a class="xref" href="mvc.html#mvc-coc-r2vnt" title="16.13.3&nbsp;The View - RequestToViewNameTranslator">Section&nbsp;16.13.3, &#8220;The View - RequestToViewNameTranslator&#8221;</a>&#12290;</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="mvc-ann-modelattrib-method-args" href="#mvc-ann-modelattrib-method-args"></a>&#22312;&#26041;&#27861;&#21442;&#25968;&#19978;&#20351;&#29992; @ModelAttribute</h4></div></div></div>

<p>&#22914;&#21069;&#25991;&#25152;&#36848;&#65292;<code class="literal">@ModelAttribute</code> &#20063;&#21487;&#20197;&#29992;&#22312;&#26041;&#27861;&#25110;&#26041;&#27861;&#21442;&#25968;&#19978;&#12290;&#36825;&#19968;&#37096;&#20998;&#23558;&#20171;&#32461;&#20854;&#22312;&#26041;&#27861;&#21442;&#25968;&#19978;&#30340;&#20351;&#29992;&#12290;</p>
<p><code class="literal">@ModelAttribute</code> &#27880;&#35299;&#30340;&#26041;&#27861;&#21442;&#25968;&#65292;&#34920;&#31034;&#35813;&#21442;&#25968;&#20250;&#20174;&#27169;&#22411;&#20013;&#26816;&#32034;&#12290;&#22914;&#26524;&#35813;&#21442;&#25968;&#19981;&#22312;&#27169;&#22411;&#20013;&#65292;&#27492;&#21442;&#25968;&#20250;&#20808;&#25191;&#34892;&#21021;&#22987;&#21270;&#25110;&#21518;&#28155;&#21152;&#21040;&#27169;&#22411;&#37324;&#65307;&#22914;&#26524;&#21442;&#25968;&#23384;&#22312;&#27169;&#22411;&#37324;&#65292;&#27492;&#21442;&#25968;&#23383;&#27573;&#20250;&#22635;&#20805;&#25152;&#26377;&#21305;&#37197;&#20854;&#21517;&#31216;&#30340;&#35831;&#27714;&#21442;&#25968;&#12290;&#36825;&#23601;&#26159;&#22823;&#23478;&#29087;&#30693;&#30340; Spring MVC &#25968;&#25454;&#32465;&#23450; &#8212;&#8212; &#19968;&#20010;&#21487;&#20197;&#20813;&#38500;&#20320;&#36880;&#20010;&#35299;&#26512;&#34920;&#21333;&#23646;&#24615;&#32780;&#21448;&#38750;&#24120;&#26377;&#29992;&#30340;&#26426;&#21046;&#12290;</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@RequestMapping(value="/owners/{ownerId}/pets/{petId}/edit", method = RequestMethod.POST)</span></em>
<span class="hl-keyword">public</span> String processSubmit(<span class="strong"><strong>@ModelAttribute Pet pet</strong></span>) { }</pre>

<p>&#19978;&#36848;&#25152;&#32473;&#20363;&#23376;&#65292;Pet &#23454;&#20363;&#21487;&#20197;&#22312;&#21738;&#37324;&#33719;&#21462;&#65311;&#26377;&#20197;&#19979;&#20960;&#31181;&#36873;&#25321;&#65306;</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
&#21487;&#33021;&#24050;&#23384;&#21040;&#27169;&#22411;&#37324;&#65292;&#33258;&#28982;&#21487;&#20174;&#27169;&#22411;&#20013;&#33719;&#21462;&#65292;&#22240;&#20026;&#20351;&#29992;&#20102; <code class="literal">@SessionAttributes</code>&#8201;&#8212;&#8201;&#21487;&#26597;&#30475; <a class="xref" href="mvc.html#mvc-ann-sessionattrib" title="&#20351;&#29992; @SessionAttributes &#23558;&#27169;&#22411;&#23646;&#24615;&#23384;&#20648;&#21040; HTTP session">the section called &#8220;&#20351;&#29992; @SessionAttributes &#23558;&#27169;&#22411;&#23646;&#24615;&#23384;&#20648;&#21040; HTTP session&#8221;</a>&#12290;
</li><li class="listitem">
&#21487;&#33021;&#24050;&#23384;&#21040;&#27169;&#22411;&#37324;&#65292;&#33258;&#28982;&#21487;&#20174;&#27169;&#22411;&#20013;&#33719;&#21462;&#65292;&#22240;&#20026;&#21516;&#19968;&#20010;&#25511;&#21046;&#22120;&#37324;&#30340; <code class="literal">@ModelAttribute</code> &#26041;&#27861;&#8201;&#8212;&#8201;&#22312;&#19978;&#19968;&#37096;&#20998;&#26377;&#35299;&#37322;&#12290;
</li><li class="listitem">
&#21487;&#20197;&#20174; URI &#27169;&#29256;&#21464;&#37327;&#21644;&#31867;&#22411;&#36716;&#25442;&#22120;&#33719;&#21462;&#65288;&#22312;&#19979;&#38754;&#35814;&#32454;&#25551;&#36848;&#20250;&#26377;&#25152;&#35828;&#26126;&#65289;
</li><li class="listitem">
&#21487;&#20197;&#20351;&#29992;&#40664;&#35748;&#26500;&#36896;&#20989;&#22120;&#21021;&#22987;&#21270;
</li></ul></div>

<p><code class="literal">@ModelAttribute</code> &#26041;&#27861;&#26159;&#19968;&#31181;&#20174;&#25968;&#25454;&#24211;&#26816;&#32034;&#32034;&#24615;&#30340;&#24120;&#29992;&#26041;&#24335;&#65292;&#25152;&#26816;&#32034;&#21040;&#30340;&#23646;&#24615;&#21487;&#20197;&#20351;&#29992; <code class="literal">@SessionAttributes</code> &#22312;&#35831;&#27714;&#20043;&#38388;&#23384;&#20648;&#12290;&#22312;&#26576;&#20123;&#24773;&#20917;&#19979;&#65292;&#20351;&#29992; URI &#27169;&#29256;&#21464;&#37327;&#21644;&#31867;&#22411;&#36716;&#21270;&#22120;&#21487;&#33021;&#20250;&#26041;&#20415;&#19968;&#20123;&#65292;&#20030;&#20010;&#20363;&#23376;&#65306;</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@RequestMapping(value="/accounts/{account}", method = RequestMethod.PUT)</span></em>
<span class="hl-keyword">public</span> String save(<em><span class="hl-annotation" style="color: gray">@ModelAttribute("account")</span></em> Account account) {

}</pre>

<p>&#19978;&#38754;&#36825;&#20010;&#20363;&#23376;&#65292;&#27169;&#22411;&#23646;&#24615;&#21517;&#31216;&#65288;&#36825;&#37324;&#20026; "account") &#21487;&#20197;&#26144;&#23556; URI &#27169;&#29256;&#27169;&#29256;&#21464;&#37327;&#12290;&#22914;&#26524;&#20320;&#27880;&#20876;&#20102; <code class="literal">Converter&lt;String, Account&gt;</code>&#65288;&#19968;&#20010;&#21487;&#23558; <code class="literal">String</code> &#31867;&#22411;&#30340; account &#20540;&#36716;&#25442;&#20026; <code class="literal">Account</code>&#23454;&#20363;&#65289;&#65292;&#37027;&#19978;&#36848;&#20363;&#23376;&#22312;&#27809;&#26377; <code class="literal">@ModelAttribute</code> &#26041;&#27861;&#19979;&#65292;&#20063;&#26159;&#21487;&#24037;&#20316;&#30340;&#12290;</p>
<p>&#19979;&#19968;&#27493;&#26159;&#25968;&#25454;&#32465;&#23450;&#12290;<code class="literal">WebDataBinder</code> &#31867;&#26144;&#23556;&#35831;&#27714;&#21442;&#25968;&#21517; &#8212;&#8212; &#21253;&#25324;&#26597;&#35810;&#23383;&#31526;&#21442;&#25968;&#21644;&#34920;&#21333;&#23646;&#24615; &#8212;&#8212; &#26681;&#25454;&#21517;&#31216;&#28155;&#21152;&#27169;&#22411;&#23646;&#24615;&#12290;&#22312;&#31867;&#22411;&#36716;&#25442;&#20043;&#21518;&#65292;&#22914;&#26524;&#38656;&#35201;&#65292;&#26144;&#23556;&#23646;&#24615;&#20250;&#34987;&#22635;&#20805;&#12290;&#25968;&#25454;&#32465;&#23450;&#22312;&#39564;&#35777;&#22312; <a class="xref" href="validation.html" title="7.&nbsp;&#25968;&#25454;&#26657;&#39564;&#12289;&#25968;&#25454;&#32465;&#23450;&#21644;&#31867;&#22411;&#36716;&#25442;">Chapter&nbsp;7, <i>&#25968;&#25454;&#26657;&#39564;&#12289;&#25968;&#25454;&#32465;&#23450;&#21644;&#31867;&#22411;&#36716;&#25442;</i></a>  &#26377;&#20171;&#32461;&#65292;&#22312;&#25511;&#21046;&#22120;&#23618;&#33258;&#23450;&#20041;&#25968;&#25454;&#32465;&#23450;&#30340;&#22788;&#29702;&#26041;&#27861;&#65292;&#22312; <a class="xref" href="mvc.html#mvc-ann-webdatabinder" title="&#33258;&#23450;&#20041; WebDataBinder &#30340;&#21021;&#22987;&#21270;">the section called &#8220;&#33258;&#23450;&#20041; WebDataBinder &#30340;&#21021;&#22987;&#21270;&#8221;</a> &#26377;&#20171;&#32461;&#12290;</p>
<p>&#22312;&#22788;&#29702;&#25968;&#25454;&#32465;&#23450;&#20013;&#65292;&#21487;&#33021;&#20250;&#25243;&#20986;&#38169;&#35823;&#65288;&#22914;&#32570;&#22833;&#24517;&#35201;&#23646;&#24615;&#25110;&#31867;&#22411;&#36716;&#25442;&#38169;&#35823;&#65289;&#12290;&#22914;&#35201;&#26816;&#26597;&#36825;&#20123;&#38169;&#35823;&#65292;&#21487;&#22312; <code class="literal">@ModelAttribute</code> &#21442;&#25968;&#21518;&#28155;&#21152; <code class="literal">BindingResult</code> &#21442;&#25968;&#12290;</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@RequestMapping(value="/owners/{ownerId}/pets/{petId}/edit", method = RequestMethod.POST)</span></em>
<span class="hl-keyword">public</span> String processSubmit(<span class="strong"><strong>@ModelAttribute("pet") Pet pet</strong></span>, BindingResult result) {

    <span class="hl-keyword">if</span> (result.hasErrors()) {
        <span class="hl-keyword">return</span> <span class="hl-string">"petForm"</span>;
    }

    <span class="hl-comment">// ...</span>

}</pre>

<p>&#20351;&#29992; <code class="literal">BindingResult</code>&#65292; &#20320;&#21487;&#20197;&#21028;&#26029;&#26159;&#21542;&#23384;&#22312;&#25968;&#25454;&#32465;&#23450;&#38169;&#35823;&#12290;&#24403;&#23384;&#22312;&#38169;&#35823;&#26102;&#65292;&#36890;&#24120;&#20250;&#28210;&#26579;&#27492;&#34920;&#21333; &#8212;&#8212; &#36890;&#36807; Spring &#30340; <code class="literal">&lt;errors&gt;</code> &#34920;&#21333;&#26631;&#31614;&#23637;&#31034;&#36825;&#20123;&#38169;&#35823;&#12290;</p>
<p>&#38500;&#20102;&#25968;&#25454;&#32465;&#23450;&#65292;&#20320;&#20063;&#21487;&#20197;&#36890;&#36807;&#33258;&#23450;&#20197;&#39564;&#35777;&#22120;&#20256;&#36882; <code class="literal">BindingResult</code> &#26469;&#25191;&#34892;&#39564;&#35777;&#12290;&#24403;&#20013; <code class="literal">BindingResult</code> &#20445;&#23384;&#20102;&#25968;&#25454;&#32465;&#23450;&#30340;&#38169;&#35823;&#12290;&#36825;&#26679;&#21487;&#20197;&#20801;&#35768;&#25968;&#25454;&#32465;&#23450;&#21644;&#39564;&#35777;&#38169;&#35823;&#32479;&#19968;&#25910;&#38598;&#65292;&#38543;&#21518;&#22238;&#39304;&#32473;&#29992;&#25143;&#12290;</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@RequestMapping(value="/owners/{ownerId}/pets/{petId}/edit", method = RequestMethod.POST)</span></em>
<span class="hl-keyword">public</span> String processSubmit(<span class="strong"><strong>@ModelAttribute("pet") Pet pet</strong></span>, BindingResult result) {

    <span class="hl-keyword">new</span> PetValidator().validate(pet, result);
    <span class="hl-keyword">if</span> (result.hasErrors()) {
        <span class="hl-keyword">return</span> <span class="hl-string">"petForm"</span>;
    }

    <span class="hl-comment">// ...</span>

}</pre>

<p>&#20320;&#20063;&#21487;&#20197;&#33258;&#21160;&#25191;&#34892;&#39564;&#35777;&#65292;&#37197;&#32622; JSR-303 `@Valid &#27880;&#35299;&#21363;&#21487;&#12290;</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@RequestMapping(value="/owners/{ownerId}/pets/{petId}/edit", method = RequestMethod.POST)</span></em>
<span class="hl-keyword">public</span> String processSubmit(<span class="strong"><strong>@Valid @ModelAttribute("pet") Pet pet</strong></span>, BindingResult result) {

    <span class="hl-keyword">if</span> (result.hasErrors()) {
        <span class="hl-keyword">return</span> <span class="hl-string">"petForm"</span>;
    }

    <span class="hl-comment">// ...</span>

}</pre>

<p>&#33267;&#20110;&#22914;&#20309;&#37197;&#32622;&#21644;&#20351;&#29992;&#39564;&#35777;&#65292;&#21487;&#26597;&#30475; <a class="xref" href="validation.html#validation-beanvalidation" title="7.8&nbsp;Spring Validation">Section&nbsp;7.8, &#8220;Spring Validation&#8221;</a> &#21644; <a class="xref" href="validation.html" title="7.&nbsp;&#25968;&#25454;&#26657;&#39564;&#12289;&#25968;&#25454;&#32465;&#23450;&#21644;&#31867;&#22411;&#36716;&#25442;">Chapter&nbsp;7, <i>&#25968;&#25454;&#26657;&#39564;&#12289;&#25968;&#25454;&#32465;&#23450;&#21644;&#31867;&#22411;&#36716;&#25442;</i></a>&#12290;</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="mvc-ann-sessionattrib" href="#mvc-ann-sessionattrib"></a>&#20351;&#29992; @SessionAttributes &#23558;&#27169;&#22411;&#23646;&#24615;&#23384;&#20648;&#21040; HTTP session</h4></div></div></div>

<p>&#31867;&#19978;&#30340; <code class="literal">@SessionAttributes</code> &#27880;&#35299;&#65292;&#22768;&#26126;&#20102; session &#23646;&#24615;&#21487;&#20197;&#34987;&#25351;&#23450; hadler &#20351;&#29992;&#12290;&#36825;&#36890;&#24120;&#20250;&#21015;&#20986;&#38656;&#35201;&#36879;&#26126;&#23384;&#20648;&#21040; session &#25110;&#20854;&#20182;&#20250;&#35805;&#23384;&#20648;&#30340;&#27169;&#22411;&#23646;&#24615;&#25110;&#27169;&#22411;&#23646;&#24615;&#30340;&#31867;&#22411;&#65292;&#20316;&#20026;&#21518;&#32493;&#35831;&#27714;&#30340; form-backing beam&#12290;</p>
<p>&#22914;&#19979;&#20195;&#30721;&#29255;&#27573;&#23637;&#31034;&#20102; @SessionAttributes &#30340;&#29992;&#27861;&#65292;&#20854;&#25351;&#23450;&#20102;&#27169;&#22411;&#23646;&#24615;&#21517;&#31216;&#65306;</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Controller</span></em>
<em><span class="hl-annotation" style="color: gray">@RequestMapping("/editPet.do")</span></em>
<span class="strong"><strong>@SessionAttributes("pet")</strong></span>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> EditPetForm {
    <span class="hl-comment">// ...</span>
}</pre>

</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="mvc-ann-redirect-attributes" href="#mvc-ann-redirect-attributes"></a>&#25351;&#23450; redirect &#21644; flash &#23646;&#24615;</h4></div></div></div>

<p>&#22312;&#37325;&#23450;&#21521; URL &#20013;&#65292;&#25152;&#26377;&#27169;&#22411;&#23646;&#24615;&#40664;&#35748;&#26292;&#38706;&#32473; URI &#27169;&#29256;&#21464;&#37327;&#65292;&#21097;&#19979;&#30340;&#23646;&#24615;(&#21407;&#22987;&#31867;&#22411;&#25110;&#21407;&#22987;&#31867;&#22411;&#38598;&#21512;/&#25968;&#32452;)&#20250;&#33258;&#21160;&#25340;&#25509;&#21040;&#26597;&#35810;&#21442;&#25968;&#20013;&#12290;</p>
<p>&#28982;&#32780;&#65292;&#22312;&#19968;&#20010;&#24102;&#27880;&#35299;&#30340;&#25511;&#21046;&#22120;&#20013;&#65292;&#27169;&#22411;&#20063;&#35768;&#21253;&#21547;&#20102;&#39069;&#22806;&#30340;&#23646;&#24615;&#65288;&#29992;&#20110;&#28210;&#26579;&#65292;&#22914;&#19979;&#25289;&#26694;&#23646;&#24615;&#65289;&#12290;&#22312;&#37325;&#23450;&#21521;&#22330;&#26223;&#20013;&#65292;&#35201;&#20934;&#30830;&#25511;&#21046;&#36825;&#20123;&#23646;&#24615;&#65292;&#21487;&#22312; <code class="literal">@RequestMapping</code> &#26041;&#27861;&#20013;&#22768;&#26126; <code class="literal">RedirectAttributes</code> &#31867;&#22411;&#21442;&#25968;&#65292;&#24182;&#24448;&#20854;&#28155;&#21152; <code class="literal">RedirectView</code> &#20351;&#29992;&#30340;&#23646;&#24615;&#12290;&#22914;&#26524;&#36825;&#20010;&#25511;&#21046;&#26041;&#27861;&#27809;&#26377;&#37325;&#23450;&#21521;&#65292;&#23558;&#20351;&#29992; <code class="literal">RedirectAttributes</code> &#30340;&#20869;&#23481;&#65292;&#21542;&#21017;&#20351;&#29992;&#40664;&#35748; <code class="literal">Model</code> &#30340;&#20869;&#23481;&#12290;</p>
<p><code class="literal">RequestMappingHandlerAdapter</code> &#25552;&#20379;&#20102;&#19968;&#20010; <code class="literal">"ignoreDefaultModelOnRedirect"</code> &#26631;&#24535;&#65292;&#29992;&#26469;&#35774;&#32622;&#22312;&#25511;&#21046;&#26041;&#27861;&#37325;&#23450;&#21521;&#26102;&#65292;&#40664;&#35748;<code class="literal">Model</code> &#30340;&#20869;&#23481;&#26159;&#21542;&#20174;&#19981;&#20351;&#29992;&#12290;&#30456;&#21453;&#65292;&#25511;&#21046;&#22120;&#26041;&#27861;&#24212;&#35813;&#22768;&#26126; <code class="literal">RedirectAttributes</code> &#31867;&#22411;&#23646;&#24615;&#65292;&#21542;&#21017;&#20250;&#27809;&#26377;&#20219;&#20309;&#23646;&#24615;&#20256;&#36882;&#32473; <code class="literal">RedirectView</code>&#12290;&#20026;&#20102;&#21521;&#21518;&#20860;&#23481;&#65292;MVC &#21629;&#21517;&#31354;&#38388;&#21644; MVC Java &#37197;&#32622;&#37117;&#23558; <code class="literal">"ignoreDefaultModelOnRedirect"</code> &#35774;&#32622;&#20026; false&#12290;&#21487;&#25105;&#20204;&#36824;&#26159;&#24314;&#35758;&#20320;&#22312;&#26032;&#24212;&#29992;&#37324;&#23558;&#20854;&#35774;&#32622;&#20026; true&#12290;</p>
<p><code class="literal">RedirectAttributes</code> &#25509;&#21475;&#20063;&#21487;&#20197;&#29992;&#26469;&#28155;&#21152; flash &#23646;&#24615;&#12290;&#19982;&#20854;&#20182;&#37325;&#23450;&#21521;&#23646;&#24615;&#65288;&#22312;&#37325;&#23450;&#21521; URL &#20013;&#38144;&#27585;&#65289;&#19981;&#21516;&#30340;&#26159;&#65292;flash &#23646;&#24615;&#20250;&#20445;&#23384;&#21040; HTTP session&#65288;&#22240;&#27492; flash &#23646;&#24615;&#20063;&#19981;&#20250;&#22312; URL &#19978;&#20986;&#29616;&#65289;&#12290;&#20316;&#29992;&#20110;&#37325;&#23450;&#21521; URL &#30340;&#25511;&#21046;&#22120;&#37324;&#30340;&#27169;&#22411;&#20250;&#33258;&#21160;&#25509;&#25910;&#36825;&#20123; flash &#23646;&#24615;&#65292;&#20043;&#21518;&#65292;flash &#23646;&#24615;&#20250;&#20174; session &#20013;&#31227;&#38500;&#12290;&#21487;&#26597;&#30475; <a class="xref" href="mvc.html#mvc-flash-attributes" title="16.6&nbsp;&#20351;&#29992; flash &#23646;&#24615;">Section&nbsp;16.6, &#8220;&#20351;&#29992; flash &#23646;&#24615;&#8221;</a>&#65292;&#20102;&#35299; Spring MVC &#23545; flash &#23646;&#24615;&#30340;&#24120;&#35268;&#25903;&#25345;&#12290;</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="mvc-ann-form-urlencoded-data" href="#mvc-ann-form-urlencoded-data"></a>&#22788;&#29702; "application/x-www-form-urlencoded" &#25968;&#25454;</h4></div></div></div>

<p>&#21069;&#19968;&#33410;&#33410;&#20171;&#32461;&#20102; <code class="literal">@ModelAttribute</code> &#22312;&#23458;&#25143;&#31471;&#27983;&#35272;&#22120;&#34920;&#21333;&#25552;&#20132;&#30340;&#20351;&#29992;&#12290;&#21516;&#26102;&#20063;&#25512;&#33616;&#20351;&#29992; <code class="literal">@ModelAttribute</code> &#22788;&#29702;&#38750;&#27983;&#35272;&#22120;&#25552;&#20132;&#30340;&#35831;&#27714;&#12290;&#28982;&#32780;&#65292;&#22312;&#22788;&#29702; HTTP PUT &#35831;&#27714;&#26102;&#65292;&#36825;&#37324;&#23384;&#22312;&#20102;&#19968;&#20010;&#26126;&#26174;&#30340;&#19981;&#21516;&#12290;&#27983;&#35272;&#22120;&#25903;&#25345;&#36890;&#36807; HTTP GET &#25110; HTTP POST &#26041;&#27861;&#25552;&#20132;&#34920;&#21333;&#25968;&#25454;&#12290;&#38750;&#27983;&#35272;&#22120;&#20063;&#25903;&#25345;&#36890;&#36807; HTTP PUT &#26041;&#27861;&#25552;&#20132;&#34920;&#21333;&#12290;&#36825;&#37324;&#25552;&#20986;&#20102;&#19968;&#20010;&#25361;&#25112; &#8212;&#8212; &#22240;&#20026; Servlet &#35268;&#33539;&#35201;&#27714; <code class="literal">ServletRequest.getParameter*()</code> &#26041;&#27861;&#38656;&#35201;&#25903;&#25345;&#34920;&#21333;&#23646;&#24615;&#35775;&#38382;&#65292;&#32780;&#36825;&#21482;&#36866;&#29992;&#20110; HTTP POST&#65292;&#19981;&#36866;&#29992;&#20110; HTTP PUT&#12290;</p>
<p>&#20026;&#20102;&#25903;&#25345; HTTP PUT &#21644; PATCH &#35831;&#27714;&#65292;<code class="literal">spring-web</code> &#27169;&#22359;&#25552;&#20379;&#20102; <code class="literal">HttpPutFormContentFilter</code> &#36807;&#28388;&#22120;&#65292;&#27492;&#36807;&#28388;&#22120;&#21487; <code class="literal">web.xml</code> &#37197;&#32622;&#65306;</p>
<pre class="programlisting"><span class="hl-tag">&lt;filter&gt;</span>
    <span class="hl-tag">&lt;filter-name&gt;</span>httpPutFormFilter<span class="hl-tag">&lt;/filter-name&gt;</span>
    <span class="hl-tag">&lt;filter-class&gt;</span>org.springframework.web.filter.HttpPutFormContentFilter<span class="hl-tag">&lt;/filter-class&gt;</span>
<span class="hl-tag">&lt;/filter&gt;</span>

<span class="hl-tag">&lt;filter-mapping&gt;</span>
    <span class="hl-tag">&lt;filter-name&gt;</span>httpPutFormFilter<span class="hl-tag">&lt;/filter-name&gt;</span>
    <span class="hl-tag">&lt;servlet-name&gt;</span>dispatcherServlet<span class="hl-tag">&lt;/servlet-name&gt;</span>
<span class="hl-tag">&lt;/filter-mapping&gt;</span>

<span class="hl-tag">&lt;servlet&gt;</span>
    <span class="hl-tag">&lt;servlet-name&gt;</span>dispatcherServlet<span class="hl-tag">&lt;/servlet-name&gt;</span>
    <span class="hl-tag">&lt;servlet-class&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="hl-tag">&lt;/servlet-class&gt;</span>
<span class="hl-tag">&lt;/servlet&gt;</span></pre>

<p><code class="literal">HttpPutFormContentFilter</code> &#36807;&#28388;&#22120;&#25318;&#25130;&#20102;content &#31867;&#22411;&#20026; <code class="literal">application/x-www-form-urlencoded</code> &#30340; HTTP PUT &#21644; PATCH &#35831;&#27714;&#65292;&#23427;&#20174;&#35831;&#27714;&#20307;&#20013;&#35835;&#21462;&#34920;&#21333;&#25968;&#25454;&#24182;&#23558;&#20854;&#23553;&#35013;&#20026; <code class="literal">ServletRequest</code>&#65292;&#20197;&#20415;&#21518;&#32493;&#20351;&#29992; <code class="literal">ServletRequest.getParameter*()</code> &#26041;&#27861;&#33719;&#21462;&#34920;&#21333;&#25968;&#25454;&#12290;</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>&#30001;&#20110;<code class="literal">HttpPutFormContentFilter</code>&#24050;&#32463;&#22788;&#29702;&#20102;&#35831;&#27714;&#20307;&#65292;&#25152;&#20197;&#19981;&#24212;&#35813;&#20877;&#32473;PUT&#21644;PATCH&#30340;&#35831;&#27714;&#37197;&#32622;&#20854;&#20182;&#20381;&#36182;&#20110;&#22788;&#29702;"application/x-www-form-urlencoded"&#30340;&#36716;&#25442;&#22120;&#12290;&#36825;&#37324;&#21253;&#25324;&#20102; <code class="literal">@RequestBody MultiValueMap&lt;String,
String&gt;</code> &#21644; <code class="literal">HttpEntity&lt;MultiValueMap&lt;String, String&gt;&gt;</code>&#12290;</p>
</td></tr></table></div>

</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="mvc-ann-cookievalue" href="#mvc-ann-cookievalue"></a>&#20351;&#29992; @CookieValue &#26144;&#23556; cookie &#20540;</h4></div></div></div>

<p><code class="literal">@CookieValue</code> &#27880;&#35299;&#20801;&#35768;&#23558;&#26041;&#27861;&#21442;&#25968;&#19982;HTTP cookie &#20540;&#32465;&#23450;&#12290;</p>
<p>&#20551;&#35774;&#19979;&#38754;&#36825;&#20010; cookie &#20540;&#24050;&#32463;&#20174; http &#35831;&#27714;&#33719;&#24471;&#12290;
Let us consider that the following cookie has been received with an http request:</p>

<pre class="literallayout">JSESSIONID=415A4AC178C59DACE0B2C9CA727CDD84</pre>

<p>&#19968;&#19979;&#20363;&#23376;&#28436;&#31034;&#20102;&#22914;&#20309;&#33719;&#21462; <code class="literal">JSESSIONID</code> cookie &#20540;&#12290;</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@RequestMapping("/displayHeaderInfo.do")</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> displayHeaderInfo(<span class="strong"><strong>@CookieValue("JSESSIONID")</strong></span> String cookie) {
    <span class="hl-comment">//...</span>
}</pre>

<p>&#22914;&#26524;&#26041;&#27861;&#21442;&#25968;&#19981;&#26159; <code class="literal">String</code> &#31867;&#22411;&#65292;&#31867;&#22411;&#36716;&#25442;&#20250;&#33258;&#21160;&#25191;&#34892;&#65292;&#21487;&#26597;&#30475; <a class="xref" href="mvc.html#mvc-ann-typeconversion" title="&#26041;&#27861;&#21442;&#25968;&#21644;&#31867;&#22411;&#36716;&#25442;">the section called &#8220;&#26041;&#27861;&#21442;&#25968;&#21644;&#31867;&#22411;&#36716;&#25442;&#8221;</a>&#12290;</p>
<p><code class="literal">@CookieValue</code> &#27880;&#35299;&#25903;&#25345;&#22312; Servlet &#21644; Portlet &#29615;&#22659;&#20013;&#27880;&#35299; handler &#26041;&#27861;&#12290;</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="mvc-ann-requestheader" href="#mvc-ann-requestheader"></a>&#20351;&#29992; @RequestHeader &#26144;&#23556;&#35831;&#27714;&#22836;&#23383;&#27573;&#23646;&#24615;</h4></div></div></div>

<p>@RequestHeader &#27880;&#35299;&#20801;&#35768;&#23558;&#26041;&#27861;&#21442;&#25968;&#19982;&#35831;&#27714;&#22836;&#23383;&#27573;&#32465;&#23450;&#12290;</p>
<p>&#22914;&#19979;&#19968;&#20010;&#35831;&#27714;&#22836;&#23383;&#27573;&#20540;&#30340;&#26679;&#20363;&#65306;</p>

<pre class="literallayout">Host                    localhost:8080
Accept                  text/html,application/xhtml+xml,application/xml;q=0.9
Accept-Language         fr,en-gb;q=0.7,en;q=0.3
Accept-Encoding         gzip,deflate
Accept-Charset          ISO-8859-1,utf-8;q=0.7,*;q=0.7
Keep-Alive              300</pre>

<p>&#22914;&#19979;&#20195;&#30721;&#28436;&#31034;&#20102;&#22914;&#20309;&#33719;&#21462; <code class="literal">Accept-Encoding</code> &#21644; <code class="literal">Keep-Alive</code> &#22836;&#23383;&#27573;&#20540;&#65306;</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@RequestMapping("/displayHeaderInfo.do")</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> displayHeaderInfo(<span class="strong"><strong>@RequestHeader("Accept-Encoding")</strong></span> String encoding,
        <span class="strong"><strong>@RequestHeader("Keep-Alive")</strong></span> <span class="hl-keyword">long</span> keepAlive) {
    <span class="hl-comment">//...</span>
}</pre>

<p>&#22914;&#26524;&#26041;&#27861;&#21442;&#25968;&#19981;&#26159; <code class="literal">String</code> &#31867;&#22411;&#65292;&#31867;&#22411;&#36716;&#25442;&#20250;&#33258;&#21160;&#25191;&#34892;&#65292;&#21487;&#26597;&#30475; <a class="xref" href="mvc.html#mvc-ann-typeconversion" title="&#26041;&#27861;&#21442;&#25968;&#21644;&#31867;&#22411;&#36716;&#25442;">the section called &#8220;&#26041;&#27861;&#21442;&#25968;&#21644;&#31867;&#22411;&#36716;&#25442;&#8221;</a>&#12290;</p>
<p>&#23558;&#27880;&#35299; <code class="literal">@RequestHeader</code> &#29992;&#20110; <code class="literal">Map&lt;String, String&gt;</code>,<code class="literal">MultiValueMap&lt;String, String&gt;</code>, &#25110; <code class="literal">HttpHeaders</code> &#21442;&#25968;&#65292;map &#20250;&#22635;&#20805;&#25152;&#26377;&#22836;&#23383;&#27573;&#20540;&#12290;</p>
<div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top">
<p>&#20869;&#32622;&#25903;&#25345;&#23558;&#36887;&#21495;&#20998;&#38548;&#30340;&#23383;&#31526;&#20018;&#36716;&#25442;&#20026;&#25968;&#32452;/&#38598;&#21512; &#25110; &#31995;&#32479;&#20854;&#20182;&#29087;&#30693;&#30340;&#31867;&#22411;&#12290;&#27604;&#22914;&#65292;&#24102;&#26377; <code class="literal">@RequestHeader("Accept")</code> &#30340;&#26041;&#27861;&#21442;&#25968;&#65292;&#21487;&#20197; <code class="literal">String</code> &#31867;&#22411;&#65292;&#20063;&#21487;&#20197;&#26159; <code class="literal">String[]</code> &#25110; <code class="literal">List&lt;String&gt;</code> &#31867;&#22411;&#12290;</p>
</td></tr></table></div>

<p><code class="literal">@RequestHeader</code> &#27880;&#35299;&#25903;&#25345;&#22312; Servlet &#21644; Portlet &#29615;&#22659;&#20013;&#27880;&#35299; handler &#26041;&#27861;&#12290;</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="mvc-ann-typeconversion" href="#mvc-ann-typeconversion"></a>&#26041;&#27861;&#21442;&#25968;&#21644;&#31867;&#22411;&#36716;&#25442;</h4></div></div></div>

<p>&#20174;&#35831;&#27714;(&#21253;&#25324;&#35831;&#27714;&#21442;&#25968;&#12289;&#36335;&#24452;&#21442;&#25968;&#12289;&#35831;&#27714;&#22836;&#21644;cookie)&#37324;&#25552;&#21462;&#30340;&#23383;&#31526;&#20018;&#65292;&#22522;&#26412;&#19978;&#37117;&#38656;&#35201;&#36716;&#25442;&#20026;&#26041;&#27861;&#21442;&#25968;&#25110;&#31867;&#23646;&#24615;&#30340;&#30446;&#26631;&#31867;&#22411;&#65292;&#22914;&#23558;&#35831;&#27714;&#21442;&#25968;&#32465;&#23450;&#21040; <code class="literal">@ModelAttribute</code> &#21442;&#25968;&#23646;&#24615;&#12290;&#22914;&#26524;&#30446;&#26631;&#31867;&#22411;&#19981;&#26159; String&#65292;Spring &#33258;&#21160;&#23558;&#20854;&#36716;&#25442;&#20026;&#21512;&#36866;&#30340;&#31867;&#22411;&#12290;&#25903;&#25345;&#25152;&#26377;&#31616;&#21333;&#31867;&#22411;&#30340;&#36716;&#25442;&#65288;&#22914; int&#12289;long&#12289;Date&#31561;&#65289;&#12290;&#20320;&#21487;&#20197;&#36827;&#19968;&#27493;&#36890;&#36807; <code class="literal">WebDataBinder</code> &#33258;&#23450;&#20041;&#22788;&#29702;&#36807;&#31243;(&#21487;&#26597;&#30475;<a class="xref" href="mvc.html#mvc-ann-webdatabinder" title="&#33258;&#23450;&#20041; WebDataBinder &#30340;&#21021;&#22987;&#21270;">the section called &#8220;&#33258;&#23450;&#20041; WebDataBinder &#30340;&#21021;&#22987;&#21270;&#8221;</a>)&#25110;&#20351;&#29992; <code class="literal">FormattingConversionService</code> &#27880;&#20876; <code class="literal">Formatters</code>&#65288;&#21487;&#26597;&#30475; <a class="xref" href="validation.html#format" title="7.6&nbsp;Spring Field Formatting">Section&nbsp;7.6, &#8220;Spring Field Formatting&#8221;</a>&#65289;&#12290;</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="mvc-ann-webdatabinder" href="#mvc-ann-webdatabinder"></a>&#33258;&#23450;&#20041; WebDataBinder &#30340;&#21021;&#22987;&#21270;</h4></div></div></div>

<p>To customize request parameter binding with PropertyEditors through Spring&#8217;s
<code class="literal">WebDataBinder</code>, you can use <code class="literal">@InitBinder</code>-annotated methods within your controller,
<code class="literal">@InitBinder</code> methods within an <code class="literal">@ControllerAdvice</code> class, or provide a custom
<code class="literal">WebBindingInitializer</code>. See the <a class="xref" href="mvc.html#mvc-ann-controller-advice" title="&#20351;&#29992; @ControllerAdvice &#27880;&#35299;&#22686;&#24378;&#25511;&#21046;&#22120;">the section called &#8220;&#20351;&#29992; <code class="literal">@ControllerAdvice</code> &#27880;&#35299;&#22686;&#24378;&#25511;&#21046;&#22120;&#8221;</a> section for more details.</p>
<div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="mvc-ann-initbinder" href="#mvc-ann-initbinder"></a>&#20351;&#29992; @InitBinder &#33258;&#23450;&#20041;&#25968;&#25454;&#32465;&#23450;</h5></div></div></div>

<p>&#20351;&#29992; @InitBinder &#27880;&#35299;&#30340;&#25511;&#21046;&#22120;&#65292;&#21487;&#20197;&#30452;&#25509;&#37197;&#32622;&#32465;&#23450; web &#25968;&#25454;&#12290;<code class="literal">@InitBinder</code> &#34920;&#31034;&#37027;&#20123;&#29992;&#20110;&#21021;&#22987;&#21270; <code class="literal">WebDataBinder</code> &#30340;&#26041;&#27861;&#65292;&#23558;&#29992;&#20110;&#22635;&#20805; &#27880;&#35299; handler &#26041;&#27861;&#30340;&#21629;&#21517;/&#34920;&#21333;&#23545;&#35937;&#21442;&#25968;&#12290;</p>
<p>&#38500;&#20102;&#21629;&#20196;/&#34920;&#21333;&#23545;&#35937;&#21644;&#31867;&#20284;&#39564;&#35777;&#32467;&#26524;&#23545;&#35937;&#65292;&#36825;&#20123;&#21021;&#22987;&#21270;&#32465;&#23450;&#26041;&#27861;&#25903;&#25345; <code class="literal">@RequestMapping</code> &#25152;&#25903;&#25345;&#30340;&#25152;&#26377;&#21442;&#25968;&#12290;&#21021;&#22987;&#21270;&#32465;&#23450;&#26041;&#27861;&#35268;&#23450;&#27809;&#26377;&#36820;&#22238;&#20540;&#12290;&#22240;&#27492;&#65292;&#36825;&#20123;&#26041;&#27861;&#24120;&#22768;&#26126;&#20026; <code class="literal">void</code>&#65292;&#36890;&#24120;&#20063;&#20250;&#21253;&#21547; <code class="literal">WebDataBinder</code> &#21442;&#25968;&#65292;&#19982; <code class="literal">WebRequest</code> &#25110; <code class="literal">java.util.Locale</code> &#32467;&#21512;&#20351;&#29992;&#65292;&#21487;&#27880;&#20876;&#19978;&#19979;&#25991;&#29305;&#23450;&#30340;&#32534;&#36753;&#22120;&#12290;</p>
<p>&#22914;&#19979;&#20363;&#23376;&#65292;&#28436;&#31034;&#20102; <code class="literal">@InitBinder</code> &#30340;&#20351;&#29992; &#8212;&#8212; &#37197;&#32622;&#19968;&#20010;&#35299;&#37322;&#25152;&#26377;&#34920;&#21333; <code class="literal">java.util.Date</code> &#23646;&#24615;&#30340; <code class="literal">CustomDateEditor</code>&#65306;</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Controller</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyFormController {

    <span class="strong"><strong>@InitBinder</strong></span>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> initBinder(WebDataBinder binder) {
        SimpleDateFormat dateFormat = <span class="hl-keyword">new</span> SimpleDateFormat(<span class="hl-string">"yyyy-MM-dd"</span>);
        dateFormat.setLenient(false);
        binder.registerCustomEditor(Date.<span class="hl-keyword">class</span>, <span class="hl-keyword">new</span> CustomDateEditor(dateFormat, false));
    }

    <span class="hl-comment">// ...</span>

}</pre>

</div>
<div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="mvc-ann-webbindinginitializer" href="#mvc-ann-webbindinginitializer"></a>&#37197;&#32622;&#33258;&#23450;&#20041;&#30340; WebBindingInitializer</h5></div></div></div>

<p>&#38656;&#35201;&#35814;&#32454;&#21021;&#22987;&#21270;&#25968;&#25454;&#32465;&#23450;&#30340;&#65292;&#20320;&#21487;&#20197;&#25552;&#20379;&#19968;&#20010; <code class="literal">WebBindingInitializer</code> &#25509;&#21475;&#30340;&#33258;&#23450;&#20041;&#23454;&#29616;&#65292;&#28982;&#21518;&#20877;&#25552;&#20379;&#19968;&#20010; <code class="literal">AnnotationMethodHandlerAdapter</code> &#30340;&#33258;&#23450;&#20041;&#20197;&#37197;&#32622; bean&#65292;&#20415;&#21487;&#35206;&#30422;&#25968;&#25454;&#32465;&#23450;&#40664;&#35748;&#30340;&#37197;&#32622;&#12290;</p>
<p>&#26469;&#33258; PetClinic &#24212;&#29992;&#30340;&#20363;&#23376;&#65292;&#28436;&#31034;&#20102;&#22914;&#20309;&#37197;&#32622;&#65306;&#20351;&#29992;&#20102; <code class="literal">WebBindingInitializer</code> &#25509;&#21475;&#30340;&#33258;&#23450;&#20041;&#23454;&#29616;&#65292;&#21644;&#19968;&#20010; <code class="literal">org.springframework.samples.petclinic.web.ClinicBindingInitializer</code>&#31867;(&#36825;&#20010;&#31867;&#37197;&#32622;&#20102; PetClinic &#22810;&#20010;&#25511;&#21046;&#22120;&#25152;&#20351;&#29992;&#30340; PropertyEditors) &#65306;</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"cacheSeconds"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"0"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"webBindingInitializer"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.samples.petclinic.web.ClinicBindingInitializer"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre>

<p><code class="literal">@InitBinder</code> &#26041;&#27861;&#20063;&#21487;&#22312; <code class="literal">@ControllerAdvice</code>- &#27880;&#35299;&#30340;&#31867;&#20013;&#20351;&#29992;&#65292; &#36825;&#31181;&#24773;&#20917;&#19979;&#65292;<code class="literal">@InitBinder</code> &#29992;&#20110;&#26144;&#23556;&#25511;&#21046;&#22120;&#12290;&#36825;&#20063;&#25552;&#20379;&#21478;&#22806;&#19968;&#31181;&#36873;&#25321; &#8212;&#8212; &#20351;&#29992; <code class="literal">WebBindingInitializer</code>&#65292;&#35814;&#24773;&#21487;&#26597;&#30475; <a class="xref" href="mvc.html#mvc-ann-controller-advice" title="&#20351;&#29992; @ControllerAdvice &#27880;&#35299;&#22686;&#24378;&#25511;&#21046;&#22120;">the section called &#8220;&#20351;&#29992; <code class="literal">@ControllerAdvice</code> &#27880;&#35299;&#22686;&#24378;&#25511;&#21046;&#22120;&#8221;</a>&#12290;</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="mvc-ann-lastmodified" href="#mvc-ann-lastmodified"></a>&#25903;&#25345; Last-Modified &#21709;&#24212;&#22836;&#65292;&#26041;&#20415;&#32531;&#23384;&#20869;&#23481;</h4></div></div></div>

<p>&#20381;&#25454; Servlet API &#23545; <code class="literal">getLastModified</code> &#26041;&#27861;&#30340;&#23450;&#20041;&#65292;<code class="literal">@RequestMapping</code> &#26041;&#27861;&#20063;&#21487;&#20197;&#25903;&#25345; <code class="literal">'Last-Modified'</code> HTTP &#35831;&#27714;&#65292;&#20197;&#26041;&#20415;&#20869;&#23481;&#32531;&#23384;&#65292;&#21152;&#24555;&#21709;&#24212;&#12290;<code class="literal">getLastModified</code>  &#26041;&#27861;&#30340;&#35843;&#29992;&#65292;&#38656;&#35201;&#35745;&#31639;&#32473;&#23450;&#35831;&#27714;&#30340; lastModified &#20540;&#65288;long &#31867;&#22411;&#65289;&#65292;&#24182;&#23558;&#20854;&#19982;&#35831;&#27714;&#22836; <code class="literal">'If-Modified-Since'</code> &#30456;&#20114;&#27604;&#36739;&#65292;&#33509;&#35748;&#20026;&#20854;&#27809;&#26377;&#26356;&#26032;&#65292;&#36820;&#22238;&#29366;&#24577;&#30721;&#20026; 304 &#30340; response&#12290;&#27880;&#35299;&#25511;&#21046;&#22120;&#21487;&#22914;&#27492;&#23454;&#29616;&#36825;&#19968;&#38656;&#27714;&#65306;</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@RequestMapping</span></em>
<span class="hl-keyword">public</span> String myHandleMethod(WebRequest webRequest, Model model) {

    <span class="hl-keyword">long</span> lastModified = <span class="hl-comment">// 1. &#24212;&#29992;&#25351;&#23450;&#30340;&#35745;&#31639;&#20540;</span>

    <span class="hl-keyword">if</span> (request.checkNotModified(lastModified)) {
        <span class="hl-comment">// 2. &#24555;&#36895;&#36864;&#20986; &#8212;&#8212; &#19981;&#20316;&#36827;&#19968;&#27493;&#22788;&#29702;</span>
        <span class="hl-keyword">return</span> null;
    }
    <span class="hl-comment">// 3. &#21542;&#21017;&#65292;&#36827;&#19968;&#27493;&#22788;&#29702;&#35831;&#27714;&#65292;&#26412;&#36136;&#26159;&#20934;&#22791;&#20869;&#23481;</span>
    model.addAttribute(...);
    <span class="hl-keyword">return</span> <span class="hl-string">"myViewName"</span>;
}</pre>

<p>&#27880;&#24847;&#20004;&#20010;&#20851;&#38190;&#28857;&#65306;&#35843;&#29992; <code class="literal">request.checkNotModified(lastModified)</code> &#21644; &#36820;&#22238; <code class="literal">null</code>&#12290;&#21069;&#32773;&#23558; response &#30340;&#29366;&#24577;&#35774;&#32622;&#20026; 304 &#21518;&#25165;&#36820;&#22238; <code class="literal">true</code>&#12290;&#21518;&#32773;&#65292;&#19982;&#21069;&#32773;&#30340;&#20351;&#29992;&#32467;&#21512;&#65292;&#21578;&#30693; Spring MVC &#19981;&#23545;&#35831;&#27714;&#20316;&#36827;&#19968;&#27493;&#30340;&#22788;&#29702;&#12290;</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="mvc-ann-controller-advice" href="#mvc-ann-controller-advice"></a>&#20351;&#29992; <code class="literal">@ControllerAdvice</code> &#27880;&#35299;&#22686;&#24378;&#25511;&#21046;&#22120;</h4></div></div></div>

<p><code class="literal">@ControllerAdvice</code> &#27880;&#35299;&#21487;&#20197;&#35753;&#23454;&#29616;&#31867;&#36890;&#36807;&#31867;&#36335;&#24452;&#33258;&#21160;&#26816;&#27979;&#20986;&#26469;&#12290;&#24403;&#20351;&#29992; MVC &#21629;&#21517;&#31354;&#38388;&#25110; MVC Java &#37197;&#32622;&#26102;&#65292;&#27492;&#27492;&#21151;&#33021;&#26159;&#40664;&#35748;&#21551;&#21160;&#30340;&#12290;</p>
<p>&#24102;&#26377; <code class="literal">@ControllerAdvice</code> &#27880;&#35299;&#30340;&#31867;&#65292;&#21487;&#20197;&#21253;&#21547; <code class="literal">@ExceptionHandler</code>&#12289;<code class="literal">@InitBinder</code>, &#21644; <code class="literal">@ModelAttribute</code> &#27880;&#35299;&#30340;&#26041;&#27861;&#65292;&#24182;&#19988;&#36825;&#20123;&#27880;&#35299;&#30340;&#26041;&#27861;&#20250;&#36890;&#36807;&#25511;&#21046;&#22120;&#23618;&#27425;&#24212;&#29992;&#21040;&#25152;&#26377; <code class="literal">@RequestMapping</code> &#26041;&#27861;&#20013;&#65292;&#32780;&#19981;&#29992;&#19968;&#19968;&#22312;&#25511;&#21046;&#22120;&#20869;&#37096;&#22768;&#26126;&#12290;</p>
<p>Classes annotated with <code class="literal">@ControllerAdvice</code> can contain <code class="literal">@ExceptionHandler</code>,
<code class="literal">@InitBinder</code>, and <code class="literal">@ModelAttribute</code> annotated methods, and these methods will apply to
<code class="literal">@RequestMapping</code> methods across all controller hierarchies as opposed to the controller
hierarchy within which they are declared.</p>
<p><code class="literal">@ControllerAdvice</code> &#27880;&#35299;&#20063;&#21487;&#22312;&#23646;&#24615;&#20013;&#27880;&#26126;&#65292;&#23558;&#24212;&#29992;&#21040;&#21738;&#20123;&#30446;&#26631;&#25511;&#21046;&#22120;&#65306;</p>
<pre class="programlisting"><span class="hl-comment">// &#24212;&#29992;&#21040;&#25152;&#26377; @RestController &#25511;&#21046;&#22120;</span>
<em><span class="hl-annotation" style="color: gray">@ControllerAdvice(annotations = RestController.class)</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AnnotationAdvice {}

<span class="hl-comment">// &#24212;&#29992;&#21040;&#25351;&#23450;&#21253;&#19979;&#30340;&#25511;&#21046;&#22120;</span>
<em><span class="hl-annotation" style="color: gray">@ControllerAdvice("org.example.controllers")</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> BasePackageAdvice {}

<span class="hl-comment">// &#24212;&#29992;&#21040;&#25351;&#23450;&#31867;&#22411;&#30340;&#25511;&#21046;&#22120;</span>
<em><span class="hl-annotation" style="color: gray">@ControllerAdvice(assignableTypes = {ControllerInterface.class, AbstractController.class})</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AssignableTypesAdvice {}</pre>

<p>&#24076;&#26395;&#21152;&#28145;&#20102;&#35299;&#30340;&#65292;&#21487;&#20197; Check out
<a class="ulink" href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/web/bind/annotation/ControllerAdvice.html" target="_top"><code class="literal">@ControllerAdvice</code>
&#25991;&#26723;</a>&#12290;</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="mvc-ann-jsonview" href="#mvc-ann-jsonview"></a>&#25903;&#25345; Jackson &#24207;&#21015;&#21270;&#35270;&#22270;</h4></div></div></div>

<p>&#22312;&#23558;&#23545;&#35937;&#24207;&#21015;&#21270;&#21040;&#21709;&#24212;&#20307;&#26102;&#65292;&#20598;&#23572;&#38656;&#35201;&#36807;&#28388;&#25935;&#24863;&#30340;&#25968;&#25454;&#12290;&#20026;&#20102;&#25552;&#20379;&#36825;&#19968;&#21151;&#33021;&#65292;Spring MVC &#20869;&#32622;&#25903;&#25345;&#20351;&#29992; <a class="ulink" href="http://wiki.fasterxml.com/JacksonJsonViews" target="_top">Jackson &#24207;&#21015;&#21270;&#35270;&#22270;</a>&#12290;</p>
<p>&#21487;&#22312;&#24102;&#26377; <code class="literal">@ResponseBody</code> &#27880;&#35299;&#30340;&#26041;&#27861;&#25110;&#36820;&#22238;<code class="literal">ResponseEntity</code> &#30340;&#26041;&#27861;&#20013;&#20351;&#29992;Jackson &#24207;&#21015;&#21270;&#35270;&#22270;&#65292;&#21482;&#38656;&#35201;&#28155;&#21152;&#19968;&#20010;&#24102; class &#21442;&#25968;&#30340;<code class="literal">@JsonView</code>&#21363;&#21487;&#65288;class &#21442;&#25968;&#25351;&#23450;&#25152;&#20351;&#29992;&#30340;&#35270;&#22270;&#31867;&#25110;&#25509;&#21475;&#65289;&#12290;</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@RestController</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> UserController {

    <em><span class="hl-annotation" style="color: gray">@RequestMapping(value = "/user", method = RequestMethod.GET)</span></em>
    <em><span class="hl-annotation" style="color: gray">@JsonView(User.WithoutPasswordView.class)</span></em>
    <span class="hl-keyword">public</span> User getUser() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> User(<span class="hl-string">"eric"</span>, <span class="hl-string">"7!jd#h23"</span>);
    }
}

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> User {

    <span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> WithoutPasswordView {};
    <span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> WithPasswordView <span class="hl-keyword">extends</span> WithoutPasswordView {};

    <span class="hl-keyword">private</span> String username;
    <span class="hl-keyword">private</span> String password;

    <span class="hl-keyword">public</span> User() {
    }

    <span class="hl-keyword">public</span> User(String username, String password) {
        <span class="hl-keyword">this</span>.username = username;
        <span class="hl-keyword">this</span>.password = password;
    }

    <em><span class="hl-annotation" style="color: gray">@JsonView(WithoutPasswordView.class)</span></em>
    <span class="hl-keyword">public</span> String getUsername() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">this</span>.username;
    }

    <em><span class="hl-annotation" style="color: gray">@JsonView(WithPasswordView.class)</span></em>
    <span class="hl-keyword">public</span> String getPassword() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">this</span>.password;
    }
}</pre>

<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>&#27880;&#24847;&#65306;&#23613;&#31649; <code class="literal">@JsonView</code> &#25903;&#25345;&#24207;&#21015;&#21270;&#22810;&#20010;&#31867;&#65292;&#20294;&#25511;&#21046;&#22120;&#26041;&#27861;&#21482;&#25903;&#25345; <code class="literal">@JsonView</code> &#24207;&#21015;&#21270;&#19968;&#20010;&#31867;&#12290;&#22914;&#26524;&#38656;&#35201;&#24207;&#21015;&#21270;&#22810;&#20010;&#35270;&#22270;&#65292;&#21487;&#20197;&#20351;&#29992;&#22810;&#20010;&#25509;&#21475;&#32452;&#21512;&#30340;&#26041;&#24335;&#12290;</p>
</td></tr></table></div>

<p>&#23545;&#20110;&#25511;&#21046;&#22120;&#20381;&#36182;&#20110;&#35270;&#22270;&#35299;&#26512;&#30340;&#24773;&#20917;&#65292;&#21482;&#38656;&#23558;&#24207;&#21015;&#21270;&#30340;&#35270;&#22270;&#31867;&#28155;&#21152;&#21040;&#27169;&#22411;&#37324;&#65292;&#21363;&#21487;&#12290;</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Controller</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> UserController <span class="hl-keyword">extends</span> AbstractController {

    <em><span class="hl-annotation" style="color: gray">@RequestMapping(value = "/user", method = RequestMethod.GET)</span></em>
    <span class="hl-keyword">public</span> String getUser(Model model) {
        model.addAttribute(<span class="hl-string">"user"</span>, <span class="hl-keyword">new</span> User(<span class="hl-string">"eric"</span>, <span class="hl-string">"7!jd#h23"</span>));
        model.addAttribute(JsonView.<span class="hl-keyword">class</span>.getName(), User.WithoutPasswordView.<span class="hl-keyword">class</span>);
        <span class="hl-keyword">return</span> <span class="hl-string">"userView"</span>;
    }
}</pre>

</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="mvc-ann-jsonp" href="#mvc-ann-jsonp"></a>&#25903;&#25345; Jackson JSONP</h4></div></div></div>

<p>&#33509;&#38656;&#35201;&#25903;&#25345;&#22312; <code class="literal">@ResponseBody</code> &#21644; <code class="literal">ResponseEntity</code> &#26041;&#27861;&#20013;&#25903;&#25345; <a class="ulink" href="http://en.wikipedia.org/wiki/JSONP" target="_top">JSONP</a> &#30340;&#20351;&#29992;&#65292;&#21487;&#20197;&#23450;&#19968;&#20010; <code class="literal">@ControllerAdvice</code> bean &#24182;&#32487;&#25215; <code class="literal">AbstractJsonpResponseBodyAdvice</code> &#31867;&#12290;<code class="literal">AbstractJsonpResponseBodyAdvice</code> &#30340;&#26500;&#36896;&#22120;&#35828;&#26126; JSONP &#30340;&#26597;&#35810;&#21442;&#25968;&#12290;&#20855;&#20307;&#20363;&#23376;&#22914;&#19979;&#65306;</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@ControllerAdvice</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> JsonpAdvice <span class="hl-keyword">extends</span> AbstractJsonpResponseBodyAdvice {

    <span class="hl-keyword">public</span> JsonpAdvice() {
        <span class="hl-keyword">super</span>(<span class="hl-string">"callback"</span>);
    }
}</pre>

<p>&#23545;&#20110;&#25511;&#21046;&#22120;&#20381;&#36182;&#20110;&#35270;&#22270;&#35299;&#26512;&#30340;&#24773;&#20917;&#65292;&#21482;&#38656;&#35201;&#35831;&#27714;&#24102;&#26377; <code class="literal">jsonp</code> &#25110; <code class="literal">callback</code> &#26597;&#35810;&#21442;&#25968;&#65292;JSONP &#20250;&#33258;&#21160;&#28608;&#27963;&#12290;JSONP &#26597;&#35810;&#21442;&#25968;&#21487;&#20197;&#36890;&#36807; <code class="literal">jsonpParameterNames</code> &#23646;&#24615;&#33258;&#23450;&#20041;&#12290;</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-ann-async" href="#mvc-ann-async"></a>16.3.4&nbsp;&#24322;&#27493;&#35831;&#27714;&#22788;&#29702;</h3></div></div></div>

<p>Spring MVC &#24341;&#20837;&#20102;&#22522;&#20110;&#24322;&#27493;&#35831;&#27714;&#30340; Servlet 3&#12290;&#22312;&#24322;&#27493;&#35831;&#27714;&#20013;&#65292;&#25511;&#21046;&#22120;&#26041;&#27861;&#36890;&#24120;&#20250;&#36820;&#22238; <code class="literal">java.util.concurrent.Callable</code> &#23545;&#35937;&#21518;&#20877;&#20351;&#29992;&#19968;&#20010;&#29420;&#31435;&#30340;&#32447;&#31243;&#20135;&#29983;&#36820;&#22238;&#20540;&#65292;&#32780;&#19981;&#26159;&#30452;&#25509;&#36820;&#22238;&#19968;&#20010;&#20540;&#12290;&#21516;&#26102;&#37322;&#25918; Servlet &#23481;&#22120;&#30340;&#20027;&#32447;&#31243;&#21644;&#20801;&#35768;&#22788;&#29702;&#20854;&#20182;&#35831;&#27714;&#12290;Spring MVC &#20511;&#21161; <code class="literal">TaskExecutor</code> &#65292;&#22312;&#19968;&#20010;&#29420;&#31435;&#32447;&#31243;&#20013;&#35843;&#29992; <code class="literal">Callable</code>&#65292;&#24403; <code class="literal">Callable</code> &#36820;&#22238;&#26102;&#65292;&#23558;&#35831;&#27714;&#36716;&#21457;&#21040; Servlet &#23481;&#22120;&#24182;&#32487;&#32493;&#22788;&#29702; <code class="literal">Callable</code> &#36820;&#22238;&#20540;&#12290;&#20363;&#23376;&#22914;&#19979;&#65306;</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@RequestMapping(method=RequestMethod.POST)</span></em>
<span class="hl-keyword">public</span> Callable&lt;String&gt; processUpload(<span class="hl-keyword">final</span> MultipartFile file) {

    <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> Callable&lt;String&gt;() {
        <span class="hl-keyword">public</span> String call() <span class="hl-keyword">throws</span> Exception {
            <span class="hl-comment">// ...</span>
            <span class="hl-keyword">return</span> <span class="hl-string">"someView"</span>;
        }
    };

}</pre>

<p>&#24322;&#27493;&#35831;&#27714;&#30340;&#21478;&#22806;&#19968;&#31181;&#26041;&#24335;&#65292;&#26159;&#35753;&#25511;&#21046;&#22120;&#36820;&#22238; <code class="literal">DeferredResult</code> &#23454;&#20363;&#12290;&#36825;&#31181;&#24773;&#20917;&#19979;&#65292;&#20381;&#28982;&#26159;&#20174;&#19968;&#20010;&#29420;&#31435;&#32447;&#31243;&#22788;&#29702;&#24182;&#20135;&#29983;&#36820;&#22238;&#20540;&#12290;&#28982;&#32780;&#65292;Spring MVC &#24182;&#19981;&#30693;&#26195;&#36825;&#20010;&#32447;&#31243;&#30340;&#21518;&#32493;&#22788;&#29702;&#12290;&#27604;&#22914;&#35828;&#65292;&#36825;&#20010;&#36820;&#22238;&#32467;&#26524;&#21487;&#20197;&#29992;&#26469;&#21709;&#24212;&#26576;&#20123;&#22806;&#37096;&#20107;&#20214;&#65288;&#22914; JMS &#20449;&#24687;&#65292;&#35745;&#21010;&#20219;&#21153;&#31561;&#65289;&#12290;&#20363;&#23376;&#22914;&#19979;&#65306;</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@RequestMapping("/quotes")</span></em>
<em><span class="hl-annotation" style="color: gray">@ResponseBody</span></em>
<span class="hl-keyword">public</span> DeferredResult&lt;String&gt; quotes() {
    DeferredResult&lt;String&gt; deferredResult = <span class="hl-keyword">new</span> DeferredResult&lt;String&gt;();
    <span class="hl-comment">// &#23558; deferredResult &#20445;&#23384;&#21040;&#20869;&#23384;&#38431;&#21015;</span>
    <span class="hl-keyword">return</span> deferredResult;
}

<span class="hl-comment">// &#22312;&#20854;&#20182;&#32447;&#31243;&#20013;...</span>
deferredResult.setResult(data);</pre>

<p>&#22914;&#26524;&#19981;&#20102;&#35299; Servlet 3 &#24322;&#27493;&#22788;&#29702;&#30340;&#32454;&#33410;&#65292;&#29702;&#35299;&#36215;&#26469;&#21487;&#33021;&#20250;&#19968;&#23450;&#30340;&#38590;&#24230;&#12290;&#24403;&#28982;&#65292;&#36825;&#37324;&#20250;&#24110;&#21161;&#20320;&#21435;&#29702;&#35299;&#12290;&#25105;&#20204;&#26368;&#23569;&#38656;&#35201;&#30693;&#36947;&#20197;&#19979;&#20107;&#23454;&#65306;</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
&#19968;&#20010; <code class="literal">ServletRequest</code> &#35831;&#27714;&#21487;&#36890;&#36807;&#35843;&#29992; <code class="literal">request.startAsync()</code> &#26041;&#27861;&#35774;&#32622;&#20026;&#24322;&#27493;&#27169;&#24335;&#12290;&#27492;&#27493;&#39588;&#26368;&#20027;&#35201;&#30340;&#20316;&#29992;&#26159;&#65292;&#22312;&#27492; Servlet &#21644;&#20854;&#20182;&#36807;&#28388;&#22120;&#36864;&#20986;&#30340;&#24773;&#20917;&#19979;&#65292;response &#20381;&#28982;&#21487;&#20197;&#20445;&#25345;&#25171;&#24320;&#29366;&#24577;&#65292;&#20197;&#20415;&#20854;&#20182;&#32447;&#31243;&#26469;&#23436;&#25104;&#22788;&#29702;&#12290;
</li><li class="listitem">
&#35843;&#29992; <code class="literal">request.startAsync()</code> &#26041;&#27861;&#36820;&#22238;&#19968;&#20010; <code class="literal">AsyncContext</code>&#12290;&#22312;&#24322;&#27493;&#22788;&#29702;&#20013;&#65292;<code class="literal">AsyncContext</code> &#21487;&#20197;&#29992;&#26469;&#20570;&#36827;&#19968;&#27493;&#30340;&#25511;&#21046;&#12290;&#27604;&#22914;&#35828;&#65292;<code class="literal">AsyncContext</code> &#25552;&#20379;&#30340; <code class="literal">dispatch</code> &#26041;&#27861;&#65292;&#21487;&#20197;&#22312;&#24212;&#29992;&#32447;&#31243;&#20013;&#35843;&#29992;&#65292;&#23558;&#35831;&#27714;&#36716;&#21457;&#22238; Servlet &#23481;&#22120;&#12290;&#24322;&#27493; dispatch(&#36716;&#21457;)&#31867;&#20284;&#20110;&#24179;&#26102;&#20351;&#29992;&#30340; forward &#26041;&#27861;&#12290;&#19981;&#21516;&#30340;&#26159;&#65292;&#24322;&#27493; dispatch(&#36716;&#21457;)&#26159;&#20174;&#24212;&#29992;&#37324;&#30340;&#19968;&#20010;&#32447;&#31243;&#36716;&#21457;&#21040; Servlet &#23481;&#22120;&#20013;&#30340;&#21478;&#19968;&#20010;&#32447;&#31243;&#65292;&#32780; forward &#26041;&#27861;&#21017;&#26159;&#22312; Servlet &#23481;&#22120;&#37324;&#30340;&#21516;&#19968;&#20010;&#32447;&#31243;&#38388;&#36716;&#21457;&#12290;
</li><li class="listitem">
<code class="literal">ServletRequest</code> &#21487;&#20197;&#26041;&#20301;&#24403;&#21069;&#30340; <code class="literal">DispatcherType</code>&#65288;&#36716;&#21457;&#31867;&#22411;&#65289;&#65292;&#27492;&#21151;&#33021;&#21487;&#20197;&#29992;&#20110;&#21028;&#26029; <span class="emphasis"><em>Servlet</em></span> &#25110; <span class="emphasis"><em>Filter</em></span> &#26159;&#22312;&#21407;&#22987;&#35831;&#27714;&#32447;&#31243;&#19978;&#22788;&#29702;&#35831;&#27714;&#65292;&#36824;&#26159;&#22312;&#24322;&#27493;&#36716;&#21457;&#32447;&#31243;&#20013;&#22788;&#29702;&#12290;
</li></ul></div>

<p>&#35760;&#20303;&#20197;&#19978;&#20107;&#23454;&#20043;&#21518;&#65292;&#25509;&#30528;&#20102;&#35299;&#19968;&#19979;&#24322;&#27493;&#35831;&#27714;&#22788;&#29702; <code class="literal">Callable</code> &#30340;&#36807;&#31243;&#65306;(1) &#25511;&#21046;&#22120;&#36820;&#22238;&#19968;&#20010; <code class="literal">Callable</code> ,(2) Spring MVC &#24320;&#22987;&#24322;&#27493;&#22788;&#29702;&#65292;&#23558; <code class="literal">Callable</code> &#25552;&#20132;&#32473; <code class="literal">TaskExecutor</code>&#65292;<code class="literal">TaskExecutor</code> &#22312;&#19968;&#20010;&#29420;&#31435;&#32447;&#31243;&#20013;&#22788;&#29702;&#65292;(3) <code class="literal">DispatcherServlet</code> &#21644;&#25152;&#26377;&#36807;&#28388;&#22120;&#36864;&#20986;&#35831;&#27714;&#22788;&#29702;&#32447;&#31243;&#65292;&#19981;&#36807;&#20445;&#25345; response &#20026;&#25171;&#24320;&#29366;&#24577;&#65292;(4) <code class="literal">Callable</code> &#20135;&#29983;&#19968;&#20010;&#32467;&#26524;&#20043;&#21518;&#65292;Spring MVC &#23558;&#36825;&#20010;&#35831;&#27714;&#36716;&#21457;&#22238; Servlet &#23481;&#22120;&#65292;(5) &#20877;&#27425;&#35843;&#29992; <code class="literal">DispatcherServlet</code>&#65292;&#24182;&#37325;&#26032;&#22788;&#29702; <code class="literal">Callable</code> &#24322;&#27493;&#20135;&#29983;&#30340;&#32467;&#26524;&#12290;(2),(3),(4) &#30340;&#20934;&#30830;&#39034;&#24207;&#22312;&#19981;&#21516;&#24773;&#20917;&#19979;&#21487;&#33021;&#26377;&#25152;&#19981;&#21516;&#65292;&#36825;&#20010;&#21462;&#20915;&#20110;&#24182;&#21457;&#32447;&#31243;&#30340;&#22788;&#29702;&#36895;&#24230;&#12290;</p>
<p>&#24322;&#27493;&#35831;&#27714;&#22788;&#29702; <code class="literal">DeferredResult</code> &#30340;&#20107;&#20214;&#39034;&#24207;&#22823;&#20307;&#19978;&#21644;&#22788;&#29702; <code class="literal">Callable</code> &#30340;&#39034;&#24207;&#30456;&#21516;&#12290;&#19981;&#21516;&#30340;&#26159;&#65292;&#36825;&#37324;&#26159;&#30001;&#24212;&#29992;&#31243;&#24207;&#30340;&#26576;&#20123;&#32447;&#31243;&#26469;&#22788;&#29702;&#24322;&#27493;&#32467;&#26524;:(1) &#25511;&#21046;&#22120;&#36820;&#22238;&#19968;&#20010; <code class="literal">DeferredResult</code> &#23545;&#35937;&#65292;&#24182;&#23558;&#20854;&#20445;&#23384;&#21040;&#21487;&#35775;&#38382;&#30340;&#20869;&#23384;&#38431;&#21015;&#25110;&#21015;&#34920;&#20013;&#65292;(2) Spring MVC &#24320;&#22987;&#24322;&#27493;&#22788;&#29702;&#65292;(3) <code class="literal">DispatcherServlet</code> &#21644;&#25152;&#26377;&#36807;&#28388;&#22120;&#36864;&#20986;&#35831;&#27714;&#22788;&#29702;&#32447;&#31243;&#65292;&#19981;&#36807;&#20445;&#25345; response &#20026;&#25171;&#24320;&#29366;&#24577;&#65292;(4) &#24212;&#29992;&#31243;&#24207;&#22312;&#26576;&#20123;&#32447;&#31243;&#20013;&#35774;&#32622; <code class="literal">DeferredResult</code>&#65292;&#20043;&#21518; Spring MVC &#23558;&#36825;&#20010;&#35831;&#27714;&#36716;&#21457;&#22238; Servlet &#23481;&#22120;&#65292;(5) &#20877;&#27425;&#35843;&#29992; <code class="literal">DispatcherServlet</code>&#65292;&#24182;&#37325;&#26032;&#22788;&#29702;&#24322;&#27493;&#20135;&#29983;&#30340;&#32467;&#26524;&#12290;</p>
<p>&#35299;&#37322;&#20102;&#24322;&#27493;&#35831;&#27714;&#22788;&#29702;&#30340;&#26426;&#21046;&#65292;&#33267;&#20110;&#20309;&#26102;&#21644;&#20026;&#20160;&#20040;&#20351;&#29992;&#24322;&#24120;&#35831;&#27714;&#22788;&#29702;&#65292;&#23601;&#36229;&#20986;&#20102;&#27492;&#25991;&#26723;&#30340;&#20171;&#32461;&#33539;&#22260;&#12290;&#38656;&#35201;&#28145;&#20837;&#20102;&#35299;&#30340;&#65292;&#21487;&#20197;&#26597;&#30475; <a class="ulink" href="https://spring.io/blog/2012/05/07/spring-mvc-3-2-preview-introducing-servlet-3-async-support" target="_top">&#36825;&#19968;&#31995;&#21015;&#21338;&#23458;</a>.</p>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="mvc-ann-async-exceptions" href="#mvc-ann-async-exceptions"></a>&#24322;&#27493;&#35831;&#27714;&#30340;&#24322;&#24120;&#22788;&#29702;</h4></div></div></div>

<p>&#24403;&#25511;&#21046;&#22120;&#36820;&#22238;&#30340; <code class="literal">Callable</code> &#22312;&#25191;&#34892;&#26102;&#21453;&#29983;&#20102;&#24322;&#24120;&#65292;&#20250;&#20986;&#29616;&#20160;&#20040;&#24773;&#20917;&#65311;&#36825;&#31181;&#24773;&#20917;&#31867;&#20284;&#20110;&#25511;&#21046;&#22120;&#21457;&#29983;&#24322;&#24120;&#26102;&#30340;&#24773;&#20917;&#12290;&#25152;&#20986;&#29616;&#30340;&#24322;&#24120;&#20250;&#30001;&#21516;&#19968;&#25511;&#21046;&#22120;&#37324;&#30340; <code class="literal">@ExceptionHandler</code> &#26041;&#27861;&#22788;&#29702;&#65292;&#25110;&#30001;&#25152;&#37197;&#32622;&#30340; <code class="literal">HandlerExceptionResolver</code> &#23454;&#20363;&#26469;&#22788;&#29702;&#12290;</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>&#22312;&#21518;&#21488;&#65292;&#24403; <code class="literal">Callable</code> &#25191;&#34892;&#21457;&#29983;&#20102;&#24322;&#24120;&#26102;&#65292;Spring MVC &#20173;&#28982;&#20250;&#23601;&#23558;&#20854;&#36716;&#21457;&#20250; Servlet &#23481;&#22120;&#65292;&#32487;&#32493;&#22120;&#21518;&#32493;&#22788;&#29702;&#12290;&#21807;&#19968;&#19981;&#21516;&#30340;&#26159;&#65292;&#25191;&#34892; <code class="literal">Callable</code> &#36820;&#22238;&#30340;&#32467;&#26524;&#26159;&#19968;&#20010;&#24322;&#24120;&#65292;&#27492;&#24322;&#24120;&#24517;&#39035;&#26377;&#25152;&#37197;&#32622;&#30340; <code class="literal">HandlerExceptionResolver</code> &#23454;&#20363;&#26469;&#22788;&#29702;&#12290;</p>
</td></tr></table></div>

<p>&#22914;&#26524;&#26159;&#25191;&#34892; <code class="literal">DeferredResult</code> &#26102;&#20986;&#29616;&#24322;&#24120;&#65292;&#20320;&#21487;&#20197;&#36873;&#25321;&#35843;&#29992; <code class="literal">DeferredResult</code> &#25552;&#20379;&#30340; <code class="literal">setErrorResult(Object)</code> &#26041;&#27861;&#65292;&#35813;&#26041;&#27861;&#39035;&#25552;&#20379;&#19968;&#20010;&#24322;&#24120;&#25110;&#20854;&#20182;&#20320;&#35774;&#32622;&#35774;&#32622;&#30340;&#23545;&#35937;&#12290; &#24403;&#32467;&#26524;&#26159;&#19968;&#20010; <code class="literal">Exception</code> &#26102;&#65292;&#20250;&#30001;&#21516;&#19968;&#25511;&#21046;&#22120;&#37324;&#30340; <code class="literal">@ExceptionHandler</code> &#26041;&#27861;&#22788;&#29702;&#65292;&#25110;&#30001;&#25152;&#37197;&#32622;&#30340; <code class="literal">HandlerExceptionResolver</code> &#23454;&#20363;&#26469;&#22788;&#29702;&#12290;</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="mvc-ann-async-interception" href="#mvc-ann-async-interception"></a>&#25318;&#25130;&#24322;&#27493;&#35831;&#27714;</h4></div></div></div>

<p><code class="literal">HandlerInterceptor</code> &#21487;&#20197;&#23454;&#29616; <code class="literal">AsyncHandlerInterceptor</code> &#25509;&#21475;&#65292;&#27492;&#25509;&#21475;&#39069;&#22806;&#25552;&#20379;&#19968;&#20010; <code class="literal">afterConcurrentHandlingStarted</code> &#26041;&#27861;&#12290;&#35813;&#26041;&#27861;&#20250;&#22312;&#21021;&#22987;&#35831;&#27714;&#22788;&#32447;&#31243;&#36864;&#20986; &#21644; &#24322;&#27493;&#22788;&#29702;&#24320;&#22987;&#20043;&#21518;&#35843;&#29992;&#12290;&#35814;&#32454;&#20449;&#24687;&#21487;&#21442;&#32771; <code class="literal">AsyncHandlerInterceptor</code> javadocs &#12290;</p>
<p>&#20063;&#21487;&#20197;&#36873;&#25321;&#20351;&#29992; <code class="literal">DeferredResult</code> &#30452;&#25509;&#25552;&#20379;&#30340;&#24322;&#27493;&#35831;&#27714;&#29983;&#21629;&#21608;&#26399;&#22238;&#35843;&#20989;&#25968;&#65292;&#24403;&#20013;&#21253;&#25324;&#20102; <code class="literal">onTimeout(Runnable)</code> &#21644; <code class="literal">onCompletion(Runnable)</code> &#26041;&#27861;&#12290;&#36825;&#20004;&#20010;&#26041;&#27861;&#20250;&#20998;&#21035;&#22312;&#24322;&#27493;&#35831;&#27714;&#36229;&#26102;&#25110;&#23436;&#25104;&#26102;&#35843;&#29992;&#12290;&#36229;&#26102;&#20107;&#20214;&#21487;&#36890;&#36807;&#35774;&#32622; <code class="literal">DeferredResult</code> &#37096;&#20998;&#20540;&#26469;&#22788;&#29702;&#65292;&#28982;&#32780;&#65292;&#23436;&#25104;&#26102;&#30340;&#22238;&#35843;&#24847;&#21619;&#30528;&#32467;&#26463;&#65292;&#21363;&#19981;&#33021;&#20877;&#35774;&#32622;&#36820;&#22238;&#32467;&#26524;&#12290;</p>
<p><code class="literal">Callable</code> &#20063;&#21487;&#20197;&#20351;&#29992;&#31867;&#20284;&#30340;&#22238;&#35843;&#21151;&#33021;&#12290;&#21487;&#26159;&#65292;&#20320;&#38656;&#35201;&#23558; <code class="literal">Callable</code> &#23553;&#35013;&#25104; <code class="literal">WebAsyncTask</code> &#23454;&#20363;&#65292;&#25509;&#30528;&#20351;&#29992;&#36825;&#20010;&#23454;&#20363;&#27880;&#20876;&#36229;&#26102;&#21644;&#23436;&#25104;&#26102;&#20107;&#20214;&#12290;&#22914;&#27492;&#20415;&#21487;&#20687; <code class="literal">DeferredResult</code> &#37027;&#26679;&#65292;&#22788;&#29702;&#36229;&#26102;&#26102;&#38388;&#21644;&#22312;&#23436;&#25104;&#26102;&#36820;&#22238;&#19968;&#20010;&#20540;&#12290;</p>
<p>&#20320;&#21487;&#20197;&#36890;&#36807; MVC Java &#37197;&#32622;&#25110; MVC &#21629;&#21517;&#31354;&#38388;&#65292;&#27880;&#20876;&#20840;&#23616;&#24615;&#30340; <code class="literal">CallableProcessingInterceptor</code> &#25110; <code class="literal">DeferredResultProcessingInterceptor</code>&#12290;&#36825;&#20004;&#20010;&#25318;&#25130;&#22120;&#25552;&#20379;&#20102;&#23436;&#25104;&#30340;&#22238;&#35843;&#26426;&#21046;&#65292;&#32780;&#19988;&#27599;&#27425;&#20351;&#29992; <code class="literal">Callable</code> &#25110; <code class="literal">DeferredResult</code> &#37117;&#20250;&#24212;&#29992;&#36825;&#20004;&#20010;&#25318;&#25130;&#22120;&#12290;</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="mvc-ann-async-configuration" href="#mvc-ann-async-configuration"></a>&#19968;&#27493;&#35831;&#27714;&#22788;&#29702;&#30340;&#37197;&#32622;</h4></div></div></div>

<div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="mvc-ann-async-configuration-servlet3" href="#mvc-ann-async-configuration-servlet3"></a>Servlet 3 &#24322;&#27493;&#37197;&#32622;</h5></div></div></div>

<p>&#20351;&#29992; Servlet 3 &#30340;&#24322;&#27493;&#35831;&#27714;&#22788;&#29702;&#65292;&#38656;&#35201;&#23558; <code class="literal">web.xml</code> &#30340;&#29256;&#26412;&#26356;&#26032;&#20026; 3.0&#12290;</p>
<pre class="programlisting"><span class="hl-tag">&lt;web-app</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://java.sun.com/xml/ns/javaee"</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
            <span class="hl-attribute">http://java.sun.com/xml/ns/javaee</span>
            <span class="hl-attribute">http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd"</span>
    <span class="hl-attribute">version</span>=<span class="hl-value">"3.0"</span><span class="hl-tag">&gt;</span>

    ...

<span class="hl-tag">&lt;/web-app&gt;</span></pre>

<p><code class="literal">DispatcherServlet</code> &#21644;&#20219;&#24847; <code class="literal">Filter</code> &#30340;&#37197;&#32622;&#37117;&#38656;&#35201;&#26377; <code class="literal">&lt;async-supported&gt;true&lt;/async-supported&gt;</code> &#23376;&#20803;&#20214;&#12290;&#21478;&#22806;&#65292;&#20219;&#24847;&#20250;&#22312;&#24322;&#27493;&#36716;&#21457;&#20013;&#35843;&#29992;&#30340; <span class="emphasis"><em>Filter</em></span> &#37117;&#38656;&#35201;&#25903;&#25345; ASYNC &#36716;&#21457;&#31867;&#22411;&#12290;&#25552;&#31034;&#65292;&#20351;&#29992; Spring &#26694;&#26550;&#26102;&#65292;&#35753;&#25152;&#26377;&#36807;&#28388;&#22120;&#37117;&#25903;&#25345; ASYNC &#36716;&#21457;&#31867;&#22411;&#26159;&#23433;&#20840;&#30340;&#65292;&#22240;&#20026;&#38500;&#38750;&#26159;&#38656;&#35201;&#29992;&#21040;&#65292;&#21542;&#21017;&#20182;&#20204;&#22312;&#24322;&#27493;&#36716;&#21457;&#20013;&#20063;&#19981;&#20250;&#34987;&#35843;&#29992;&#12290;</p>
<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Warning]" src="images/warning.png"></td><th align="left">Warning</th></tr><tr><td align="left" valign="top">
<p>&#27880;&#24847;&#65292;&#23545;&#37096;&#20998;&#36807;&#28388;&#22120;&#26469;&#35828;&#65292;&#35831;&#30830;&#20445;&#23427;&#20204;&#20250;&#22312;&#24322;&#27493;&#36716;&#21457;&#26102;&#34987;&#26144;&#23556;&#35843;&#29992;&#12290;&#27604;&#22914;&#65292;&#24403;&#19968;&#20010;&#36807;&#28388;&#22120;&#26159;&#36127;&#36131;&#37322;&#25918;&#25968;&#25454;&#24211;&#36830;&#25509;&#30340;&#65288;&#22914;<code class="literal">OpenEntityManagerInViewFilter</code>&#65289;&#65292;&#36825;&#20010;&#36807;&#28388;&#22120;&#24517;&#39035;&#22312;&#24322;&#27493;&#35831;&#27714;&#26368;&#21518;&#19968;&#27493;&#25165;&#35843;&#29992;&#12290;</p>
<p>&#22914;&#19979;&#65292;&#26159;&#19968;&#20010;&#36807;&#28388;&#22120;&#37197;&#32622;&#30340;&#26679;&#20363;&#65306;</p>
</td></tr></table></div>

<pre class="programlisting"><span class="hl-tag">&lt;web-app</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://java.sun.com/xml/ns/javaee"</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"
            http://java.sun.com/xml/ns/javaee
            http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd"</span>
    <span class="hl-attribute">version</span>=<span class="hl-value">"3.0"</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;filter&gt;</span>
        <span class="hl-tag">&lt;filter-name&gt;</span>Spring OpenEntityManagerInViewFilter<span class="hl-tag">&lt;/filter-name&gt;</span>
        <span class="hl-tag">&lt;filter-class&gt;</span>org.springframework.~.OpenEntityManagerInViewFilter<span class="hl-tag">&lt;/filter-class&gt;</span>
        <span class="hl-tag">&lt;async-supported&gt;</span>true<span class="hl-tag">&lt;/async-supported&gt;</span>
    <span class="hl-tag">&lt;/filter&gt;</span>

    <span class="hl-tag">&lt;filter-mapping&gt;</span>
        <span class="hl-tag">&lt;filter-name&gt;</span>Spring OpenEntityManagerInViewFilter<span class="hl-tag">&lt;/filter-name&gt;</span>
        <span class="hl-tag">&lt;url-pattern&gt;</span>/*<span class="hl-tag">&lt;/url-pattern&gt;</span>
        <span class="hl-tag">&lt;dispatcher&gt;</span>REQUEST<span class="hl-tag">&lt;/dispatcher&gt;</span>
        <span class="hl-tag">&lt;dispatcher&gt;</span>ASYNC<span class="hl-tag">&lt;/dispatcher&gt;</span>
    <span class="hl-tag">&lt;/filter-mapping&gt;</span>

<span class="hl-tag">&lt;/web-app&gt;</span>

</pre>

<p>&#22914;&#26524;&#20351;&#29992; Servlet 3&#65292;Java &#22522;&#30784;&#37197;&#32622;&#65288;&#22914;&#20351;&#29992; <code class="literal">WebApplicationInitializer</code>&#65289;&#31561;&#65292;&#38500;&#20102;&#38656;&#35201;&#22312; '<code class="literal">web.xml</code> &#37197;&#32622; ASYNC &#36716;&#21457;&#31867;&#22411;&#65292;&#20320;&#36824;&#38656;&#35201;&#35774;&#32622; "asyncSupported" &#26631;&#35782;&#12290;&#22914;&#26524;&#24819;&#31616;&#21270;&#36825;&#20123;&#37197;&#32622;&#30340;&#65292;&#21487;&#20197;&#32487;&#25215; <code class="literal">AbstractDispatcherServletInitializer</code>&#25110;<code class="literal">AbstractAnnotationConfigDispatcherServletInitializer</code>&#65292;&#36825;&#20004;&#20010;&#25277;&#35937;&#31867;&#25110;&#35774;&#32622;&#20197;&#19978;&#26631;&#35782;&#65292;&#22914;&#27492;&#20415;&#21487;&#36731;&#26494;&#22320;&#27880;&#20876; <code class="literal">Filter</code> &#23454;&#20363;&#12290;</p>
</div>
<div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="mvc-ann-async-configuration-spring-mvc" href="#mvc-ann-async-configuration-spring-mvc"></a>Spring MVC &#24322;&#27493;&#37197;&#32622;</h5></div></div></div>

<p>MVC Java &#37197;&#32622;&#21644; MVC &#21629;&#21517;&#31354;&#38388;&#37117;&#25552;&#20379;&#20102;&#24322;&#27493;&#35831;&#27714;&#22788;&#29702;&#37197;&#32622;&#30340;&#36873;&#39033;&#12290;<code class="literal">WebMvcConfigurer</code> &#21487;&#20197;&#36890;&#36807; <code class="literal">configureAsyncSupport</code> &#26041;&#27861;&#35774;&#32622;&#65292;&lt;mvc:annotation-driven&gt;&#21017;&#21487;&#36890;&#36807;&#23376;&#20803;&#20214; &lt;async-support&gt; &#35774;&#32622;&#12290;</p>
<p>&#22914;&#26524;&#27809;&#26377;&#37197;&#32622;&#24322;&#27493;&#35831;&#27714;&#36229;&#26102;&#26102;&#38388;&#65292;&#20197;&#19978;&#20004;&#31181;&#37197;&#32622;&#37117;&#20250;&#20351;&#29992;&#40664;&#35748;&#30340;&#36229;&#26102;&#26102;&#38388;&#20540;(&#21462;&#20915;&#20110;&#24213;&#23618; Servlet &#23481;&#22120;&#65292;&#22914; Tomcat &#26159; 10 &#31186;)&#12290;&#20063;&#21487;&#20197;&#37197;&#32622; <code class="literal">AsyncTaskExecutor</code>&#65292;&#29992;&#26469;&#25191;&#34892;&#25511;&#21046;&#22120;&#26041;&#27861;&#36820;&#22238;&#30340; <code class="literal">Callable</code> &#23454;&#20363;&#12290;&#21478;&#22806;&#65292;&#24378;&#28872;&#25512;&#33616;&#20320;&#37197;&#32622; <code class="literal">AsyncTaskExecutor</code> &#23646;&#24615;,&#22240;&#20026; Spring MVC &#40664;&#35748;&#26159;&#20351;&#29992; <code class="literal">SimpleAsyncTaskExecutor</code>&#12290;MVC Java &#37197;&#32622;&#21644; MVC &#21629;&#21517;&#31354;&#38388;&#37117;&#20801;&#35768;&#27880;&#20876; <code class="literal">CallableProcessingInterceptor</code>&#21644;<code class="literal">DeferredResultProcessingInterceptor</code>&#23454;&#20363;&#12290;</p>
<p>&#22914;&#26524;&#38656;&#35201;&#35206;&#30422;&#25351;&#23450; <code class="literal">DeferredResult</code> &#30340;&#40664;&#35748;&#36229;&#26102;&#20540;&#65292;&#21487;&#20197;&#20351;&#29992;&#20854;&#21512;&#36866;&#30340;&#26500;&#36896;&#22120;&#12290;&#31867;&#20284;&#22320;&#65292;&#22914;&#26524;&#26159;&#35206;&#30422; <code class="literal">Callable</code> &#30340;&#40664;&#35748;&#36229;&#26102;&#20540;&#65292;&#21487;&#20197;&#23558;&#20854;&#23553;&#35013;&#20026; <code class="literal">WebAsyncTask</code> &#23545;&#35937;&#24182;&#20351;&#29992;&#21512;&#36866;&#30340;&#26500;&#36896;&#22120;&#26469;&#33258;&#23450;&#20041;&#36229;&#26102;&#20540;&#12290;<code class="literal">WebAsyncTask</code> &#26500;&#36896;&#22120;&#20063;&#25552;&#20379;&#20102;  <code class="literal">AsyncTaskExecutor</code>&#12290;</p>
</div>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-ann-tests" href="#mvc-ann-tests"></a>16.3.5&nbsp;&#27979;&#35797;&#25511;&#21046;&#22120;</h3></div></div></div>

<p><code class="literal">spring-test</code> &#27169;&#22359;&#25552;&#20379;&#20102;&#19968;&#27969;&#30340;&#27979;&#35797;&#31867;&#65292;&#25903;&#25345;&#27979;&#35797;&#27880;&#35299;&#25511;&#21046;&#22120;&#12290;&#35814;&#24773;&#21487;&#26597;&#30475;<a class="xref" href="aop-api.html#spring-mvc-test-framework" title="10.15.6&nbsp;Spring MVC Test Framework">Section&nbsp;10.15.6, &#8220;Spring MVC Test Framework&#8221;</a>.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="mvc-handlermapping" href="#mvc-handlermapping"></a>16.4&nbsp;Handler &#26144;&#23556;</h2></div></div></div>

<p>Spring &#30340;&#21069;&#20960;&#20010;&#29256;&#26412;&#65292;&#24320;&#21457;&#32773;&#37117;&#38656;&#35201;&#22312; web &#24212;&#29992;&#30340;&#19978;&#19979;&#25991;&#23450;&#20041;(&#22810;&#20010;) <code class="literal">HandlerMapping</code> bean&#65292;&#29992;&#26469;&#23558; web &#35831;&#27714;&#26144;&#23556;&#21040;&#25351;&#23450;&#30340; handler&#12290;&#21487;&#24403;&#24341;&#20837;&#27880;&#35299;&#25511;&#21046;&#22120;&#26102;&#65292;&#24320;&#21457;&#32773;&#22522;&#26412;&#19981;&#20877;&#38656;&#35201;&#36825;&#26679;&#37197;&#32622;&#12290;&#22240;&#20026; <code class="literal">RequestMappingHandlerMapping</code> &#20250;&#33258;&#21160;&#23547;&#25214;&#25152;&#26377; <code class="literal">@Controller</code> bean &#20013;&#30340; <code class="literal">@RequestMapping</code> &#27880;&#35299;&#12290;&#21478;&#22806;&#25552;&#37266;&#19968;&#19979;&#65292;&#25152;&#26377;&#20174; <code class="literal">AbstractHandlerMapping</code> &#32487;&#25215;&#36807;&#26469;&#30340; <code class="literal">HandlerMapping</code> &#31867;&#65292;&#37117;&#20197;&#36890;&#36807;&#35774;&#32622;&#20197;&#19979;&#23646;&#24615;&#26469;&#33258;&#23450;&#20041;&#20854;&#34892;&#20026;&#65306;</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<code class="literal">interceptors</code> &#25318;&#25130;&#22120;&#38142;&#12290; <code class="literal">HandlerInterceptor</code>s &#20250;&#22312;
<a class="xref" href="mvc.html#mvc-handlermapping-interceptor" title="16.4.1&nbsp;&#20351;&#29992; HandlerInterceptor &#25318;&#25130;&#35831;&#27714;">Section&nbsp;16.4.1, &#8220;&#20351;&#29992; HandlerInterceptor &#25318;&#25130;&#35831;&#27714;&#8221;</a> &#35848;&#35770;&#12290;
</li><li class="listitem">
<code class="literal">defaultHandler</code> &#40664;&#35748; handler&#12290;&#27492; handler &#19981;&#24433;&#21709;&#20854;&#20182; handler &#30340;&#20351;&#29992;&#12290;
</li><li class="listitem">
<code class="literal">order</code> order &#23646;&#24615; (&#21487;&#26597;&#30475; <code class="literal">org.springframework.core.Ordered</code> &#25509;&#21475;), 	Spring&#20250;&#23545;&#21487;&#21305;&#37197;&#30340; handler &#36827;&#34892;&#25490;&#24207;&#65292;&#24182;&#24212;&#29992;&#31532;&#19968;&#20010;&#21305;&#37197;&#21040; handler&#12290;
</li><li class="listitem">
<code class="literal">alwaysUseFullPath</code> &#24403;&#27492;&#23646;&#24615;&#20026; <code class="literal">true</code> &#26102;&#65292;Spring &#20250;&#20351;&#29992;&#24403;&#21069; Servlet &#19978;&#19979;&#25991;&#30340;&#20840;&#36335;&#24452;&#21435;&#23547;&#25214;&#21512;&#36866;&#30340; handler&#12290;&#24403;&#20026; <code class="literal">false</code> &#26102;(&#40664;&#35748;&#20540;)&#65292;Spring &#20250;&#20351;&#29992;&#30456;&#23545;&#36335;&#24452;&#26469;&#23547;&#25214;&#21512;&#36866;&#30340; handler&#12290;&#20030;&#20010;&#20363;&#23376;&#65292;&#24403; &#26576;&#20010; Servlet &#26144;&#23556; <code class="literal">/testing/*</code> &#35831;&#27714;&#26102;&#65292;&#33509; <code class="literal">alwaysUseFullPath</code> &#23646;&#24615;&#20026; <code class="literal">true</code>,&#20250;&#20351;&#29992; <code class="literal">/testing/viewPage.html</code>&#65307;&#21453;&#20043;&#65292;&#20351;&#29992; <code class="literal">/viewPage.html</code>&#12290;
</li><li class="listitem">
<code class="literal">urlDecode</code> &#20174; Spring 2.5 &#24320;&#22987;&#65292;&#27492;&#23646;&#24615;&#40664;&#35748;&#20026; <code class="literal">true</code>&#12290;&#22914;&#26524;&#20320;&#26356;&#38656;&#35201;&#32534;&#30721;&#36335;&#22522;&#36335;&#24452;&#65292;&#21487;&#23558;&#27492;&#23646;&#24615;&#35774;&#32622;&#20026; true&#12290;&#28982;&#32780;&#65292;<code class="literal">HttpServletRequest</code> &#24635;&#20250;&#26292;&#38706;&#35299;&#30721;&#21518;&#30340; Servlet &#36335;&#24452;&#12290;&#21478;&#22806;&#27880;&#24847;&#30340;&#26159;&#65292;&#24403;&#27604;&#36739;&#32534;&#30721;&#21518;&#30340;&#36335;&#24452;&#26102;&#65292;Servlet &#36335;&#24452;&#26159;&#19981;&#20250;&#20877;&#21305;&#37197;&#30340;&#12290;
</li></ul></div>

<p>&#22914;&#19979;&#20363;&#23376;&#65292;&#28436;&#31034;&#20102;&#22914;&#20309;&#37197;&#32622;&#19968;&#20010;&#25318;&#25130;&#22120;&#65306;</p>
<pre class="programlisting"><span class="hl-tag">&lt;beans&gt;</span>
    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"handlerMapping"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"interceptors"</span><span class="hl-tag">&gt;</span>
            <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"example.MyInterceptor"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;/property&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>
<span class="hl-tag">&lt;beans&gt;</span></pre>

<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-handlermapping-interceptor" href="#mvc-handlermapping-interceptor"></a>16.4.1&nbsp;&#20351;&#29992; HandlerInterceptor &#25318;&#25130;&#35831;&#27714;</h3></div></div></div>

<p>Spring &#30340; handler &#26144;&#23556;&#26426;&#21046;&#21253;&#21547;&#20102; handler &#25318;&#25130;&#22120;&#12290;&#20351;&#29992;handler &#25318;&#25130;&#22120;&#65292;&#21487;&#20197;&#22312;&#26576;&#20123;&#30340;&#35831;&#27714;&#20013;&#24212;&#29992;&#30340;&#29305;&#27530;&#30340;&#21151;&#33021;&#65292;&#27604;&#22914;&#35828;&#65292;&#26816;&#26597;&#26435;&#38480;&#12290;</p>
<p>handler &#26144;&#23556;&#30340;&#25318;&#25130;&#22120;&#24517;&#39035;&#23454;&#29616; <code class="literal">HandlerInterceptor</code> &#25509;&#21475;(&#27492;&#33410;&#25509;&#21475;&#20301;&#20110; <code class="literal">org.springframework
.web.servlet</code> &#21253;&#20013;)&#12290;&#36825;&#20010;&#25509;&#21475;&#23450;&#20041;&#20102;&#19977;&#20010;&#26041;&#27861;&#65306;<code class="literal">preHandle(..)</code> &#22312; handler
&#25191;&#34892;&#21069;&#35843;&#29992;&#65307;<code class="literal">postHandle(..)</code> &#22312;handler &#25191;&#34892;&#21518;&#35843;&#29992;&#65307;<code class="literal">afterCompletion(..)</code>
&#22312;&#25972;&#19968;&#20010;&#35831;&#27714;&#23436;&#25104;&#21518;&#35843;&#29992;&#12290;&#36825;&#19977;&#20010;&#26041;&#27861;&#22522;&#26412;&#36275;&#22815;&#24212;&#23545;&#21508;&#31181;&#39044;&#22788;&#29702;&#21644;&#21518;&#22788;&#29702;&#30340;&#29366;&#20917;&#12290;</p>
<p><code class="literal">preHandle(..)</code> &#26041;&#27861;&#36820;&#22238;&#19968;&#20010; boolean &#20540;&#12290;&#20320;&#21487;&#20197;&#20351;&#29992;&#36825;&#20010;&#26041;&#27861;&#26469;&#20013;&#26029;&#25110;&#32487;&#32493;&#22788;&#29702; handler
&#25191;&#34892;&#38142;&#12290;&#24403;&#27492;&#26041;&#27861;&#36820;&#22238; <code class="literal">true</code> &#26102;&#65292;hadler &#25191;&#34892;&#38142;&#20250;&#32487;&#32493;&#25191;&#34892;&#65307;&#21453;&#20043;&#65292;<code class="literal">DispatcherServlet</code>
&#20250;&#35748;&#20026;&#27492;&#25318;&#25130;&#22120;&#24050;&#22788;&#29702;&#23436;&#25104;&#35813;&#35831;&#27714;(&#21644;&#28210;&#26579;&#19968;&#20010;&#35270;&#22270;)&#65292;&#20043;&#21518;&#19981;&#20877;&#25191;&#34892;&#20313;&#19979;&#30340;&#25318;&#25130;&#22120;&#65292;&#20063;&#19981;&#22312;&#25191;&#34892;
handler &#25191;&#34892;&#38142;&#12290;</p>
<p>&#21487;&#20197;&#20351;&#29992; <code class="literal">interceptors</code> &#23646;&#24615;&#37197;&#32622;&#25318;&#25130;&#22120;&#12290;&#25152;&#26377;&#20174;  <code class="literal">AbstractHandlerMapping</code> &#32487;&#25215;&#36807;&#26469;&#30340; <code class="literal">HandlerMapping</code> &#31867;&#37117;&#25317;&#26377;&#27492;&#23646;&#24615;&#12290;&#28436;&#31034;&#20363;&#23376;&#22914;&#19979;&#65306;</p>
<pre class="programlisting"><span class="hl-tag">&lt;beans&gt;</span>
    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"handlerMapping"</span>
            <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"interceptors"</span><span class="hl-tag">&gt;</span>
            <span class="hl-tag">&lt;list&gt;</span>
                <span class="hl-tag">&lt;ref</span> <span class="hl-attribute">bean</span>=<span class="hl-value">"officeHoursInterceptor"</span><span class="hl-tag">/&gt;</span>
            <span class="hl-tag">&lt;/list&gt;</span>
        <span class="hl-tag">&lt;/property&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"officeHoursInterceptor"</span>
            <span class="hl-attribute">class</span>=<span class="hl-value">"samples.TimeBasedAccessInterceptor"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"openingTime"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"9"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"closingTime"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"18"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>
<span class="hl-tag">&lt;beans&gt;</span></pre>

<pre class="programlisting"><span class="hl-keyword">package</span> samples;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> TimeBasedAccessInterceptor <span class="hl-keyword">extends</span> HandlerInterceptorAdapter {

    <span class="hl-keyword">private</span> <span class="hl-keyword">int</span> openingTime;
    <span class="hl-keyword">private</span> <span class="hl-keyword">int</span> closingTime;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setOpeningTime(<span class="hl-keyword">int</span> openingTime) {
        <span class="hl-keyword">this</span>.openingTime = openingTime;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setClosingTime(<span class="hl-keyword">int</span> closingTime) {
        <span class="hl-keyword">this</span>.closingTime = closingTime;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">boolean</span> preHandle(HttpServletRequest request, HttpServletResponse response,
            Object handler) <span class="hl-keyword">throws</span> Exception {
        Calendar cal = Calendar.getInstance();
        <span class="hl-keyword">int</span> hour = cal.get(HOUR_OF_DAY);
        <span class="hl-keyword">if</span> (openingTime &lt;= hour &amp;&amp; hour &lt; closingTime) {
            <span class="hl-keyword">return</span> true;
        }
        response.sendRedirect(<span class="hl-string">"http://host.com/outsideOfficeHours.html"</span>);
        <span class="hl-keyword">return</span> false;
    }
}</pre>

<p>&#36890;&#36807;&#36825;&#26679;&#30340;&#37197;&#32622;&#65292;&#25152;&#26377;&#35831;&#27714; handler &#37117;&#20250;&#34987; <code class="literal">TimeBasedAccessInterceptor</code> &#25318;&#25130;&#12290;&#22914;&#26524;&#24403;&#21069;&#26102;&#38388;&#26159;&#19979;&#29677;&#26102;&#38388;&#65292;&#29992;&#25143;&#20250;&#37325;&#23450;&#21521;&#21040;&#19968;&#20010;&#38745;&#24577;&#39029;&#38754;&#65292;&#25442;&#21477;&#35805;&#35828;&#23601;&#26159;&#65292;&#20320;&#21482;&#33021;&#22312;&#19978;&#29677;&#26102;&#38388;&#35775;&#38382;&#35813;&#32593;&#31449;&#12290;</p>
<p>[&#25552;&#31034;]</p>
<div class="informalexample">
<p>&#24403;&#20351;&#29992; <code class="literal">RequestMappingHandlerMapping</code> &#26102;&#65292;&#30495;&#23454;&#30340; handler &#26159;&#19968;&#20010;<code class="literal">HandlerMethod</code> &#23454;&#20363;&#65292;&#35813;&#23454;&#20363;&#25351;&#23450;&#20102;&#20250;&#34987;&#35843;&#29992;&#30340;&#25511;&#21046;&#22120;&#26041;&#27861;&#12290;</p>
</div>

<p>&#22914;&#20320;&#25152;&#35265;&#65292;Spring &#30340;&#36866;&#37197;&#22120;&#31867; <code class="literal">HandlerInterceptorAdapter</code>&#65292;&#20351;&#32487;&#25215; <code class="literal">HandlerInterceptor</code> &#25509;&#21475;&#21464;&#24471;&#26356;&#21152;&#31616;&#21333;&#12290;</p>
<div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top">
<p>&#22312;&#19978;&#36848;&#20363;&#23376;&#20013;&#65292;&#25152;&#37197;&#32622;&#30340;&#25318;&#25130;&#22120;&#20250;&#24212;&#29992;&#21040;&#25152;&#26377;&#24102;&#27880;&#35299;&#30340;&#35831;&#27714;&#22788;&#29702;&#22120;&#12290;&#22914;&#26524;&#38656;&#35201;&#32553;&#31364;&#25318;&#25130;&#22120;&#30340;&#25318;&#25130; url &#36335;&#24452;&#33539;&#22260;&#65292;&#21487;&#20197;&#20351;&#29992; MVC &#21629;&#21517;&#31354;&#38388;&#25110; MVC Java &#37197;&#32622;&#65292;&#25110;&#22768;&#26126; <code class="literal">MappedInterceptor</code> &#31867;&#22411;&#30340; bean &#26469;&#32553;&#31364;&#25318;&#25130;&#22120;&#30340;&#25318;&#25130;&#33539;&#22260;&#65292;&#35814;&#24773;&#21487;&#21442;&#32771; <a class="xref" href="mvc.html#mvc-config-enable" title="16.16.1&nbsp;Enabling the MVC Java Config or the MVC XML Namespace">Section&nbsp;16.16.1, &#8220;Enabling the MVC Java Config or the MVC XML Namespace&#8221;</a>&#12290;</p>
</td></tr></table></div>

<p>&#27880;&#24847;&#65292;<code class="literal">HandlerInterceptor</code> &#30340; <code class="literal">postHandle</code> &#26041;&#27861;&#19981;&#19968;&#23450;&#36866;&#29992;&#20110;<code class="literal">@ResponseBody</code>&#21644;<code class="literal">ResponseEntity</code>&#26041;&#27861;&#12290;&#22312;&#36825;&#31181;&#24773;&#20917;&#19979;&#65292;<code class="literal">HttpMessageConverter</code> &#23454;&#20363;&#20250;&#22312; <code class="literal">postHandle</code> &#26041;&#27861;&#25191;&#34892;&#20043;&#21069;&#23601;&#23558;&#25968;&#25454;&#20889;&#21040; response &#24182;&#25552;&#20132; response&#65292;&#25152;&#20197; <code class="literal">postHandle</code> &#26041;&#27861;&#19981;&#21487;&#33021;&#20877;&#22788;&#29702; response&#65288;&#22914;&#28155;&#21152;&#19968;&#20010; Header&#65289;&#12290;&#30456;&#21453;&#65292;&#24212;&#29992;&#31243;&#24207;&#21487;&#20197;&#23454;&#29616; <code class="literal">ResponseBodyAdvice</code> &#65292;&#23558;&#20854;&#22768;&#26126;&#20026; <code class="literal">@ControllerAdvice</code> bean &#25110;&#23558;&#20854;&#30452;&#25509;&#22312; <code class="literal">RequestMappingHandlerAdapter</code> &#20013;&#37197;&#32622;&#23427;&#12290;</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="mvc-viewresolver" href="#mvc-viewresolver"></a>16.5&nbsp;&#35270;&#22270;&#35299;&#26512;</h2></div></div></div>

<p>&#25152;&#26377; web &#24212;&#29992;&#30340; MVC &#26694;&#26550;&#37117;&#20250;&#25552;&#20102;&#35270;&#22270;&#35299;&#26512;&#30340;&#26041;&#26696;&#65292;Spring &#25552;&#20379;&#30340;&#35270;&#22270;&#35299;&#26512;&#65292;&#21487;&#20197;&#35753;&#20320;&#22312;&#19981;&#25351;&#23450;&#29305;&#23450;&#35270;&#22270;&#25216;&#26415;&#30340;&#21069;&#25552;&#19979;&#65292;&#20415;&#21487;&#22312;&#27983;&#35272;&#22120;&#20013;&#28210;&#26579;&#27169;&#22411;&#12290;Spring &#25903;&#25345;&#20351;&#29992; USP&#65292;Veloctiy &#27169;&#26495;&#21644; XSLT &#35270;&#22270;&#25216;&#26415;&#65292;&#36825;&#20123;&#35270;&#22270;&#25216;&#26415;&#37117;&#26159;&#24320;&#31665;&#21363;&#29992;&#30340;&#12290;&#26597;&#30475;<a class="xref" href="view.html" title="17.&nbsp;View technologies">Chapter&nbsp;17, <i>View technologies</i></a>&#65292;&#21487;&#20197;&#20102;&#35299;&#21040;&#22914;&#20309;&#38598;&#25104;&#21644;&#20351;&#29992;&#22810;&#31181;&#19981;&#21516;&#30340;&#35270;&#22270;&#25216;&#26415;&#12290;</p>
<p><code class="literal">ViewResolver</code> &#21644; <code class="literal">View</code> &#26159; Spring &#22788;&#29702;&#35270;&#22270;&#30340;&#20004;&#20010;&#37325;&#35201;&#25509;&#21475;&#12290;&#24403;&#20013;&#65292;<code class="literal">ViewResolver</code> &#25552;&#20379;&#20102;&#35270;&#22270;&#21517;&#31216;&#21644;&#30495;&#23454;&#35270;&#22270;&#20043;&#38388;&#30340;&#26144;&#23556;&#65292;<code class="literal">View</code> &#21017;&#26159;&#36127;&#36131;&#35299;&#20915;&#26576;&#20010;&#35270;&#22270;&#30340;&#25216;&#26415;&#30340;&#35831;&#27714;&#39044;&#22788;&#29702;&#21644;&#35831;&#27714;&#30340;&#21518;&#32493;&#22788;&#29702;&#12290;</p>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-viewresolver-resolver" href="#mvc-viewresolver-resolver"></a>16.5.1&nbsp;&#20351;&#29992; ViewResolver &#25509;&#21475;&#35299;&#26512;&#35270;&#22270;</h3></div></div></div>

<p>&#22914; <a class="xref" href="mvc.html#mvc-controller" title="16.3&nbsp;Implementing Controllers">Section&nbsp;16.3, &#8220;Implementing Controllers&#8221;</a> &#25152;&#36848;&#65292;Spring web MVC &#20013;&#30340;&#25152;&#26377; handler &#26041;&#27861;&#37117;&#38656;&#35201;&#35299;&#26512;&#26576;&#19968;&#20010;&#36923;&#36753;&#35270;&#22270;&#21517;&#31216;&#65292;&#21487;&#20197;&#26159;&#26174;&#24335;&#30340;&#65292;&#22914;&#22914;&#36820;&#22238; <code class="literal">String</code>, <code class="literal">View</code>, &#25110; <code class="literal">ModelAndView</code> &#23454;&#20363;&#65292;&#20063;&#21487;&#20197;&#26159;&#38544;&#24335;&#30340;(&#36825;&#20010;&#38656;&#22522;&#20110;&#20107;&#20808;&#32422;&#23450;&#65289;&#12290;Spring &#20013;&#35270;&#22270;&#36890;&#36807;&#36923;&#36753;&#35270;&#22270;&#21517;&#31216;&#26469;&#23450;&#20301;&#65292;&#24182;&#20351;&#29992;&#35270;&#22270;&#35299;&#26512;&#22120;&#35299;&#26512;&#12290;Spring &#25552;&#20379;&#20102;&#19968;&#31995;&#21015;&#30340;&#35270;&#22270;&#35299;&#26512;&#20854;&#65292;&#22914;&#19979;&#34920;&#65306;</p>
<div class="table"><a name="mvc-view-resolvers-tbl" href="#mvc-view-resolvers-tbl"></a><p class="title"><b>Table&nbsp;16.3.&nbsp;&#35270;&#22270;&#35299;&#26512;&#22120;</b></p><div class="table-contents">

  <table summary="&#35270;&#22270;&#35299;&#26512;&#22120;" style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="col_1"><col class="col_2"></colgroup><thead><tr><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">&#35270;&#22270;&#35299;&#26512;&#22120;</th><th style="border-bottom: 0.5pt solid ; " align="left" valign="top">&#25551;&#36848;</th></tr></thead><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">AbstractCachingViewResolver</code></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>&#25277;&#35937;&#35270;&#22270;&#35299;&#26512;&#22120;&#29992;&#20110;&#32531;&#23384;&#35270;&#22270;&#12290;&#36890;&#24120;&#65292;&#22312;&#35270;&#22270;&#20351;&#29992;&#20043;&#21069;&#65292;&#37117;&#38656;&#35201;&#32463;&#36807;&#39044;&#22788;&#29702;&#65307;&#32487;&#25215;&#27492;&#35299;&#26512;&#22120;&#21487;&#29992;&#26469;&#32531;&#23384;&#35270;&#22270;&#12290;</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">XmlViewResolver</code></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">ViewResolver</code> &#30340;&#23454;&#29616;&#31867;&#65292;&#25509;&#25910;&#19968;&#20010; xml &#30340;&#37197;&#32622;&#25991;&#20214;&#65288;&#20351;&#29992;&#19982; Spring xml bean &#24037;&#21378;&#19968;&#30452;&#30340; dtd&#65289;&#12290;&#40664;&#35748;&#30340;&#37197;&#32622;&#25991;&#20214;&#36335;&#24452;&#26159;<code class="literal">/WEB-INF/views.xml</code>.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">ResourceBundleViewResolver</code></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">ViewResolver</code> &#23454;&#29616;&#31867;&#65292;&#20351;&#29992;<code class="literal">ResourceBundle</code> &#20013;&#30340; bean &#23450;&#20041;&#65292;&#20854;&#36890;&#36807; bundle &#21517;&#31216;&#26469;&#25351;&#23450;&#12290;&#36890;&#24120;&#65292;&#20320;&#21487;&#20197;&#36873;&#25321;&#22312;&#31867;&#36335;&#24452;&#20013;&#65292;&#36890;&#36807; properties &#25991;&#20214;&#26469;&#23450;&#20041; bundle&#12290;&#40664;&#35748;&#30340;&#25991;&#20214;&#21517;&#26159; <code class="literal">views.properties</code>&#12290;</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">UrlBasedViewResolver</code></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">ViewResolver</code> &#30340;&#31616;&#26131;&#23454;&#29616;&#12290;
Simple implementation of the <code class="literal">ViewResolver</code> interface that effects the direct
  resolution of logical view names to URLs, without an explicit mapping definition. This
  is appropriate if your logical names match the names of your view resources in a
  straightforward manner, without the need for arbitrary mappings.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">InternalResourceViewResolver</code></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Convenient subclass of <code class="literal">UrlBasedViewResolver</code> that supports <code class="literal">InternalResourceView</code> (in
  effect, Servlets and JSPs) and subclasses such as <code class="literal">JstlView</code> and <code class="literal">TilesView</code>. You can
  specify the view class for all views generated by this resolver by using
  <code class="literal">setViewClass(..)</code>. See the <code class="literal">UrlBasedViewResolver</code> javadocs for details.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">VelocityViewResolver</code> / <code class="literal">FreeMarkerViewResolver</code></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">UrlBasedViewResolver</code> &#30340;&#23376;&#31867;&#65292;&#20998;&#21035;&#25903;&#25345; <code class="literal">VelocityView</code>&#65288;Velocity &#27169;&#29256;&#65289;&#21644; <code class="literal">FreeMarkerView</code>&#65292;&#20063;&#25903;&#25345;&#33258;&#23450;&#20041;&#23427;&#20204;&#30340;&#23376;&#31867;&#12290;</p></td></tr><tr><td style="border-right: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">ContentNegotiatingViewResolver</code></p></td><td style="" align="left" valign="top"><p><code class="literal">ViewResolver</code> &#30340;&#23454;&#29616;&#31867;&#65292;&#27492;&#35299;&#26512;&#22120;&#21487;&#36890;&#36807;&#35831;&#27714;&#25991;&#20214;&#21517;&#25110; <code class="literal">Accept</code> &#22836;&#23383;&#27573;&#20540;&#26469;&#35299;&#26512;&#35270;&#22270;&#12290;&#35814;&#24773;&#21487;&#26597;&#30475; <a class="xref" href="mvc.html#mvc-multiple-representations" title="16.5.4&nbsp;ContentNegotiatingViewResolver">Section&nbsp;16.5.4, &#8220;ContentNegotiatingViewResolver&#8221;</a>&#12290;</p></td></tr></tbody></table>
</div></div><br class="table-break">

<p>&#20030;&#20010;&#20363;&#23376;&#65292;&#35299;&#26512; JSP &#35270;&#22270;&#25216;&#26415;&#65292;&#21487;&#20197;&#20351;&#29992; <code class="literal">UrlBasedViewResolver</code> &#35299;&#26512;&#22120;&#12290;&#27492;&#35299;&#26512;&#22120;&#20250;&#23558;&#35270;&#22270;&#21517;&#31216;&#36716;&#25442;&#20026; url&#65292;&#21644;&#20256;&#36882;&#35831;&#27714;&#21040; RequestDispatcher&#65292;&#20197;&#20415;&#28210;&#26579;&#35270;&#22270;&#12290;</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"viewResolver"</span>
        <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.web.servlet.view.UrlBasedViewResolver"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"viewClass"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"org.springframework.web.servlet.view.JstlView"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"prefix"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"/WEB-INF/jsp/"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"suffix"</span> <span class="hl-attribute">value</span>=<span class="hl-value">".jsp"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre>

<p>&#24403;&#36820;&#22238; <code class="literal">test</code> &#36923;&#36753;&#36923;&#36753;&#35270;&#22270;&#21517;&#26102;&#65292;&#27492;&#35270;&#22270;&#35299;&#26512;&#22120;&#20250;&#23558;&#35831;&#27714;&#36716;&#21457;&#21040; <code class="literal">RequestDispatcher</code>&#65292;&#25509;&#30528; <code class="literal">RequestDispatcher</code> &#23558;&#35831;&#27714;&#21457;&#36865;&#21040; <code class="literal">/WEB-INF/jsp/test.jsp</code>&#12290;</p>
<p>&#24403;&#20320;&#38656;&#35201;&#22312; web &#24212;&#29992;&#20013;&#32852;&#21512;&#20351;&#29992;&#19981;&#21516;&#30340;&#35270;&#22270;&#25216;&#26415;&#26102;&#65292;&#21487;&#20197;&#20351;&#29992; <code class="literal">ResourceBundleViewResolver</code> &#35299;&#26512;&#22120;&#12290;</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"viewResolver"</span>
        <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.web.servlet.view.ResourceBundleViewResolver"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"basename"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"views"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"defaultParentView"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"parentView"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre>

<p>The <code class="literal">ResourceBundleViewResolver</code> inspects the <code class="literal">ResourceBundle</code> identified by the
basename, and for each view it is supposed to resolve, it uses the value of the property
<code class="literal">[viewname].(class)</code> as the view class and the value of the property <code class="literal">[viewname].url</code> as
the view url. Examples can be found in the next chapter which covers view technologies.
As you can see, you can identify a parent view, from which all views in the properties
file "extend". This way you can specify a default view class, for example.</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p><code class="literal">AbstractCachingViewResolver</code> &#30340;&#23376;&#31867;&#20250;&#32531;&#23384;&#20854;&#35299;&#26512;&#30340;&#35270;&#22270;&#23454;&#20363;&#12290;&#32531;&#23384;&#25552;&#39640;&#26576;&#20123;&#35270;&#22270;&#25216;&#26415;&#30340;&#24615;&#33021;&#12290;&#24403;&#28982;&#65292;&#20063;&#21487;&#20197;&#25918;&#24323;&#35813;&#32531;&#23384;&#21151;&#33021;&#65292;&#21482;&#38656;&#23558; <code class="literal">cache</code> &#23646;&#24615;&#35774;&#32622;&#20026; <code class="literal">false</code> &#21363;&#21487;&#12290;&#27492;&#22806;&#65292;&#22914;&#26524;&#24517;&#39035;&#22312;&#36816;&#34892;&#26102;&#21047;&#26032;&#35270;&#22270;&#30340;(&#22914; Veloctiy &#27169;&#29256;&#26356;&#26032;)&#65292;&#21487;&#20197;&#20351;&#29992; <code class="literal">removeFromCache(String viewName, Locale loc)</code> &#26041;&#27861;&#12290;</p>
</td></tr></table></div>

</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-viewresolver-chaining" href="#mvc-viewresolver-chaining"></a>16.5.2&nbsp;&#35270;&#22270;&#35299;&#26512;&#22120;&#38142;</h3></div></div></div>

<p>Spring &#25552;&#20379;&#22810;&#31181;&#35270;&#22270;&#25216;&#26415;&#12290;&#22240;&#27492;&#65292;&#20320;&#21487;&#20197;&#23450;&#20041;&#35299;&#26512;&#22120;&#38142;&#65292;&#27604;&#22914;&#65292;&#21487;&#22312;&#26576;&#20123;&#24773;&#20917;&#19979;&#35206;&#30422;&#25351;&#23450;&#35270;&#22270;&#12290;&#21487;&#36890;&#36807;&#22312;&#24212;&#29992;&#19978;&#19979;&#25991;&#20013;&#28155;&#21152;&#22810;&#20010;&#35299;&#26512;&#22120;&#26469;&#23450;&#20041;&#35299;&#26512;&#22120;&#38142;&#65292;&#22914;&#26377;&#38656;&#35201;&#30340;&#65292;&#20063;&#21487;&#25351;&#23450;&#36825;&#20123;&#35299;&#26512;&#22120;&#30340;&#39034;&#24207;&#12290;&#35760;&#20303;&#65292;order &#23646;&#24615;&#36234;&#39640;&#65292;&#35299;&#26512;&#22120;&#30340;&#38142;&#19978;&#20301;&#32622;&#32422;&#38752;&#21518;&#12290;</p>
<p>&#22914;&#19979;&#20363;&#23376;&#65292;&#23450;&#20041;&#20102;&#21253;&#21547;&#20004;&#20010;&#35299;&#26512;&#22120;&#30340;&#35299;&#26512;&#22120;&#38142;&#12290;&#24403;&#20013;&#19968;&#20010;&#26159; <code class="literal">InternalResourceViewResolver</code>&#65292;&#27492;&#35299;&#26512;&#22120;&#24635;&#26159;&#33258;&#21160;&#23450;&#20301;&#21040;&#35299;&#26512;&#22120;&#38142;&#20013;&#26368;&#21518;&#19968;&#20010;&#65307;&#21478;&#22806;&#19968;&#20010;&#26159; <code class="literal">XmlViewResolver</code>&#65292;&#29992;&#26469;&#25351;&#23450; Excel &#35270;&#22270;&#12290;<code class="literal">InternalResourceViewResolver</code> &#19981;&#25903;&#25345; Excel &#35270;&#22270;&#12290;</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"jspViewResolver"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.web.servlet.view.InternalResourceViewResolver"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"viewClass"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"org.springframework.web.servlet.view.JstlView"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"prefix"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"/WEB-INF/jsp/"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"suffix"</span> <span class="hl-attribute">value</span>=<span class="hl-value">".jsp"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"excelViewResolver"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.web.servlet.view.XmlViewResolver"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"order"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"1"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"location"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"/WEB-INF/views.xml"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-comment">&lt;!-- in views.xml --&gt;</span>

<span class="hl-tag">&lt;beans&gt;</span>
    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">name</span>=<span class="hl-value">"report"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.example.ReportExcelView"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/beans&gt;</span></pre>

<p>&#22914;&#26524;&#19968;&#20010;&#35270;&#22270;&#35299;&#26512;&#22120;&#19981;&#33021;&#23548;&#20986;&#19968;&#20010;&#35270;&#22270;&#65292;Spring &#20250;&#26816;&#32034;&#19978;&#19979;&#25991;&#65292;&#26597;&#25214;&#20854;&#20182;&#35270;&#22270;&#35299;&#26512;&#22120;&#12290;&#22914;&#26524;&#26597;&#25214;&#21040;&#20854;&#20182;&#35270;&#22270;&#35299;&#26512;&#22120;&#65292;Spring &#20250;&#32487;&#32493;&#22788;&#29702;&#65292;&#30452;&#21040;&#26377;&#35299;&#26512;&#22120;&#23548;&#20986;&#19968;&#20010;&#35270;&#22270;&#12290;&#22914;&#26524;&#27809;&#26377;&#35299;&#26512;&#22120;&#36820;&#22238;&#19968;&#20010;&#35270;&#22270;&#65292;Spring &#20250;&#25243;&#20986; <code class="literal">ServletException</code>&#12290;</p>
<p>&#35270;&#22270;&#35299;&#26512;&#21327;&#35758;&#35268;&#23450;&#35270;&#22270;&#35299;&#26512;&#22120;&#21487;&#20197;&#36820;&#22238; null&#65292;&#34920;&#31034;&#27809;&#26377;&#25214;&#21040;&#25351;&#23450;&#30340;&#35270;&#22270;&#12290;&#28982;&#32780;&#65292;&#19981;&#26159;&#25152;&#26377;&#30340;&#35270;&#22270;&#35299;&#26512;&#22120;&#36820;&#22238;null&#65292;&#37117;&#34920;&#31034;&#27809;&#26377;&#25214;&#21040;&#35270;&#22270;&#12290;&#22240;&#20026;&#26576;&#20123;&#24773;&#20917;&#19979;&#65292;&#35270;&#22270;&#35299;&#26512;&#22120;&#20063;&#26080;&#27861;&#26816;&#27979;&#35270;&#22270;&#26159;&#21542;&#23384;&#22312;&#12290;&#27604;&#22914;&#65292;<code class="literal">InternalResourceViewResolver</code> &#22312;&#20869;&#37096;&#36923;&#36753;&#37324;&#20351;&#29992; <code class="literal">RequestDispatcher</code>&#65292;&#22914;&#26524; JSP &#25991;&#20214;&#23384;&#22312;&#65292;&#37027;&#20998;&#21457;&#26159;&#21807;&#19968;&#21487;&#20197;&#25214;&#21040; JSP &#25991;&#20214;&#30340;&#26041;&#24335;&#65292;&#21487;&#20998;&#21457;&#21482;&#33021;&#25191;&#34892;&#19968;&#27425;&#12290;<code class="literal">VelocityViewResolver</code> &#21644;&#20854;&#20182;&#35299;&#26512;&#22120;&#20063;&#31867;&#20284;&#12290;&#21487;&#26597;&#30475;&#23545;&#24212;&#35270;&#22270;&#35299;&#26512;&#22120;&#30340; javaDoc &#25991;&#20214;&#65292;&#29702;&#35299;&#20854;&#26159;&#21542;&#25253;&#21578;&#19981;&#23384;&#22312;&#30340;&#35270;&#22270;&#12290;</p>
<p>The contract of a view resolver specifies that a view resolver <span class="emphasis"><em>can</em></span> return null to
indicate the view could not be found. Not all view resolvers do this, however, because
in some cases, the resolver simply cannot detect whether or not the view exists. For
example, the <code class="literal">InternalResourceViewResolver</code> uses the <code class="literal">RequestDispatcher</code> internally, and
dispatching is the only way to figure out if a JSP exists, but this action can only
execute once. The same holds for the <code class="literal">VelocityViewResolver</code> and some others. Check the
javadocs of the specific view resolver to see whether it reports non-existing views.
Thus, putting an <code class="literal">InternalResourceViewResolver</code> in the chain in a place other than
the last results in the chain not being fully inspected, because the
<code class="literal">InternalResourceViewResolver</code> will <span class="emphasis"><em>always</em></span> return a view!</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-redirecting" href="#mvc-redirecting"></a>16.5.3&nbsp;&#37325;&#23450;&#21521;&#21040;&#35270;&#22270;</h3></div></div></div>

<p>&#22914;&#21069;&#25991;&#25152;&#36848;&#65292;&#25511;&#21046;&#22120;&#36890;&#24120;&#36820;&#22238;&#19968;&#20010;&#36923;&#36753;&#35270;&#22270;&#21517;&#65292;&#20877;&#30001;&#23545;&#24212;&#35270;&#22270;&#35299;&#26512;&#22120;&#35299;&#26512;&#12290;&#23545;&#20110;&#36890;&#36807; Servlet &#25110; JSP &#24341;&#25806;&#26469;&#22788;&#29702;&#30340;&#35270;&#22270;&#25216;&#26415;(&#22914; JSP)&#65292;&#20854;&#35299;&#20915;&#26041;&#24335;&#36890;&#24120;&#20250;&#32467;&#21512;  <code class="literal">InternalResourceViewResolver</code> &#21644; <code class="literal">InternalResourceView</code>&#26469;&#22788;&#29702;&#65292;&#20351;&#29992; Servlet API &#30340; <code class="literal">RequestDispatcher.forward(..)</code> &#26041;&#27861;&#25110; <code class="literal">RequestDispatcher.include()</code> &#26041;&#27861;&#21457;&#20986;&#20869;&#37096;&#36339;&#36716;&#25110;&#21253;&#21547;&#30340;&#21160;&#20316;&#12290;&#23545;&#20110;&#20854;&#20182;&#35270;&#22270;&#25216;&#26415;(&#22914;Velocity, XSLT &#31561;)&#65292;&#35270;&#22270;&#20250;&#33258;&#36523;&#20869;&#23481;&#30452;&#25509;&#20889;&#21040;&#21709;&#24212;&#27969;&#12290;</p>
<p>&#22312;&#28210;&#26579;&#35270;&#22270;&#21069;&#65292;&#26377;&#26102;&#20505;&#38656;&#35201;&#23558; HTTP &#35831;&#27714;&#37325;&#23450;&#21521;&#22238;&#23458;&#25143;&#31471;&#12290;&#27604;&#22914;&#65306;&#24403;&#19968;&#20010;&#25511;&#21046;&#22120;&#22788;&#29702;&#23436; <span class="emphasis"><em>POST</em></span> &#25968;&#25454;&#65292;&#24182;&#23558;&#21709;&#24212;&#22996;&#25176;&#32473;&#21478;&#19968;&#20010;&#25511;&#21046;&#22120;&#65288;&#22914;&#25104;&#21151;&#25552;&#20132;&#34920;&#21333;&#26102;&#65289;&#12290;&#36825;&#31181;&#24773;&#20917;&#19979;&#65292;&#20351;&#29992;&#27491;&#35268;&#30340;&#20869;&#37096;&#36339;&#36716;&#20250;&#35753;&#21478;&#19968;&#20010;&#25511;&#21046;&#22120;&#20063;&#21487;&#26816;&#32034;&#21040; <code class="literal">POST</code> &#25968;&#25454;&#65292;&#33509;&#21478;&#19968;&#20010;&#25511;&#21046;&#22120;&#26399;&#24453;&#30340;&#25968;&#25454;&#19982; <code class="literal">POST</code> &#25968;&#25454;&#28151;&#28102;&#65292;&#21017;&#20250;&#24050;&#21457;&#19968;&#20123;&#28508;&#22312;&#30340;&#38382;&#39064;&#12290;&#22312;&#26174;&#31034;&#25968;&#25454;&#21069;&#25191;&#34892;&#37325;&#23450;&#21521;&#30340;&#21478;&#19968;&#20010;&#19968;&#20010;&#21407;&#22240;&#26159;&#65306;&#25490;&#38500;&#29992;&#25143;&#22810;&#27425;&#25552;&#20132;&#34920;&#21333;&#30340;&#21487;&#33021;&#24615;&#12290;&#36825;&#31181;&#24773;&#22659;&#19979;&#65292;&#27983;&#35272;&#22120;&#39318;&#20808;&#21457;&#36865;&#21021;&#22987;&#21270;&#22909;&#30340; <code class="literal">POST</code> &#35831;&#27714;&#65292;&#25509;&#30528;&#27983;&#35272;&#22120;&#25509;&#25910;&#19968;&#20010;&#37325;&#23450;&#21521;&#21040;&#21478;&#19968;&#20010; URL &#30340;&#21709;&#24212;&#65292;&#26368;&#21518;&#65292;&#27983;&#35272;&#22120;&#23545;&#21518;&#32493; URL(&#19978;&#19968;&#27493;&#21709;&#24212;&#37324;&#30340; URL) &#25191;&#34892; <code class="literal">GET</code> &#35831;&#27714;&#12290;&#22240;&#27492;&#65292;&#20174;&#27983;&#35272;&#22120;&#35282;&#24230;&#26469;&#30475;&#65292;&#24403;&#21069;&#39029;&#38754;&#23545;&#24212;&#30340;&#19981;&#26159; <code class="literal">POST</code> &#30340;&#32467;&#26524;&#65292;&#32780;&#26159; <code class="literal">GET</code> &#30340;&#32467;&#26524;&#12290;&#26368;&#32456;&#30340;&#25928;&#26524;&#23601;&#26159;&#29992;&#25143;&#19981;&#20250;&#22240;&#21047;&#26032;&#32780;&#19981;&#23567;&#24515;&#37325;&#26032;&#25552;&#20132;&#19968;&#27425; <code class="literal">POST</code> &#25968;&#25454; &#8212;&#8212; &#21047;&#26032;&#26159; <code class="literal">GET</code> &#19968;&#27425;&#32467;&#26524;&#30340;&#39029;&#38754;&#65292;&#32780;&#19981;&#26159;&#37325;&#26032;&#21457;&#36865; <code class="literal">POST</code> &#25968;&#25454;&#12290;</p>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="mvc-redirecting-redirect-view" href="#mvc-redirecting-redirect-view"></a>RedirectView</h4></div></div></div>

<p>One way to force a redirect as the result of a controller response is for the controller
to create and return an instance of Spring&#8217;s <code class="literal">RedirectView</code>. In this case,
<code class="literal">DispatcherServlet</code> does not use the normal view resolution mechanism. Rather because it
has been given the (redirect) view already, the <code class="literal">DispatcherServlet</code> simply instructs the
view to do its work.</p>
<p>The <code class="literal">RedirectView</code> issues an <code class="literal">HttpServletResponse.sendRedirect()</code> call that returns to
the client browser as an HTTP redirect. By default all model attributes are considered
to be exposed as URI template variables in the redirect URL. Of the remaining attributes
those that are primitive types or collections/arrays of primitive types are
automatically appended as query parameters.</p>
<p>Appending primitive type attributes as query parameters may be the desired result if a
model instance was prepared specifically for the redirect. However, in annotated
controllers the model may contain additional attributes added for rendering purposes
(e.g. drop-down field values). To avoid the possibility of having such attributes appear
in the URL an annotated controller can declare an argument of type <code class="literal">RedirectAttributes</code>
and use it to specify the exact attributes to make available to <code class="literal">RedirectView</code>. If the
controller method decides to redirect, the content of <code class="literal">RedirectAttributes</code> is used.
Otherwise the content of the model is used.</p>
<p>Note that URI template variables from the present request are automatically made
available when expanding a redirect URL and do not need to be added explicitly neither
through <code class="literal">Model</code> nor <code class="literal">RedirectAttributes</code>. For example:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@RequestMapping(value = "/files/{path}", method = RequestMethod.POST)</span></em>
<span class="hl-keyword">public</span> String upload(...) {
    <span class="hl-comment">// ...</span>
    <span class="hl-keyword">return</span> <span class="hl-string">"redirect:files/{path}"</span>;
}</pre>

<p>If you use <code class="literal">RedirectView</code> and the view is created by the controller itself, it is
recommended that you configure the redirect URL to be injected into the controller so
that it is not baked into the controller but configured in the context along with the
view names. The next section discusses this process.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="mvc-redirecting-redirect-prefix" href="#mvc-redirecting-redirect-prefix"></a>redirect: &#21069;&#32512;</h4></div></div></div>

<p>&#23613;&#31649;&#20351;&#29992; <code class="literal">RedirectView</code> &#24037;&#20316;&#27491;&#24120;&#65292;&#21487;&#25511;&#21046;&#22120;&#26412;&#36523;&#21019;&#24314; <code class="literal">RedirectView</code> &#36825;&#19968;&#20107;&#23454;&#65292;&#19981;&#21487;&#21542;&#35748;&#20854;&#26159;&#22312;&#25191;&#34892;&#37325;&#23450;&#21521;&#25805;&#20316;&#12290;&#36825;&#26159;&#19981;&#22815;&#29702;&#24819;&#30340;&#65292;&#20004;&#32773;&#20043;&#38388;&#30340;&#20851;&#31995;&#32806;&#21512;&#20005;&#37325;&#12290;&#25511;&#21046;&#22120;&#19981;&#24212;&#35813;&#20851;&#24515;&#21709;&#24212;&#22914;&#20309;&#22788;&#29702;&#12290;&#19968;&#33324;&#32780;&#35328;&#65292;&#25511;&#21046;&#22120;&#21482;&#38656;&#25805;&#20316;&#27880;&#20837;&#30340;&#36923;&#36753;&#30340;&#35270;&#22270;&#21517;&#21363;&#21487;&#12290;</p>
<p><code class="literal">redirect:</code> &#21069;&#32512;&#20801;&#35768;&#20320;&#36798;&#21040;&#19978;&#36848;&#25928;&#26524;&#12290;&#24403;&#36923;&#36753;&#35270;&#22270;&#21517;&#24102;&#19978; <code class="literal">redirect:</code> &#21069;&#32512;&#26102;&#65292;<code class="literal">UrlBasedViewResolver</code> &#21450;&#20854;&#23376;&#31867;&#20250;&#35782;&#21035;&#35813;&#21069;&#32512;&#25191;&#34892;&#37325;&#23450;&#21521;&#25805;&#20316;&#12290;&#35270;&#22270;&#21517;&#30340;&#20313;&#19979;&#37096;&#20998;&#20250;&#23558;&#37325;&#23450;&#21521;&#30340; url&#12290;</p>
<p><code class="literal">redirect:</code> &#30340;&#20316;&#29992;&#19982;&#25511;&#21046;&#22120;&#36820;&#22238; <code class="literal">RedirectView</code> &#30340;&#25928;&#26524;&#19968;&#33268;&#65292;&#19981;&#36807;&#20351;&#29992; <code class="literal">redirect:</code>&#65292;&#25511;&#21046;&#22120;&#26412;&#36523;&#21482;&#38656;&#25805;&#20316;&#36923;&#36753;&#35270;&#22270;&#21517;&#21363;&#21487;&#12290;&#36923;&#36753;&#35270;&#22270;&#21517;&#65288;&#22914; <code class="literal">redirect:/myapp/some/resource</code>&#65289;&#20250;&#30456;&#23545;&#24403;&#21069; Servlet &#23481;&#22120;&#37325;&#23450;&#21521;&#65292;&#21478;&#22806;&#22914; <code class="literal">redirect:http://myhost.com/some/arbitrary/path</code> &#30340;&#36923;&#36753;&#35270;&#22270;&#65292;&#20250;&#26681;&#25454;&#32477;&#23545; url &#37325;&#23450;&#21521;&#12290;</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="mvc-redirecting-forward-prefix" href="#mvc-redirecting-forward-prefix"></a>forward: &#21069;&#32512;</h4></div></div></div>

<p>&#20063;&#21487;&#22312;&#36923;&#36753;&#35270;&#22270;&#21517;&#21069;&#20351;&#29992; <code class="literal">forward:</code>&#65292;<code class="literal">forward:</code> &#21069;&#32512;&#26412;&#36136;&#20063;&#26159;&#30001;<code class="literal">UrlBasedViewResolver</code>&#21450;&#20854;&#23376;&#31867;&#25152;&#22788;&#29702;&#12290;&#20351;&#29992; <code class="literal">forward:</code> &#21069;&#32512;&#65292;&#20250;&#26681;&#25454;&#36923;&#36753;&#35270;&#22270;&#21517;&#30340;&#20313;&#19979;&#37096;&#20998;(url)&#21019;&#24314;<code class="literal">InternalResourceView</code> &#23545;&#35937;&#65288;&#26412;&#36136;&#26159;&#20351;&#29992; <code class="literal">RequestDispatcher.forward()</code>&#65289;.</p>
<p>It is also possible to use a special <code class="literal">forward:</code> prefix for view names that are
ultimately resolved by <code class="literal">UrlBasedViewResolver</code> and subclasses. This creates an
<code class="literal">InternalResourceView</code> (which ultimately does a <code class="literal">RequestDispatcher.forward()</code>) around
the rest of the view name, which is considered a URL. Therefore, this prefix is not
useful with <code class="literal">InternalResourceViewResolver</code> and <code class="literal">InternalResourceView</code> (for JSPs for
example). But the prefix can be helpful when you are primarily using another view
technology, but still want to force a forward of a resource to be handled by the
Servlet/JSP engine. (Note that you may also chain multiple view resolvers, instead.)</p>
<p>&#19982; <code class="literal">redirect:</code> &#21069;&#32512;&#31867;&#22411;&#65292;&#24403;&#24102;&#19978; <code class="literal">forward:</code> &#21069;&#32512;&#30340;&#35270;&#22270;&#21517;&#27880;&#20837;&#25511;&#21046;&#22120;&#26102;&#65292;&#25511;&#21046;&#22120;&#19981;&#20250;&#23519;&#35273;&#23558;&#22914;&#20309;&#22788;&#29702;&#21709;&#24212;&#12290;</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-multiple-representations" href="#mvc-multiple-representations"></a>16.5.4&nbsp;ContentNegotiatingViewResolver</h3></div></div></div>

<p><code class="literal">ContentNegotiatingViewResolver</code> &#33258;&#36523;&#24182;&#27809;&#26377;&#21435;&#35299;&#26512;&#35270;&#22270;&#65292;&#32780;&#26159;&#23558;&#20854;&#22996;&#27966;&#32473;&#20854;&#20182;&#35270;&#22270;&#35299;&#26512;&#22120;&#65292;&#36873;&#25321;&#25351;&#23450;&#21709;&#24212;&#34920;&#36848;&#36820;&#22238;&#32473;&#23458;&#25143;&#31471;&#12290;&#26377;&#20197;&#19979;&#20004;&#31181;&#31574;&#30053;&#65292;&#20801;&#35768;&#23458;&#25143;&#31471;&#35831;&#27714;&#25351;&#23450;&#34920;&#36848;&#26041;&#24335;&#30340;&#36164;&#28304;&#65306;</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
&#19981;&#21516;&#30340;&#36164;&#28304;&#20351;&#29992;&#19981;&#21516;&#30340; URI &#34920;&#31034;&#65306;&#36890;&#24120;&#20351;&#29992;&#25991;&#20214;&#25299;&#23637;&#21517;&#26469;&#34920;&#31034;&#19981;&#21516;&#30340;&#21709;&#24212;&#34920;&#36848;&#65292;&#22914; <code class="literal">http://www.example.com/users/fred.pdf</code> &#35831;&#27714;&#29992;&#25143; fred &#30340; pdf &#35270;&#22270;&#34920;&#36848;&#65292;<code class="literal">http://www.example.com/users/fred.xml</code> &#21017;&#26159;&#35831;&#27714;&#29992;&#25143; fred &#30340; xml &#35270;&#22270;&#34920;&#36848;&#12290;
</li><li class="listitem">
&#20351;&#29992;&#30456;&#21516;&#30340; uri &#21152;&#36733;&#25351;&#23450;&#36164;&#28304;&#65292;&#19981;&#36807;&#20351;&#29992; <code class="literal">Accept</code> HTTP &#35831;&#27714;&#22836;&#34920;&#31034;&#20854;&#35831;&#27714;&#30340;http://en.wikipedia.org/wiki/Internet_media_type[&#23186;&#20307;&#31867;&#22411;]&#12290;&#22914;uri <code class="literal">http://www.example.com/users/fred</code>&#65292;&#24403; <code class="literal">Accept</code> &#20026; <code class="literal">application/pdf</code> &#65292;&#34920;&#31034;&#35831;&#27714;&#29992;&#25143; fred &#30340;pdf&#35270;&#22270;&#34920;&#36848;&#65292;&#24403; <code class="literal">Accept</code> &#20026; <code class="literal">application/xml</code> &#34920;&#31034;&#35831;&#27714;&#29992;&#25143; fred &#30340;xml &#35270;&#22270;&#34920;&#36848;&#12290;&#36825;&#31181;&#31574;&#30053;&#20063;&#21487;&#31216;&#20026; <a class="ulink" href="http://en.wikipedia.org/wiki/Content_negotiation" target="_top">&#20869;&#23481;&#21327;&#21830;</a>.
</li></ul></div>

<p>[&#25552;&#31034;]</p>
<div class="informalexample">
<p>&#19982; <code class="literal">Accept</code> &#22836;&#23383;&#27573;&#30340;&#26377;&#20851;&#19968;&#20010; issue&#65292;&#23601;&#22312;&#19981;&#33021;&#36890;&#36807; web &#27983;&#35272;&#22120;&#35774;&#32622; <code class="literal">Accept</code> &#22836;&#23383;&#27573;&#20540;&#12290;&#27604;&#22914;&#35828;&#65292;&#22312; firefox&#65292;<code class="literal">Accept</code> &#23383;&#27573;&#26159;&#22266;&#23450;&#30340;&#65306;</p>

<pre class="literallayout">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</pre>

<p>&#30001;&#20110;&#36825;&#20010;&#21407;&#22240;&#65292;&#22312;&#24320;&#21457;&#22522;&#20110;&#27983;&#35272;&#22120;&#30340;web&#24212;&#29992;&#26102;&#65292;&#36890;&#24120;&#20250;&#36873;&#25321;&#20351;&#29992;&#19981;&#21516;&#30340;uri&#26469;&#34920;&#31034;&#19981;&#21516;&#30340;&#35270;&#22270;&#34920;&#36848;.</p>
</div>

<p>&#20026;&#20102;&#25903;&#25345;&#21516;&#19968;&#36164;&#28304;&#30340;&#22810;&#31181;&#34920;&#36848;,Spring &#25552;&#20379;&#20102; <code class="literal">ContentNegotiatingViewResolver</code>,&#21487;&#26681;&#25454;&#25991;&#20214;&#25299;&#23637;&#21517;&#25110; <code class="literal">Accept</code> &#22836;&#23383;&#27573;&#20540;&#36873;&#25321;&#25351;&#23450;&#36164;&#28304;&#30340;&#34920;&#36848;.<code class="literal">ContentNegotiatingViewResolver</code> &#33258;&#36523;&#24182;&#35299;&#37322;&#35270;&#22270;,&#32780;&#26159;&#23558;&#20854;&#36716;&#21457;&#32473;&#36890;&#36807; <code class="literal">ViewResolvers</code> &#23646;&#24615;&#37197;&#32622;&#30340;&#35270;&#22270;&#35299;&#26512;&#22120;.</p>
<p>The <code class="literal">ContentNegotiatingViewResolver</code> selects an appropriate <code class="literal">View</code> to handle the request
by comparing the request media type(s) with the media type (also known as
<code class="literal">Content-Type</code>) supported by the <code class="literal">View</code> associated with each of its <code class="literal">ViewResolvers</code>. The
first <code class="literal">View</code> in the list that has a compatible <code class="literal">Content-Type</code> returns the representation
to the client. If a compatible view cannot be supplied by the <code class="literal">ViewResolver</code> chain, then
the list of views specified through the <code class="literal">DefaultViews</code> property will be consulted. This
latter option is appropriate for singleton <code class="literal">Views</code> that can render an appropriate
representation of the current resource regardless of the logical view name. The <code class="literal">Accept</code>
header may include wild cards, for example <code class="literal">text/*</code>, in which case a <code class="literal">View</code> whose
Content-Type was <code class="literal">text/xml</code> is a compatible match.</p>
<p>&#20026;&#20102;&#25903;&#25345;&#22522;&#20110;&#25991;&#20214;&#25299;&#23637;&#21517;&#30340;&#35299;&#26512;&#65292;&#21487;&#20197;&#20351;&#29992; <code class="literal">ContentNegotiatingViewResolver</code> &#30340;&#23646;&#24615; <code class="literal">mediaTypes</code> &#37197;&#32622;&#21487;&#21305;&#37197;&#30340;&#23186;&#20307;&#31867;&#22411;&#12290;&#20851;&#20110;&#36873;&#25321;&#21738;&#19968;&#31181;&#23186;&#20307;&#31867;&#22411;&#30340;&#31639;&#27861;&#30340;&#35814;&#32454;&#20449;&#24687;&#65292;&#21487;&#21442;&#32771; <code class="literal">ContentNegotiatingViewResolver</code> API &#25991;&#26723;&#12290;</p>
<p>&#22914;&#19979;&#65292;&#26159;&#19968;&#20010; <code class="literal">ContentNegotiatingViewResolver</code> &#37197;&#32622;&#26679;&#20363;&#65306;</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.web.servlet.view.ContentNegotiatingViewResolver"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"mediaTypes"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;map&gt;</span>
            <span class="hl-tag">&lt;entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">"atom"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"application/atom+xml"</span><span class="hl-tag">/&gt;</span>
            <span class="hl-tag">&lt;entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">"html"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"text/html"</span><span class="hl-tag">/&gt;</span>
            <span class="hl-tag">&lt;entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">"json"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"application/json"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;/map&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"viewResolvers"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;list&gt;</span>
            <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.web.servlet.view.BeanNameViewResolver"</span><span class="hl-tag">/&gt;</span>
            <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.web.servlet.view.InternalResourceViewResolver"</span><span class="hl-tag">&gt;</span>
                <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"prefix"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"/WEB-INF/jsp/"</span><span class="hl-tag">/&gt;</span>
                <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"suffix"</span> <span class="hl-attribute">value</span>=<span class="hl-value">".jsp"</span><span class="hl-tag">/&gt;</span>
            <span class="hl-tag">&lt;/bean&gt;</span>
        <span class="hl-tag">&lt;/list&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"defaultViews"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;list&gt;</span>
            <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.web.servlet.view.json.MappingJackson2JsonView"</span><span class="hl-tag"> /&gt;</span>
        <span class="hl-tag">&lt;/list&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"content"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.foo.samples.rest.SampleContentAtomView"</span><span class="hl-tag">/&gt;</span></pre>

<p><code class="literal">InternalResourceViewResolver</code> &#22788;&#29702;&#35797;&#22270;&#21517;&#31216;&#30340;&#35299;&#26512;&#21644; JSP &#39029;&#38754;&#65292;&#21478;&#22806;&#65292;<code class="literal">BeanNameViewResolver</code>&#20250;&#36820;&#22238;&#22522;&#20110; bean &#21517;&#31216;&#30340;&#35270;&#22270;&#65288;&#21487;&#21442;&#32771; "<a class="link" href="mvc.html#mvc-viewresolver-resolver" title="16.5.1&nbsp;&#20351;&#29992; ViewResolver &#25509;&#21475;&#35299;&#26512;&#35270;&#22270;">&#20351;&#29992; ViewResolver &#35299;&#26512;&#35270;&#22270;</a>&#65292;&#20102;&#35299; Spring &#22914;&#20309;&#23547;&#25214;&#21644;&#21021;&#22987;&#21270;&#19968;&#20010;&#35270;&#22270;"&#65289;&#12290;&#22312;&#19978;&#36848;&#20363;&#23376;&#20013;&#65292;<code class="literal">content</code> bean &#26159;&#19968;&#20010;&#32487;&#25215; <code class="literal">AbstractAtomFeedView</code> &#30340;&#31867;&#65292;&#36825;&#20010;bean &#21487;&#20197;&#36820;&#22238;&#19968;&#20010; RSS &#21407;&#23376;&#12290;&#21019;&#24314; &#19968;&#20010;&#21407;&#23376;&#34920;&#36848;&#30340;&#35814;&#32454;&#20449;&#24687;&#65292;&#21487;&#21442;&#32771;&#21407;&#23376;&#35270;&#22270;&#30340;&#37027;&#19968;&#31456;&#12290;</p>
<p>&#22312;&#19978;&#36848;&#37197;&#32622;&#20013;&#65292;&#24403;&#35831;&#27714;&#26159;&#30001; <code class="literal">.html</code>&#25299;&#23637;&#21517;&#32452;&#25104;&#26102;&#65292;&#35270;&#22270;&#35299;&#26512;&#22120;&#20250;&#21435;&#23547;&#25214;&#19968;&#20010;&#21305;&#37197; <code class="literal">text/html</code> &#30340;&#35270;&#22270;&#12290;<code class="literal">InternalResourceViewResolver</code> &#25552;&#20379;&#20102; <code class="literal">text/html</code> &#30340;&#26144;&#23556;&#12290;&#24403;&#35831;&#27714;&#26159;&#30001; <code class="literal">.atom</code> &#25299;&#23637;&#21517;&#32452;&#25104;&#26102;&#65292;&#35270;&#22270;&#35299;&#26512;&#22120;&#20250;&#21435;&#23547;&#25214;&#19968;&#20010;&#21305;&#37197; <code class="literal">.atom</code> &#30340;&#35270;&#22270;&#12290;&#36825;&#20010;&#35270;&#22270; <code class="literal">BeanNameViewResolver</code> &#26377;&#25552;&#20379;&#65292;&#33509;&#35270;&#22270;&#21517;&#31216;&#20026; <code class="literal">content</code>,&#21017;&#26144;&#23556;&#21040; <code class="literal">SampleContentAtomView</code>&#12290;&#24403;&#35831;&#27714;&#26159;&#30001; <code class="literal">.json</code>&#25299;&#23637;&#21517;&#32452;&#25104;&#26102;&#65292;&#20250;&#36873;&#25321; <code class="literal">DefaultViews</code> &#25552;&#20379;&#30340; <code class="literal">MappingJackson2JsonView</code> &#25509;&#21475;&#65292;&#27880;&#24847;&#36825;&#20010;&#26144;&#23556;&#19982;&#35270;&#22270;&#21517;&#31216;&#26080;&#20851;&#12290;&#21478;&#22806;&#65292;&#23458;&#25143;&#31471;&#30340;&#35831;&#27714;&#19981;&#24102;&#25299;&#23637;&#21517;&#65292;&#36890;&#36807; <code class="literal">Accept</code> &#22836;&#23383;&#27573;&#25351;&#23450;&#23186;&#20307;&#31867;&#22411;&#26102;&#65292;&#20063;&#20250;&#25191;&#34892;&#21644;&#25991;&#20214;&#25299;&#23637;&#21517;&#19968;&#26679;&#30340;&#22788;&#29702;&#36923;&#36753;&#12290;</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>&#24403; <code class="literal">ContentNegotiatingViewResolver</code> &#27809;&#26377;&#26126;&#30830;&#23450;&#20041;&#19968;&#31995;&#21015;&#35270;&#22270;&#35299;&#26512;&#22120;&#26102;&#65292;&#20250;&#38543;&#26426;&#20351;&#29992;&#24212;&#29992;&#19978;&#19979;&#25991;&#30340;&#20219;&#19968;&#35299;&#26512;&#22120;&#12290;</p>
</td></tr></table></div>

<p>&#21487;&#20197;&#26681;&#25454; <code class="literal">http://localhost/content.atom</code> &#25110; <code class="literal">http://localhost/content</code>&#21644;<code class="literal">Accept</code>&#23383;&#27573;&#20540;&#20026; application/atom+xml &#20004;&#31181;&#24773;&#20917;&#65292;&#36820;&#22238;&#21407;&#23376;&#35270;&#22270;&#30340;&#25511;&#21046;&#22120;&#20195;&#30721;&#22914;&#19979;&#65306;</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Controller</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ContentController {

    <span class="hl-keyword">private</span> List&lt;SampleContent&gt; contentList = <span class="hl-keyword">new</span> ArrayList&lt;SampleContent&gt;();

    <em><span class="hl-annotation" style="color: gray">@RequestMapping(value="/content", method=RequestMethod.GET)</span></em>
    <span class="hl-keyword">public</span> ModelAndView getContent() {
        ModelAndView mav = <span class="hl-keyword">new</span> ModelAndView();
        mav.setViewName(<span class="hl-string">"content"</span>);
        mav.addObject(<span class="hl-string">"sampleContentList"</span>, contentList);
        <span class="hl-keyword">return</span> mav;
    }

}</pre>

</div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="mvc-flash-attributes" href="#mvc-flash-attributes"></a>16.6&nbsp;&#20351;&#29992; flash &#23646;&#24615;</h2></div></div></div>

<p>Flash attributes provide a way for one request to store attributes intended for use in
another. This is most commonly needed when redirecting&#8201;&#8212;&#8201;for example, the
<span class="emphasis"><em>Post/Redirect/Get</em></span> pattern. Flash attributes are saved temporarily before the
redirect (typically in the session) to be made available to the request after the
redirect and removed immediately.</p>
<p>Spring MVC has two main abstractions in support of flash attributes. <code class="literal">FlashMap</code> is used
to hold flash attributes while <code class="literal">FlashMapManager</code> is used to store, retrieve, and manage
<code class="literal">FlashMap</code> instances.</p>
<p>Flash attribute support is always "on" and does not need to enabled explicitly although
if not used, it never causes HTTP session creation. On each request there is an "input"
<code class="literal">FlashMap</code> with attributes passed from a previous request (if any) and an "output"
<code class="literal">FlashMap</code> with attributes to save for a subsequent request. Both <code class="literal">FlashMap</code> instances
are accessible from anywhere in Spring MVC through static methods in
<code class="literal">RequestContextUtils</code>.</p>
<p>Annotated controllers typically do not need to work with <code class="literal">FlashMap</code> directly. Instead an
<code class="literal">@RequestMapping</code> method can accept an argument of type <code class="literal">RedirectAttributes</code> and use it
to add flash attributes for a redirect scenario. Flash attributes added via
<code class="literal">RedirectAttributes</code> are automatically propagated to the "output" FlashMap. Similarly
after the redirect attributes from the "input" <code class="literal">FlashMap</code> are automatically added to the
<code class="literal">Model</code> of the controller serving the target URL.</p>
<div class="sidebar"><div class="titlepage"><div><div><p class="title"><b>Matching requests to flash attributes</b></p></div></div></div>

<p>The concept of flash attributes exists in many other Web frameworks and has proven to be
exposed sometimes to concurrency issues. This is because by definition flash attributes
are to be stored until the next request. However the very "next" request may not be the
intended recipient but another asynchronous request (e.g. polling or resource requests)
in which case the flash attributes are removed too early.</p>
<p>To reduce the possibility of such issues, <code class="literal">RedirectView</code> automatically "stamps"
<code class="literal">FlashMap</code> instances with the path and query parameters of the target redirect URL. In
turn the default <code class="literal">FlashMapManager</code> matches that information to incoming requests when
looking up the "input" <code class="literal">FlashMap</code>.</p>
<p>This does not eliminate the possibility of a concurrency issue entirely but nevertheless
reduces it greatly with information that is already available in the redirect URL.
Therefore the use of flash attributes is recommended mainly for redirect scenarios .</p>
</div>

</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="mvc-uri-building" href="#mvc-uri-building"></a>16.7&nbsp;&#26500;&#24314; URI</h2></div></div></div>

<p>Spring MVC &#25552;&#20379;&#20102;&#26500;&#24314;&#21644;&#32534;&#30721; URI &#30340;&#26426;&#21046;&#65292;&#36825;&#31181;&#26426;&#21046;&#30340;&#20351;&#29992;&#38656;&#35201;&#36890;&#36807; <code class="literal">UriComponentsBuilder</code> &#21644; <code class="literal">UriComponents</code>.</p>
<p>&#22914;&#19979;&#65292;&#20320;&#21487;&#20197;&#22914;&#27492;&#23637;&#24320;&#21644;&#32534;&#30721; URI &#27169;&#29256;&#23383;&#31526;&#20018;&#65306;
For example you can expand and encode a URI template string:</p>
<pre class="programlisting">UriComponents uriComponents = UriComponentsBuilder.fromUriString(
        <span class="hl-string">"http://example.com/hotels/{hotel}/bookings/{booking}"</span>).build();

URI uri = uriComponents.expand(<span class="hl-string">"42"</span>, <span class="hl-string">"21"</span>).encode().toUri();</pre>

<p>&#27880;&#24847;&#65292;<code class="literal">UriComponents</code> &#26159;&#19981;&#21487;&#21464;&#30340;&#65307;&#22914;&#26524;&#26377;&#38656;&#35201;&#30340;&#65292;<code class="literal">expand()</code> &#21644; <code class="literal">encode()</code> &#25805;&#20316;&#20250;&#36820;&#22238;&#19968;&#20010;&#26032;&#30340;&#23454;&#20363;&#12290;
Note that <code class="literal">UriComponents</code> is immutable and the <code class="literal">expand()</code> and <code class="literal">encode()</code> operations
return new instances if necessary.</p>
<p>&#20320;&#21487;&#20197;&#21333;&#29420;&#20351;&#29992;&#19968;&#20010; URI &#21407;&#20214;&#23637;&#24320;&#21644;&#32534;&#30721; URI &#27169;&#29256;&#23383;&#31526;&#20018;&#65306;</p>
<pre class="programlisting">UriComponents uriComponents = UriComponentsBuilder.newInstance()
        .scheme(<span class="hl-string">"http"</span>).host(<span class="hl-string">"example.com"</span>).path(<span class="hl-string">"/hotels/{hotel}/bookings/{booking}"</span>).build()
        .expand(<span class="hl-string">"42"</span>, <span class="hl-string">"21"</span>)
        .encode();</pre>

<p>Servlet &#29615;&#22659;&#20013;&#65292;<code class="literal">ServletUriComponentsBuilder</code> &#30340;&#23376;&#31867;&#25552;&#20379;&#20102;&#20174; Servlet &#35831;&#27714;&#22797;&#21046; URL &#20449;&#24687;&#30340;&#38745;&#24577;&#26041;&#27861;&#65306;</p>
<pre class="programlisting">HttpServletRequest request = ...

<span class="hl-comment">// &#37325;&#29992; host, scheme, port, path &#21644; query</span>
<span class="hl-comment">// &#26367;&#25442; "accountId" &#26597;&#35810;&#21442;&#25968;</span>

ServletUriComponentsBuilder ucb = ServletUriComponentsBuilder.fromRequest(request)
        .replaceQueryParam(<span class="hl-string">"accountId"</span>, <span class="hl-string">"{id}"</span>).build()
        .expand(<span class="hl-string">"123"</span>)
        .encode();</pre>

<p>&#21478;&#22806;&#65292;&#20320;&#20063;&#21487;&#20197;&#22797;&#21046;&#19978;&#19979;&#25991;&#21644;&#36335;&#24452;&#20449;&#24687;&#30340;&#26576;&#20010;&#23376;&#38598;&#65292;</p>
<pre class="programlisting"><span class="hl-comment">// &#37325;&#29992; host&#65292;port &#21644; &#19978;&#19979;&#25991;&#36335;&#24452;</span>
<span class="hl-comment">// &#23558; "/accounts" &#38468;&#21152;&#21040;&#36335;&#24452;&#20013;</span>

ServletUriComponentsBuilder ucb = ServletUriComponentsBuilder.fromContextPath(request)
        .path(<span class="hl-string">"/accounts"</span>).build()</pre>

<p>&#33509; <code class="literal">DispatcherServlet</code> &#26159;&#36890;&#36807;&#21517;&#31216;&#26144;&#23556;&#30340;&#65288;&#22914;&#65292;<code class="literal">/main/*</code>),&#20320;&#20063;&#21487;&#33719;&#21462;&#21040; servlet &#26144;&#23556;&#30340;&#25991;&#23383;&#37096;&#20998;&#65306;</p>
<pre class="programlisting"><span class="hl-comment">// &#37325;&#29992; host&#65292;port &#21644; &#19978;&#19979;&#25991;&#36335;&#24452;</span>
<span class="hl-comment">// &#23558; Servlet &#26144;&#23556;&#30340;&#25991;&#23383;&#37096;&#20998;&#38468;&#21152;&#21040;&#36335;&#24452;&#20013;</span>
<span class="hl-comment">// &#23558; "/accounts" &#38468;&#21152;&#21040;&#36335;&#24452;&#20013;</span>

ServletUriComponentsBuilder ucb = ServletUriComponentsBuilder.fromServletMapping(request)
        .path(<span class="hl-string">"/accounts"</span>).build()</pre>

<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-links-to-controllers" href="#mvc-links-to-controllers"></a>16.7.1&nbsp;&#26681;&#25454;&#25511;&#21046;&#22120;&#21644;&#26041;&#27861;&#26500;&#24314; URI</h3></div></div></div>

<p>Spring MVC &#36824;&#25552;&#20379;&#20102;&#21478;&#22806;&#19968;&#31181;&#26500;&#24314;&#21644;&#32534;&#30721; URI &#30340;&#26426;&#21046;&#65292;&#36825;&#31181;&#26426;&#21046;&#21487;&#26681;&#25454;&#24212;&#29992;&#20013;&#23545;&#24212;&#30340;&#25511;&#21046;&#22120;&#21644;&#26041;&#27861;&#26469;&#29983;&#25104; URI&#12290;</p>
<p>Spring MVC provides another mechanism for building and encoding URIs that link to
Controllers and methods defined within an application.
<a class="ulink" href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/web/servlet/mvc/method/annotation/MvcUriComponentsBuilder.html" target="_top"><code class="literal">MvcUriComponentsBuilder</code></a> &#25552;&#20379;&#20102;&#36825;&#31181;&#26426;&#21046;&#65292;&#36825;&#20010;&#31867;&#32487;&#25215;&#20102; <code class="literal">UriComponentsBuilder</code>&#12290;</p>
<p>&#20551;&#35774;&#25511;&#21046;&#22120;&#30340;&#23450;&#20041;&#22914;&#19979;:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Controller</span></em>
<em><span class="hl-annotation" style="color: gray">@RequestMapping("/hotels/{hotel}")</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> BookingController {

    <em><span class="hl-annotation" style="color: gray">@RequestMapping("/bookings/{booking}")</span></em>
    <span class="hl-keyword">public</span> String getBooking(<em><span class="hl-annotation" style="color: gray">@PathVariable</span></em> Long booking) {

    <span class="hl-comment">// ...</span>

}</pre>

<p>&#29616;&#22312;&#20351;&#29992; <code class="literal">MvcUriComponentsBuilder</code> &#65292;&#37027;&#21069;&#38754;&#26500;&#24314;&#30340;&#20363;&#23376;&#21487;&#20197;&#36825;&#26679;&#20889;&#65306;</p>
<pre class="programlisting">UriComponents uriComponents = MvcUriComponentsBuilder
    .fromMethodName(BookingController.<span class="hl-keyword">class</span>, <span class="hl-string">"getBooking"</span>,<span class="hl-number">21</span>).buildAndExpand(<span class="hl-number">42</span>);

URI uri = uriComponents.encode().toUri();</pre>

<p><code class="literal">MvcUriComponentsBuilder</code> &#20063;&#21487;&#20197;&#21019;&#24314; "&#27169;&#25311;&#25511;&#21046;&#22120;"&#65292;&#30456;&#23545;&#25511;&#21046;&#22120; API &#26469;&#35828;&#65292;<code class="literal">MvcUriComponentsBuilder</code>&#21487;&#36890;&#36807;&#20195;&#30721;&#26469;&#21019;&#24314; URI&#12290;</p>
<pre class="programlisting">UriComponents uriComponents = MvcUriComponentsBuilder
    .fromMethodCall(on(BookingController.<span class="hl-keyword">class</span>).getBooking(<span class="hl-number">21</span>)).buildAndExpand(<span class="hl-number">42</span>);

URI uri = uriComponents.encode().toUri();</pre>

</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-links-to-controllers-from-views" href="#mvc-links-to-controllers-from-views"></a>16.7.2&nbsp;Building URIs to Controllers and methods from views</h3></div></div></div>

<p>It is also useful to build links to annotated controllers from views (e.g. JSP).
This can be done through a method on <code class="literal">MvcUriComponentsBuilder</code> which refers to mappings
by name called <code class="literal">fromMappingName</code>.</p>
<p>As of 4.1 every <code class="literal">@RequestMapping</code> is assigned a default name based on the
capital letters of the class and the full method name. For example, the method <code class="literal">getFoo</code> in class
<code class="literal">FooController</code> is assigned the name "FC#getFoo". This naming strategy is pluggable
by implementing <code class="literal">HandlerMethodMappingNamingStrategy</code> and configuring it on your
<code class="literal">RequestMappingHandlerMapping</code>. Furthermore the <code class="literal">@RequestMapping</code> annotation includes
a name attribute that can be used to override the default strategy.</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>&#25351;&#23450;&#30340;&#35831;&#27714;&#21305;&#37197;&#21517;&#31216;&#20250;&#22312;&#21551;&#21160;&#26102;&#20197; TRACE &#32423;&#21035;&#36755;&#20986;&#26085;&#24535;&#12290;</p>
</td></tr></table></div>

<p>Spring JSP &#26631;&#31614;&#24211;&#25552;&#20379;&#30340; <code class="literal">mvcUrl</code> &#20989;&#25968;&#65292;&#21487;&#20197;&#29992;&#26469;&#20934;&#22791;&#25511;&#21046;&#22120;&#26041;&#27861;&#30340;&#38142;&#25509;&#65292;&#21407;&#29702;&#23601;&#26159;&#22522;&#20110;&#19978;&#36848;&#26426;&#21046;&#12290;</p>
<p>&#26679;&#20363;&#65306;</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@RequestMapping("/people/{id}/addresses")</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyController {

    <em><span class="hl-annotation" style="color: gray">@RequestMapping("/{country}")</span></em>
    <span class="hl-keyword">public</span> HttpEntity getAddress(<em><span class="hl-annotation" style="color: gray">@PathVariable</span></em> String country) { ... }
}</pre>

<p>&#22914;&#19979; JSP &#20195;&#30721;&#21487;&#20197;&#20934;&#22791;&#19968;&#20010;&#38142;&#25509;&#65306;</p>
<pre class="programlisting">&lt;%@ taglib uri="http://www.springframework.org/tags" prefix="s" %&gt;
...
&lt;a href="${s:mvcUrl(<span class="emphasis"><em>'PC#getPerson</em></span>').arg(0,<span class="emphasis"><em>'US</em></span>').buildAndExpand(<span class="emphasis"><em>'123</em></span>')}"&gt;Get Person&lt;/a&gt;</pre>

</div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="mvc-localeresolver" href="#mvc-localeresolver"></a>16.8&nbsp;&#20351;&#29992;&#26412;&#22320;&#21270;</h2></div></div></div>

<p>Sopring &#26550;&#26500;&#20013;&#24456;&#22823;&#30340;&#19968;&#37096;&#20998;&#37117;&#25903;&#25345;&#22269;&#38469;&#21270;&#65292;Spring  web mvc &#26694;&#26550;&#23601;&#26159;&#20854;&#20013;&#30340;&#19968;&#37096;&#20998;&#12290;<code class="literal">DispatcherServlet</code> &#21487;&#20197;&#26681;&#25454;&#23458;&#25143;&#31471;&#26412;&#22320;&#21270;&#35299;&#26512;&#28040;&#24687;&#12290;&#36825;&#26159;&#36890;&#36807; <code class="literal">LocaleResolver</code> &#23545;&#35937;&#23436;&#25104;&#30340;&#12290;</p>
<p>&#24403;&#35831;&#27714;&#21040;&#26469;&#26102;&#65292;<code class="literal">DispatcherServlet</code> &#20250;&#26597;&#25214;&#26412;&#22320;&#21270;&#35299;&#26512;&#22120;&#65292;&#24403;&#25214;&#21040;&#26102;&#65292;&#20250;&#20351;&#29992;&#20854;&#26469;&#35774;&#32622;&#24403;&#21069;&#35821;&#35328;&#29615;&#22659;&#12290;&#36890;&#36807; <code class="literal">RequestContext.getLocale()</code> &#26041;&#27861;&#65292;&#20320;&#24635;&#21487;&#20197;&#33719;&#21462;&#21040;&#34987;&#26412;&#22320;&#21270;&#35299;&#26512;&#22120;&#35299;&#26512;&#30340;&#35821;&#35328;&#12290;</p>
<p>&#38500;&#20102;&#33258;&#21160;&#23436;&#25104;&#26412;&#22320;&#21270;&#35299;&#26512;&#65292;&#23545;&#20110;&#26576;&#20123;&#29305;&#23450;&#24773;&#20917;&#65292;&#20320;&#20063;&#21487;&#20197;&#22312;&#26144;&#23556; handler &#26102;&#28155;&#21152;&#19968;&#20010;&#25318;&#25130;&#22120;&#65292;&#21160;&#24577;&#25351;&#23450;&#24403;&#21069;&#35821;&#35328;&#29615;&#22659;&#65292;&#27604;&#22914;&#35828;&#22522;&#20110;&#35831;&#27714;&#20013;&#30340;&#19968;&#20010;&#21442;&#25968;&#12290;&#65288;handler &#26144;&#23556;&#25318;&#25130;&#22120;&#30340;&#35814;&#32454;&#20449;&#24687;&#21487;&#39184;&#21345; <a class="xref" href="mvc.html#mvc-handlermapping-interceptor" title="16.4.1&nbsp;&#20351;&#29992; HandlerInterceptor &#25318;&#25130;&#35831;&#27714;">Section&nbsp;16.4.1, &#8220;&#20351;&#29992; HandlerInterceptor &#25318;&#25130;&#35831;&#27714;&#8221;</a>&#65289;</p>
<p>&#26412;&#22320;&#21270;&#35299;&#26512;&#22120;&#21644;&#25318;&#25130;&#22120;&#22312; <code class="literal">org.springframework.web.servlet.i18n</code> &#21253;&#20013;&#23450;&#20041;&#65292;&#37117;&#21487;&#36890;&#36807;&#24120;&#35268;&#26041;&#24335;&#37197;&#32622;&#21040;&#24212;&#29992;&#37324;&#12290;&#36825;&#26159; Spring &#20026;&#26412;&#22320;&#21270;&#35299;&#26512;&#22120;&#25552;&#20379;&#30340;&#19968;&#31181;&#36873;&#25321;&#12290;</p>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-timezone" href="#mvc-timezone"></a>16.8.1&nbsp;&#33719;&#24471;&#26102;&#21306;&#20449;&#24687;</h3></div></div></div>

<p>&#38500;&#20102;&#33719;&#24471;&#23458;&#25143;&#31471;&#30340;&#26412;&#22320;&#21270;&#20449;&#24687;&#65292;&#20063;&#24120;&#24120;&#38656;&#35201;&#33719;&#24471;&#23458;&#25143;&#31471;&#30340;&#26102;&#21306;&#20449;&#24687;&#12290;
<code class="literal">LocaleContextResolver</code> &#25509;&#21475;&#25299;&#23637;&#20102; <code class="literal">LocaleResolver</code>&#65292;&#25552;&#20379;&#19968;&#20010;&#21151;&#33021;&#26356;&#21152;&#20016;&#23500;&#30340; <code class="literal">LocaleContext</code>&#65292;&#24403;&#20013;&#23601;&#21253;&#21547;&#20102;&#26102;&#21306;&#20449;&#24687;&#30340;&#33719;&#21462;&#12290;</p>
<p>&#22312;&#38656;&#35201;&#30340;&#26102;&#20505;&#65292;&#21487;&#20197;&#36890;&#36807; <code class="literal">RequestContext.getTimeZone()</code> &#26041;&#27861;&#33719;&#21462;&#29992;&#25143;&#30340;&#26102;&#21306;&#12290;&#26102;&#21306;&#20449;&#24687;&#23558;&#33258;&#21160;&#24212;&#29992; &#26085;&#26399;/&#26102;&#38388;&#36716;&#25442;&#22120;&#21644;&#26684;&#24335;&#21270;&#23545;&#35937;&#65288;&#20351;&#29992; <code class="literal">ConversionService</code> &#27880;&#20876;&#65289;&#12290;</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-localeresolver-acceptheader" href="#mvc-localeresolver-acceptheader"></a>16.8.2&nbsp;AcceptHeaderLocaleResolver</h3></div></div></div>

<p>AcceptHeaderLocaleResolver &#20250;&#26816;&#26597;&#23458;&#25143;&#31471;(&#22914; web &#27983;&#35272;&#22120;&#65289;&#25152;&#21457;&#36865;&#35831;&#27714;&#30340; <code class="literal">accept-language</code> &#22836;&#23383;&#27573;&#65292;&#36890;&#24120;&#36825;&#20010;&#22836;&#23383;&#27573;&#21253;&#21547;&#20102;&#23458;&#25143;&#31471;&#25805;&#20316;&#31995;&#32479;&#30340;&#26412;&#22320;&#21270;&#20449;&#24687;&#12290;__&#27880;&#24847;&#65292;AcceptHeaderLocaleResolver &#19981;&#25903;&#25345;&#26102;&#21306;&#20449;&#24687;&#30340;&#35299;&#26512;&#12290;</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-localeresolver-cookie" href="#mvc-localeresolver-cookie"></a>16.8.3&nbsp;CookieLocaleResolver</h3></div></div></div>

<p>CookieLocaleResolver &#20250;&#26816;&#26597;&#23458;&#25143;&#31471;&#30340; <code class="literal">Cookie</code>&#65292;&#21028;&#26029;&#26159;&#21542;&#23384;&#22312; <code class="literal">Locale</code> &#25110;&#32773; <code class="literal">TimeZone</code> &#30340; cookie&#12290;&#22914;&#26524;&#23384;&#22312;&#65292;&#20250;&#20351;&#29992; <code class="literal">Locale</code> &#25110;&#32773; <code class="literal">TimeZone</code> &#25351;&#23450;&#30340;&#20449;&#24687;&#12290;&#36890;&#36807; CookieLocaleResolver &#30340;&#23646;&#24615;&#31446;&#30528;&#65292;&#38500;&#20102;&#21487;&#20197;&#25351;&#23450; cookie &#30340;&#26377;&#25928;&#26102;&#38388;&#65292;&#20063;&#21487;&#20197;&#25351;&#23450;&#30340; cookie &#30340;&#21517;&#31216;&#12290;&#22914;&#19979;&#65292;&#23450;&#20041;&#20102;&#19968;&#20010; <code class="literal">CookieLocaleResolver</code>&#65306;</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"localeResolver"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.web.servlet.i18n.CookieLocaleResolver"</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"cookieName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"clientlanguage"</span><span class="hl-tag">/&gt;</span>

    <span class="hl-comment">&lt;!-- in seconds. If set to -1, the cookie is not persisted (deleted when browser shuts down) --&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"cookieMaxAge"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"100000"</span><span class="hl-tag">&gt;</span>

<span class="hl-tag">&lt;/bean&gt;</span></pre>

<div class="table"><a name="mvc-cookie-locale-resolver-props-tbl" href="#mvc-cookie-locale-resolver-props-tbl"></a><p class="title"><b>Table&nbsp;16.4.&nbsp;CookieLocaleResolver &#23646;&#24615;</b></p><div class="table-contents">

  <table summary="CookieLocaleResolver &#23646;&#24615;" style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="col_1"><col class="col_2"><col class="col_3"></colgroup><thead><tr><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">&#23646;&#24615;</th><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">&#40664;&#35748;&#20540;</th><th style="border-bottom: 0.5pt solid ; " align="left" valign="top">&#25551;&#36848;</th></tr></thead><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>cookieName</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>&#31867;&#21517;&#31216; + LOCALE</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>cookie &#30340;&#21517;&#31216;</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>cookieMaxAge</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Integer.MAX_INT</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>cookie &#22312;&#23458;&#25143;&#31471;&#30340;&#26368;&#38271;&#26377;&#25928;&#26102;&#38388;&#12290;&#24403;&#20026; -1 &#26102;&#65292;cookie &#19981;&#20250;&#34987;&#25345;&#20037;&#21270;&#65292;&#22312;&#23458;&#25143;&#31471;&#20851;&#38381;&#27983;&#35272;&#22120;&#20043;&#21518;&#23601;&#20250;&#22833;&#25928;&#12290;</p></td></tr><tr><td style="border-right: 0.5pt solid ; " align="left" valign="top"><p>cookiePath</p></td><td style="border-right: 0.5pt solid ; " align="left" valign="top"><p>/</p></td><td style="" align="left" valign="top"><p>&#38480;&#23450; cookie &#22312;&#32593;&#31449;&#30340;&#21487;&#35265;&#33539;&#22260;&#12290;&#24403;&#25351;&#23450; cookiePath &#26102;&#65292;cookie &#23601;&#21482;&#22312;&#24403;&#21069;&#36335;&#24452;&#25110;&#20854;&#19979;&#36335;&#24452;&#21487;&#35265;&#12290;</p></td></tr></tbody></table>
</div></div><br class="table-break">

</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-localeresolver-session" href="#mvc-localeresolver-session"></a>16.8.4&nbsp;SessionLocaleResolver</h3></div></div></div>

<p><code class="literal">SessionLocaleResolver</code> &#20801;&#35768;&#20320;&#36890;&#36807; session &#26816;&#32034; <code class="literal">Locale</code> &#21644; <code class="literal">TimeZone</code>&#65292;&#27492; session &#25110;&#35768;&#19982;&#29992;&#25143;&#30340;&#35831;&#27714;&#26377;&#20851;&#32852;&#12290;</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-localeresolver-interceptor" href="#mvc-localeresolver-interceptor"></a>16.8.5&nbsp;LocaleChangeInterceptor</h3></div></div></div>

<p>&#36890;&#36807;&#22312; handler &#26144;&#23556;&#20013;&#28155;&#21152; <code class="literal">LocaleChangeInterceptor</code> &#25318;&#25130;&#22120;&#65288;&#21487;&#26597;&#30475;<a class="xref" href="mvc.html#mvc-handlermapping" title="16.4&nbsp;Handler &#26144;&#23556;">Section&nbsp;16.4, &#8220;Handler &#26144;&#23556;&#8221;</a>&#65289;&#65292;&#21487;&#20197;&#20462;&#25913;&#26412;&#22320;&#21270;&#20449;&#24687;&#12290; <code class="literal">LocaleChangeInterceptor</code> &#20250;&#26816;&#27979;&#35831;&#27714;&#37324;&#30340;&#26576;&#19968;&#20010;&#21442;&#25968;&#65292;&#36827;&#32780;&#20462;&#25913;&#26412;&#22320;&#21270;&#20449;&#24687;&#12290;&#23427;&#35843;&#29992;&#20102;&#19978;&#19979;&#25991;&#30340; <code class="literal">LocaleResolver</code> &#20013;&#30340; <code class="literal">setLocale()</code> &#26041;&#27861;&#12290;&#22914;&#19979;&#20363;&#23376;&#65292;&#23454;&#29616;&#20102;&#25152;&#26377;&#21253;&#21547; <code class="literal">siteLanguage</code> &#30340; <code class="literal">*.view</code> &#36164;&#28304;&#65292;&#20854;&#26412;&#22320;&#21270;&#20449;&#24687;&#37117;&#20250;&#34987;&#25913;&#21464;&#12290;&#25152;&#20197;&#65292;&#22914; <code class="literal">http://www.sf.net/home.view?siteLanguage=nl</code> &#36825;&#20010;&#35831;&#27714;&#65292;&#20854;&#32593;&#31449;&#35821;&#35328;&#20250;&#34987;&#20462;&#25913;&#20026;&#33655;&#20848;&#35821;&#12290;</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"localeChangeInterceptor"</span>
        <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.web.servlet.i18n.LocaleChangeInterceptor"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"paramName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"siteLanguage"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"localeResolver"</span>
        <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.web.servlet.i18n.CookieLocaleResolver"</span><span class="hl-tag">/&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"urlMapping"</span>
        <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.web.servlet.handler.SimpleUrlHandlerMapping"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"interceptors"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;list&gt;</span>
            <span class="hl-tag">&lt;ref</span> <span class="hl-attribute">bean</span>=<span class="hl-value">"localeChangeInterceptor"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;/list&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"mappings"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;value&gt;</span>/**/*.view=someController<span class="hl-tag">&lt;/value&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre>

</div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="mvc-themeresolver" href="#mvc-themeresolver"></a>16.9&nbsp;&#20027;&#39064;&#30340;&#20351;&#29992;</h2></div></div></div>

<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-themeresolver-introduction" href="#mvc-themeresolver-introduction"></a>16.9.1&nbsp;&#20027;&#39064;&#27010;&#35272;</h3></div></div></div>

<p>&#21487;&#20197;&#20351;&#29992; Spring MVC &#30719;&#24314;&#30340;&#20027;&#39064;&#26469;&#35774;&#32622;&#24212;&#29992;&#30340;&#25972;&#20307;&#22806;&#35266;&#65292;&#20174;&#32780;&#25552;&#20379;&#29992;&#25143;&#30340;&#20307;&#39564;&#12290;&#20027;&#39064;&#20854;&#23454;&#23601;&#26159;&#19968;&#31995;&#21015;&#38745;&#24577;&#36164;&#28304;&#30340;&#38598;&#21512;&#65292;&#29305;&#25351;&#37027;&#20123;&#24433;&#21709;&#24212;&#29992;&#30340;&#35270;&#35273;&#24863;&#21463;&#30340;&#26679;&#24335;&#34920;&#21644;&#22270;&#29255;&#12290;</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-themeresolver-defining" href="#mvc-themeresolver-defining"></a>16.9.2&nbsp;&#35270;&#22270;&#23450;&#20041;</h3></div></div></div>

<p>&#35201;&#22312;&#24212;&#29992;&#20013;&#24212;&#29992;&#35270;&#22270;&#65292;&#24517;&#39035;&#22312;&#24212;&#29992;&#20013;&#24314;&#31435;&#19968;&#20010;  <code class="literal">org.springframework.ui.context.ThemeSource</code> &#30340;&#23454;&#29616;&#12290;<code class="literal">WebApplicationContext</code> &#25509;&#21475;&#32487;&#25215;&#20102; <code class="literal">ThemeSource</code>&#65292;&#19981;&#36807;&#20854;&#23558;&#32844;&#36131;&#22996;&#25176;&#32473;&#19968;&#20010;&#19987;&#29992;&#30340;&#23454;&#29616;&#12290;&#40664;&#35748;&#24773;&#20917;&#19979;&#65292;&#22996;&#25176;&#26159;&#19968;&#20010; <code class="literal">org.springframework.ui.context.support.ResourceBundleThemeSource</code> &#30340;&#23454;&#29616;&#65292;&#20854;&#36127;&#36733;&#20174;&#26681;&#36335;&#24452;&#21152;&#36733;&#21508;&#31181;&#23646;&#24615;&#25991;&#20214;&#12290;&#35201;&#22312;&#24212;&#29992;&#20013;&#20351;&#29992;&#33258;&#23450;&#20041;&#30340; <code class="literal">ThemeSource</code> &#23454;&#29616;&#25110;&#37197;&#32622; <code class="literal">ResourceBundleThemeSource</code> &#21517;&#31216;&#21069;&#32512;&#65292;&#20320;&#37117;&#38656;&#35201;&#22312;&#24212;&#29992;&#19978;&#19979;&#25991;&#20013;&#37197;&#32622;&#19968;&#20010;&#21517;&#20026; <code class="literal">themeSource</code> &#30340; bean&#65292;&#37027; web &#24212;&#29992;&#23558;&#20250;&#33258;&#21160;&#27880;&#20837;&#35813; bean &#24182;&#20351;&#29992;&#23427;&#12290;</p>
<p>&#24403;&#20351;&#29992; <code class="literal">ResourceBundleThemeSource</code> &#26102;&#65292;&#20027;&#39064;&#20250;&#34987;&#23450;&#20041;&#21040;&#19968;&#20010;&#31616;&#26131;&#30340;&#23646;&#24615;&#25991;&#20214;&#37324;&#12290;&#22312;&#36825;&#20010;&#23646;&#24615;&#25991;&#20214;&#37324;&#20250;&#21015;&#20986;&#32452;&#25104;&#36825;&#20010;&#20027;&#39064;&#30340;&#25152;&#26377;&#36164;&#28304;&#65292;&#22914;&#19979;&#38754;&#36825;&#20010;&#26679;&#20363;&#65306;</p>

<pre class="literallayout">styleSheet=/themes/cool/style.css
background=/themes/cool/img/coolBg.jpg</pre>

<p>&#19978;&#36848;&#23646;&#24615;&#30340; key &#23601;&#26159;&#35270;&#22270;&#20195;&#30721;&#20013;&#20027;&#39064;&#20803;&#20214;&#30340;&#21517;&#31216;&#12290;&#22312; JSP &#37324;&#65292;&#20320;&#21487;&#20197;&#20351;&#29992; <code class="literal">spring:theme</code> &#36825;&#20010;&#33258;&#23450;&#20041;&#30340;&#26631;&#31614;&#26469;&#25351;&#21521;&#36825;&#20123;&#20027;&#39064;&#20803;&#20214;&#65292;&#36825;&#20010;&#26631;&#31614;&#30340;&#20351;&#29992;&#31867;&#20284;&#20110; <code class="literal">spring:message</code> &#26631;&#31614;&#30340;&#20351;&#29992;&#12290;&#22914;&#19979;&#30340; JSP &#29255;&#27573;&#65292;&#28436;&#31034;&#20102;&#22914;&#20309;&#20351;&#29992;&#19978;&#36848;&#20027;&#39064;&#26469;&#33258;&#23450;&#20041;&#22806;&#35266;&#65306;</p>
<pre class="programlisting"><span class="hl-tag">&lt;%@</span> <span class="hl-attribute">taglib</span> <span class="hl-attribute">prefix</span>=<span class="hl-value">"spring"</span> <span class="hl-attribute">uri</span>=<span class="hl-value">"http://www.springframework.org/tags"</span><span class="hl-attribute">%&gt;</span>
<span class="hl-attribute">&lt;html&gt;</span>
    <span class="hl-attribute">&lt;head&gt;</span>
        <span class="hl-attribute">&lt;link</span> <span class="hl-attribute">rel</span>=<span class="hl-value">"stylesheet"</span> <span class="hl-attribute">href</span>=<span class="hl-value">"&lt;spring:theme code=</span><span class="emphasis"><em>'styleSheet</em></span>'/&gt;" type="text/css"/&gt;
    <span class="hl-tag">&lt;/head&gt;</span>
    <span class="hl-tag">&lt;body</span> <span class="hl-attribute">style</span>=<span class="hl-value">"background=&lt;spring:theme code=</span><span class="emphasis"><em>'background</em></span>'/&gt;"&gt;
        ...
    <span class="hl-tag">&lt;/body&gt;</span>
<span class="hl-tag">&lt;/html&gt;</span></pre>

<p>&#40664;&#35748;&#24773;&#20917;&#19979;&#65292;<code class="literal">ResourceBundleThemeSource</code> &#20250;&#20351;&#29992;&#19968;&#20010;&#31354;&#30340;&#21517;&#31216;&#21069;&#32512;&#12290;&#22240;&#20026;&#65292;&#23646;&#24615;&#25991;&#20214;&#37117;&#20250;&#20174;&#26681;&#36335;&#24452;&#21152;&#36733;&#12290;&#25152;&#20197;&#20320;&#21487;&#20197;&#22312;&#26681;&#36335;&#24452;&#65288;&#22914;<code class="literal">/WEB-INF/classes</code>&#65289;&#20013;&#25918;&#32622;&#19968;&#20010; <code class="literal">cool.properties</code> &#30340;&#20027;&#39064;&#23450;&#20041;&#12290; <code class="literal">ResourceBundleThemeSource</code> &#20351;&#29992;&#26631;&#20934;&#30340; Java &#36164;&#28304;&#26463;&#21152;&#36733;&#26426;&#21046;&#65292;&#20801;&#35768;&#23450;&#20041;&#22269;&#38469;&#21270;&#30340;&#20027;&#39064;&#12290;&#27604;&#22914;&#35828;&#65292;&#25105;&#20204;&#21487;&#20197;&#29992;&#19968;&#20010; <code class="literal">/WEB-INF/classes/cool_nl.properties</code> &#25991;&#20214;&#25351;&#21521;&#19968;&#24352;&#33655;&#20848;&#25991;&#30340;&#32972;&#26223;&#22270;&#29255;&#12290;</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-themeresolver-resolving" href="#mvc-themeresolver-resolving"></a>16.9.3&nbsp;&#20027;&#39064;&#35299;&#26512;&#22120;</h3></div></div></div>

<p>&#23450;&#20041;&#22909;&#20027;&#39064;&#21518;&#65292;&#25509;&#30528;&#20320;&#21487;&#20197;&#20915;&#23450;&#20351;&#29992;&#21738;&#19968;&#20010;&#20027;&#39064;&#65292;<code class="literal">DispatcherServlet</code> &#23558;&#20250;&#23547;&#25214;&#19968;&#20010;&#21517;&#20026; <code class="literal">themeResolver</code> &#30340; bean&#65292;&#20174;&#32780;&#30830;&#23450;&#20351;&#29992;&#21738;&#19968;&#20010; <code class="literal">ThemeResolver</code> &#30340;&#23454;&#29616;&#12290;&#20027;&#39064;&#35299;&#26512;&#22120;&#30340;&#24037;&#20316;&#21407;&#29702;&#31867;&#20284;&#20110; <code class="literal">LocaleResolver</code>.&#23427;&#21487;&#20197;&#20026;&#27599;&#19968;&#20010;&#29305;&#23450;&#30340;&#35831;&#27714;&#20934;&#22791;&#19968;&#20010;&#20027;&#39064;&#65292;&#20063;&#21487;&#20197;&#26356;&#25913;&#35831;&#27714;&#25152;&#20351;&#29992;&#30340;&#20027;&#39064;&#12290;&#22914;&#19979;&#21015;&#20986;&#20102; Spring &#25552;&#20379;&#30340;&#20027;&#39064;&#35299;&#26512;&#22120;&#65306;</p>
<div class="table"><a name="mvc-theme-resolver-impls-tbl" href="#mvc-theme-resolver-impls-tbl"></a><p class="title"><b>Table&nbsp;16.5.&nbsp;ThemeResolver &#23454;&#29616;</b></p><div class="table-contents">

  <table summary="ThemeResolver &#23454;&#29616;" style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="col_1"><col class="col_2"></colgroup><thead><tr><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Class</th><th style="border-bottom: 0.5pt solid ; " align="left" valign="top">&#25551;&#36848;</th></tr></thead><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">FixedThemeResolver</code></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>&#20351;&#29992;&#19968;&#20010;&#22266;&#23450;&#20027;&#39064;&#65292;&#36890;&#36807;&#23646;&#24615; <code class="literal">defaultThemeName</code> &#35774;&#32622;</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">SessionThemeResolver</code></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>&#36825;&#20010;&#20027;&#39064;&#32500;&#25345;&#22312;&#29992;&#25143;&#30340; HTTP &#20250;&#35805;&#20013;&#12290;&#23545;&#20110;&#27599;&#19968;&#20010;&#20250;&#35805;&#65292;&#37117;&#21482;&#38656;&#35201;&#35774;&#32622;&#19968;&#27425;&#65292;&#19981;&#36807;&#65292;&#20854;&#19981;&#20250;&#22312;&#20250;&#35805;&#20013;&#20445;&#23384;&#12290;</p></td></tr><tr><td style="border-right: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">CookieThemeResolver</code></p></td><td style="" align="left" valign="top"><p>&#25152;&#36873;&#30340;&#20027;&#39064;&#23558;&#20250;&#20445;&#23384;&#21040;&#23458;&#25143;&#31471;&#30340; cookie &#20013;&#12290;</p></td></tr></tbody></table>
</div></div><br class="table-break">

<p>Spring &#20063;&#25552;&#20379;&#20102;&#19968;&#20010; <code class="literal">ThemeChangeInterceptor</code> &#25318;&#25130;&#22120;&#65292;&#21487;&#26681;&#25454;&#35831;&#27714;&#21442;&#25968;&#21160;&#24577;&#25913;&#21464;&#27599;&#19968;&#20010;&#35831;&#27714;&#30340;&#20027;&#39064;&#12290;</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="mvc-multipart" href="#mvc-multipart"></a>16.10&nbsp;Spring&#8217;s multipart (file upload) support</h2></div></div></div>

<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-multipart-introduction" href="#mvc-multipart-introduction"></a>16.10.1&nbsp;Introduction</h3></div></div></div>

<p>Spring&#8217;s built-in multipart support handles file uploads in web applications. You enable
this multipart support with pluggable <code class="literal">MultipartResolver</code> objects, defined in the
<code class="literal">org.springframework.web.multipart</code> package. Spring provides one <code class="literal">MultipartResolver</code>
implementation for use with <a class="ulink" href="http://jakarta.apache.org/commons/fileupload" target="_top"><span class="emphasis"><em>Commons
FileUpload</em></span></a> and another for use with Servlet 3.0 multipart request parsing.</p>
<p>By default, Spring does no multipart handling, because some developers want to handle
multiparts themselves. You enable Spring multipart handling by adding a multipart
resolver to the web application&#8217;s context. Each request is inspected to see if it
contains a multipart. If no multipart is found, the request continues as expected. If a
multipart is found in the request, the <code class="literal">MultipartResolver</code> that has been declared in
your context is used. After that, the multipart attribute in your request is treated
like any other attribute.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-multipart-resolver-commons" href="#mvc-multipart-resolver-commons"></a>16.10.2&nbsp;Using a MultipartResolver with <span class="emphasis"><em>Commons FileUpload</em></span></h3></div></div></div>

<p>The following example shows how to use the <code class="literal">CommonsMultipartResolver</code>:</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"multipartResolver"</span>
        <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.web.multipart.commons.CommonsMultipartResolver"</span><span class="hl-tag">&gt;</span>

    <span class="hl-comment">&lt;!-- one of the properties available; the maximum file size in bytes --&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"maxUploadSize"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"100000"</span><span class="hl-tag">/&gt;</span>

<span class="hl-tag">&lt;/bean&gt;</span></pre>

<p>Of course you also need to put the appropriate jars in your classpath for the multipart
resolver to work. In the case of the <code class="literal">CommonsMultipartResolver</code>, you need to use
<code class="literal">commons-fileupload.jar</code>.</p>
<p>When the Spring <code class="literal">DispatcherServlet</code> detects a multi-part request, it activates the
resolver that has been declared in your context and hands over the request. The resolver
then wraps the current <code class="literal">HttpServletRequest</code> into a <code class="literal">MultipartHttpServletRequest</code> that
supports multipart file uploads. Using the <code class="literal">MultipartHttpServletRequest</code>, you can get
information about the multiparts contained by this request and actually get access to
the multipart files themselves in your controllers.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-multipart-resolver-standard" href="#mvc-multipart-resolver-standard"></a>16.10.3&nbsp;Using a MultipartResolver with <span class="emphasis"><em>Servlet 3.0</em></span></h3></div></div></div>

<p>In order to use Servlet 3.0 based multipart parsing, you need to mark the
<code class="literal">DispatcherServlet</code> with a <code class="literal">"multipart-config"</code> section in <code class="literal">web.xml</code>, or with a
<code class="literal">javax.servlet.MultipartConfigElement</code> in programmatic Servlet registration, or in case
of a custom Servlet class possibly with a <code class="literal">javax.servlet.annotation.MultipartConfig</code>
annotation on your Servlet class. Configuration settings such as maximum sizes or
storage locations need to be applied at that Servlet registration level as Servlet 3.0
does not allow for those settings to be done from the MultipartResolver.</p>
<p>Once Servlet 3.0 multipart parsing has been enabled in one of the above mentioned ways
you can add the <code class="literal">StandardServletMultipartResolver</code> to your Spring configuration:</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"multipartResolver"</span>
        <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.web.multipart.support.StandardServletMultipartResolver"</span><span class="hl-tag">&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre>

</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-multipart-forms" href="#mvc-multipart-forms"></a>16.10.4&nbsp;Handling a file upload in a form</h3></div></div></div>

<p>After the <code class="literal">MultipartResolver</code> completes its job, the request is processed like any
other. First, create a form with a file input that will allow the user to upload a form.
The encoding attribute ( <code class="literal">enctype="multipart/form-data"</code>) lets the browser know how to
encode the form as multipart request:</p>
<pre class="programlisting"><span class="hl-tag">&lt;html&gt;</span>
    <span class="hl-tag">&lt;head&gt;</span>
        <span class="hl-tag">&lt;title&gt;</span>Upload a file please<span class="hl-tag">&lt;/title&gt;</span>
    <span class="hl-tag">&lt;/head&gt;</span>
    <span class="hl-tag">&lt;body&gt;</span>
        <span class="hl-tag">&lt;h1&gt;</span>Please upload a file<span class="hl-tag">&lt;/h1&gt;</span>
        <span class="hl-tag">&lt;form</span> <span class="hl-attribute">method</span>=<span class="hl-value">"post"</span> <span class="hl-attribute">action</span>=<span class="hl-value">"/form"</span> <span class="hl-attribute">enctype</span>=<span class="hl-value">"multipart/form-data"</span><span class="hl-tag">&gt;</span>
            <span class="hl-tag">&lt;input</span> <span class="hl-attribute">type</span>=<span class="hl-value">"text"</span> <span class="hl-attribute">name</span>=<span class="hl-value">"name"</span><span class="hl-tag">/&gt;</span>
            <span class="hl-tag">&lt;input</span> <span class="hl-attribute">type</span>=<span class="hl-value">"file"</span> <span class="hl-attribute">name</span>=<span class="hl-value">"file"</span><span class="hl-tag">/&gt;</span>
            <span class="hl-tag">&lt;input</span> <span class="hl-attribute">type</span>=<span class="hl-value">"submit"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;/form&gt;</span>
    <span class="hl-tag">&lt;/body&gt;</span>
<span class="hl-tag">&lt;/html&gt;</span></pre>

<p>The next step is to create a controller that handles the file upload. This controller is
very similar to a <a class="link" href="mvc.html#mvc-ann-controller" title="16.3.1&nbsp;&#20351;&#29992; @Controller &#23450;&#20041;&#25511;&#21046;&#22120;">normal annotated <code class="literal">@Controller</code></a>, except that we
use <code class="literal">MultipartHttpServletRequest</code> or <code class="literal">MultipartFile</code> in the method parameters:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Controller</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> FileUploadController {

    <em><span class="hl-annotation" style="color: gray">@RequestMapping(value = "/form", method = RequestMethod.POST)</span></em>
    <span class="hl-keyword">public</span> String handleFormUpload(<em><span class="hl-annotation" style="color: gray">@RequestParam("name")</span></em> String name,
            <em><span class="hl-annotation" style="color: gray">@RequestParam("file")</span></em> MultipartFile file) {

        <span class="hl-keyword">if</span> (!file.isEmpty()) {
            <span class="hl-keyword">byte</span>[] bytes = file.getBytes();
            <span class="hl-comment">// store the bytes somewhere</span>
            <span class="hl-keyword">return</span> <span class="hl-string">"redirect:uploadSuccess"</span>;
        }

        <span class="hl-keyword">return</span> <span class="hl-string">"redirect:uploadFailure"</span>;
    }

}</pre>

<p>Note how the <code class="literal">@RequestParam</code> method parameters map to the input elements declared in the
form. In this example, nothing is done with the <code class="literal">byte[]</code>, but in practice you can save
it in a database, store it on the file system, and so on.</p>
<p>When using Servlet 3.0 multipart parsing you can also use <code class="literal">javax.servlet.http.Part</code> for
the method parameter:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Controller</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> FileUploadController {

    <em><span class="hl-annotation" style="color: gray">@RequestMapping(value = "/form", method = RequestMethod.POST)</span></em>
    <span class="hl-keyword">public</span> String handleFormUpload(<em><span class="hl-annotation" style="color: gray">@RequestParam("name")</span></em> String name,
            <em><span class="hl-annotation" style="color: gray">@RequestParam("file")</span></em> Part file) {

        InputStream inputStream = file.getInputStream();
        <span class="hl-comment">// store bytes from uploaded file somewhere</span>

        <span class="hl-keyword">return</span> <span class="hl-string">"redirect:uploadSuccess"</span>;
    }

}</pre>

</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-multipart-forms-non-browsers" href="#mvc-multipart-forms-non-browsers"></a>16.10.5&nbsp;Handling a file upload request from programmatic clients</h3></div></div></div>

<p>Multipart requests can also be submitted from non-browser clients in a RESTful service
scenario. All of the above examples and configuration apply here as well. However,
unlike browsers that typically submit files and simple form fields, a programmatic
client can also send more complex data of a specific content type&#8201;&#8212;&#8201;for example a
multipart request with a file and second part with JSON formatted data:</p>

<pre class="literallayout">POST /someUrl
Content-Type: multipart/mixed

--edt7Tfrdusa7r3lNQc79vXuhIIMlatb7PQg7Vp
Content-Disposition: form-data; name="meta-data"
Content-Type: application/json; charset=UTF-8
Content-Transfer-Encoding: 8bit

{
	"name": "value"
}
--edt7Tfrdusa7r3lNQc79vXuhIIMlatb7PQg7Vp
Content-Disposition: form-data; name="file-data"; filename="file.properties"
Content-Type: text/xml
Content-Transfer-Encoding: 8bit
... File Data ...</pre>

<p>You could access the part named "meta-data" with a <code class="literal">@RequestParam("meta-data") String
metadata</code> controller method argument. However, you would probably prefer to accept a
strongly typed object initialized from the JSON formatted data in the body of the
request part, very similar to the way <code class="literal">@RequestBody</code> converts the body of a
non-multipart request to a target object with the help of an <code class="literal">HttpMessageConverter</code>.</p>
<p>You can use the <code class="literal">@RequestPart</code> annotation instead of the <code class="literal">@RequestParam</code> annotation for
this purpose. It allows you to have the content of a specific multipart passed through
an <code class="literal">HttpMessageConverter</code> taking into consideration the <code class="literal">'Content-Type'</code> header of the
multipart:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@RequestMapping(value="/someUrl", method = RequestMethod.POST)</span></em>
<span class="hl-keyword">public</span> String onSubmit(<span class="strong"><strong>@RequestPart("meta-data") MetaData metadata,
        @RequestPart("file-data") MultipartFile file</strong></span>) {

    <span class="hl-comment">// ...</span>

}</pre>

<p>Notice how <code class="literal">MultipartFile</code> method arguments can be accessed with <code class="literal">@RequestParam</code> or with
<code class="literal">@RequestPart</code> interchangeably. However, the <code class="literal">@RequestPart("meta-data") MetaData</code> method
argument in this case is read as JSON content based on its <code class="literal">'Content-Type'</code> header and
converted with the help of the <code class="literal">MappingJackson2HttpMessageConverter</code>.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="mvc-exceptionhandlers" href="#mvc-exceptionhandlers"></a>16.11&nbsp;Handling exceptions</h2></div></div></div>

<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-exceptionhandlers-resolver" href="#mvc-exceptionhandlers-resolver"></a>16.11.1&nbsp;HandlerExceptionResolver</h3></div></div></div>

<p>Spring <code class="literal">HandlerExceptionResolver</code> implementations deal with unexpected exceptions that
occur during controller execution. A <code class="literal">HandlerExceptionResolver</code> somewhat resembles the
exception mappings you can define in the web application descriptor <code class="literal">web.xml</code>. However,
they provide a more flexible way to do so. For example they provide information about
which handler was executing when the exception was thrown. Furthermore, a programmatic
way of handling exceptions gives you more options for responding appropriately before
the request is forwarded to another URL (the same end result as when you use the Servlet
specific exception mappings).</p>
<p>Besides implementing the <code class="literal">HandlerExceptionResolver</code> interface, which is only a matter of
implementing the <code class="literal">resolveException(Exception, Handler)</code> method and returning a
<code class="literal">ModelAndView</code>, you may also use the provided <code class="literal">SimpleMappingExceptionResolver</code> or create
<code class="literal">@ExceptionHandler</code> methods. The <code class="literal">SimpleMappingExceptionResolver</code> enables you to take
the class name of any exception that might be thrown and map it to a view name. This is
functionally equivalent to the exception mapping feature from the Servlet API, but it is
also possible to implement more finely grained mappings of exceptions from different
handlers. The <code class="literal">@ExceptionHandler</code> annotation on the other hand can be used on methods
that should be invoked to handle an exception. Such methods may be defined locally
within an <code class="literal">@Controller</code> or may apply to many <code class="literal">@Controller</code> classes when defined within an
<code class="literal">@ControllerAdvice</code> class. The following sections explain this in more detail.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-ann-exceptionhandler" href="#mvc-ann-exceptionhandler"></a>16.11.2&nbsp;@ExceptionHandler</h3></div></div></div>

<p>The <code class="literal">HandlerExceptionResolver</code> interface and the <code class="literal">SimpleMappingExceptionResolver</code>
implementations allow you to map Exceptions to specific views declaratively along with
some optional Java logic before forwarding to those views. However, in some cases,
especially when relying on <code class="literal">@ResponseBody</code> methods rather than on view resolution, it
may be more convenient to directly set the status of the response and optionally write
error content to the body of the response.</p>
<p>You can do that with <code class="literal">@ExceptionHandler</code> methods. When declared within a controller such
methods apply to exceptions raised by <code class="literal">@RequestMapping</code> methods of that contoroller (or
any of its sub-classes). You can also declare an <code class="literal">@ExceptionHandler</code> method within an
<code class="literal">@ControllerAdvice</code> class in which case it handles exceptions from <code class="literal">@RequestMapping</code>
methods from many controllers. Below is an example of a controller-local
<code class="literal">@ExceptionHandler</code> method:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Controller</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SimpleController {

    <span class="hl-comment">// @RequestMapping methods omitted ...</span>

    <em><span class="hl-annotation" style="color: gray">@ExceptionHandler(IOException.class)</span></em>
    <span class="hl-keyword">public</span> ResponseEntity&lt;String&gt; handleIOException(IOException ex) {
        <span class="hl-comment">// prepare responseEntity</span>
        <span class="hl-keyword">return</span> responseEntity;
    }

}</pre>

<p>The <code class="literal">@ExceptionHandler</code> value can be set to an array of Exception types. If an exception
is thrown that matches one of the types in the list, then the method annotated with the
matching <code class="literal">@ExceptionHandler</code> will be invoked. If the annotation value is not set then
the exception types listed as method arguments are used.</p>
<p>Much like standard controller methods annotated with a <code class="literal">@RequestMapping</code> annotation, the
method arguments and return values of <code class="literal">@ExceptionHandler</code> methods can be flexible. For
example, the <code class="literal">HttpServletRequest</code> can be accessed in Servlet environments and the
<code class="literal">PortletRequest</code> in Portlet environments. The return type can be a <code class="literal">String</code>, which is
interpreted as a view name, a <code class="literal">ModelAndView</code> object, a <code class="literal">ResponseEntity</code>, or you can also
add the <code class="literal">@ResponseBody</code> to have the method return value converted with message
converters and written to the response stream.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-ann-rest-spring-mvc-exceptions" href="#mvc-ann-rest-spring-mvc-exceptions"></a>16.11.3&nbsp;Handling Standard Spring MVC Exceptions</h3></div></div></div>

<p>Spring MVC may raise a number of exceptions while processing a request. The
<code class="literal">SimpleMappingExceptionResolver</code> can easily map any exception to a default error view as
needed. However, when working with clients that interpret responses in an automated way
you will want to set specific status code on the response. Depending on the exception
raised the status code may indicate a client error (4xx) or a server error (5xx).</p>
<p>The <code class="literal">DefaultHandlerExceptionResolver</code> translates Spring MVC exceptions to specific error
status codes. It is registered by default with the MVC namespace, the MVC Java config,
and also by the the <code class="literal">DispatcherServlet</code> (i.e. when not using the MVC namespace or Java
config). Listed below are some of the exceptions handled by this resolver and the
corresponding status codes:</p>
<div class="informaltable">
  <table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="col_1"><col class="col_2"></colgroup><thead><tr><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Exception</th><th style="border-bottom: 0.5pt solid ; " align="left" valign="top">HTTP Status Code</th></tr></thead><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">BindException</code></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>400 (Bad Request)</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">ConversionNotSupportedException</code></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>500 (Internal Server Error)</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">HttpMediaTypeNotAcceptableException</code></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>406 (Not Acceptable)</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">HttpMediaTypeNotSupportedException</code></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>415 (Unsupported Media Type)</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">HttpMessageNotReadableException</code></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>400 (Bad Request)</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">HttpMessageNotWritableException</code></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>500 (Internal Server Error)</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">HttpRequestMethodNotSupportedException</code></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>405 (Method Not Allowed)</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">MethodArgumentNotValidException</code></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>400 (Bad Request)</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">MissingServletRequestParameterException</code></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>400 (Bad Request)</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">MissingServletRequestPartException</code></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>400 (Bad Request)</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">NoHandlerFoundException</code></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>404 (Not Found)</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">NoSuchRequestHandlingMethodException</code></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>404 (Not Found)</p></td></tr><tr><td style="border-right: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">TypeMismatchException</code></p></td><td style="" align="left" valign="top"><p>400 (Bad Request)</p></td></tr></tbody></table>
</div>

<p>The <code class="literal">DefaultHandlerExceptionResolver</code> works transparently by setting the status of the
response. However, it stops short of writing any error content to the body of the
response while your application may need to add developer-friendly content to every
error response for example when providing a REST API. You can prepare a <code class="literal">ModelAndView</code>
and render error content through view resolution&#8201;&#8212;&#8201;i.e. by configuring a
<code class="literal">ContentNegotiatingViewResolver</code>, <code class="literal">MappingJackson2JsonView</code>, and so on. However, you may
prefer to use <code class="literal">@ExceptionHandler</code> methods instead.</p>
<p>If you prefer to write error content via <code class="literal">@ExceptionHandler</code> methods you can extend
<code class="literal">ResponseEntityExceptionHandler</code> instead. This is a convenient base for
<code class="literal">@ControllerAdvice</code> classes providing an <code class="literal">@ExceptionHandler</code> method to handle standard
Spring MVC exceptions and return <code class="literal">ResponseEntity</code>. That allows you to customize the
response and write error content with message converters. See the
<code class="literal">ResponseEntityExceptionHandler</code> javadocs for more details.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-ann-annotated-exceptions" href="#mvc-ann-annotated-exceptions"></a>16.11.4&nbsp;Annotating Business Exceptions With @ResponseStatus</h3></div></div></div>

<p>A business exception can be annotated with <code class="literal">@ResponseStatus</code>. When the exception is
raised, the <code class="literal">ResponseStatusExceptionResolver</code> handles it by setting the status of the
response accordingly. By default the <code class="literal">DispatcherServlet</code> registers the
<code class="literal">ResponseStatusExceptionResolver</code> and it is available for use.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-ann-customer-servlet-container-error-page" href="#mvc-ann-customer-servlet-container-error-page"></a>16.11.5&nbsp;Customizing the Default Servlet Container Error Page</h3></div></div></div>

<p>When the status of the response is set to an error status code and the body of the
response is empty, Servlet containers commonly render an HTML formatted error page. To
customize the default error page of the container, you can declare an <code class="literal">&lt;error-page&gt;</code>
element in <code class="literal">web.xml</code>. Up until Servlet 3, that element had to be mapped to a specific
status code or exception type. Starting with Servlet 3 an error page does not need to be
mapped, which effectively means the specified location customizes the default Servlet
container error page.</p>
<pre class="programlisting"><span class="hl-tag">&lt;error-page&gt;</span>
    <span class="hl-tag">&lt;location&gt;</span>/error<span class="hl-tag">&lt;/location&gt;</span>
<span class="hl-tag">&lt;/error-page&gt;</span></pre>

<p>Note that the actual location for the error page can be a JSP page or some other URL
within the container including one handled through an <code class="literal">@Controller</code> method:</p>
<p>When writing error information, the status code and the error message set on the
<code class="literal">HttpServletResponse</code> can be accessed through request attributes in a controller:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Controller</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ErrorController {

    <em><span class="hl-annotation" style="color: gray">@RequestMapping(value="/error", produces="application/json")</span></em>
    <em><span class="hl-annotation" style="color: gray">@ResponseBody</span></em>
    <span class="hl-keyword">public</span> Map&lt;String, Object&gt; handle(HttpServletRequest request) {

        Map&lt;String, Object&gt; map = <span class="hl-keyword">new</span> HashMap&lt;String, Object&gt;();
        map.put(<span class="hl-string">"status"</span>, request.getAttribute(<span class="hl-string">"javax.servlet.error.status_code"</span>));
        map.put(<span class="hl-string">"reason"</span>, request.getAttribute(<span class="hl-string">"javax.servlet.error.message"</span>));

        <span class="hl-keyword">return</span> map;
    }

}</pre>

<p>or in a JSP:</p>
<pre class="programlisting"><span class="hl-tag">&lt;%@</span> <span class="hl-attribute">page</span> <span class="hl-attribute">contentType</span>=<span class="hl-value">"application/json"</span> <span class="hl-attribute">pageEncoding</span>=<span class="hl-value">"UTF-8"</span><span class="hl-attribute">%&gt;</span>
<span class="hl-attribute">{</span>
    <span class="hl-attribute">status:&lt;%</span>=<span class="hl-value">request.getAttribute("javax.servlet.error.status_code")</span> <span class="hl-attribute">%&gt;,</span>
    <span class="hl-attribute">reason:&lt;%</span>=<span class="hl-value">request.getAttribute("javax.servlet.error.message")</span> <span class="hl-attribute">%&gt;</span>
<span class="hl-attribute">}</span></pre>

</div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="mvc-web-security" href="#mvc-web-security"></a>16.12&nbsp;Web Security</h2></div></div></div>

<p>The <a class="ulink" href="http://projects.spring.io/spring-security/" target="_top">Spring Security</a> project provides features
to protect web applications from malicious exploits. Check out the reference documentation in the sections on
<a class="ulink" href="http://docs.spring.io/spring-security/site/docs/current/reference/htmlsingle/#csrf" target="_top">"CSRF protection"</a>,
<a class="ulink" href="http://docs.spring.io/spring-security/site/docs/current/reference/htmlsingle/#headers" target="_top">"Security Response Headers"</a>, and also
<a class="ulink" href="http://docs.spring.io/spring-security/site/docs/current/reference/htmlsingle/#mvc" target="_top">"Spring MVC Integration"</a>.
Note that using Spring Security to secure the application is not necessarily required for all features.
For example CSRF protection can be added simply by adding the <code class="literal">CsrfFilter</code> and
<code class="literal">CsrfRequestDataValueProcessor</code> to your configuration. See the
<a class="ulink" href="https://github.com/spring-projects/spring-mvc-showcase/commit/361adc124c05a8187b84f25e8a57550bb7d9f8e4" target="_top">Spring MVC Showcase</a>
for an example.</p>
<p>Another option is to use a framework dedicated to Web Security.
<a class="ulink" href="http://hdiv.org/" target="_top">HDIV</a> is one such framework and integrates with Spring MVC.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="mvc-coc" href="#mvc-coc"></a>16.13&nbsp;Convention over configuration support</h2></div></div></div>

<p>For a lot of projects, sticking to established conventions and having reasonable
defaults is just what they (the projects) need, and Spring Web MVC now has explicit
support for <span class="emphasis"><em>convention over configuration</em></span>. What this means is that if you establish
a set of naming conventions and suchlike, you can <span class="emphasis"><em>substantially</em></span> cut down on the
amount of configuration that is required to set up handler mappings, view resolvers,
<code class="literal">ModelAndView</code> instances, etc. This is a great boon with regards to rapid prototyping,
and can also lend a degree of (always good-to-have) consistency across a codebase should
you choose to move forward with it into production.</p>
<p>Convention-over-configuration support addresses the three core areas of MVC: models,
views, and controllers.</p>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-coc-ccnhm" href="#mvc-coc-ccnhm"></a>16.13.1&nbsp;The Controller ControllerClassNameHandlerMapping</h3></div></div></div>

<p>The <code class="literal">ControllerClassNameHandlerMapping</code> class is a <code class="literal">HandlerMapping</code> implementation that
uses a convention to determine the mapping between request URLs and the <code class="literal">Controller</code>
instances that are to handle those requests.</p>
<p>Consider the following simple <code class="literal">Controller</code> implementation. Take special notice of the
<span class="emphasis"><em>name</em></span> of the class.</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> <span class="strong"><strong>ViewShoppingCartController</strong></span> <span class="hl-keyword">implements</span> Controller {

    <span class="hl-keyword">public</span> ModelAndView handleRequest(HttpServletRequest request, HttpServletResponse response) {
        <span class="hl-comment">// the implementation is not hugely important for this example...</span>
    }

}</pre>

<p>Here is a snippet from the corresponding Spring Web MVC configuration file:</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.web.servlet.mvc.support.ControllerClassNameHandlerMapping"</span><span class="hl-tag">/&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"</span><span class="strong"><strong>viewShoppingCart</strong></span>" class="x.y.z.ViewShoppingCartController"&gt;
    <span class="hl-comment">&lt;!-- inject dependencies as required... --&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre>

<p>The <code class="literal">ControllerClassNameHandlerMapping</code> finds all of the various handler (or
<code class="literal">Controller</code>) beans defined in its application context and strips <code class="literal">Controller</code> off the
name to define its handler mappings. Thus, <code class="literal">ViewShoppingCartController</code> maps to the
<code class="literal">/viewshoppingcart*</code> request URL.</p>
<p>Let&#8217;s look at some more examples so that the central idea becomes immediately familiar.
(Notice all lowercase in the URLs, in contrast to camel-cased <code class="literal">Controller</code> class names.)</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<code class="literal">WelcomeController</code> maps to the <code class="literal">/welcome*</code> request URL
</li><li class="listitem">
<code class="literal">HomeController</code> maps to the <code class="literal">/home*</code> request URL
</li><li class="listitem">
<code class="literal">IndexController</code> maps to the <code class="literal">/index*</code> request URL
</li><li class="listitem">
<code class="literal">RegisterController</code> maps to the <code class="literal">/register*</code> request URL
</li></ul></div>

<p>In the case of <code class="literal">MultiActionController</code> handler classes, the mappings generated are
slightly more complex. The <code class="literal">Controller</code> names in the following examples are assumed to
be <code class="literal">MultiActionController</code> implementations:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<code class="literal">AdminController</code> maps to the <code class="literal">/admin/*</code> request URL
</li><li class="listitem">
<code class="literal">CatalogController</code> maps to the <code class="literal">/catalog/*</code> request URL
</li></ul></div>

<p>If you follow the convention of naming your <code class="literal">Controller</code> implementations as
<code class="literal">xxxController</code>, the <code class="literal">ControllerClassNameHandlerMapping</code> saves you the tedium of
defining and maintaining a potentially <span class="emphasis"><em>looooong</em></span> <code class="literal">SimpleUrlHandlerMapping</code> (or
suchlike).</p>
<p>The <code class="literal">ControllerClassNameHandlerMapping</code> class extends the <code class="literal">AbstractHandlerMapping</code> base
class so you can define <code class="literal">HandlerInterceptor</code> instances and everything else just as you
would with many other <code class="literal">HandlerMapping</code> implementations.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-coc-modelmap" href="#mvc-coc-modelmap"></a>16.13.2&nbsp;The Model ModelMap (ModelAndView)</h3></div></div></div>

<p>The <code class="literal">ModelMap</code> class is essentially a glorified <code class="literal">Map</code> that can make adding objects that
are to be displayed in (or on) a <code class="literal">View</code> adhere to a common naming convention. Consider
the following <code class="literal">Controller</code> implementation; notice that objects are added to the
<code class="literal">ModelAndView</code> without any associated name specified.</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> DisplayShoppingCartController <span class="hl-keyword">implements</span> Controller {

    <span class="hl-keyword">public</span> ModelAndView handleRequest(HttpServletRequest request, HttpServletResponse response) {

        List cartItems = <span class="hl-comment">// get a List of CartItem objects</span>
        User user = <span class="hl-comment">// get the User doing the shopping</span>

        ModelAndView mav = <span class="hl-keyword">new</span> ModelAndView(<span class="hl-string">"displayShoppingCart"</span>); &lt;-- the logical view name

        mav.addObject(cartItems); &lt;-- look ma, no name, just the object
        mav.addObject(user); &lt;-- and again ma!

        <span class="hl-keyword">return</span> mav;
    }
}</pre>

<p>The <code class="literal">ModelAndView</code> class uses a <code class="literal">ModelMap</code> class that is a custom <code class="literal">Map</code> implementation
that automatically generates a key for an object when an object is added to it. The
strategy for determining the name for an added object is, in the case of a scalar object
such as <code class="literal">User</code>, to use the short class name of the object&#8217;s class. The following
examples are names that are generated for scalar objects put into a <code class="literal">ModelMap</code> instance.</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
An <code class="literal">x.y.User</code> instance added will have the name <code class="literal">user</code> generated.
</li><li class="listitem">
An <code class="literal">x.y.Registration</code> instance added will have the name <code class="literal">registration</code> generated.
</li><li class="listitem">
An <code class="literal">x.y.Foo</code> instance added will have the name <code class="literal">foo</code> generated.
</li><li class="listitem">
A <code class="literal">java.util.HashMap</code> instance added will have the name <code class="literal">hashMap</code> generated. You
probably want to be explicit about the name in this case because <code class="literal">hashMap</code> is less
than intuitive.
</li><li class="listitem">
Adding <code class="literal">null</code> will result in an <code class="literal">IllegalArgumentException</code> being thrown. If the object
(or objects) that you are adding could be <code class="literal">null</code>, then you will also want to be
explicit about the name.
</li></ul></div>

<div class="sidebar"><div class="titlepage"><div><div><p class="title"><b>What, no automatic pluralization?</b></p></div></div></div>

<p>Spring Web MVC&#8217;s convention-over-configuration support does not support automatic
pluralization. That is, you cannot add a <code class="literal">List</code> of <code class="literal">Person</code> objects to a <code class="literal">ModelAndView</code>
and have the generated name be <code class="literal">people</code>.</p>
<p>This decision was made after some debate, with the "Principle of Least Surprise" winning
out in the end.</p>
</div>

<p>The strategy for generating a name after adding a <code class="literal">Set</code> or a <code class="literal">List</code> is to peek into the
collection, take the short class name of the first object in the collection, and use
that with <code class="literal">List</code> appended to the name. The same applies to arrays although with arrays
it is not necessary to peek into the array contents. A few examples will make the
semantics of name generation for collections clearer:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
An <code class="literal">x.y.User[]</code> array with zero or more <code class="literal">x.y.User</code> elements added will have the name
<code class="literal">userList</code> generated.
</li><li class="listitem">
An <code class="literal">x.y.Foo[]</code> array with zero or more <code class="literal">x.y.User</code> elements added will have the name
<code class="literal">fooList</code> generated.
</li><li class="listitem">
A <code class="literal">java.util.ArrayList</code> with one or more <code class="literal">x.y.User</code> elements added will have the name
<code class="literal">userList</code> generated.
</li><li class="listitem">
A <code class="literal">java.util.HashSet</code> with one or more <code class="literal">x.y.Foo</code> elements added will have the name
<code class="literal">fooList</code> generated.
</li><li class="listitem">
An <span class="emphasis"><em>empty</em></span> <code class="literal">java.util.ArrayList</code> will not be added at all (in effect, the
<code class="literal">addObject(..)</code> call will essentially be a no-op).
</li></ul></div>

</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-coc-r2vnt" href="#mvc-coc-r2vnt"></a>16.13.3&nbsp;The View - RequestToViewNameTranslator</h3></div></div></div>

<p>The <code class="literal">RequestToViewNameTranslator</code> interface determines a logical <code class="literal">View</code> name when no
such logical view name is explicitly supplied. It has just one implementation, the
<code class="literal">DefaultRequestToViewNameTranslator</code> class.</p>
<p>The <code class="literal">DefaultRequestToViewNameTranslator</code> maps request URLs to logical view names, as
with this example:</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> RegistrationController <span class="hl-keyword">implements</span> Controller {

    <span class="hl-keyword">public</span> ModelAndView handleRequest(HttpServletRequest request, HttpServletResponse response) {
        <span class="hl-comment">// process the request...</span>
        ModelAndView mav = <span class="hl-keyword">new</span> ModelAndView();
        <span class="hl-comment">// add data as necessary to the model...</span>
        <span class="hl-keyword">return</span> mav;
        <span class="hl-comment">// notice that no View or logical view name has been set</span>
    }

}</pre>

<pre class="programlisting"><span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd"</span><span class="hl-tag">&gt;</span>

    <span class="hl-comment">&lt;!-- this bean with the well known name generates view names for us --&gt;</span>
    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"viewNameTranslator"</span>
            <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.web.servlet.view.DefaultRequestToViewNameTranslator"</span><span class="hl-tag">/&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"x.y.RegistrationController"</span><span class="hl-tag">&gt;</span>
        <span class="hl-comment">&lt;!-- inject dependencies as necessary --&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-comment">&lt;!-- maps request URLs to Controller names --&gt;</span>
    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.web.servlet.mvc.support.ControllerClassNameHandlerMapping"</span><span class="hl-tag">/&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"viewResolver"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.web.servlet.view.InternalResourceViewResolver"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"prefix"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"/WEB-INF/jsp/"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"suffix"</span> <span class="hl-attribute">value</span>=<span class="hl-value">".jsp"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre>

<p>Notice how in the implementation of the <code class="literal">handleRequest(..)</code> method no <code class="literal">View</code> or logical
view name is ever set on the <code class="literal">ModelAndView</code> that is returned. The
<code class="literal">DefaultRequestToViewNameTranslator</code> is tasked with generating a <span class="emphasis"><em>logical view name</em></span>
from the URL of the request. In the case of the above <code class="literal">RegistrationController</code>, which is
used in conjunction with the <code class="literal">ControllerClassNameHandlerMapping</code>, a request URL of
<code class="literal">http://localhost/registration.html</code> results in a logical view name of <code class="literal">registration</code>
being generated by the <code class="literal">DefaultRequestToViewNameTranslator</code>. This logical view name is
then resolved into the <code class="literal">/WEB-INF/jsp/registration.jsp</code> view by the
<code class="literal">InternalResourceViewResolver</code> bean.</p>
<div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top">
<p>You do not need to define a <code class="literal">DefaultRequestToViewNameTranslator</code> bean explicitly. If you
like the default settings of the <code class="literal">DefaultRequestToViewNameTranslator</code>, you can rely on
the Spring Web MVC <code class="literal">DispatcherServlet</code> to instantiate an instance of this class if one
is not explicitly configured.</p>
</td></tr></table></div>

<p>Of course, if you need to change the default settings, then you do need to configure
your own <code class="literal">DefaultRequestToViewNameTranslator</code> bean explicitly. Consult the comprehensive
<code class="literal">DefaultRequestToViewNameTranslator</code> javadocs for details on the various properties
that can be configured.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="mvc-etag" href="#mvc-etag"></a>16.14&nbsp;ETag support</h2></div></div></div>

<p>An <a class="ulink" href="http://en.wikipedia.org/wiki/HTTP_ETag" target="_top">ETag</a> (entity tag) is an HTTP response header
returned by an HTTP/1.1 compliant web server used to determine change in content at a
given URL. It can be considered to be the more sophisticated successor to the
<code class="literal">Last-Modified</code> header. When a server returns a representation with an ETag header, the
client can use this header in subsequent GETs, in an <code class="literal">If-None-Match</code> header. If the
content has not changed, the server returns <code class="literal">304: Not Modified</code>.</p>
<p>Support for ETags is provided by the Servlet filter <code class="literal">ShallowEtagHeaderFilter</code>. It is a
plain Servlet Filter, and thus can be used in combination with any web framework. The
<code class="literal">ShallowEtagHeaderFilter</code> filter creates so-called shallow ETags (as opposed to deep
ETags, more about that later).The filter caches the content of the rendered JSP (or
other content), generates an MD5 hash over that, and returns that as an ETag header in
the response. The next time a client sends a request for the same resource, it uses that
hash as the <code class="literal">If-None-Match</code> value. The filter detects this, renders the view again, and
compares the two hashes. If they are equal, a <code class="literal">304</code> is returned. This filter will not
save processing power, as the view is still rendered. The only thing it saves is
bandwidth, as the rendered response is not sent back over the wire.</p>
<p>You configure the <code class="literal">ShallowEtagHeaderFilter</code> in <code class="literal">web.xml</code>:</p>
<pre class="programlisting"><span class="hl-tag">&lt;filter&gt;</span>
    <span class="hl-tag">&lt;filter-name&gt;</span>etagFilter<span class="hl-tag">&lt;/filter-name&gt;</span>
    <span class="hl-tag">&lt;filter-class&gt;</span>org.springframework.web.filter.ShallowEtagHeaderFilter<span class="hl-tag">&lt;/filter-class&gt;</span>
<span class="hl-tag">&lt;/filter&gt;</span>

<span class="hl-tag">&lt;filter-mapping&gt;</span>
    <span class="hl-tag">&lt;filter-name&gt;</span>etagFilter<span class="hl-tag">&lt;/filter-name&gt;</span>
    <span class="hl-tag">&lt;servlet-name&gt;</span>petclinic<span class="hl-tag">&lt;/servlet-name&gt;</span>
<span class="hl-tag">&lt;/filter-mapping&gt;</span></pre>

</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="mvc-container-config" href="#mvc-container-config"></a>16.15&nbsp;Code-based Servlet container initialization</h2></div></div></div>

<p>In a Servlet 3.0+ environment, you have the option of configuring the Servlet container
programmatically as an alternative or in combination with a <code class="literal">web.xml</code> file. Below is an
example of registering a <code class="literal">DispatcherServlet</code>:</p>
<pre class="programlisting"><span class="hl-keyword">import</span> org.springframework.web.WebApplicationInitializer;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyWebApplicationInitializer <span class="hl-keyword">implements</span> WebApplicationInitializer {

    <em><span class="hl-annotation" style="color: gray">@Override</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> onStartup(ServletContext container) {
        XmlWebApplicationContext appContext = <span class="hl-keyword">new</span> XmlWebApplicationContext();
        appContext.setConfigLocation(<span class="hl-string">"/WEB-INF/spring/dispatcher-config.xml"</span>);

        ServletRegistration.Dynamic registration = container.addServlet(<span class="hl-string">"dispatcher"</span>, <span class="hl-keyword">new</span> DispatcherServlet(appContext));
        registration.setLoadOnStartup(<span class="hl-number">1</span>);
        registration.addMapping(<span class="hl-string">"/"</span>);
    }

}</pre>

<p><code class="literal">WebApplicationInitializer</code> is an interface provided by Spring MVC that ensures your
implementation is detected and automatically used to initialize any Servlet 3 container.
An abstract base class implementation of <code class="literal">WebApplicationInitializer</code> named
<code class="literal">AbstractDispatcherServletInitializer</code> makes it even easier to register the
<code class="literal">DispatcherServlet</code> by simply overriding methods to specify the servlet mapping and the
location of the <code class="literal">DispatcherServlet</code> configuration:</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyWebAppInitializer <span class="hl-keyword">extends</span> AbstractAnnotationConfigDispatcherServletInitializer {

    <em><span class="hl-annotation" style="color: gray">@Override</span></em>
    <span class="hl-keyword">protected</span> Class&lt;?&gt;[] getRootConfigClasses() {
        <span class="hl-keyword">return</span> null;
    }

    <em><span class="hl-annotation" style="color: gray">@Override</span></em>
    <span class="hl-keyword">protected</span> Class&lt;?&gt;[] getServletConfigClasses() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> Class[] { MyWebConfig.<span class="hl-keyword">class</span> };
    }

    <em><span class="hl-annotation" style="color: gray">@Override</span></em>
    <span class="hl-keyword">protected</span> String[] getServletMappings() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> String[] { <span class="hl-string">"/"</span> };
    }

}</pre>

<p>The above example is for an application that uses Java-based Spring configuration. If
using XML-based Spring configuration, extend directly from
<code class="literal">AbstractDispatcherServletInitializer</code>:</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyWebAppInitializer <span class="hl-keyword">extends</span> AbstractDispatcherServletInitializer {

    <em><span class="hl-annotation" style="color: gray">@Override</span></em>
    <span class="hl-keyword">protected</span> WebApplicationContext createRootApplicationContext() {
        <span class="hl-keyword">return</span> null;
    }

    <em><span class="hl-annotation" style="color: gray">@Override</span></em>
    <span class="hl-keyword">protected</span> WebApplicationContext createServletApplicationContext() {
        XmlWebApplicationContext cxt = <span class="hl-keyword">new</span> XmlWebApplicationContext();
        cxt.setConfigLocation(<span class="hl-string">"/WEB-INF/spring/dispatcher-config.xml"</span>);
        <span class="hl-keyword">return</span> cxt;
    }

    <em><span class="hl-annotation" style="color: gray">@Override</span></em>
    <span class="hl-keyword">protected</span> String[] getServletMappings() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> String[] { <span class="hl-string">"/"</span> };
    }

}</pre>

<p><code class="literal">AbstractDispatcherServletInitializer</code> also provides a convenient way to add <code class="literal">Filter</code>
instances and have them automatically mapped to the <code class="literal">DispatcherServlet</code>:</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyWebAppInitializer <span class="hl-keyword">extends</span> AbstractDispatcherServletInitializer {

    <span class="hl-comment">// ...</span>

    <em><span class="hl-annotation" style="color: gray">@Override</span></em>
    <span class="hl-keyword">protected</span> Filter[] getServletFilters() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> Filter[] { <span class="hl-keyword">new</span> HiddenHttpMethodFilter(), <span class="hl-keyword">new</span> CharacterEncodingFilter() };
    }

}</pre>

<p>Each filter is added with a default name based on its concrete type and automatically
mapped to the <code class="literal">DispatcherServlet</code>.</p>
<p>The <code class="literal">isAsyncSupported</code> protected method of <code class="literal">AbstractDispatcherServletInitializer</code>
provides a single place to enable async support on the <code class="literal">DispatcherServlet</code> and all
filters mapped to it. By default this flag is set to <code class="literal">true</code>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="mvc-config" href="#mvc-config"></a>16.16&nbsp;Configuring Spring MVC</h2></div></div></div>

<p><a class="xref" href="mvc.html#mvc-servlet-special-bean-types" title="16.2.1&nbsp;WebApplicationContext &#30340;&#19987;&#29992; bean">Section&nbsp;16.2.1, &#8220;WebApplicationContext &#30340;&#19987;&#29992; bean&#8221;</a> and <a class="xref" href="mvc.html#mvc-servlet-config" title="16.2.2&nbsp;&#40664;&#35748;&#30340; DispatcherServlet &#37197;&#32622;">Section&nbsp;16.2.2, &#8220;&#40664;&#35748;&#30340; DispatcherServlet &#37197;&#32622;&#8221;</a> explained about Spring
MVC&#8217;s special beans and the default implementations used by the <code class="literal">DispatcherServlet</code>. In
this section you&#8217;ll learn about two additional ways of configuring Spring MVC. Namely
the MVC Java config and the MVC XML namespace.</p>
<p>The MVC Java config and the MVC namespace provide similar default configuration that
overrides the <code class="literal">DispatcherServlet</code> defaults. The goal is to spare most applications from
having to having to create the same configuration and also to provide higher-level
constructs for configuring Spring MVC that serve as a simple starting point and require
little or no prior knowledge of the underlying configuration.</p>
<p>You can choose either the MVC Java config or the MVC namespace depending on your
preference. Also as you will see further below, with the MVC Java config it is easier to
see the underlying configuration as well as to make fine-grained customizations directly
to the created Spring MVC beans. But let&#8217;s start from the beginning.</p>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-config-enable" href="#mvc-config-enable"></a>16.16.1&nbsp;Enabling the MVC Java Config or the MVC XML Namespace</h3></div></div></div>

<p>To enable MVC Java config add the annotation <code class="literal">@EnableWebMvc</code> to one of your
<code class="literal">@Configuration</code> classes:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Configuration</span></em>
<em><span class="hl-annotation" style="color: gray">@EnableWebMvc</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> WebConfig {

}</pre>

<p>To achieve the same in XML use the <code class="literal">mvc:annotation-driven</code> element in your
DispatcherServlet context (or in your root context if you have no DispatcherServlet
context defined):</p>
<pre class="programlisting"><span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
    <span class="hl-attribute">xmlns:mvc</span>=<span class="hl-value">"http://www.springframework.org/schema/mvc"</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/mvc
        http://www.springframework.org/schema/mvc/spring-mvc.xsd"</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;mvc:annotation-driven /&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre>

<p>The above registers a <code class="literal">RequestMappingHandlerMapping</code>, a <code class="literal">RequestMappingHandlerAdapter</code>,
and an <code class="literal">ExceptionHandlerExceptionResolver</code> (among others) in support of processing
requests with annotated controller methods using annotations such as <code class="literal">@RequestMapping</code>,
<code class="literal">@ExceptionHandler</code>, and others.</p>
<p>It also enables the following:</p>
<div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
Spring 3 style type conversion through a <a class="link" href="validation.html#core-convert" title="7.5&nbsp;Spring Type Conversion">ConversionService</a> instance
in addition to the JavaBeans PropertyEditors used for Data Binding.
</li><li class="listitem">
Support for <a class="link" href="validation.html#format" title="7.6&nbsp;Spring Field Formatting">formatting</a> Number fields using the <code class="literal">@NumberFormat</code> annotation
through the <code class="literal">ConversionService</code>.
</li><li class="listitem">
Support for <a class="link" href="validation.html#format" title="7.6&nbsp;Spring Field Formatting">formatting</a> Date, Calendar, Long, and Joda Time fields using the
<code class="literal">@DateTimeFormat</code> annotation.
</li><li class="listitem">
Support for <a class="link" href="validation.html#validation-mvc-jsr303" title="Configuring a JSR-303/JSR-349 Validator for use by Spring MVC">validating</a> <code class="literal">@Controller</code> inputs with <code class="literal">@Valid</code>, if
a JSR-303 Provider is present on the classpath.
</li><li class="listitem">
<p class="simpara">HttpMessageConverter support for <code class="literal">@RequestBody</code> method parameters and <code class="literal">@ResponseBody</code>
method return values from <code class="literal">@RequestMapping</code> or <code class="literal">@ExceptionHandler</code> methods.</p>
<p class="simpara">This is the complete list of HttpMessageConverters set up by mvc:annotation-driven:</p>
<div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
<code class="literal">ByteArrayHttpMessageConverter</code> converts byte arrays.
</li><li class="listitem">
<code class="literal">StringHttpMessageConverter</code> converts strings.
</li><li class="listitem">
<code class="literal">ResourceHttpMessageConverter</code> converts to/from
<code class="literal">org.springframework.core.io.Resource</code> for all media types.
</li><li class="listitem">
<code class="literal">SourceHttpMessageConverter</code> converts to/from a <code class="literal">javax.xml.transform.Source</code>.
</li><li class="listitem">
<code class="literal">FormHttpMessageConverter</code> converts form data to/from a <code class="literal">MultiValueMap&lt;String,
String&gt;</code>.
</li><li class="listitem">
<code class="literal">Jaxb2RootElementHttpMessageConverter</code> converts Java objects to/from XML&#8201;&#8212;&#8201;added if
JAXB2 is present and Jackson 2 XML extension is not present on the classpath.
</li><li class="listitem">
<code class="literal">MappingJackson2HttpMessageConverter</code> converts to/from JSON&#8201;&#8212;&#8201;added if Jackson 2
is present on the classpath.
</li><li class="listitem">
<code class="literal">MappingJackson2XmlHttpMessageConverter</code> converts to/from XML&#8201;&#8212;&#8201;added if
<a class="ulink" href="https://github.com/FasterXML/jackson-dataformat-xml" target="_top">Jackson 2 XML extension</a> is present
on the classpath.
</li><li class="listitem">
<code class="literal">AtomFeedHttpMessageConverter</code> converts Atom feeds&#8201;&#8212;&#8201;added if Rome is present on the
classpath.
</li><li class="listitem">
<code class="literal">RssChannelHttpMessageConverter</code> converts RSS feeds&#8201;&#8212;&#8201;added if Rome is present on
the classpath.
</li></ol></div>

</li></ol></div>

</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-config-customize" href="#mvc-config-customize"></a>16.16.2&nbsp;Customizing the Provided Configuration</h3></div></div></div>

<p>To customize the default configuration in Java you simply implement the
<code class="literal">WebMvcConfigurer</code> interface or more likely extend the class <code class="literal">WebMvcConfigurerAdapter</code>
and override the methods you need. Below is an example of some of the available methods
to override. See
<a class="ulink" href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/web/servlet/config/annotation/WebMvcConfigurer.html" target="_top"><code class="literal">WebMvcConfigurer</code></a>
for a list of all methods and the javadocs for further details:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Configuration</span></em>
<em><span class="hl-annotation" style="color: gray">@EnableWebMvc</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> WebConfig <span class="hl-keyword">extends</span> WebMvcConfigurerAdapter {

    <em><span class="hl-annotation" style="color: gray">@Override</span></em>
    <span class="hl-keyword">protected</span> <span class="hl-keyword">void</span> addFormatters(FormatterRegistry registry) {
        <span class="hl-comment">// Add formatters and/or converters</span>
    }

    <em><span class="hl-annotation" style="color: gray">@Override</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> configureMessageConverters(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters) {
        <span class="hl-comment">// Configure the list of HttpMessageConverters to use</span>
    }

}</pre>

<p>To customize the default configuration of <code class="literal">&lt;mvc:annotation-driven /&gt;</code> check what
attributes and sub-elements it supports. You can view the
<a class="ulink" href="http://schema.spring.io/mvc/spring-mvc.xsd" target="_top">Spring MVC XML schema</a> or use the code
completion feature of your IDE to discover what attributes and sub-elements are
available. The sample below shows a subset of what is available:</p>
<pre class="programlisting"><span class="hl-tag">&lt;mvc:annotation-driven</span> <span class="hl-attribute">conversion-service</span>=<span class="hl-value">"conversionService"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;mvc:message-converters&gt;</span>
        <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.example.MyHttpMessageConverter"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.example.MyOtherHttpMessageConverter"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/mvc:message-converters&gt;</span>
<span class="hl-tag">&lt;/mvc:annotation-driven&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"conversionService"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.format.support.FormattingConversionServiceFactoryBean"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"formatters"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;list&gt;</span>
            <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.example.MyFormatter"</span><span class="hl-tag">/&gt;</span>
            <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.example.MyOtherFormatter"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;/list&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre>

</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-config-interceptors" href="#mvc-config-interceptors"></a>16.16.3&nbsp;Interceptors</h3></div></div></div>

<p>You can configure <code class="literal">HandlerInterceptors</code> or <code class="literal">WebRequestInterceptors</code> to be applied to all
incoming requests or restricted to specific URL path patterns.</p>
<p>An example of registering interceptors in Java:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Configuration</span></em>
<em><span class="hl-annotation" style="color: gray">@EnableWebMvc</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> WebConfig <span class="hl-keyword">extends</span> WebMvcConfigurerAdapter {

    <em><span class="hl-annotation" style="color: gray">@Override</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> addInterceptors(InterceptorRegistry registry) {
        registry.addInterceptor(<span class="hl-keyword">new</span> LocaleInterceptor());
        registry.addInterceptor(<span class="hl-keyword">new</span> ThemeInterceptor()).addPathPatterns(<span class="hl-string">"/**"</span>).excludePathPatterns(<span class="hl-string">"/admin/**"</span>);
        registry.addInterceptor(<span class="hl-keyword">new</span> SecurityInterceptor()).addPathPatterns(<span class="hl-string">"/secure/*"</span>);
    }

}</pre>

<p>And in XML use the <code class="literal">&lt;mvc:interceptors&gt;</code> element:</p>
<pre class="programlisting"><span class="hl-tag">&lt;mvc:interceptors&gt;</span>
    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.web.servlet.i18n.LocaleChangeInterceptor"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;mvc:interceptor&gt;</span>
        <span class="hl-tag">&lt;mvc:mapping</span> <span class="hl-attribute">path</span>=<span class="hl-value">"/**"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;mvc:exclude-mapping</span> <span class="hl-attribute">path</span>=<span class="hl-value">"/admin/**"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.web.servlet.theme.ThemeChangeInterceptor"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;/mvc:interceptor&gt;</span>
    <span class="hl-tag">&lt;mvc:interceptor&gt;</span>
        <span class="hl-tag">&lt;mvc:mapping</span> <span class="hl-attribute">path</span>=<span class="hl-value">"/secure/*"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.example.SecurityInterceptor"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;/mvc:interceptor&gt;</span>
<span class="hl-tag">&lt;/mvc:interceptors&gt;</span></pre>

</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-config-content-negotiation" href="#mvc-config-content-negotiation"></a>16.16.4&nbsp;Content Negotiation</h3></div></div></div>

<p>You can configure how Spring MVC determines the requested media types from the client
for request mapping as well as for content negotiation purposes. The available options
are to check the file extension in the request URI, the "Accept" header, a request
parameter, as well as to fall back on a default content type. By default, file extension
in the request URI is checked first and the "Accept" header is checked next.</p>
<p>For file extensions in the request URI, the MVC Java config and the MVC namespace,
automatically register extensions such as <code class="literal">.json</code>, <code class="literal">.xml</code>, <code class="literal">.rss</code>, and <code class="literal">.atom</code> if the
corresponding dependencies such as Jackson, JAXB2, or Rome are present on the classpath.
Additional extensions may be not need to be registered explicitly if they can be
discovered via <code class="literal">ServletContext.getMimeType(String)</code> or the <span class="emphasis"><em>Java Activation Framework</em></span>
(see <code class="literal">javax.activation.MimetypesFileTypeMap</code>). You can register more extensions with the
<a class="ulink" href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/web/servlet/mvc/method/annotation/RequestMappingHandlerMapping.html#setUseRegisteredSuffixPatternMatch(boolean)" target="_top">setUseRegisteredSuffixPatternMatch
method</a>.</p>
<p>The introduction of <code class="literal">ContentNegotiationManager</code> also enables selective suffix pattern
matching for incoming requests. For more details, see its javadocs.</p>
<p>Below is an example of customizing content negotiation options through the MVC Java
config:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Configuration</span></em>
<em><span class="hl-annotation" style="color: gray">@EnableWebMvc</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> WebConfig <span class="hl-keyword">extends</span> WebMvcConfigurerAdapter {

    <em><span class="hl-annotation" style="color: gray">@Override</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> configureContentNegotiation(ContentNegotiationConfigurer configurer) {
        configurer.favorPathExtension(false).favorParameter(true);
    }
}</pre>

<p>In the MVC namespace, the <code class="literal">&lt;mvc:annotation-driven&gt;</code> element has a
<code class="literal">content-negotiation-manager</code> attribute, which expects a <code class="literal">ContentNegotiationManager</code>
that in turn can be created with a <code class="literal">ContentNegotiationManagerFactoryBean</code>:</p>
<pre class="programlisting"><span class="hl-tag">&lt;mvc:annotation-driven</span> <span class="hl-attribute">content-negotiation-manager</span>=<span class="hl-value">"contentNegotiationManager"</span><span class="hl-tag"> /&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"contentNegotiationManager"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.web.accept.ContentNegotiationManagerFactoryBean"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"favorPathExtension"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"false"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"favorParameter"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"true"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"mediaTypes"</span><span class="hl-tag"> &gt;</span>
        <span class="hl-tag">&lt;value&gt;</span>
            json=application/json
            xml=application/xml
        <span class="hl-tag">&lt;/value&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre>

<p>If not using the MVC Java config or the MVC namespace, you&#8217;ll need to create an instance
of <code class="literal">ContentNegotiationManager</code> and use it to configure <code class="literal">RequestMappingHandlerMapping</code>
for request mapping purposes, and <code class="literal">RequestMappingHandlerAdapter</code> and
<code class="literal">ExceptionHandlerExceptionResolver</code> for content negotiation purposes.</p>
<p>Note that <code class="literal">ContentNegotiatingViewResolver</code> now can also be configured with a
<code class="literal">ContentNegotiatingViewResolver</code>, so you can use one instance throughout Spring MVC.</p>
<p>In more advanced cases, it may be useful to configure multiple
<code class="literal">ContentNegotiationManager</code> instances that in turn may contain custom
<code class="literal">ContentNegotiationStrategy</code> implementations. For example you could configure
<code class="literal">ExceptionHandlerExceptionResolver</code> with a <code class="literal">ContentNegotiationManager</code> that always
resolves the requested media type to <code class="literal">"application/json"</code>. Or you may want to plug a
custom strategy that has some logic to select a default content type (e.g. either XML or
JSON) if no content types were requested.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-config-view-controller" href="#mvc-config-view-controller"></a>16.16.5&nbsp;View Controllers</h3></div></div></div>

<p>This is a shortcut for defining a <code class="literal">ParameterizableViewController</code> that immediately
forwards to a view when invoked. Use it in static cases when there is no Java controller
logic to execute before the view generates the response.</p>
<p>An example of forwarding a request for <code class="literal">"/"</code> to a view called <code class="literal">"home"</code> in Java:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Configuration</span></em>
<em><span class="hl-annotation" style="color: gray">@EnableWebMvc</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> WebConfig <span class="hl-keyword">extends</span> WebMvcConfigurerAdapter {

    <em><span class="hl-annotation" style="color: gray">@Override</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> addViewControllers(ViewControllerRegistry registry) {
        registry.addViewController(<span class="hl-string">"/"</span>).setViewName(<span class="hl-string">"home"</span>);
    }

}</pre>

<p>And the same in XML use the <code class="literal">&lt;mvc:view-controller&gt;</code> element:</p>
<pre class="programlisting"><span class="hl-tag">&lt;mvc:view-controller</span> <span class="hl-attribute">path</span>=<span class="hl-value">"/"</span> <span class="hl-attribute">view-name</span>=<span class="hl-value">"home"</span><span class="hl-tag">/&gt;</span></pre>

</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-config-view-resolvers" href="#mvc-config-view-resolvers"></a>16.16.6&nbsp;View Resolvers</h3></div></div></div>

<p>The MVC config simplifies the registration of view resolvers.</p>
<p>The following is a Java config example that configures content negotiation view
resolution using FreeMarker HTML templates and Jackson as a default <code class="literal">View</code> for
JSON rendering:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Configuration</span></em>
<em><span class="hl-annotation" style="color: gray">@EnableWebMvc</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> WebConfig <span class="hl-keyword">extends</span> WebMvcConfigurerAdapter {

    <em><span class="hl-annotation" style="color: gray">@Override</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> configureViewResolvers(ViewResolverRegistry registry) {
        registry.enableContentNegotiation(<span class="hl-keyword">new</span> MappingJackson2JsonView());
        registry.jsp();
    }

}</pre>

<p>And the same in XML:</p>
<pre class="programlisting"><span class="hl-tag">&lt;mvc:view-resolvers&gt;</span>
    <span class="hl-tag">&lt;mvc:content-negotiation&gt;</span>
        <span class="hl-tag">&lt;mvc:default-views&gt;</span>
            <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.web.servlet.view.json.MappingJackson2JsonView"</span><span class="hl-tag"> /&gt;</span>
        <span class="hl-tag">&lt;/mvc:default-views&gt;</span>
    <span class="hl-tag">&lt;/mvc:content-negotiation&gt;</span>
    <span class="hl-tag">&lt;mvc:jsp /&gt;</span>
<span class="hl-tag">&lt;/mvc:view-resolvers&gt;</span></pre>

<p>Note however that FreeMarker, Velocity, Tiles, and Groovy Markup also require
configuration of the underlying view technology.</p>
<p>The MVC namespace provides dedicated elements. For example with FreeMarker:</p>
<pre class="programlisting">
<span class="hl-tag">&lt;mvc:view-resolvers&gt;</span>
    <span class="hl-tag">&lt;mvc:content-negotiation&gt;</span>
        <span class="hl-tag">&lt;mvc:default-views&gt;</span>
            <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.web.servlet.view.json.MappingJackson2JsonView"</span><span class="hl-tag"> /&gt;</span>
        <span class="hl-tag">&lt;/mvc:default-views&gt;</span>
    <span class="hl-tag">&lt;/mvc:content-negotiation&gt;</span>
    <span class="hl-tag">&lt;mvc:freemarker</span> <span class="hl-attribute">cache</span>=<span class="hl-value">"false"</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/mvc:view-resolvers&gt;</span>

<span class="hl-tag">&lt;mvc:freemarker-configurer&gt;</span>
    <span class="hl-tag">&lt;mvc:template-loader-path</span> <span class="hl-attribute">location</span>=<span class="hl-value">"/freemarker"</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/mvc:freemarker-configurer&gt;</span>

</pre>

<p>In Java config simply add the respective "Configurer" bean:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Configuration</span></em>
<em><span class="hl-annotation" style="color: gray">@EnableWebMvc</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> WebConfig <span class="hl-keyword">extends</span> WebMvcConfigurerAdapter {

    <em><span class="hl-annotation" style="color: gray">@Override</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> configureViewResolvers(ViewResolverRegistry registry) {
        registry.enableContentNegotiation(<span class="hl-keyword">new</span> MappingJackson2JsonView());
        registry.freeMarker().cache(false);
    }

    <em><span class="hl-annotation" style="color: gray">@Bean</span></em>
    <span class="hl-keyword">public</span> FreeMarkerConfigurer freeMarkerConfigurer() {
        FreeMarkerConfigurer configurer = <span class="hl-keyword">new</span> FreeMarkerConfigurer();
        configurer.setTemplateLoaderPath(<span class="hl-string">"/WEB-INF/"</span>);
        <span class="hl-keyword">return</span> configurer;
    }

}</pre>

</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-config-static-resources" href="#mvc-config-static-resources"></a>16.16.7&nbsp;Serving of Resources</h3></div></div></div>

<p>This option allows static resource requests following a particular URL pattern to be
served by a <code class="literal">ResourceHttpRequestHandler</code> from any of a list of <code class="literal">Resource</code> locations.
This provides a convenient way to serve static resources from locations other than the
web application root, including locations on the classpath. The <code class="literal">cache-period</code> property
may be used to set far future expiration headers (1 year is the recommendation of
optimization tools such as Page Speed and YSlow) so that they will be more efficiently
utilized by the client. The handler also properly evaluates the <code class="literal">Last-Modified</code> header
(if present) so that a <code class="literal">304</code> status code will be returned as appropriate, avoiding
unnecessary overhead for resources that are already cached by the client. For example,
to serve resource requests with a URL pattern of <code class="literal">/resources/**</code> from a
<code class="literal">public-resources</code> directory within the web application root you would use:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Configuration</span></em>
<em><span class="hl-annotation" style="color: gray">@EnableWebMvc</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> WebConfig <span class="hl-keyword">extends</span> WebMvcConfigurerAdapter {

    <em><span class="hl-annotation" style="color: gray">@Override</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> addResourceHandlers(ResourceHandlerRegistry registry) {
        registry.addResourceHandler(<span class="hl-string">"/resources/**"</span>).addResourceLocations(<span class="hl-string">"/public-resources/"</span>);
    }

}</pre>

<p>And the same in XML:</p>
<pre class="programlisting"><span class="hl-tag">&lt;mvc:resources</span> <span class="hl-attribute">mapping</span>=<span class="hl-value">"/resources/**"</span> <span class="hl-attribute">location</span>=<span class="hl-value">"/public-resources/"</span><span class="hl-tag">/&gt;</span></pre>

<p>To serve these resources with a 1-year future expiration to ensure maximum use of the
browser cache and a reduction in HTTP requests made by the browser:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Configuration</span></em>
<em><span class="hl-annotation" style="color: gray">@EnableWebMvc</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> WebConfig <span class="hl-keyword">extends</span> WebMvcConfigurerAdapter {

    <em><span class="hl-annotation" style="color: gray">@Override</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> addResourceHandlers(ResourceHandlerRegistry registry) {
        registry.addResourceHandler(<span class="hl-string">"/resources/**"</span>).addResourceLocations(<span class="hl-string">"/public-resources/"</span>).setCachePeriod(<span class="hl-number">31556926</span>);
    }

}</pre>

<p>And in XML:</p>
<pre class="programlisting"><span class="hl-tag">&lt;mvc:resources</span> <span class="hl-attribute">mapping</span>=<span class="hl-value">"/resources/**"</span> <span class="hl-attribute">location</span>=<span class="hl-value">"/public-resources/"</span> <span class="hl-attribute">cache-period</span>=<span class="hl-value">"31556926"</span><span class="hl-tag">/&gt;</span></pre>

<p>The <code class="literal">mapping</code> attribute must be an Ant pattern that can be used by
<code class="literal">SimpleUrlHandlerMapping</code>, and the <code class="literal">location</code> attribute must specify one or more valid
resource directory locations. Multiple resource locations may be specified using a
comma-separated list of values. The locations specified will be checked in the specified
order for the presence of the resource for any given request. For example, to enable the
serving of resources from both the web application root and from a known path of
<code class="literal">/META-INF/public-web-resources/</code> in any jar on the classpath use:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@EnableWebMvc</span></em>
<em><span class="hl-annotation" style="color: gray">@Configuration</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> WebConfig <span class="hl-keyword">extends</span> WebMvcConfigurerAdapter {

    <em><span class="hl-annotation" style="color: gray">@Override</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> addResourceHandlers(ResourceHandlerRegistry registry) {
        registry.addResourceHandler(<span class="hl-string">"/resources/**"</span>)
                .addResourceLocations(<span class="hl-string">"/"</span>, <span class="hl-string">"classpath:/META-INF/public-web-resources/"</span>);
    }

}</pre>

<p>And in XML:</p>
<pre class="programlisting"><span class="hl-tag">&lt;mvc:resources</span> <span class="hl-attribute">mapping</span>=<span class="hl-value">"/resources/**"</span> <span class="hl-attribute">location</span>=<span class="hl-value">"/, classpath:/META-INF/public-web-resources/"</span><span class="hl-tag">/&gt;</span></pre>

<p>When serving resources that may change when a new version of the application is
deployed it is recommended that you incorporate a version string into the mapping
pattern used to request the resources so that you may force clients to request the
newly deployed version of your application&#8217;s resources. Support for versioned URLs is
built into the framework and can be enabled by configuring a resource chain
on the resource handler. The chain consists of one more <code class="literal">ResourceResolver</code>
instances followed by one or more <code class="literal">ResourceTransformer</code> instances. Together they
can provide arbitrary resolution and transformation of resources.</p>
<p>The built-in <code class="literal">VersionResourceResolver</code> can be configured with different strategies.
For example a <code class="literal">FixedVersionStrategy</code> can use a property, a date, or other as the version.
A <code class="literal">ContentVersionStrategy</code> uses an MD5 hash computed from the content of the resource
(known as "fingerprinting" URLs).</p>
<p><code class="literal">ContentVersionStrategy</code> is a good default choice to use except in cases where
it cannot be used (e.g. with JavaScript module loaders). You can configure
different version strategies against different patterns as shown below. Keep in mind
also that computing content-based versions is expensive and therefore resource chain
caching should be enabled in production.</p>
<p>Java config example;</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Configuration</span></em>
<em><span class="hl-annotation" style="color: gray">@EnableWebMvc</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> WebConfig <span class="hl-keyword">extends</span> WebMvcConfigurerAdapter {

    <em><span class="hl-annotation" style="color: gray">@Override</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> addResourceHandlers(ResourceHandlerRegistry registry) {
        registry.addResourceHandler(<span class="hl-string">"/resources/**"</span>)
                .addResourceLocations(<span class="hl-string">"/public-resources/"</span>)
                .resourceChain(true).addResolver(
                    <span class="hl-keyword">new</span> VersionResourceResolver().addContentVersionStrategy(<span class="hl-string">"/**"</span>));
    }

}</pre>

<p>XML example:</p>
<pre class="programlisting"><span class="hl-tag">&lt;mvc:resources</span> <span class="hl-attribute">mapping</span>=<span class="hl-value">"/resources/**"</span> <span class="hl-attribute">location</span>=<span class="hl-value">"/public-resources/"</span><span class="hl-tag">&gt;</span>
	<span class="hl-tag">&lt;mvc:resource-chain&gt;</span>
		<span class="hl-tag">&lt;mvc:resource-cache /&gt;</span>
		<span class="hl-tag">&lt;mvc:resolvers&gt;</span>
			<span class="hl-tag">&lt;mvc:version-resolver&gt;</span>
				<span class="hl-tag">&lt;mvc:content-version-strategy</span> <span class="hl-attribute">patterns</span>=<span class="hl-value">"/**"</span><span class="hl-tag">/&gt;</span>
			<span class="hl-tag">&lt;/mvc:version-resolver&gt;</span>
		<span class="hl-tag">&lt;/mvc:resolvers&gt;</span>
	<span class="hl-tag">&lt;/mvc:resource-chain&gt;</span>
<span class="hl-tag">&lt;/mvc:resources&gt;</span></pre>

<p>In order for the above to work the application must also
render URLs with versions. The easiest way to do that is to configure the
<code class="literal">ResourceUrlEncodingFilter</code> which wraps the response and overrides its <code class="literal">encodeURL</code> method.
This will work in JSPs, FreeMarker, Velocity, and any other view technology that calls
the response <code class="literal">encodeURL</code> method. Alternatively, an application can also inject and
use directly the <code class="literal">ResourceUrlProvider</code> bean, which is automatically declared with the MVC
Java config and the MVC namespace.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-default-servlet-handler" href="#mvc-default-servlet-handler"></a>16.16.8&nbsp;Falling Back On the "Default" Servlet To Serve Resources</h3></div></div></div>

<p>This allows for mapping the <code class="literal">DispatcherServlet</code> to "/" (thus overriding the mapping
of the container&#8217;s default Servlet), while still allowing static resource requests to be
handled by the container&#8217;s default Servlet. It configures a
<code class="literal">DefaultServletHttpRequestHandler</code> with a URL mapping of "/**" and the lowest priority
relative to other URL mappings.</p>
<p>This handler will forward all requests to the default Servlet. Therefore it is important
that it remains last in the order of all other URL <code class="literal">HandlerMappings</code>. That will be the
case if you use <code class="literal">&lt;mvc:annotation-driven&gt;</code> or alternatively if you are setting up your
own customized <code class="literal">HandlerMapping</code> instance be sure to set its <code class="literal">order</code> property to a value
lower than that of the <code class="literal">DefaultServletHttpRequestHandler</code>, which is <code class="literal">Integer.MAX_VALUE</code>.</p>
<p>To enable the feature using the default setup use:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Configuration</span></em>
<em><span class="hl-annotation" style="color: gray">@EnableWebMvc</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> WebConfig <span class="hl-keyword">extends</span> WebMvcConfigurerAdapter {

    <em><span class="hl-annotation" style="color: gray">@Override</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> configureDefaultServletHandling(DefaultServletHandlerConfigurer configurer) {
        configurer.enable();
    }

}</pre>

<p>Or in XML:</p>
<pre class="programlisting"><span class="hl-tag">&lt;mvc:default-servlet-handler/&gt;</span></pre>

<p>The caveat to overriding the "/" Servlet mapping is that the <code class="literal">RequestDispatcher</code> for the
default Servlet must be retrieved by name rather than by path. The
<code class="literal">DefaultServletHttpRequestHandler</code> will attempt to auto-detect the default Servlet for
the container at startup time, using a list of known names for most of the major Servlet
containers (including Tomcat, Jetty, GlassFish, JBoss, Resin, WebLogic, and WebSphere).
If the default Servlet has been custom configured with a different name, or if a
different Servlet container is being used where the default Servlet name is unknown,
then the default Servlet&#8217;s name must be explicitly provided as in the following example:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Configuration</span></em>
<em><span class="hl-annotation" style="color: gray">@EnableWebMvc</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> WebConfig <span class="hl-keyword">extends</span> WebMvcConfigurerAdapter {

    <em><span class="hl-annotation" style="color: gray">@Override</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> configureDefaultServletHandling(DefaultServletHandlerConfigurer configurer) {
        configurer.enable(<span class="hl-string">"myCustomDefaultServlet"</span>);
    }

}</pre>

<p>Or in XML:</p>
<pre class="programlisting"><span class="hl-tag">&lt;mvc:default-servlet-handler</span> <span class="hl-attribute">default-servlet-name</span>=<span class="hl-value">"myCustomDefaultServlet"</span><span class="hl-tag">/&gt;</span></pre>

</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-config-path-matching" href="#mvc-config-path-matching"></a>16.16.9&nbsp;Path Matching</h3></div></div></div>

<p>This allows customizing various settings related to URL mapping and path matching.
For details on the individual options check out the
<a class="ulink" href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/web/servlet/config/annotation/PathMatchConfigurer.html" target="_top">PathMatchConfigurer</a> API.</p>
<p>Below is an example in Java config:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Configuration</span></em>
<em><span class="hl-annotation" style="color: gray">@EnableWebMvc</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> WebConfig <span class="hl-keyword">extends</span> WebMvcConfigurerAdapter {

    <em><span class="hl-annotation" style="color: gray">@Override</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> configurePathMatch(PathMatchConfigurer configurer) {
        configurer
            .setUseSuffixPatternMatch(true)
            .setUseTrailingSlashMatch(false)
            .setUseRegisteredSuffixPatternMatch(true)
            .setPathMatcher(antPathMatcher())
            .setUrlPathHelper(urlPathHelper());
    }

    <em><span class="hl-annotation" style="color: gray">@Bean</span></em>
    <span class="hl-keyword">public</span> UrlPathHelper urlPathHelper() {
        <span class="hl-comment">//...</span>
    }

    <em><span class="hl-annotation" style="color: gray">@Bean</span></em>
    <span class="hl-keyword">public</span> PathMatcher antPathMatcher() {
        <span class="hl-comment">//...</span>
    }

}</pre>

<p>And the same in XML, use the <code class="literal">&lt;mvc:path-matching&gt;</code> element:</p>
<pre class="programlisting"><span class="hl-tag">&lt;mvc:annotation-driven&gt;</span>
    <span class="hl-tag">&lt;mvc:path-matching</span>
        <span class="hl-attribute">suffix-pattern</span>=<span class="hl-value">"true"</span>
        <span class="hl-attribute">trailing-slash</span>=<span class="hl-value">"false"</span>
        <span class="hl-attribute">registered-suffixes-only</span>=<span class="hl-value">"true"</span>
        <span class="hl-attribute">path-helper</span>=<span class="hl-value">"pathHelper"</span>
        <span class="hl-attribute">path-matcher</span>=<span class="hl-value">"pathMatcher"</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/mvc:annotation-driven&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"pathHelper"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.example.app.MyPathHelper"</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"pathMatcher"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.example.app.MyPathMatcher"</span><span class="hl-tag"> /&gt;</span></pre>

</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-config-advanced-java" href="#mvc-config-advanced-java"></a>16.16.10&nbsp;Advanced Customizations with MVC Java Config</h3></div></div></div>

<p>As you can see from the above examples, MVC Java config and the MVC namespace provide
higher level constructs that do not require deep knowledge of the underlying beans
created for you. Instead it helps you to focus on your application needs. However, at
some point you may need more fine-grained control or you may simply wish to understand
the underlying configuration.</p>
<p>The first step towards more fine-grained control is to see the underlying beans created
for you. In MVC Java config you can see the javadocs and the <code class="literal">@Bean</code> methods in
<code class="literal">WebMvcConfigurationSupport</code>. The configuration in this class is automatically imported
through the <code class="literal">@EnableWebMvc</code> annotation. In fact if you open <code class="literal">@EnableWebMvc</code> you can see
the <code class="literal">@Import</code> statement.</p>
<p>The next step towards more fine-grained control is to customize a property on one of the
beans created in <code class="literal">WebMvcConfigurationSupport</code> or perhaps to provide your own instance.
This requires two things&#8201;&#8212;&#8201;remove the <code class="literal">@EnableWebMvc</code> annotation in order to prevent
the import and then extend from <code class="literal">DelegatingWebMvcConfiguration</code>, a subclass of
<code class="literal">WebMvcConfigurationSupport</code>.
Here is an example:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Configuration</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> WebConfig <span class="hl-keyword">extends</span> DelegatingWebMvcConfiguration {

    <em><span class="hl-annotation" style="color: gray">@Override</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> addInterceptors(InterceptorRegistry registry){
        <span class="hl-comment">// ...</span>
    }

    <em><span class="hl-annotation" style="color: gray">@Override</span></em>
    <em><span class="hl-annotation" style="color: gray">@Bean</span></em>
    <span class="hl-keyword">public</span> RequestMappingHandlerAdapter requestMappingHandlerAdapter() {
        <span class="hl-comment">// Create or let "super" create the adapter</span>
        <span class="hl-comment">// Then customize one of its properties</span>
    }

}</pre>

<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>An application should have only one configuration extending <code class="literal">DelegatingWebMvcConfiguration</code>
or a single <code class="literal">@EnableWebMvc</code> annotated class, since they both register the same underlying
beans.</p>
<p>Modifying beans in this way does not prevent you from using any of the higher-level
constructs shown earlier in this section. <code class="literal">WebMvcConfigurerAdapter</code> subclasses and
<code class="literal">WebMvcConfigurer</code> implementations are still being used.</p>
</td></tr></table></div>

</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="mvc-config-advanced-xml" href="#mvc-config-advanced-xml"></a>16.16.11&nbsp;Advanced Customizations with the MVC Namespace</h3></div></div></div>

<p>Fine-grained control over the configuration created for you is a bit harder with the MVC
namespace.</p>
<p>If you do need to do that, rather than replicating the configuration it provides,
consider configuring a <code class="literal">BeanPostProcessor</code> that detects the bean you want to customize
by type and then modifying its properties as necessary. For example:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Component</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyPostProcessor <span class="hl-keyword">implements</span> BeanPostProcessor {

    <span class="hl-keyword">public</span> Object postProcessBeforeInitialization(Object bean, String name) <span class="hl-keyword">throws</span> BeansException {
        <span class="hl-keyword">if</span> (bean <span class="hl-keyword">instanceof</span> RequestMappingHandlerAdapter) {
            <span class="hl-comment">// Modify properties of the adapter</span>
        }
    }

}</pre>

<p>Note that <code class="literal">MyPostProcessor</code> needs to be included in an <code class="literal">&lt;component scan /&gt;</code> in order for
it to be detected or if you prefer you can declare it explicitly with an XML bean
declaration.</p>
</div>
</div>
</div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="spring-web.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="spring-web.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="view.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Part&nbsp;V.&nbsp;The Web&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;17.&nbsp;View technologies</td></tr></table></div></body></html>